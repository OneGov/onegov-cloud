<div metal:use-macro="layout.base" i18n:domain="onegov.org">
    <tal:b metal:fill-slot="title">
        ${title}
    </tal:b>
    <tal:b metal:fill-slot="content">
        <div class="row">
            <div class="small-12 columns" tal:define="upload_url layout.file_upload_url">
                <h2 i18n:translate="">Upload</h2>
                <tal:block metal:use-macro="layout.macros.dropzone" />
            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
                <h2 i18n:translate="">All Files</h2>

                <tal:b condition="not:count">
                    <p i18n:translate="">No files uploaded yet</p>
                </tal:b>

                <table tal:condition="count" class="files">
                    <tbody>
                        <tal:b repeat="(group, files) grouped">
                            <tr>
                                <th colspan="2">
                                    <span tal:condition="model.order_by == 'name'">
                                        ${group}
                                    </span>
                                    <a
                                        tal:condition="model.order_by != 'name'"
                                        href="${request.link(model.for_order('name'))}"
                                        i18n:translate>

                                        Name
                                    </a>
                                </th>
                                <th i18n:translate>
                                    Extension
                                </th>
                                <th i18n:translate>
                                    <span tal:condition="model.order_by == 'date'">
                                        ${group}
                                    </span>
                                    <a
                                        tal:condition="model.order_by != 'date'"
                                        href="${request.link(model.for_order('date'))}"
                                        i18n:translate>

                                        Upload Date
                                    </a>
                                </th>
                            </tr>

                            <tal:b tal:repeat="file files">
                                <tr id="${file.file_id}">
                                    <td class="file-link">
                                        ${structure: file(layout)}
                                    </td>
                                    <td class="file-toggle">
                                        <a id="button-${file.file_id}" data-toggle="#details-${file.file_id}" class="untoggled">
                                            <span i18n:translate class="show-for-sr">Show Details</span>
                                            <i class="fa fa-chevron-down" aria-hidden="true"></i>
                                        </a>
                                    </td>
                                    <td class="file-extension ${signed(file) and 'signed' or ''}">
                                        <span>
                                            ${extension(file)}
                                        </span>
                                    </td>
                                    <td class="file-date">
                                        ${format_date(file.upload_date)}
                                    </td>
                                </tr>
                                <tr id="details-${file.file_id}" class="file-details" style="display: none;">
                                    <td colspan="4">
                                        <div
                                            id="ic-${file.file_id}"
                                            ic-trigger-from="#button-${file.file_id}"
                                            ic-trigger-on="click once"
                                            ic-get-from="${actions_url(file.file_id)}"
                                            >
                                        </div>
                                    </td>
                                </tr>
                                <tr style="display: none"></tr> <!--! keeps odd/even shading on track -->

                            </tal:b>

                            <tr tal:condition="len(files) % 2 == 0" style="height: 0;"></tr>
                        </tal:b>
                    </tbody>
                </table>
            </div>
        </div>
    </tal:b>
</div>
