<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      i18n:domain="onegov.org">
<body>

<metal:b define-macro="favicon">
    <!--! To be overridden by other applications -->
</metal:b>

<metal:b define-macro="before_directory_entry_lead">
    <!--! To be override by other applications -->
</metal:b>

<metal:b define-macro="consume_messages" i18n:domain="onegov.org">
    <div tal:repeat="message request.consume_messages()" data-alert class="alert-box ${message.type}">
        ${message.text}
        <a href="#" class="close">&times;</a>
      </div>
</metal:b>

<metal:navigation define-macro="top_navigation">
    <div class="main-navigation" tal:define="links top_navigation|layout.top_navigation">
        <nav class="top-bar" data-topbar role="navigation" tal:condition="links">
            <ul class="title-area">
                <!--! this section needs to be included (even though it's empty),
                or the responsive menu bar icon won't be rendered -->
                <li class="name" style="width: 0;"></li>
                <li class="toggle-topbar menu-icon">
                    <a href="#"><span>Menu</span></a>
                </li>
            </ul>
            <section class="top-bar-section">
                <ul class="left">
                    <li tal:repeat="link links" tal:content="structure link(layout)" />
                </ul>
            </section>
        </nav>
        <div class="clearfix"></div>
    </div>
</metal:navigation>

<metal:editbar define-macro="editbar">
    <div class="row" tal:condition="layout.editbar_links">
        <div class="small-12 columns">
            <div class="edit-bar clearfix">
                <tal:b repeat="group layout.editbar_links">
                    <tal:b condition="group.links|nothing" define="dropdown_id 'editbar-dropdown-{}'.format(repeat.group.number)">
                        <button href="#" data-dropdown="${dropdown_id}" class="${group.right_side and 'right-side'} tiny button dropdown">
                            ${group.title}
                        </button>
                        <ul id="${dropdown_id}" data-dropdown-content class="f-dropdown disable-scroll">
                            <li tal:repeat="link group.links">
                                <tal:b replace="structure link(layout)" />
                            </li>
                        </ul>
                    </tal:b>
                    <tal:b condition="group.url|group.attrs|nothing" define="link group">
                        <tal:b replace="structure link(layout, ('tiny', 'button'))" />
                    </tal:b>
                </tal:b>
            </div>
        </div>
    </div>
</metal:editbar>

<metal:breadcrumbs define-macro="breadcrumbs">
    <nav role="navigation" aria-label="You are here" i18n:attributes="aria-label">
        <ul class="breadcrumbs" tal:condition="layout.breadcrumbs">
            <tal:b repeat="link layout.breadcrumbs">
                <li tal:attributes="class repeat.link.end and 'current' or ''"
                    tal:content="structure link(layout)">
                </li>
            </tal:b>
        </ul>
    </nav>
</metal:breadcrumbs>

<metal:panel-links define-macro="panel-links">
    <ul class="panel-links">
        <li tal:repeat="link panel.links">
            <tal:b content="structure link(layout)" />
            <small>${link.subtitle}</small>
        </li>
    </ul>
</metal:panel-links>

<metal:footer define-macro="footer">
    <footer>
        <div class="row footer-content">
            <div class="small-12 columns">
                <metal:b use-macro="layout.macros['footer_columns']" />
                <metal:b use-macro="layout.macros['footer_links']" />
            </div>
        </div>
    </footer>
</metal:footer>

<metal:footer_columns define-macro="footer_columns">
    <tal:b define="contact layout.org.meta.contact_html|nothing;
                       contact_url layout.org.meta.contact_url|nothing;
                       opening_hours layout.org.meta.opening_hours_html|nothing;
                       opening_hours_url layout.org.meta.opening_hours_url|nothing;
                       facebook layout.org.meta.facebook_url|nothing;
                       twitter layout.org.meta.twitter_url|nothing;">
        <div class="row footer-columns" tal:condition="any((
            contact,
            contact_url,
            opening_hours,
            opening_hours_url,
            facebook,
            twitter
        ))">
            <div class="small-12 medium-3 columns">
                <metal:b use-macro="layout.macros['footer_contact']" />
            </div>

            <div class="small-12 medium-5 columns">
                <metal:b use-macro="layout.macros['footer_opening_hours']" />
            </div>

            <div class="small-12 medium-4 columns">
                <metal:b use-macro="layout.macros['footer_social_media']" />
            </div>
        </div>
    </tal:b>
</metal:footer_columns>

<metal:footer_links define-macro="footer_links">
    <div class="row footer-links">
      <div class="small-12 columns">
        <a href="https://www.onegovcloud.ch">OneGov Cloud</a>
        by
        <a href="https://www.seantis.ch">Seantis GmbH</a>
      </div>
    </div>
</metal:footer_links>

<metal:footer_contact define-macro="footer_contact" i18n:domain="onegov.org">
    <h2 i18n:translate tal:condition="contact or contact_url">Contact</h2>
    <div tal:content="structure layout.org.meta.contact_html" />
    <a i18n:translate tal:condition="contact_url" tal:attributes="href contact_url">more…</a>
</metal:footer_contact>

<metal:footer_opening_hours define-macro="footer_opening_hours" i18n:domain="onegov.org">
    <h2 i18n:translate tal:condition="opening_hours or opening_hours_url">Opening Hours</h2>
    <div tal:content="structure layout.org.meta.opening_hours_html" />
    <a i18n:translate tal:condition="opening_hours_url" tal:attributes="href opening_hours_url">more…</a>
</metal:footer_opening_hours>

<metal:footer_social_media define-macro="footer_social_media">
    <h2 i18n:translate tal:condition="facebook or twitter">Social Media</h2>

    <ul class="social-media-links" tal:condition="facebook or twitter">
        <li tal:condition="facebook">
            <a tal:attributes="href facebook">
                <i class="fa fa-facebook-official fa-fw"></i> Facebook
            </a>
        </li>
        <li tal:condition="twitter">
            <a tal:attributes="href twitter">
                <i class="fa fa-twitter fa-fw"></i> Twitter
            </a>
        </li>
    </ul>
</metal:footer_social_media>

<metal:footer_locales define-macro="footer_locales">
    <div class="footer-locales" tal:condition="layout.org.locales and len(layout.org.locales) > 1">
        <h2>Languages</h2>
        <div class="text-links">
            <tal:b repeat="(name, url) layout.locales">
                <a tal:condition="request.locale not in url" href="${url}">${name}</a>
                <a tal:condition="request.locale in url" style="cursor: default"><strong>${name}</strong></a>
            </tal:b>
        </div>
    </div>
</metal:footer_locales>

<metal:panel define-macro="events-panel">
    <h2 i18n:translate>Events</h2>
    <metal:b use-macro="layout.macros['panel-links']" tal:define="panel event_panel"/>
</metal:panel>

<metal:panel define-macro="directories-panel">
    <tal:b condition="directory_panel.links">
        <h2 i18n:translate>Directories</h2>
        <metal:b use-macro="layout.macros['panel-links']" tal:define="panel directory_panel" />
    </tal:b>
</metal:panel>

<metal:form define-macro="form">
    <form tal:attributes="action form.action|'.';data-image-upload-url layout.image_upload_json_url; data-image-list-url layout.image_list_url;data-file-upload-url layout.file_upload_json_url; data-file-list-url layout.file_list_url; data-sitecollection-url layout.sitecollection_url;" class="${form.css_class|''}" method="${form.method|'POST'}" enctype="multipart/form-data">
        <tal:b repeat="fieldset form.fieldsets">
            <fieldset tal:condition="fieldset.is_visible" id="fieldset-${fieldset.label.lower().replace(' ', '-')}">
                <legend>${fieldset.label}</legend>
                <div class="formfields">
                    <metal:fields use-macro="layout.macros['fields']" tal:define="fields fieldset.fields.values()" />
                    <div class="clearfix"></div>
                </div>
            </fieldset>
            <tal:b condition="not:fieldset.is_visible">
                <div class="formfields">
                    <metal:fields use-macro="layout.macros['fields']" tal:define="fields fieldset.fields.values()" />
                    <div class="clearfix"></div>
                </div>
            </tal:b>
        </tal:b>
        <tal:b condition="cancel|nothing">
            <a class="button secondary cancel-button" href="${cancel}" i18n:translate="" role="button">
                <tal:b condition="not:cancel_text|nothing">
                    Cancel
                </tal:b>
                <tal:b condition="cancel_text|nothing">
                    ${cancel_text}
                </tal:b>
            </a>
        </tal:b>
        <tal:b condition="not: button_text|nothing">
            <input type="submit" value="Submit" class="button" i18n:attributes="value">
        </tal:b>
        <tal:b condition="button_text|nothing">
            <input type="submit" value="${button_text}" class="button" role="button">
        </tal:b>
    </form>
</metal:form>

<metal:fields define-macro="fields">
    <tal:b repeat="field fields">
        <div tal:define="hidden form.is_hidden(field)|False" class="row field-${field.id} field-type-${field.type.lower()} ${hidden and 'field-hidden'}"><div class="large-12 columns">
        <tal:b define="input_type field.widget.input_type|None">
            <tal:b condition="input_type == 'hidden'">
                ${field()}
                <small class="error" tal:repeat="error field.errors">${error}</small>
            </tal:b>
            <tal:b condition="input_type != 'hidden'">
                <label tal:attributes="class field.errors and 'error' or None" tal:condition="not:field.contains_labels|nothing">
                    <metal:b use-macro="layout.macros['field']" />
                </label>

                <div tal:attributes="class field.errors and 'error group-label' or 'group-label'" tal:condition="field.contains_labels|nothing">
                    <metal:b use-macro="layout.macros['field']" />
                </div>
                <small class="error" tal:repeat="error field.errors">${error}</small>
            </tal:b>
        </tal:b>
    </div></div>
    </tal:b>
</metal:fields>

<metal:homepage-tiles define-macro="homepage-tiles" i18n:domain="onegov.org">
    <div tal:define="show_title show_title|nothing">
        <h2 i18n:translate class="${'' if show_title else 'show-for-sr'}">Selected Topics</h2>
        <div class="homepage-tiles">
            <div tal:repeat="tile tiles" class="homepage-tile" id="homepage-tile-${tile.number}">
                <a href="${tile.page.url}" class="tile-link">
                    <div class="tile-image"></div>
                    <h3>${tile.page.text}</h3>
                </a>
                <div class="child-links">
                    <tal:b repeat="link tile.links" tal:content="structure link(layout)" />
                </div>
            </div>
        </div>
    </div>
</metal:homepage-tiles>

<metal:single_field define-macro="field">
     <!--! render the label after the field if it's a boolean field -->
    <tal:b condition="field.type == 'BooleanField'">
        ${field(placeholder=request.translate(field.description))}
        <span class="label-text">${field.label.text}</span>
        <span class="label-required" tal:condition="field.flags.required|nothing">*</span>
    </tal:b>
    <tal:b condition="field.type != 'BooleanField'">
        <span class="label-text">${field.label.text}</span>
        <span class="label-required" tal:condition="field.flags.required|nothing">*</span>
        ${field(placeholder=request.translate(field.description))}
    </tal:b>
</metal:single_field>

<metal:upload define-macro="upload" i18n:domain="onegov.org">
    <form action="${upload_url}" class="upload" method="POST" enctype="multipart/form-data">
        <div class="upload-dropzone dropzone" i18n:translate>
            Drop files to upload
        </div>

        <div class="upload-progress" metal:define-slot='upload-progress'></div>
        <div class="upload-filelist" metal:define-slot='upload-filelist'></div>

        <!--! fallback for integration tests -->
        <noscript>
            <input name="file" type="file" multiple />
            <input type="submit" value="Submit" class="button" i18n:attributes="value">
        </noscript>

    </form>
</metal:upload>

<metal:newslist define-macro="newslist" i18n:domain="onegov.org">
    <div class="newslist" tal:condition="news">
        <h2 i18n:translate tal:condition="not:hide_title|False">Latest news</h2>

        <div class="row news-list-item" tal:repeat="item news">
            <div class="small-12 columns">
                <a tal:attributes="href request.link(item)">
                    <h2 tal:condition="heading == 'h2'|True">${item.title} <metal:hint use-macro="layout.macros['hidden_from_public_hint']" /></h2>
                    <h3 tal:condition="heading == 'h3'|nothing">${item.title} <metal:hint use-macro="layout.macros['hidden_from_public_hint']" /></h3>
                </a>
                <p class="news-date" tal:condition="not:hide_date|False">${layout.format_date(item.created, 'relative')}</p>
                <p class="news-lead">${item.content.lead}</p>
            </div>
        </div>

        <h3 class="all-news" tal:condition="show_all_news_link|nothing">
            <a href="${layout.news_url}" i18n:translate>All news</a>
            <a href="${layout.newsletter_url}" i18n:translate>Newsletter</a>
        </h3>
    </div>
</metal:newslist>

<metal:hidden_page_hint define-macro="hidden_from_public_hint" i18n:domain="onegov.org">
    <tal:b condition="item.is_hidden_from_public|nothing">
        <i title="This site is hidden from the general public" i18n:attributes="title" class="hidden-from-public-hint"></i>
    </tal:b>
</metal:hidden_page_hint>

<metal:hidden_page_hint define-macro="hidden_from_public_hint_long" i18n:domain="onegov.org">
    <tal:b condition="item.is_hidden_from_public|nothing">
        <div class="row">
            <div class="small-12 columns">
                <div class="panel callout">
                    <p i18n:translate>
                    This site is hidden from the general public. To show it to
                    everyone, edit this page and disable "Hide from public".
                    </p>
                </div>
            </div>
        </div>
    </tal:b>
</metal:hidden_page_hint>

<metal:empty_lead_hint define-macro="empty_page_lead_hint" i18n:domain="onegov.org">
    <tal:b condition="not item.lead and request.is_manager|nothing">
        <div class="row">
            <div class="small-12 columns">
                <div class="panel callout">
                    <p i18n:translate>This site contains no lead. Leads are used for lists and search results.</p>
                </div>
            </div>
        </div>
    </tal:b>
</metal:empty_lead_hint>

<metal:page_content define-macro="page_content" i18n:domain="onegov.org">
    <div class="row" tal:define="show_side_panel show_side_panel|False; location location|False">
        <tal:b condition="not: people or contact or coordinates or location or show_side_panel">
            <div class="small-12 columns page-content-main">
                <div metal:define-slot="before-lead"></div>
                <span class="page-lead" tal:condition="lead" tal:content="lead" />
                <div metal:define-slot="after-lead"></div>

                <div class="page-text" tal:condition="text" tal:content="structure text" />
                <div metal:define-slot="after-text"></div>
            </div>
        </tal:b>
        <tal:b condition="people or contact or coordinates or show_side_panel">
            <div class="small-12 medium-8 columns page-content-main">
                <span class="page-lead" tal:condition="lead" tal:content="lead" />
                <div metal:define-slot="after-lead"></div>

                <div class="page-text" tal:condition="text" tal:content="structure text" />
                <div metal:define-slot="after-text"></div>
            </div>
            <div class="small-12 medium-4 columns page-content-sidebar" tal:condition="people or contact or coordinates or show_side_panel" tal:define="highlight_contacts highlight_contacts|True">
                <div metal:define-slot="before-panels"></div>
                <div class="side-panel without-title ${highlight_contacts and 'highlighted'}" tal:condition="contact or coordinates or location">
                    <tal:b condition="contact" content="structure contact" />
                    <br tal:condition="coordinates and contact" />
                    <h2 i18n:translate tal:condition="not contact">Map</h2>
                    <div tal:condition="coordinates" class="marker-map" data-map-type="thumbnail" data-lat="${coordinates.lat}" data-lon="${coordinates.lon}" data-zoom="${coordinates.zoom}" data-marker-icon="${marker_icon|nothing}" data-marker-color="${marker_color|nothing}"></div>
                    <div class="location" tal:condition="location">${location}</div>
                </div>
                <div class="side-panel people-panel" tal:condition="people">
                    <h2 i18n:translate>People</h2>
                    <ul class="panel-links" data-sortable data-sortable-url="${layout.move_person_url_template}">
                        <li tal:repeat="person people" data-sortable-id="${request.is_manager and person.id}">
                            <a href="${request.link(person)}">${person.title}</a>
                            <small>${person.context_specific_function}</small>
                        </li>
                    </ul>
                </div>
                <div metal:define-slot="after-panels"></div>
            </div>
        </tal:b>
    </div>
</metal:page_content>

<metal:display_form define-macro="display_form" i18n:domain="onegov.org">
    <div tal:condition="form" tal:repeat="fieldset form.fieldsets">
        <tal:b define="fields fieldset.non_empty_fields" condition="fields">
            <h2 tal:condition="fieldset.is_visible">${fieldset.label}</h2>
            <metal:b use-macro="layout.macros['display_fields']" tal:define="fields fields.values()">
        </tal:b>
    </div>
    <tal:b condition="price|nothing">
        <dl class="field-display">
            <dt i18n:translate>Total Amount</dt>
            <dd><metal:b use-macro="layout.macros['price']" /></dd>
        </dl>
    </tal:b>
</metal:display_form>

<metal:display_field define-macro="display_fields" i18n:domain="onegov.org">
    <dl class="field-display" tal:repeat="field fields" tal:define="allow_downloads allow_downloads|request.is_manager; allow_views allow_views|False">
        <tal:b define="rendered layout.render_field(field)|nothing" condition="rendered">
            <dt>${field.label.text}</dt>
            <dd>
                <tal:b condition="(allow_downloads or allow_views) and field.type == 'UploadField'">
                    <tal:b define="url layout.field_download_link(field)">
                        <a href="${url}" tal:condition="not allow_views or not field.is_image">
                            <tal:b replace="structure rendered" />
                        </a>
                        <img src="${url}" tal:condition="allow_views and field.is_image" alt="" />
                    </tal:b>
                </tal:b>
                <tal:b condition="not (allow_downloads or allow_views) or field.type != 'UploadField'">
                    <tal:b replace="structure rendered" />
                </tal:b>
            </dd>
        </tal:b>
        <div class="clearfix"></div>
    </dl>
</metal:display_field>

<metal:price define-macro="price">
    ${layout.format_number(price.net_amount)} ${price.currency}
    <tal:b condition="price.fee and show_fee|nothing">
        (+ ${layout.format_number(price.fee)} <tal:b i18n:translate>Credit Card Fee</tal:b>)
    </tal:b>
</metal:price>

<metal:person_card define-macro="person_list_card" i18n:domain="onegov.org">
    <div class="person-card person-list-card" tal:define="link request.link(person); exclude request.app.org.excluded_person_fields(request)">
        <a href="${link}" aria-hidden="true" tal:define="url (person.picture_url and layout.thumbnail_url(person.picture_url))">
            <div class="person-card-portrait">
                <i class="fa fa-user" tal:condition="not:url"></i>
                <div class="cover-image" tal:condition="url" style='background-image: url("${url}");'></div>
            </div>
        </a>
        <ul>
            <li class="person-card-title">
                <a href="${link}">
                    <span>${person.title}</span>
                </a>
            </li>
            <li tal:condition="person.function" class="person-card-function">
                <em>${person.function}</em>
            </li>
            <li tal:condition="person.email and 'email' not in exclude" class="person-card-email">
                <a href="mailto:${person.email}">${person.email}</a>
            </li>
            <li tal:condition="person.phone and 'phone' not in exclude" class="person-card-phone">
                <a href="tel:${person.phone}">${person.phone}</a>
            </li>
        </ul>
        <div class="clearfix"></div>
    </div>
</metal:person_card>

<metal:person_card define-macro="person_card" i18n:domain="onegov.org">
    <div class="person-card person-single-item" tal:define="exclude request.app.org.excluded_person_fields(request)">
        <div class="row">
            <div class="columns small-12 medium-4 large-3">
                <div aria-hidden="true" tal:define="url person.picture_url">
                    <div class="person-card-portrait">
                        <i class="fa fa-user" tal:condition="not:url"></i>
                        <div class="cover-image" tal:condition="url" style='background-image: url("${url}");'></div>
                    </div>
                </div>
            </div>
            <div class="columns small-12 medium-8 large-9">
                <ul>
                    <li tal:condition="person.function" class="person-card-function">
                        <em>${person.function}</em>
                    </li>
                    <li class="person-card-personal">
                        <span tal:condition="person.born and 'born' not in exclude">${person.born}</span>
                        <span tal:condition="person.academic_title and 'academic_title' not in exclude">${person.academic_title}</span>
                        <span tal:condition="person.profession and 'profession' not in exclude">${person.profession}</span>
                        <span tal:condition="person.political_party and 'political_party' not in exclude">${person.political_party}</span>
                    </li>
                    <li tal:condition="person.address and 'address' not in exclude" class="person-card-address">
                        <span>${person.address}</span>
                    </li>
                    <li tal:condition="person.email and 'email' not in exclude" class="person-card-email">
                        <a href="mailto:${person.email}">${person.email}</a>
                    </li>
                    <li tal:condition="person.phone and 'phone' not in exclude" class="person-card-phone">
                        <a href="tel:${person.phone}">${person.phone}</a>
                    </li>
                    <li tal:condition="person.phone_direct and 'phone_direct' not in exclude" class="person-card-phone-direct">
                        <a href="tel:${person.phone_direct}">${person.phone_direct}</a>
                    </li>
                    <li tal:condition="person.website and 'website' not in exclude" class="person-card-website">
                        <a href="${person.website}">${person.website}</a>
                    </li>
                    <li class="person-card-notes" tal:condition="person.notes and 'notes' not in exclude">
                        <span>${person.notes}</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</metal:person_card>

<metal:sidebar define-macro="sidebar" i18n:domain="onegov.org">
    <nav role="navigation">
        <ul class="side-nav" data-sortable data-sortable-url="${layout.sortable_url_template}">
            <tal:b repeat="link layout.sidebar_links">
                <li tal:define="is_group hasattr(link, 'links')" class="${is_group and 'active' or ''}" data-sortable-id="${request.is_manager and link.model.id}">
                    <tal:b condition="not:is_group" replace="structure link(layout)" />
                    <tal:b condition="is_group">
                        <a href="#" class="group-title">${link.title}
                            <metal:b use-macro="layout.macros['hidden_from_public_hint']" tal:define="item link"/>
                        </a>
                        <ul class="children" tal:condition="link.links"
                            data-sortable data-sortable-url="${layout.sortable_url_template}">
                            <li tal:repeat="child link.links" data-sortable-id="${request.is_manager and child.model.id}">
                                <tal:b replace="structure child(layout)" />
                            </li>
                        </ul>
                    </tal:b>
                </li>
            </tal:b>
        </ul>
    </nav>
</metal:sidebar>

<metal:ticket_status define-macro="ticket_status" i18n:domain="onegov.org">
    <div i18n:translate tal:condition="ticket.state == 'open'" class="ticket-state-open">
        Open
    </div>
    <div i18n:translate tal:condition="ticket.state == 'pending'" class="ticket-state-pending">
        Pending
    </div>
    <div i18n:translate tal:condition="ticket.state == 'closed'" class="ticket-state-closed">
        Closed
    </div>
</metal:ticket_status>

<metal:payment_status define-macro="payment_status" i18n:domain="onegov.org">
    <div i18n:translate tal:condition="payment.state == 'open'" class="payment-state payment-state-open">
        Open
    </div>
    <div i18n:translate tal:condition="payment.state == 'paid'" class="payment-state payment-state-paid">
        Paid
    </div>
    <div i18n:translate tal:condition="payment.state == 'failed'" class="payment-state payment-state-failed">
        Failed
    </div>
    <div i18n:translate tal:condition="payment.state == 'cancelled'" class="payment-state payment-state-cancelled">
        Refunded
    </div>
</metal:payment_status>

<metal:payment_status define-macro="payment_source" i18n:domain="onegov.org">
    <div i18n:translate tal:condition="payment.source == 'manual'">
        Manual
    </div>
    <div tal:condition="payment.source == 'stripe_connect'">
        <a href="${payment.remote_url}">
            Stripe Connect
        </a>
    </div>
</metal:payment_status>

<metal:ticket_callout define-macro="ticket_callout" i18n:domain="onegov.org">
    <div class="borderless-side-panel" tal:condition="ticket">
        <h2 i18n:translate>Ticket</h2>
        <div class="ticket-number"><a href="${request.link(ticket)}">${ticket.number}</a></div>
    </div>
</metal:ticket_callout>

<metal:pagination define-macro="pagination" i18n:domain="onegov.org">
    <ul class="pagination" role="menubar" aria-label="Pagination" tal:condition="collection.pages_count > 1">
        <tal:b repeat="page collection.pages">
            <tal:b define="
                previous current_page.previous;
                next current_page.next;
                is_current current_page == page;
                is_visible abs(current_page.page-page.page) < 6;
            ">
                <tal:b condition="repeat.page.start and previous">
                    <li class="arrow">
                        <a href="${request.link(previous)}" aria-label="Previous Page" i18n:attributes="aria-label"><i class="fa fa-chevron-left"></i></a>
                    </li>
                </tal:b>

                <li tal:condition="is_visible" class="${is_current and 'current' or ''}">
                    <a href="${request.link(page)}">${page.page + 1}</a>
                </li>

                <tal:b condition="repeat.page.end and next">
                    <li class="arrow">
                        <a href="${request.link(next)}" aria-label="Next Page" i18n:attributes="aria-label"><i class="fa fa-chevron-right"></i></a>
                    </li>
                </tal:b>
            </tal:b>
        </tal:b>
    </ul>
</metal:pagination>

<metal:reservations define-macro="reservation-infos" i18n:domain="onegov.org">
    <div tal:condition="reservation_infos" tal:define="failed failed_reservations|set()" class="reservation-selection large">
        <div class="reservation-selection-inner">
            <ul>
                <li class="${info.reservation.id in failed and 'reservation failed' or 'reservation'}" tal:repeat="info reservation_infos">
                    <span class="reservation-date" data-quota="${info.reservation.quota}">
                        ${layout.format_date(info.reservation.display_start(), 'weekday_long')},
                        ${layout.format_date(info.reservation.display_start(), 'date_long')}
                    </span>
                    <span class="reservation-time">
                        ${info.time}
                    </span>
                    <span class="reservation-price" tal:condition="info.price">
                        ${'{:.2f}'.format(info.price.amount)} ${info.price.currency}
                    </span>
                </li>
            </ul>
        </div>
    </div>
</metal:reservations>

<metal:reservations define-macro="reservations" i18n:domain="onegov.org">
    <ul tal:condition="reservations" class="reservations">
        <li tal:repeat="reservation reservations">
            <tal:b define="start reservation.display_start(); end reservation.display_end()">
                <strong>
                    ${layout.format_date(start, 'weekday_long')},
                    ${layout.format_date(start, 'date_long')}
                </strong>
                <!--! simple whole day check: -->
                <span tal:condition="start.time() != end.time()">
                    <br>
                    ${layout.format_time_range(start, end)}
                </span>
                <br><span i18n:translate>Quota</span>
                <span>
                    ${reservation.quota}
                </span>
            </tal:b>
        </li>
    </ul>
</metal:reservations>

<metal:display_event define-macro="display_event" i18n:domain="onegov.org">
    <dl>
        <tal:b condition="request.is_manager">
            <dt i18n:translate>State</dt>
            <dd i18n:translate tal:condition="event.state == 'initiated'">Initiated</dd>
            <dd i18n:translate tal:condition="event.state == 'submitted'">Submitted</dd>
            <dd i18n:translate tal:condition="event.state == 'published'">Published</dd>
            <dd i18n:translate tal:condition="event.state == 'withdrawn'">Withdrawn</dd>

            <tal:b define="submitter event.meta.get('submitter_email') if event.meta else ''">
                <dt i18n:translate>Submitter</dt>
                <dd>${submitter}</dd>
            </tal:b>
        </tal:b>

        <dt i18n:translate>Title</dt>
        <dd>${event.title}</dd>

        <dt i18n:translate>Description</dt>
        <dd tal:content="structure event.description.replace('\n', '<br>')" />

        <tal:b condition="event.image">
            <dt i18n:translate>Image</dt>
            <dd>
                <img src="${request.link(event.image)}">
            </dd>
        </tal:b>

        <dt i18n:translate>Location</dt>
        <dd>${event.location}</dd>

        <tal:b condition="event.coordinates">
            <dt i18n:translate>Map</dt>
            <dd>
                <div class="marker-map" data-map-type="thumbnail" data-lat="${event.coordinates.lat}" data-lon="${event.coordinates.lon}" data-zoom="${event.coordinates.zoom}"></div>
            </dd>
        </tal:b>

        <tal:b condition="event.organizer">
            <dt i18n:translate>Organizer</dt>
            <dd tal:content="event.organizer" />
        </tal:b>

        <tal:b condition="event.tags">
            <dt i18n:translate>Tags</dt>
            <dd>
                <ul class="no-margin-bottom">
                    <li tal:repeat="tag event.tags" i18n:translate>${tag}</li>
                </ul>
            </dd>
        </tal:b>

        <dt i18n:translate>Date and time</dt>
        <dd>
            ${layout.format_date(event.localized_start, 'event')},
            ${layout.format_time_range(event.localized_start, event.localized_end)}
        </dd>

        <!-- we can have reucrrences which we do not display, therefore we check the displayed value -->
        <tal:b define="recurrence event.recurrence and layout.format_recurrence(event.recurrence)" condition="recurrence">
            <dt i18n:translate>Recurrence</dt>
            <dd>${recurrence}</dd>
        </tal:b>

        <tal:b define="dates event.occurrence_dates(localize=True)" condition="len(dates) > 1">
            <dt i18n:translate>All dates</dt>
            <dd tal:define="occurrences event.occurrence_dates(localize=True)">
                <ul>
                    <li tal:repeat="occurrence occurrences">${layout.format_date(occurrence, 'weekday_long')} ${layout.format_date(occurrence, 'date')}</li>
                </ul>
            </dd>
        </tal:b>
    </dl>
</metal:display_event>

<metal:atoz define-macro="atoz" i18n:domain="onegov.org">
    <div class="atoz-block" tal:repeat="item items">
        <h2>${item[0]}</h2>
        <ul>
            <li tal:repeat="detail item[1]">
                <div metal:define-slot="item-detail">
                    <a href="${request.link(detail)}">${detail.title}</a>
                    <metal:hint tal:define="item detail" use-macro="layout.macros['hidden_from_public_hint']" />
                </div>
            </li>
        </ul>
    </div>
</metal:atoz>

<metal:calendar_day define-macro="calendar-day" i18n:domain="onegov.org">
    <h2 class="calendar-day">
        <metal:b use-macro="layout.macros['calendar-day-content']" />
    </h2>
</metal:calendar_day>

<metal:calendar_day_box define-macro="calendar-day-content" i18n:domain="onegov.org">
    <a href="${link|nothing}" tal:condition="image|nothing"
        class="calendar-day-thumbnail"
        style="background-image: url(${request.link(image, name='thumbnail')});">
    </a>

    <a href="${link|nothing}" tal:condition="not:image|nothing" class="calendar-day-thumbnail">
        <i class="fa fa-calendar-o" aria-hidden="true"></i>
    </a>

    <div class="calendar-day-date">
        <div class="weekday">${layout.format_date(date, 'weekday_short').rstrip('.')}</div>
        <div class="date">${date.day}. ${layout.format_date(date, 'month_long')}</div>
    </div>
</metal:calendar_day_box>

<metal:occurrences define-macro="occurrences" i18n:domain="onegov.org">
    <tal:b repeat="occurrence occurrences">
        <div class="row">
            <div class="occurrence">
                <div class="large-3 medium-4 small-12 columns">
                    <metal:b
                        tal:define="
                            date occurrence.localized_start;
                            image occurrence.event.image;
                            link request.link(occurrence)
                        "
                        use-macro="layout.macros['calendar-day']"
                    />
                </div>
                <div class="large-9 medium-8 small-12 columns">
                    <h3><a href="${request.link(occurrence)}">${occurrence.title}</a></h3>
                    <div class="occurrence-date show-for-sr">${layout.format_date(occurrence.localized_start, 'date')}</div>
                    <div class="occurrence-location">${occurrence.location}</div>
                    <div class="occurrence-time" tal:define="time layout.format_time_range(occurrence.localized_start, occurrence.localized_end)">
                        ${time[0].upper()}${time[1:]}
                    </div>
                    <div><span tal:repeat="tag occurrence.tags" class="blank-label" i18n:translate>${tag}</span></div>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
    </tal:b>

    <div tal:condition="not occurrences" i18n:translate>No events found.</div>
</metal:occurrences>

<metal:date_range_selector define-macro="date-range-selector" i18n:domain="onegov.org">
    <div class="date-range-selector">
        <form action="" method="GET">
            <div metal:define-slot="before-date-range"></div>

            <div class="row date-range-selector">
                <div class="large-6 columns">
                    <div class="row collapse">
                        <label i18n:translate>From</label>
                        <input class="small" name="start" type="date" value="${start}" placeholder="${layout.today().isoformat()}">
                    </div>
                </div>
                <div class="large-6 columns">
                    <div class="row collapse">
                        <label i18n:translate>To</label>
                        <input class="small" name="end" type="date" value="${end}" placeholder="${layout.today().isoformat()}">
                    </div>
                </div>
            </div>
            <noscript>
                <div class="row">
                    <div class="large-6 columns">
                        <div class="row collapse">
                            <input type="submit" value="Filter by date" class="button" i18n:attributes="value">
                        </div>
                    </div>
                </div>
            </noscript>
        </form>
    </div>
</metal:date_range_selector>

<metal:role_singular define-macro="role-singular" i18n:domain="onegov.org">
    <tal:b switch="role">
        <tal:b case="'admin'" i18n:translate>Administrator</tal:b>
        <tal:b case="'editor'" i18n:translate>Editor</tal:b>
        <tal:b case="'member'" i18n:translate>Member</tal:b>
    </tal:b>
</metal:role_singular>

<metal:role_plural define-macro="role-plural" i18n:domain="onegov.org">
    <tal:b switch="role">
        <tal:b case="'admin'" i18n:translate>Administrators</tal:b>
        <tal:b case="'editor'" i18n:translate>Editors</tal:b>
        <tal:b case="'member'" i18n:translate>Members</tal:b>
    </tal:b>
</metal:role_plural>

<metal:identicon define-macro="identicon" i18n:domain="onegov.org">
    <tal:b define="identicon_size size|'small'">
        <span class="user-initials-${identicon_size}" style="background-color: ${layout.get_user_color(username)}" title="${username}">
            ${initials}
        </span>
    </tal:b>
</metal:identicon>

<metal:photoswipe define-macro="photoswipe" i18n:domain="onegov.org">
    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="pswp__bg"></div>
        <div class="pswp__scroll-wrap">

            <div class="pswp__container">
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
            </div>

            <div class="pswp__ui pswp__ui--hidden">

                <div class="pswp__top-bar">

                    <div class="pswp__counter"></div>

                    <button class="pswp__button pswp__button--close" title="Close (Esc)" i18n:attributes="title"></button>
                    <button class="pswp__button pswp__button--share" title="Share" i18n:attributes="title"></button>
                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen" i18n:attributes="title"></button>
                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out" i18n:attributes="title"></button>

                    <div class="pswp__preloader">
                        <div class="pswp__preloader__icn">
                          <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                          </div>
                        </div>
                    </div>
                </div>

                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                    <div class="pswp__share-tooltip"></div>
                </div>

                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
                </button>

                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
                </button>

                <div class="pswp__caption">
                    <div class="pswp__caption__center"></div>
                </div>

            </div>
        </div>
    </div>
</metal:photoswipe>


<metal:slider define-macro="slider" i18n:domain="onegov.org">
    <ul tal:condition="images" class="slider" data-orbit="" data-options="slide_number:false; bullets:false; pause_on_hover:false; timer_speed: 7500;">
        <li tal:repeat="image images" style="background: url('${image.src}') no-repeat center;">
            <div class="orbit-caption" tal:condition="image.note">
                ${image.note}
            </div>
        </li>
    </ul>
    <div class="slider no-images" tal:condition="not images and request.is_manager">
        <tal:b i18n:translate>
            This space holds images from your photo-albums. To show photos add a few
            photos to an album and mark it as available for the homepage.
        </tal:b>
    </div>
</metal:slider>


<metal:search_result_users define-macro="search_result_users" i18n:domain="onegov.org">
    <a href="${request.return_here(request.link(result))}">${result.title}</a>
    <ul>
        <li>${translate(result.role.capitalize())}</li>
    </ul>
</metal:search_result_users>


<metal:search_result_files define-macro="search_result_files" i18n:domain="onegov.org">
    <a href="${request.return_here(request.link(result))}">${result.name}</a>
    <ul>
        <li>
            <tal:b condition="result.signed">
                <span i18n:translate>Digitally signed</span>,
            </tal:b>
            <span>
                <tal:b i18n:translate tal:condition="result.stats.get('pages', 0) == 1">
                    <tal:b i18n:name="count">${result.stats.get('pages', 0)}</tal:b> page
                </tal:b>

                <tal:b i18n:translate tal:condition="result.stats.get('pages', 0) > 1">
                    <tal:b i18n:name="count">${result.stats.get('pages', 0)}</tal:b> pages
                </tal:b>
            </span>
        </li>
    </ul>
</metal:search_result_files>


<metal:search_result_tickets define-macro="search_result_tickets" i18n:domain="onegov.org">
    <a href="${request.link(result)}">${result.number}</a>
    <ul>
        <li>${translate(result.group)}</li>
        <li tal:content="structure result.title"></li>
        <li tal:content="structure result.subtitle"></li>
    </ul>
</metal:search_result_tickets>


<metal:search_result_events define-macro="search_result_events" i18n:domain="onegov.org">
    <a href="${request.link(result, 'latest')}">${result.title}</a>
    <ul tal:define="occurrence result.latest_occurrence">
        <li tal:condition="occurrence">${
            '-'.join((
                layout.format_date(occurrence.localized_start, 'event'),
                layout.format_date(occurrence.localized_end, 'time')
            ))
        }</li>
        <li tal:condition="result.location">${result.location}</li>
    </ul>
</metal:search_result_events>


<metal:search_result_people define-macro="search_result_people" i18n:domain="onegov.org">
    <a href="${request.link(result)}">${result.title}</a>
    <p tal:condition="result.function|nothing">${result.function}</p>
    <p tal:condition="not:result.function|nothing" i18n:translate>People</p>
</metal:search_result_people>


<metal:search_result_default define-macro="search_result_default" i18n:domain="onegov.org">
    <a href="${request.link(result)}">${result.title}</a>
    <tal:b condition="result.lead">
        ${result.lead[:160]}<tal:b condition="len(result.lead) > 160">…</tal:b>
    </tal:b>
</metal:search_result_default>


<metal:ticket_status_page_message define-macro="ticket_status_page_message" i18n:domain="onegov.org">
    <p i18n:translate tal:condition="ticket.state == 'open'">
        Your request will be processed shortly. To see the state of
        your process your may return to this page at any time.

        All information on this page has been sent to your e-mail address.
    </p>
    <p i18n:translate tal:condition="ticket.state == 'closed'">
        Your request has been completed. If you asked for documents to be
        sent to your address, they should arrive shortly. If you asked to
        pick up documents at the municipality, the are now ready to be
        picked up.
    </p>
</metal:ticket_status_page_message>


<metal:checkout_form define-macro="checkout_form" i18n:domain="onegov.org">
    <form action="${complete_link}" method="POST" class="checkout">
        <dl class="field-display" tal:condition="show_privacy_settings|nothing">
            <dt i18n:translate>Privacy</dt>
            <dd>
                <label class="common-text">
                    <input type="checkbox" name="send_by_email" value="yes" checked>
                    <span class="label-text" i18n:translate style="max-width: 100%">
                        Send me my entered data by e-mail.
                    </span>
                </label>
            </dd>
        </dl>

        <tal:b condition="price" switch="payment_method">
            <tal:b case="'manual'">
                <label style="display: none;">
                    <input type="radio" name="payment_method" value="manual" checked>
                </label>
            </tal:b>
            <tal:b case="'cc'">
                <label style="display: none;">
                    <input type="radio" name="payment_method" value="online" checked>
                </label>
            </tal:b>
            <tal:b case="'free'">
                <div class="field-display">
                    <div class="field-display-block">
                        <div class="field-display-label" i18n:translate>Payment</div>
                        <div class="field-display-data">
                            <label class="common-text">
                                <input type="radio" name="payment_method" value="online" checked>
                                <span>
                                    <tal:b i18n:translate>Pay Online Now</tal:b>
                                    <tal:b tal:condition="price.fee|nothing">
                                        (+ ${layout.format_number(price.fee)} ${price.currency} <tal:b i18n:translate>Credit Card Fee</tal:b>)
                                    </tal:b>
                                </span>
                            </label>
                            <label class="common-text">
                                <input type="radio" name="payment_method" value="manual">
                                <span i18n:translate>Pay Offline later</span>
                            </label>
                        </div>
                    </div>
                </div>
            </tal:b>

            <div data-depends-on="payment_method/online">
                <tal:b replace="structure checkout_button" />
                <metal:b define-slot="after-submit" />
            </div>
            <div data-depends-on="payment_method/manual">
                <input type="submit" value="Complete" class="button" i18n:attributes="value">
                <metal:b define-slot="after-submit" />
            </div>
        </tal:b>

        <tal:b condition="not price">
            <input type="submit" value="Complete" class="button" i18n:attributes="value">
            <metal:b define-slot="after-submit" />
        </tal:b>
    </form>
</metal:checkout_form>

<metal:tags define-macro="tags">
    <ul class="tags">
        <li tal:repeat="link tags" class="click-through">
            <span tal:content="structure link(layout)"
                class="${link.active and 'active'} blank-label ${getattr(link, 'rounded', None) and 'rounded'}"
            />
        </li>
    </ul>
</metal:tags>

<metal:generic_message define-macro="generic_message" i18n:domain="onegov.org">
    <div class="title">
        <metal:b define-slot="title" />
    </div>
    <div class="identicon">
        <metal:b use-macro="layout.macros.identicon"
                 tal:define="
                    initials owner.initials;
                    username owner.username;
                    size 'large';
                "
        />
    </div>
    <div class="timestamp">
        <b>${owner.name}</b>
        <tal:b i18n:translate>
            at <tal:b i18n:name="time">${layout.format_date(model.created, 'time')}</tal:b>
        </tal:b>
    </div>
    <div class="text">
        <metal:b define-slot="text" />
    </div>
    <div class="actions">
        <metal:b define-slot="actions" />
    </div>
</metal:generic_message>

<metal:payment_link_fallback define-macro="payment_link_fallback" i18n:domain="onegov.org">
    <!--! pass -->
</metal:payment_link_fallback>

<metal:payments define-macro="payments" i18n:domain="onegov.org">
    <table class="payments-table" tal:condition="payments">
        <thead>
            <tr>
                <th i18n:translate tal:condition="payment_links|nothing">
                    Object
                </th>
                <th i18n:translate>
                    Net Amount
                </th>
                <th i18n:translate>
                    Fee
                </th>
                <th i18n:translate>
                    Payment Provider
                </th>
                <th i18n:translate>
                    State
                </th>
                <th i18n:translate>
                    Created
                </th>
                <th i18n:translate>
                    Disbursed
                </th>
                <th tal:condition="payment_actions|nothing"></th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="payment payments">
                <td tal:condition="payment_links|nothing">
                    <tal:b repeat="link payment_links[payment.id]">
                        <tal:b switch="link.__tablename__">
                            <tal:b case="'submissions'">
                                <tal:b define="ticket get_ticket(link)">
                                    <div>
                                        <a href="${request.link(ticket)}">
                                            <strong>${ticket.number}</strong> - ${ticket.group}
                                        </a>
                                        <div>
                                            ${link.title}
                                        </div>
                                    </div>
                                </tal:b>
                            </tal:b>
                            <tal:b case="'reservations'" condition="repeat.link.start">
                                <tal:b define="ticket get_ticket(link)">
                                    <div>
                                        <a href="${request.link(ticket)}">
                                            <strong>${ticket.number}</strong> - ${ticket.group}
                                        </a>
                                        <div>
                                            ${link.title}
                                        </div>
                                    </div>
                                </tal:b>
                            </tal:b>
                            <tal:b case="default">
                                <metal:b use-macro="layout.macros['payment_link_fallback']" />
                            </tal:b>
                        </tal:b>
                    </tal:b>
                </td>
                <td>${'{0:.2f}'.format(payment.net_amount)} ${payment.currency}</td>
                <td>
                    <tal:b condition="payment.fee|nothing">
                        + ${'{0:.2f}'.format(payment.fee)} ${payment.currency}
                    </tal:b>
                </td>
                <td>
                    <span tal:condition="payment.provider_id">
                        ${providers[payment.provider_id].title}
                    </span>
                    <span tal:condition="not:payment.provider" i18n:translate>
                        Manual
                    </span>
                </td>
                <td>
                    <metal:b use-macro="layout.macros['payment_status']" />
                </td>
                <td>
                    ${layout.format_date(payment.created, 'datetime')}
                </td>
                <td>
                    <tal:b condition="payment.payout_date|nothing">
                        ${layout.format_date(payment.payout_date, 'date')}
                    </tal:b>
                </td>
                <td tal:condition="payment_actions|nothing" class="text-links">
                    <tal:b repeat="link payment_actions(payment)">
                        <tal:b replace="structure link(layout)" />
                    </tal:b>
                </td>
            </tr>
        </tbody>
    </table>
</metal:payments>

<metal:directory_error define-macro="directory_error" i18n:domain="onegov.org">
    <ul class="dense">
        <li tal:repeat="(field_id, messages) error.errors.items()">
            <div tal:condition="error.link|nothing">
                <strong><a href="${error.link}">${error.entry.title}</a></strong>
            </div>
            <div tal:condition="not:error.link|nothing">
                <strong>${error.entry.title}</strong>
            </div>
            <div>
                ${directory.field_by_id(field_id).human_id}: ${error_translate(' '.join(messages))}
            </div>
        </li>
    </ul>
</metal:directory_error>

<metal:group_by_column define-macro="group_by_column" i18n:domain="onegov.org">
    <tal:b repeat="group grouped">
        <h2 tal:condition="len(grouped) > 1">${group}</h2>

        <ul class="with-lead">
            <li tal:repeat="record grouped[group]">

                <a class="list-title" tal:attributes="href request.link(record)">
                    ${record.title}
                </a>
                <metal:hint use-macro="layout.macros['hidden-from-public-hint']" tal:define="item record" />

                <div class="list-lead">${record.meta.get('lead')}</div>
            </li>
        </ul>
    </tal:b>
</metal:group_by_column>

<metal:file_details define-macro="file-details" i18n:domain="onegov.org">
    <div class="row">
        <div class="columns small-4">
            <a class="file-preview" href="${request.link(file)}" tal:condition="extension == 'pdf'">
                <img class="pdf-preview" src="${request.link(file, name='medium')}">
            </a>
            <a class="file-preview" href="${request.link(file)}" tal:condition="extension != 'pdf'">
                <svg width="204px" height="261px" viewBox="0 0 204 261" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="position:relative; left: -6px;">
                    <defs>
                        <filter x="-7.8%" y="-5.9%" width="120.0%" height="115.3%" filterUnits="objectBoundingBox" id="filter-1">
                            <feOffset dx="4" dy="4" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>
                            <feGaussianBlur stdDeviation="5" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>
                            <feColorMatrix values="0 0 0 0 0.392156863   0 0 0 0 0.392156863   0 0 0 0 0.392156863  0 0 0 0.4 0" type="matrix" in="shadowBlurOuter1" result="shadowMatrixOuter1"></feColorMatrix>
                            <feMerge>
                                <feMergeNode in="shadowMatrixOuter1"></feMergeNode>
                                <feMergeNode in="SourceGraphic"></feMergeNode>
                            </feMerge>
                        </filter>
                        <path d="M180,55.8004032 L180,233.892177 C180,235.962291 178.328034,237.640449 176.26556,237.640449 L3.73443983,237.640449 C1.67196566,237.640449 0,235.962291 0,233.892177 L0,3.74827207 C0,1.67815857 1.67196566,0 3.73443983,0 L124.368614,7.10542736e-15 C127.027185,1.13396268e-14 129.576325,1.05864997 131.452741,2.94201554 L177.084127,48.7424188 C178.9515,50.6167086 180,53.1546434 180,55.8004032 Z" id="path-2"></path>
                        <path d="M180,55.8004032 L180,233.892177 C180,235.962291 178.328034,237.640449 176.26556,237.640449 L3.73443983,237.640449 C1.67196566,237.640449 0,235.962291 0,233.892177 L0,3.74827207 C0,1.67815857 1.67196566,0 3.73443983,0 L124.368614,7.10542736e-15 C127.027185,1.13396268e-14 129.576325,1.05864997 131.452741,2.94201554 L177.084127,48.7424188 C178.9515,50.6167086 180,53.1546434 180,55.8004032 Z" id="path-4"></path>
                    </defs>
                    <g id="Artboard" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <g id="Group" filter="url(#filter-1)" transform="translate(7.000000, 7.000000)">
                            <g id="Page">
                                <mask id="mask-3" fill="white">
                                    <use xlink:href="#path-2"></use>
                                </mask>
                                <use id="Mask" stroke="#DDDDDD" stroke-width="2" fill="#F7F8F8" fill-rule="nonzero" xlink:href="#path-2"></use>
                                <rect id="Corner" fill="#DDDDDD" mask="url(#mask-3)" x="127.717842" y="-3.74827207" width="56.0165975" height="56.2240811" rx="4"></rect>
                            </g>
                            <mask id="mask-5" fill="white">
                                <use xlink:href="#path-4"></use>
                            </mask>
                            <use id="Mask" stroke="#DDDDDD" stroke-width="2" fill="#F7F8F8" fill-rule="nonzero" xlink:href="#path-4"></use>
                            <rect id="Corner" fill="#DDDDDD" mask="url(#mask-5)" x="128.426966" y="-5.05617978" width="55.6179775" height="56.6292135" rx="4"></rect>
                            <path d="M-0.0112359551,167.853933 L-0.0112359551,233.651685 C-0.0112359551,235.860824 1.77962505,237.651685 3.98876404,237.651685 L176.011236,237.651685 C178.220375,237.651685 180.011236,235.860824 180.011236,233.651685 L180.011236,167.853933 L-0.0112359551,167.853933 Z" id="Banner" stroke="#DDDDDD" stroke-width="2" fill="${color}" mask="url(#mask-5)"></path>
                            <text id="PDF" mask="url(#mask-5)" font-family="OpenSans-Bold, Open Sans, Helvetica Neue, Arial, sans-serif" font-size="41" font-weight="bold" fill="#FFFFFF" text-anchor="middle" y="216" x="44.5%">${extension.upper()}</text>
                        </g>
                    </g>
                </svg>
            </a>
        </div>
        <div class="columns small-6 file-status">

            <tal:b condition="request.app.enable_yubikey and file.reference['content_type'] == 'application/pdf'">
                <h3 i18n:translate>Digital Signature</h3>
                <div class="signature">
                    <div class="file-status-tag">
                        <metal:b use-macro="layout.macros['signature_status']" />
                    </div>
                </div>
            </tal:b>

            <h3 i18n:translate>Publication</h3>
            <div class="publication" tal:define="
                post_url layout.csrf_protected_url(request.link(file, name='update-publish-date'));
                publish_date file.publish_date and layout.to_timezone(file.publish_date, layout.timezone);
            ">
                <div tal:condition="file.published" class="file-status-tag">
                    <a ic-post-to="${layout.csrf_protected_url(request.link(file, name='unpublish'))}"
                       ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))"
                       class="is-published">
                        <i class="fa fa-fw fa-check-circle" aria-hidden="true"></i> <span i18n:translate>Public</span>
                    </a>
                </div>
                <div tal:condition="not:file.published" class="file-status-tag">
                    <a ic-post-to="${layout.csrf_protected_url(request.link(file, name='publish'))}"
                       ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))"
                       class="is-not-published">
                        <i class="fa fa-fw fa-eye-slash" aria-hidden="true"></i> <span i18n:translate>Private</span>
                    </a>
                </div>

                <div class="publication-settings ${publish_date and 'publication-date-set' or 'publication-date-not-set'}" tal:condition="not:file.published">
                    <form method="POST">
                        <fieldset>
                            <legend tal:condition="publish_date" i18n:translate>Will be published on:</legend>
                            <legend tal:condition="not:publish_date" i18n:translate>Publication date:</legend>

                            <div class="publication-settings-input">
                                <input type="date" name="date" class="small" ic-post-to="${post_url}" ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))" value="${publish_date and publish_date.date().isoformat() or ''}" required="required">

                                <select name="hour" ic-post-to="${post_url}" ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))">
                                    <option tal:condition="not:publish_date"></option>
                                    <tal:b repeat="hour range(24)" tal:define="publish_time publish_date and '{:0>2}:00'.format(publish_date.hour)">
                                        <option tal:define="time '{:0>2}:00'.format(hour)" tal:attributes="selected publish_time == time" value="${time}">${time}</option>
                                    </tal:b>
                                </select>

                                <a ic-post-to="${post_url}&clear=1" ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))">
                                    <i class="fa fa-times-circle" aria-hidden="true"></i>
                                    <span class="show-for-sr" i18n:translate>Reset</span>
                                </a>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>

            <tal:b condition="file.reference['content_type'] == 'application/pdf'">
                <h3 i18n:translate>Content</h3>
                <div class="file-content">
                    <div class="file-status-tag">
                        <div tal:condition="file.stats.get('pages', 0) <= 1">
                            <i class="fa fa-fw fa-file-text-o" aria-hidden="true"></i>
                            <span i18n:translate>1 page</span>
                        </div>
                        <div tal:condition="file.stats.get('pages', 0) > 1">
                            <i class="fa fa-fw fa-file-text-o" aria-hidden="true"></i>
                            <span i18n:translate><tal:b i18n:name="count">${file.stats.get('pages', 0)}</tal:b> pages</span>
                        </div>
                        <div tal:define="words file.stats.get('words', 0)">
                            <tal:b condition="words == 0">
                                <i class="fa fa-fw fa-exclamation-triangle" aria-hidden="true"></i>
                                <span i18n:translate>Contains no readable text</span>
                            </tal:b>
                            <tal:b condition="words == 1">
                                <i class="fa fa-fw fa-font" aria-hidden="true"></i>
                                <span i18n:translate>1 word</span>
                            </tal:b>
                            <tal:b condition="words > 1">
                                <i class="fa fa-fw fa-font" aria-hidden="true"></i>
                                <span i18n:translate><tal:b i18n:name="count">${words}</tal:b> words</span>
                            </tal:b>
                        </div>
                    </div>
                </div>
            </tal:b>
        </div>
        <div class="columns small-2 file-actions">
            <a class="button secondary confirm delete" role="button"
                ic-delete-from="${request.link(file)}?csrf-token=${layout.csrf_token}"
                ic-on-success="
                    var info = $(elt).closest('tr');
                    info.prev().remove();
                    info.next().remove();
                    info.remove();
                "
                data-confirm="Do you really want to delete this file?"
                data-confirm-extra="${file.name}"
                data-confirm-yes="Delete File"
                data-confirm-no="Cancel"
                i18n:attributes="data-confirm;data-confirm-yes;data-confirm-no"
                i18n:translate>
                Delete
            </a>
            <a class="button secondary rename prompt" role="button"
                data-prompt="Please provide the new name for the file"
                data-prompt-ok="Rename"
                data-prompt-cancel="Cancel"
                data-prompt-value="${file.name}"
                data-prompt-success="(function(value) {
                    var url = '${request.link(file, 'rename')}?csrf-token=${layout.csrf_token}';
                    var ext = '.${file.name.split('.')[-1].strip()}';
                    var elt = $(this);

                    value = value.substring(value.length - ext.length, value.length) === ext && value || value + ext;

                    jQuery.post(url, {'name': value}, function() {
                        var actions = elt;

                        actions.closest('tr').prev().find('td:first').text(value);
                        actions.find('a.prompt').data('prompt-value', value);
                        actions.find('a.delete').data('confirm-extra', value);
                    });
                })"
                i18n:attributes="data-prompt;data-prompt-ok;data-prompt-cancel"
                i18n:translate>
                Rename
            </a>
        </div>
    </div>
</metal:file_details>

<metal:sign_result define-macro="sign_result" i18n:domain="onegov.org">
    <metal:b use-macro="layout.macros['consume_messages']" />
    <metal:b use-macro="layout.macros['signature_status']" />
</metal:sign_result>

<metal:signature_status define-macro="signature_status" i18n:domain="onegov.org">
    <tal:b condition="file.reference.content_type == 'application/pdf'" define="may_sign request.app.enable_yubikey and request.is_admin">
        <div tal:condition="file.signed" class="is-signed signature-status">
            <i class="fa fa-fw fa-lock" aria-hidden="true"></i>

            <span i18n:translate>
                Digitally signed by <tal:b i18n:name="signee">${layout.get_user_title(file.signature_metadata['signee'])}</tal:b>
                on <span class="nowrap" i18n:name="date">${layout.format_date(layout.parse_isodate(file.signature_metadata['timestamp']), 'datetime_long')}</span>
            </span>
        </div>
        <tal:b condition="not file.signed and may_sign">
            <a tal:condition="not:file.signed" class="is-not-signed signature-status"
                data-prompt="Please enter your yubikey to digitally sign this file"
                data-prompt-ok="Sign"
                data-prompt-cancel="Cancel"
                data-prompt-placeholder="Plug your YubiKey into a USB slot and press it."
                data-prompt-info="Published and digitally signed documents can be discovered through the site-search and in the list of digitally signed documents. This action will be logged and cannot be undone."
                data-prompt-success="(function(value) {
                    var url = '${request.link(file, 'sign')}?csrf-token=${layout.csrf_token}';
                    var elt = $(this);
                    var row = elt.closest('tr');

                    elt.toggleClass('signing', true);
                    window.elt = elt;

                    jQuery.post(url, {'token': value}, function(data) {
                        var target = elt.closest('.signature-status').parent();
                        target.html(data);
                        processCommonNodes(target);
                        row.prev().addClass('signed');
                    }).always(function() {
                        elt.toggleClass('signing', false);
                    });
                })"
                i18n:attributes="data-prompt;data-prompt-ok;data-prompt-cancel;data-prompt-info;data-prompt-placeholder"
            >
                <i class="fa fa-fw fa-unlock" aria-hidden="true"></i>

                <span i18n:translate class="hide-on-hover">
                    Unsigned
                </span>

                <span i18n:translate class="show-on-hover">
                    Sign now
                </span>
            </a>
        </tal:b>
        <tal:b condition="not file.signed and not may_sign">
            <div class="is-not-signed signature-status">
                <i class="fa fa-fw fa-lock" aria-hidden="true"></i>

                <span i18n:translate class="hide-on-hover">
                    Unsigned
                </span>

                <span i18n:translate class="show-on-hover">
                    You are not authorised to digitally sign documents
                </span>
            </div>
        </tal:b>
    </tal:b>
</metal:signature_status>

<metal:file_info define-macro="file-info" i18n:domain="onegov.org">
    <tal:b define="
        file_number file.number|file.id;
        file_upload file.upload_date|file.created
    ">
        <tr class="file-info ${file.signed and 'signed'}">
            <td>
                ${file.name}
            </td>
            <td>
                <a id="button-${file_number}" data-toggle="#details-${file_number}" class="untoggled">
                    <i class="fa fa-chevron-down" aria-hidden="true"></i>
                </a>
            </td>
            <td>
                ${extension(file)}
            </td>
            <td>
                ${format_date(file_upload)}
            </td>
        </tr>
        <tr id="details-${file_number}" style="display: none;">
            <td colspan="4">
                <div ic-trigger-from="#button-${file_number}"
                     ic-trigger-on="click once"
                     ic-get-from="${actions_url(file.id)}">
                </div>
            </td>
        </tr>
        <tr style="display: none"></tr> <!--! keeps odd/even shading on track -->
    </tal:b>
</metal:file_info>

<metal:uploaded_image define-macro="uploaded_image" i18n:domain="onegov.org">
    <li id="image-${index}" class="image-box">
        <a href="${image.url}" tal:condition="image" class="editable-alt" data-note-update-url="${image.extra}">
            <img tal:condition="image.alt" data-src="${image.src}" class="lazyload static-alt" alt="${image.alt}" width="${image.width}" height="${image.height}" />
            <img tal:condition="not:image.alt" data-src="${image.src}" class="lazyload missing-alt static-alt" alt="Click to add a description" i18n:attributes="alt" width="${image.width}" height="${image.height}"/>
        </a>
        <a class="delete confirm"
           ic-delete-from="${image.url}?csrf-token=${layout.csrf_token}"
           ic-on-success="$('#image-${index}').remove();"
           data-confirm="Do you really want to delete the image?"
           data-confirm-yes="Delete Image"
           data-confirm-no="Cancel"
           i18n:attributes="data-confirm;data-confirm-yes;data-confirm-no"><i class="fa fa-times" aria-hidden="true"></i></a>
    </li>
</metal:uploaded_image>

<metal:digest_result define-macro="digest_result" i18n:domain="onegov.org">
    <div class="digest-result digest-${is_known and 'is-known' or 'is-not-known'}" tal:switch="is_known">
        <tal:b case="True">
            <div>
                <i class="fa fa-fw fa-check-circle" aria-hidden="true"></i>
            </div>
            <div i18n:translate>
                <span i18n:name="name">${name}</span>
                was digitally signed on
                <span i18n:name="date">${layout.format_date(date, 'datetime')}</span>
            </div>
        </tal:b>
        <tal:b case="False">
            <div>
                <i class="fa fa-fw fa-exclamation-circle" aria-hidden="true"></i>
            </div>
            <div i18n:translate>
                <span i18n:name="name">${name}</span>
                is not in our database
            </div>
        </tal:b>
    </div>
</metal:digest_result>
