<div metal:use-macro="layout.base" i18n:domain="onegov.org">
    <tal:block metal:fill-slot="title">
        ${title}
    </tal:block>
    <tal:block metal:fill-slot="content">
        <table class="tickets-table tickets-state-${tickets_state}">
            <thead>
                <tr>
                    <th colspan="6">
                        <div class="row ticket-filters">
                            <div class="columns small-12 medium-6">
                                <dl class="sub-nav">
                                    <dt class="show-for-sr" i18n:translate>State:</dt>
                                    <tal:block repeat="link filters">
                                        <dd class="${link.active and 'active' or ''}">
                                            <tal:block replace="structure link(request)"></tal:block>
                                        </dd>
                                    </tal:block>
                                </dl>
                            </div>
                            <div class="columns small-12 medium-6">
                                <span>
                                    <button href="#" data-dropdown="owners" aria-controls="owners" aria-expanded="false" class="${has_owner_filter and 'tiny primary radius button dropdown' or 'tiny secondary radius button dropdown'} selected-owner">
                                        <span i18n:translate class="show-for-sr">Owner:</span>
                                        <span>${owner.text}</span>
                                    </button>
                                    <ul id="owners" data-dropdown-content class="f-dropdown disable-scroll" aria-hidden="true">
                                        <li tal:repeat="link owners">
                                            <a href="${link.url}" class="${not repeat.link.start and 'ticket-group-filter' or 'ALL-link'}">
                                                <tal:block condition="link.model|nothing">
                                                    <metal:identicon use-macro="layout.macros.identicon" tal:define="initials link.model.initials; username link.model.username" />
                                                </tal:block>

                                                ${link.text}
                                            </a>
                                        </li>
                                    </ul>
                                </span>

                                <span>
                                    <button href="#" data-dropdown="handlers" aria-controls="handlers" aria-expanded="false" class="${has_handler_filter and 'tiny primary radius button dropdown' or 'tiny secondary radius button dropdown'} selected-handler">
                                        <span i18n:translate class="show-for-sr">Kind:</span> 
                                        <span class="${' '.join(handler.classes)}">${handler.text}</span>
                                    </button>
                                    <ul id="handlers" data-dropdown-content class="f-dropdown disable-scroll" aria-hidden="true">
                                        <li tal:repeat="link handlers"><tal:block replace="structure link(request)"></tal:block></li>
                                    </ul>
                                </span>
                            </div>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tal:block repeat="ticket tickets">
                    <tr tal:define="ticket_url request.link(ticket)" class="ticket ticket-handler-${ticket.handler_code} ticket-row-state-${ticket.state}">
                        <td class="ticket-number-plain">
                            <a href="${ticket_url}">
                                ${ticket.number}
                            </a>
                        </td>
                        <td class="ticket-group" colspan="2">
                            <div>${translate(ticket.group)}</div>
                            <div>${ticket.title}</div>
                            <div>${ticket.subtitle}</div>
                        </td>
                        <td class="ticket-date">
                            ${layout.format_date(ticket.created, 'relative')}
                        </td>
                        <td class="ticket-action" tal:condition="ticket.state == 'open'" colspan="2">
                            <a class="ticket-accept ticket-button" href="${request.link(ticket, 'accept')}" i18n:translate>
                                Accept
                            </a>
                        </td>
                        <td class="ticket-state" tal:condition="ticket.state != 'open'">
                            <tal:block condition="ticket.state == 'pending'" i18n:translate>
                                Pending
                            </tal:block>
                            <tal:block condition="ticket.state == 'closed'" i18n:translate>
                                Closed
                            </tal:block>
                        </td>
                        <td class="ticket-user" tal:condition="ticket.state != 'open'">
                            <metal:identicon use-macro="layout.macros.identicon" tal:define="initials ticket.user.initials; username ticket.user.username" />
                        </td>
                    </tr>
                </tal:block>
            </tbody>
        </table>

        <div class="pagination-centered">
            <div metal:use-macro="layout.macros['pagination']" tal:define="
            collection layout.model; current_page layout.model;" />
        </div>
    </tal:block>
</div>