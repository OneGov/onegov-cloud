<div metal:use-macro="layout.base" i18n:domain="onegov.org">
    <tal:block metal:fill-slot="title">
        ${title}
    </tal:block>
    <tal:block metal:fill-slot="content">
        <p i18n:translate tal:condition="not payments">
            No payments yet.
        </p>

        <table class="payments-table" tal:condition="payments">
            <thead>
                <tr>
                    <th i18n:translate>
                        Object
                    </th>
                    <th i18n:translate>
                        Net Amount
                    </th>
                    <th i18n:translate>
                        Fee
                    </th>
                    <th i18n:translate>
                        Payment Provider
                    </th>
                    <th i18n:translate>
                        State
                    </th>
                    <th i18n:translate>
                        Created
                    </th>
                    <th i18n:translate>
                        Disbursed
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr tal:repeat="payment payments">
                    <td>
                        <tal:b repeat="link payment_links[payment.id]">
                            <tal:b switch="link.__tablename__">
                                <tal:b case="'submissions'">
                                    <tal:b define="ticket get_ticket(link)">
                                        <div>
                                            <a href="${request.link(ticket)}">
                                                <strong>${ticket.number}</strong>
                                            </a>
                                            <div>
                                                ${link.title}
                                            </div>
                                        </div>
                                    </tal:b>
                                </tal:b>
                                <tal:b case="'reservations'" condition="repeat.link.start">
                                    <tal:b define="ticket get_ticket(link)">
                                        <div>
                                            <a href="${request.link(ticket)}">
                                                <strong>${ticket.number}</strong>
                                            </a>
                                            <div>
                                                ${link.title}
                                            </div>
                                        </div>
                                    </tal:b>
                                </tal:b>
                            </tal:b>
                        </tal:b>
                    </td>
                    <td>${'{0:.2f}'.format(payment.net_amount)} ${payment.currency}</td>
                    <td>
                        <tal:b condition="payment.fee|nothing">
                            + ${'{0:.2f}'.format(payment.fee)} ${payment.currency}
                        </tal:b>
                    </td>
                    <td>
                        <span tal:condition="payment.provider_id">
                            ${providers[payment.provider_id].title}
                        </span>
                        <span tal:condition="not:payment.provider" i18n:translate>
                            Manual
                        </span>
                    </td>
                    <td>
                        <metal:b use-macro="layout.macros['payment_status']" />
                    </td>
                    <td>
                        ${layout.format_date(payment.created, 'datetime')}
                    </td>
                    <td>
                        <tal:b condition="payment.payout_date|nothing">
                            ${layout.format_date(payment.payout_date, 'date')}
                        </tal:b>
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="pagination-centered">
            <div metal:use-macro="layout.macros['pagination']" tal:define="
            collection layout.model; current_page layout.model;" />
        </div>
    </tal:block>
</div>