<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      i18n:domain="onegov.feriennet">
<body>

<metal:favicon define-macro="favicon">
    <link rel="apple-touch-icon" sizes="180x180" href="${layout.static_file_path('icon/apple-touch-icon.png')}">
    <link rel="icon" type="image/png" href="${layout.static_file_path('icon/favicon-16x16.png')}" sizes="16x16">
    <link rel="icon" type="image/png" href="${layout.static_file_path('icon/favicon-32x32.png')}" sizes="32x32">
    <link rel="manifest" href="${layout.static_file_path('icon/manifest.json')}">
    <link rel="mask-icon" href="${layout.static_file_path('icon/safari-pinned-tab.svg')}" color="${layout.primary_color}">
    <meta name="theme-color" content="${layout.primary_color}">
</metal:favicon>

<metal:tags define-macro="tags">
    <ul class="tags">
        <li tal:repeat="link tags">
            <span tal:content="structure link(request)"
                class="${link.active and 'active'} blank-label"
            />
        </li>
    </ul>
</metal:tags>

<metal:activity_ticket_summary define-macro="activity_ticket_summary" i18n:domain="onegov.feriennet">
    <tal:block define="user activity.user.data.organisation or activity.user.title|activity.user.title">

        <div class="panel callout">

            <div i18n:translate>
                The activity associated with this ticket belongs to <strong i18n:name="user">${user}</strong>.
            </div>
            <div i18n:translate tal:condition="is_first">
                This is the user's first activity.
            </div>
            <div i18n:translate tal:condition="not is_first">
                The user has submitted activities before.
            </div>

            <p>
                <br>
                <span i18n:translate>Activity State</span>: <strong><metal:block use-macro="layout.macros.activity_state_text" /></strong>
            </p>

            <p tal:condition="activity.state != 'accepted'" i18n:translate>
                Please review the activity carefully before publishing it.
            </p>

            <p tal:condition="activity.state == 'accepted'" i18n:translate>
                To remove this activity from the public part of the website, you can archive it.
            </p>
        </div>

        <h2>${activity.title}</h2>

        <span class="page-lead" tal:condition="activity.lead" tal:content="activity.lead" />

    </tal:block>
</metal:activity_ticket_summary>

<metal:activity_detailed define-macro="activity_detailed" i18n:domain="onegov.feriennet">

    <tal:block metal:use-macro="layout.macros.page_content"
        tal:define="lead activity.lead; text activity.text; coordinates activity.coordinates; people None; contact None; show_side_panel True; highlight_contacts False; location activity.location">

        <div metal:fill-slot="after-lead" tal:condition="activity.tags">
            <ul class="tags">
                <li class="blank-label" tal:repeat="tag activity.ordered_tags(request)">
                    ${request.translate(tag)}
                </li>
            </ul>
        </div>

        <div metal:fill-slot="before-panels">
            <div class="side-panel highlighted organiser-panel" tal:define="organiser activity.user">
                <h2 i18n:translate>Organiser</h2>
                <metal:block use-macro="layout.macros.organiser" />

                <small tal:condition="show_ticket_panel and not request.is_admin and organiser.username == request.identity.userid|nothing">
                    <a href="${request.return_here(request.link(request.app.org, 'benutzerprofil'))}" i18n:translate>Edit contact info</a>
                </small>

                <small tal:condition="show_ticket_panel and request.is_admin">
                    <a href="${request.return_here(request.link(activity.user))}" i18n:translate>Edit contact info</a>
                </small>
            </div>
        </div>

        <div metal:fill-slot="after-panels" tal:condition="show_ticket_panel and request.is_organiser">
            <div class="side-panel activity-status-panel">
                <h2 class="show-for-sr" i18n:translate>Activity</h2>

                <dl>
                    <dt i18n:translate>
                        Activity State
                    </dt>
                    <dd>
                        <metal:block use-macro="layout.macros.activity_state" />
                    </dd>

                    <tal:block condition="layout.ticket">
                        <dt i18n:translate>
                            Ticket State
                        </dt>
                        <dd class="activity-ticket-state" tal:define="ticket layout.ticket">
                            <metal:block use-macro="layout.macros.ticket_status" />
                        </dd>
                    </tal:block>
                </dl>
            </div>
        </div>

    </tal:block>
</metal:activity_detailed>

<metal:activity_state define-macro="activity_state" i18n:domain="onegov.feriennet">
    <div class="activity-state activity-state-${activity.state}">
        <metal:block use-macro="layout.macros.activity_state_text" />
    </div>
</metal:activity_state>

<metal:activity_state_text define-macro="activity_state_text" i18n:domain="onegov.feriennet">
    <tal:block switch="activity.state">
        <tal:block i18n:translate case="string:preview">Preview</tal:block>
        <tal:block i18n:translate case="string:proposed">Proposed</tal:block>
        <tal:block i18n:translate case="string:accepted">Published</tal:block>
        <tal:block i18n:translate case="string:archived">Archived</tal:block>
    </tal:block>
</metal:activity_state_text>

<metal:organiser define-macro="organiser" i18n:domain="onegov.feriennet">
    <div class="organiser">
        <ul>
            <li class="organiser-name"
                tal:condition="organiser.data.organisation|nothing"
                tal:content="organiser.data.organisation">
            </li>
            <li class="organiser-name"
                tal:condition="organiser.realname|nothing"
                tal:content="organiser.realname">
            </li>
            <li class="organiser-address"
                tal:condition="organiser.data.address|organiser.data.zip_code|organiser.data.place|nothing">
                <span class="newlines" tal:condition="organiser.data.address|nothing">${organiser.data.address}</span>
                <div tal:condition="organiser.data.zip_code|organiser.data.place|nothing">
                    <span tal:condition="organiser.data.zip_code|nothing">${organiser.data.zip_code}</span>
                    <span tal:condition="organiser.data.place|nothing">${organiser.data.place}</span>
                </div>
            </li>
            <li class="organiser-email" tal:define="email organiser.data.email or organiser.username|organiser.username">
                <a href="mailto:${email}">${email}</a>
            </li>
            <li class="organiser-phone" tal:condition="organiser.data.phone|nothing">
                <a href="tel:${organiser.data.phone}">${organiser.data.phone}</a>
            </li>
            <li class="organiser-website" tal:condition="organiser.data.website|nothing">
                <a href="${organiser.data.website}">${organiser.data.website.replace('http://', '').replace('https://', '')}</a>
            </li>
        </ul>
    </div>
</metal:organiser>

<metal:occasion define-macro="occasion" i18n:domain="onegov.feriennet">
    <tal:block define="show_enroll show_enroll|nothing; show_links show_links|nothing; period occasion.period">
        <div class="row" tal:define="show_stats not period.wishlist_phase">
            <!--! the width of this column together with the next one doesn't add up to 12 by
            intention to make space for the icons rendered ::before the first column. -->
            <div class="small-12 medium-6 columns factoids">
                <ul tal:condition="len(occasion.dates) > 1">
                    <li tal:repeat="date occasion.dates[1:]">
                        ${layout.format_datetime_range(date.localized_start, date.localized_end)}
                    </li>
                </ul>

                <div class="full" tal:condition="show_stats and not occasion.cancelled and occasion.full">
                    <span i18n:translate>Fully booked</span>
                </div>

                <div class="full" tal:condition="show_stats and occasion.cancelled">
                    <span i18n:translate>Rescinded</span>
                </div>

                <div class="available-spots" tal:condition="show_stats and not occasion.cancelled and not occasion.full and not period.finalized">
                    <span i18n:translate><tal:block i18n:name="count" replace="occasion.available_spots" /> spots available</span>
                </div>

                <div class="location" tal:condition="occasion.meeting_point">
                    <span i18n:translate class="show-for-sr">Meeting Point</span>
                    <span>${occasion.meeting_point}</span>
                </div>

                <div class="age">
                    <span i18n:translate class="show-for-sr">Age</span>
                    <span i18n:translate>
                        <tal:block replace="occasion.age.lower" i18n:name='min_age' />
                        -
                        <tal:block replace="occasion.age.upper - 1" i18n:name='max_age' />
                        years old
                    </span>
                </div>

                <div class="spots" tal:condition="not period.finalized">
                    <span i18n:translate class="show-for-sr">Participants</span>

                    <span i18n:translate tal:condition="occasion.spots.lower">
                        <tal:block replace="occasion.spots.lower" i18n:name='min_spots' />
                        -
                        <tal:block replace="occasion.spots.upper - 1" i18n:name='max_spots' />
                        participants
                    </span>

                    <span i18n:translate tal:condition="not:occasion.spots.lower">
                        up to
                        <tal:block replace="occasion.spots.upper - 1" i18n:name='max_spots' />
                        participants
                    </span>
                </div>

                <div class="spots" tal:condition="show_stats and not occasion.cancelled and period.finalized">
                    <span i18n:translate><tal:block i18n:name="count" replace="occasion.attendee_count" /> attendees</span>
                </div>

                <div class="cost">
                    <span i18n:translate class="show-for-sr">Cost</span>

                    <tal:block condition="period.all_inclusive">
                        <tal:block condition="occasion.cost" i18n:translate>
                            <tal:block i18n:name="cost" replace="occasion.cost" /> CHF
                        </tal:block>
                        <tal:block condition="not:occasion.cost" i18n:translate>
                            No additional costs
                        </tal:block>
                    </tal:block>
                    <tal:block condition="not:period.all_inclusive">
                        <tal:block condition="occasion.cost or period.booking_cost" i18n:translate>
                            <tal:block i18n:name="cost" replace="(occasion.cost or 0) + (period.booking_cost or 0)" /> CHF
                        </tal:block>
                        <tal:block condition="not:occasion.cost or period.booking_cost" i18n:translate>
                            Free of charge
                        </tal:block>
                    </tal:block>
                </div>

                <div class="overlap-check" tal:condition="occasion.exclude_from_overlap_check">
                    <span i18n:translate>Independent of other occasions</span>
                </div>

                <div class="text-links" tal:condition="show_links and (request.is_admin or layout.is_owner)">
                    <tal:block repeat="link occasion_links(occasion)">
                        <tal:block replace="structure link(request)" />
                    </tal:block>
                </div>
            </div>
            <div class="small-12 medium-6 columns">
                <p tal:condition="occasion.note">${occasion.note}</p>
            </div>
        </div>

        <div class="call-to-action" tal:condition="show_enroll">
            <tal:block switch="age_bracket(occasion.age)">
                <span tal:case="'young'" i18n:translate>
                    Enroll your young child now.
                </span>
                <span tal:case="'teenager'" i18n:translate>
                    Enroll your teenager now.
                </span>
                <span tal:case="default" i18n:translate>
                    Enroll your child now.
                </span>
            </tal:block>

            <tal:block switch="request.is_logged_in">
                <a tal:case="True" class="button" href="${request.link(occasion, 'anmelden')}" i18n:translate>Enroll</a>
                <a tal:case="False" class="button" href="${layout.login_to_url(request.link(occasion, 'anmelden'), skip=True)}" i18n:translate>Enroll</a>
            </tal:block>
        </div>
    </tal:block>
</metal:occasion>

<metal:star define-macro="star" i18n:domain="onegov.feriennet">
    <tal:block condition="not booking.starred">
        <i id="star-${booking.id}" class="fa fa-star-o" aria-hidden="true"></i>
        <span class="show-for-sr" i18n:translate>Mark activity as favorite</span>
    </tal:block>
    <tal:block condition="booking.starred">
        <i id="star-${booking.id}" class="fa fa-star" aria-hidden="true"></i>
        <span class="show-for-sr" i18n:translate>Unmark activity as favorite</span>
    </tal:block>
</metal:star>


<metal:star define-macro="nobble" i18n:domain="onegov.feriennet">
    <tal:block define="booking_id booking.id|record.booking_id; nobbled booking.nobbled|record.booking_nobbled">
        <tal:block condition="not nobbled">
            <i id="nobble-${booking_id}" class="fa fa-fw fa-square-o" aria-hidden="true"></i>
            <span class="show-for-sr" i18n:translate>Increase the bookings priority</span>
        </tal:block>
        <tal:block condition="nobbled">
            <i id="nobble-${booking_id}" class="fa fa-fw fa-check-square-o" aria-hidden="true"></i>
            <span class="show-for-sr" i18n:translate>Decrease the bookings priority</span>
        </tal:block>
    </tal:block>
</metal:star>


<metal:hints define-macro="period_hints" i18n:domain="onegov.feriennet">
    <tal:block define="today layout.today()">
        <div class="hint hint-prebooking" tal:condition="today < period.prebooking_start" i18n:translate>
            Prebooking begins on <strong tal:content="layout.format_date(period.prebooking_start, 'date_long')" i18n:name="date" />.
        </div>

        <div class="hint hint-prebooking" tal:condition="period.wishlist_phase and period.prebooking_start <= today and today <= period.prebooking_end" i18n:translate>
            Prebooking is now active until <strong tal:content="layout.format_date(period.prebooking_end, 'date_long')" i18n:name="date" />.
        </div>

        <div class="hint hint-prebooking" tal:condition="today > period.prebooking_end or (period.prebooking_start <= today and not period.wishlist_phase) and not period.finalized" i18n:translate>
            Prebooking has ended.
        </div>

        <div class="hint hint-finalized" tal:condition="period.finalized" i18n:translate>
            There cannot be any more bookings.
        </div>

        <div class="hint hint-deadline" tal:condition="not period.finalized and period.confirmed and period.deadline_date" i18n:translate>
            The deadline for last-minute bookings is the <tal:block i18n:name="date">${layout.format_date(period.deadline_date, 'date')}</tal:block>.
        </div>

        <div class="hint hint-deadline" tal:condition="not period.finalized and period.confirmed and period.deadline_days" i18n:translate>
            Last-minute bookings are possible up to <tal:block i18n:name="days">${period.deadline_days}</tal:block> before each occasion.
        </div>

        <div class="hint hint-max-activities" tal:condition="period.all_inclusive and period.max_bookings_per_attendee" i18n:translate>
            Each child is assigned up to <tal:block i18n:name="count" tal:replace="period.max_bookings_per_attendee" /> activities. To ensure a good matching you can signup for more activities than those.
        </div>

        <div class="hint hint-costs" tal:condition="period.all_inclusive and period.booking_cost" i18n:translate>
            The passport costs <tal:block i18n:name="amount" tal:replace="period.booking_cost" /> CHF per child. Individual activities may incur additional charges.
        </div>

        <div class="hint hint-minutes" tal:condition="period.minutes_between" i18n:translate>
            Between each booking we enforce <tal:block i18n:name="minutes" tal:replace="period.minutes_between" /> minutes of block-time in which no other booking is permitted.
        </div>
    </tal:block>
</metal:hints>


<metal:confirmed_booking_state define-macro="confirmed_booking_state" i18n:domain="onegov.feriennet">
    <tal:block switch="state">
        <div tal:case="'open'" class="state ${state}" i18n:translate>
            Open
        </div>
        <div tal:case="'accepted'" class="state ${state}" i18n:translate>
            Accepted
        </div>
        <div tal:case="'cancelled'" class="state ${state}" i18n:translate>
            Cancelled
        </div>
        <div tal:case="'denied'" class="state ${state}" i18n:translate>
            Denied
        </div>
        <div tal:case="'blocked'" class="state ${state}" i18n:translate>
            Blocked
        </div>
    </tal:block>
</metal:confirmed_booking_state>


<metal:wishlist_booking_state define-macro="wishlist_booking_state" i18n:domain="onegov.feriennet">
    <tal:block switch="state">
        <div tal:case="'cancelled'" class="state ${state}" i18n:translate>
            Cancelled
        </div>
        <div tal:case="default" class="state open" i18n:translate>
            Open
        </div>
    </tal:block>
</metal:wishlist_booking_state>


<metal:periods define-macro="periods" i18n:domain="onegov.feriennet">
    <div class="row other-periods" tal:condition="len(periods) > 1">
        <div class="columns small-12">
            <h2 i18n:translate>Period</h2>
            <select onchange="location = this.value;">
                <option tal:repeat="p periods" value="${request.link(model.for_period(p))}" tal:attributes="selected p.id == period.id">
                    ${p.title}
                </option>
            </select>
        </div>
    </div>
</metal:periods>


<metal:users define-macro="users" i18n:domain="onegov.feriennet">
    <div class="row other-users" tal:condition="request.is_admin and users">
        <div class="columns small-12">
            <h2 i18n:translate>User</h2>
            <select onchange="location = this.value;">
                <option tal:repeat="u users" value="${request.link(model.for_username(u.username))}" tal:attributes="selected u.id == user.id">
                    ${u.title}
                </option>
            </select>
        </div>
    </div>
</metal:users>
