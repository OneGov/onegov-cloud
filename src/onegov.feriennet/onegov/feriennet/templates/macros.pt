<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      i18n:domain="onegov.feriennet">
<body>

<metal:favicon define-macro="favicon">
    <link rel="apple-touch-icon" sizes="180x180" href="${layout.static_file_path('icon/apple-touch-icon.png')}">
    <link rel="icon" type="image/png" href="${layout.static_file_path('icon/favicon-16x16.png')}" sizes="16x16">
    <link rel="icon" type="image/png" href="${layout.static_file_path('icon/favicon-32x32.png')}" sizes="32x32">
    <link rel="manifest" href="${layout.static_file_path('icon/manifest.json')}">
    <link rel="mask-icon" href="${layout.static_file_path('icon/safari-pinned-tab.svg')}" color="${layout.primary_color}">
    <meta name="theme-color" content="${layout.primary_color}">

    <!--! Google Tag Manager -->
    <script>/* eslint-disable */
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-KM9K588');/* eslint-enable */
    </script>

</metal:favicon>

<metal:footer define-macro="footer">
    <footer>
        <div>
            <div class="row footer-content">
                <div class="small-12 columns">
                    <metal:b use-macro="layout.macros['footer_columns']" />
                    <metal:b use-macro="layout.macros['footer_sponsors']" />
                    <metal:b use-macro="layout.macros['footer_links']" />
                </div>
            </div>
        </div>
    </footer>

    <!--! Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KM9K588"
        height="0" width="0" style="display:none;visibility:hidden" />
    </noscript>
</metal:footer>

<metal:footer_sponsors define-macro="footer_sponsors" i18n:domain="onegov.feriennet">
    <div class="row sponsor-footer">
        <div class="columns small-12">
            <h2 i18n:translate>Pro Juventute Feriennet</h2>

            <div class="row">
                <div class="columns small-12 medium-3">
                    <a href="https://feriennet.projuventute.ch/" class="pro-juventute-logo">
                        <img src="${layout.static_file_path('projuventute.svg')}"
                             alt="Pro Juventute Logo"
                             i18n:attributes="alt"
                             height="175px"
                             width="151px"
                        >
                    </a>
                </div>
                <div class="columns small-12 medium-9 pro-juventute-ad-text">
                    <div>
                        <a href="https://feriennet.projuventute.ch" i18n:translate>
                            Feriennet is Pro Juventute's booking platform for
                            supervised vacation activities.
                        </a>
                    </div>

                    <div i18n:translate>
                        This platform was developed by <a i18n:name="seantis" href="https://www.seantis.ch">Seantis GmbH</a> with <a i18n:name="onegovcloud" href="https://www.onegovcloud.ch">OneGov Cloud</a>, supported by <a i18n:name="netcetera" href="https://www.netcetera.com">Netcetera AG</a>.
                    </div>

                    <div>
                        <div i18n:translate>
                            You can find additional Pro Juventute offers
                            <a href="https://www.projuventute.ch" i18n:name="here" i18n:translate>here</a>.
                        </div>
                    </div>

                    <div>
                        <div i18n:translate>
                            Pro Juventute Feriennet could only be realised thanks to the
                            generous support of our <a i18n:name="partners" i18n:translate href="https://www.projuventute.ch/Unsere-Partner.3789.0.html">partners</a>.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row sponsor-footer">
        <div class="columns small-12">
            <h2 i18n:translate>Feriennet Partner</h2>

            <div tal:repeat="chunk layout.chunks(layout.app.sponsors, 4)" class="row sponsors-row">
                <div tal:repeat="sponsor chunk" class="columns small-12 medium-3 large-3 ${repeat.sponsor.end and 'end' or ''}">
                    <div tal:define="sponsor sponsor and sponsor.compiled(request)" tal:condition="sponsor" class="sponsor" style="background-color: ${sponsor.background};">
                        <a href="${sponsor.logo_url}" title="${sponsor.name}">
                            <img height="${sponsor.height}" width="${sponsor.width}" src="${sponsor.url_for(request, sponsor.logo)}" style="top: ${sponsor.top};">
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</metal:footer_sponsors>

<metal:footer_projuventute define-macro="footer_projuventute" i18n:domain="onegov.feriennet">
    <h2 i18n:translate>Platform</h2>
    <a href="https://www.projuventute.ch/" class="projuventute-logo">
        <img
            src="${layout.static_file_path('projuventute.svg')}"
            alt="Pro Juventute Logo"
            i18n:attributes="alt"
            height="175px"
            width="151px"
        >
    </a>
</metal:footer_projuventute>

<metal:activity_ticket_summary define-macro="activity_ticket_summary" i18n:domain="onegov.feriennet">
    <tal:b define="user activity.user.data.organisation or activity.user.title|activity.user.title">

        <div class="panel">

            <div i18n:translate>
                The activity associated with this ticket belongs to <strong i18n:name="user">${user}</strong>.
            </div>
            <div i18n:translate tal:condition="is_first">
                This is the user's first activity.
            </div>
            <div i18n:translate tal:condition="not is_first">
                The user has submitted activities before.
            </div>

            <p>
                <br>
                <span i18n:translate>Activity State</span>: <strong><metal:b use-macro="layout.macros.activity_state_text" /></strong>
            </p>

            <p tal:condition="activity.state != 'accepted'" i18n:translate>
                Please review the activity carefully before publishing it.
            </p>

            <p tal:condition="activity.state == 'accepted'" i18n:translate>
                To remove this activity from the public part of the website, you can archive it.
            </p>
        </div>

        <h2>${activity.title}</h2>

        <p>
            <span class="page-lead" tal:condition="activity.lead" tal:content="activity.lead" />
            <span>${period.title}</span>
        </p>

    </tal:b>
</metal:activity_ticket_summary>

<metal:activity_detailed define-macro="activity_detailed" i18n:domain="onegov.feriennet">

    <tal:b metal:use-macro="layout.macros.page_content"
        tal:define="lead activity.lead; text activity.text; coordinates activity.coordinates; people None; contact None; show_side_panel True; highlight_contacts False; location activity.location">

        <div metal:fill-slot="after-lead" tal:condition="activity.tags">
            <ul class="tags">
                <li class="blank-label" tal:repeat="tag activity.ordered_tags(request)">
                    ${request.translate(tag)}
                </li>
            </ul>
        </div>

        <div metal:fill-slot="before-panels">
            <div class="side-panel highlighted organiser-panel" tal:define="organiser activity.user; public request.app.public_organiser_data" tal:condition="public">
                <h2 i18n:translate>Organiser</h2>
                <metal:b use-macro="layout.macros.organiser" />
            </div>
        </div>

        <div metal:fill-slot="after-panels" tal:condition="show_ticket_panel and request.is_organiser">
            <div class="side-panel activity-status-panel">
                <h2 class="show-for-sr" i18n:translate>Activity</h2>

                <dl>
                    <dt i18n:translate>
                        Activity State
                    </dt>
                    <dd>
                        <metal:b use-macro="layout.macros.activity_state" />
                    </dd>

                    <tal:b condition="layout.ticket and layout.model.state != 'preview'">
                        <dt i18n:translate>
                            Ticket State
                        </dt>
                        <dd class="activity-ticket-state" tal:define="ticket layout.ticket">
                            <metal:b use-macro="layout.macros.ticket_status" />
                        </dd>
                    </tal:b>
                </dl>
            </div>
        </div>

    </tal:b>
</metal:activity_detailed>

<metal:activity_state define-macro="activity_state" i18n:domain="onegov.feriennet">
    <div class="activity-state activity-state-${activity.state}">
        <metal:b use-macro="layout.macros.activity_state_text" />
    </div>
</metal:activity_state>

<metal:activity_state_text define-macro="activity_state_text" i18n:domain="onegov.feriennet">
    <tal:b switch="activity.state">
        <tal:b i18n:translate case="string:preview">Preview</tal:b>
        <tal:b i18n:translate case="string:proposed">Proposed</tal:b>
        <tal:b i18n:translate case="string:accepted">Published</tal:b>
        <tal:b i18n:translate case="string:archived">Archived</tal:b>
    </tal:b>
</metal:activity_state_text>

<metal:organiser define-macro="organiser" i18n:domain="onegov.feriennet">
    <div class="organiser">
        <ul>
            <tal:b condition="'name' in public">
                <li class="organiser-name"
                    tal:condition="organiser.data.organisation|nothing"
                    tal:content="organiser.data.organisation">
                </li>
                <li class="organiser-name"
                    tal:condition="organiser.realname.strip()|nothing"
                    tal:content="organiser.realname">
                </li>
            </tal:b>
            <tal:b condition="'address' in public">
                <li class="organiser-address" tal:condition="organiser.data.address|organiser.data.zip_code|organiser.data.place|nothing">
                    <span class="newlines" tal:condition="organiser.data.address|nothing">${organiser.data.address}</span>
                    <div tal:condition="organiser.data.zip_code|organiser.data.place|nothing">
                        <span tal:condition="organiser.data.zip_code|nothing">${organiser.data.zip_code}</span>
                        <span tal:condition="organiser.data.place|nothing">${organiser.data.place}</span>
                    </div>
                </li>
            </tal:b>
            <tal:b condition="'email' in public">
                <li class="organiser-email" tal:define="email organiser.data.email or organiser.username|organiser.username">
                    <a href="mailto:${email}">${email}</a>
                </li>
            </tal:b>
            <tal:b condition="'phone' in public">
                <li class="organiser-phone" tal:condition="organiser.data.phone|nothing">
                    <a href="tel:${organiser.data.phone}">${organiser.data.phone}</a>
                </li>
            </tal:b>
            <tal:b condition="'website' in public">
                <li class="organiser-website" tal:condition="organiser.data.website|nothing">
                    <a href="${organiser.data.website}">${organiser.data.website.replace('http://', '').replace('https://', '').rstrip('/')}</a>
                </li>
            </tal:b>
        </ul>
    </div>
</metal:organiser>

<metal:occasion define-macro="occasion" i18n:domain="onegov.feriennet">
    <div class="occasion" tal:define="
        show_enroll show_enroll|nothing;
        show_links show_links|nothing;
        show_needs show_needs|nothing;
        period occasion.period;
        wrap_occasion_link wrap_occasion_link|lambda url: url">

        <div class="state" tal:condition="period.phase not in ('inactive', 'wishlist')">
            <div class="full" tal:condition="not occasion.cancelled and occasion.full">
                <span i18n:translate>Fully booked</span>
            </div>

            <div class="cancelled" tal:condition="occasion.cancelled">
                <span i18n:translate>Rescinded</span>
            </div>

            <div class="available-spots" tal:condition="not occasion.cancelled and not occasion.full and not period.finalized">
                <span i18n:translate><tal:b i18n:name="count" replace="occasion.available_spots" /> spots available</span>
            </div>

            <div class="spots" tal:condition="not occasion.cancelled and period.finalized">
                <span i18n:translate><tal:b i18n:name="count" replace="occasion.attendee_count" /> attendees</span>
            </div>
        </div>

        <div class="factoids">
            <div class="dates">
                <ul>
                    <li tal:repeat="date occasion.dates">
                        ${layout.format_datetime_range(date.localized_start, date.localized_end)}
                    </li>
                </ul>
            </div>
        </div>

        <div class="factoids right-align">
            <div class="age">
                <span i18n:translate class="show-for-sr">Age</span>
                <span i18n:translate>
                    <tal:b replace="occasion.age.lower" i18n:name='min_age' />
                    -
                    <tal:b replace="occasion.age.upper - 1" i18n:name='max_age' />
                    years
                </span>
            </div>

            <div class="spots" tal:condition="not period.finalized">
                <span i18n:translate class="show-for-sr">Participants</span>

                <span i18n:translate tal:condition="occasion.spots.lower">
                    <tal:b replace="occasion.spots.lower" i18n:name='min_spots' />
                    -
                    <tal:b replace="occasion.spots.upper - 1" i18n:name='max_spots' />
                    participants
                </span>

                <span i18n:translate tal:condition="not:occasion.spots.lower">
                    up to
                    <tal:b replace="occasion.spots.upper - 1" i18n:name='max_spots' />
                    participants
                </span>
            </div>

            <div class="cost">
                <span i18n:translate class="show-for-sr">Cost</span>

                <tal:b condition="period.all_inclusive">
                    <tal:b condition="occasion.cost" i18n:translate>
                        <tal:b i18n:name="cost" replace="occasion.cost" /> CHF
                    </tal:b>
                    <tal:b condition="not:occasion.cost" i18n:translate>
                        No additional costs
                    </tal:b>
                </tal:b>
                <tal:b condition="not:period.all_inclusive">
                    <tal:b condition="occasion.cost or period.booking_cost" i18n:translate>
                        <tal:b i18n:name="cost" replace="(occasion.cost or 0) + (period.booking_cost or 0)" /> CHF
                    </tal:b>
                    <tal:b condition="not:occasion.cost or period.booking_cost" i18n:translate>
                        Free of charge
                    </tal:b>
                </tal:b>
            </div>
        </div>

        <div class="factoids spacer">
            <div class="location" tal:condition="occasion.meeting_point">
                <span i18n:translate class="show-for-sr">Meeting Point</span>
                <span>${occasion.meeting_point}</span>
            </div>

            <div class="overlap-check" tal:condition="occasion.exclude_from_overlap_check">
                <span i18n:translate>Independent of other occasions</span>
            </div>

            <div class="bring-cash" tal:condition="period.all_inclusive and occasion.cost and period.pay_organiser_directly" i18n:translate>
                Please bring <tal:b i18n:name="cost" replace="occasion.cost" /> CHF in cash.
            </div>

            <div class="note" tal:condition="occasion.note">
                <p tal:condition="occasion.note">${occasion.note}</p>
            </div>

            <tal:b condition="show_links and layout.is_editable">
                <tal:b define="links tuple(occasion_links(occasion))" condition="links">
                    <div class="text-links">
                        <tal:b repeat="link links">
                            <tal:b replace="structure link(layout)" />
                        </tal:b>
                    </div>
                </tal:b>
            </tal:b>
        </div>

        <div class="occasion-needs" tal:condition="show_needs">
            <h5 i18n:translate>Needs</h5>

            <div class="need-add">
                <a href="${request.link(occasion, 'add-need')}" i18n:translate>Enter a need</a>
            </div>

            <div tal:condition="not:occasion.needs" class="need-info">
                <i class="fa fa-info-circle" aria-hidden="true"></i>
                <span i18n:translate>Keep track of required resources by adding needs.</span>
            </div>

            <ul tal:condition="occasion.needs">
                <li tal:repeat="need occasion.needs">
                    <span class="need-number">
                        ${need.number.lower} - ${need.number.upper - 1}
                    </span>
                    <span class="need-name">
                        ${need.name}
                    </span>
                    <span class="need-actions text-links" tal:condition="request.is_admin">
                        <a href="${request.link(need, 'edit')}" i18n:translate>Edit</a>
                        <a class="confirm" data-confirm="Do you really want to delete this need?" data-confirm-yes="Delete need" data-confirm-no="Cancel" ic-delete-from="${layout.csrf_protected_url(request.link(need))}" ic-verb="DELETE" redirect-after="${request.link(occasion)}" i18n:translate i18n:attributes="data-confirm;data-confirm-yes;data-confirm-no">
                            Delete
                        </a>
                    </span>
                    <span class="need-description">
                        <tal:b replace="structure layout.paragraphify(layout.linkify(need.description))" />
                    </span>
                </li>
            </ul>
        </div>

        <div class="call-to-action" tal:condition="show_enroll">
            <span i18n:translate>
                Enroll your child now.
            </span>

            <tal:b switch="request.is_logged_in">
                <a tal:case="True" class="button" href="${wrap_occasion_link(request.link(occasion, 'book'))}" i18n:translate>Enroll</a>
                <a tal:case="False" class="button" href="${layout.login_to_url(wrap_occasion_link(request.link(occasion, 'book')), skip=True)}" i18n:translate>Enroll</a>
            </tal:b>
        </div>

    </div>
</metal:occasion>

<metal:star define-macro="star" i18n:domain="onegov.feriennet">
    <tal:b condition="not booking.starred">
        <i id="star-${booking.id}" class="fa fa-star-o" aria-hidden="true"></i>
        <span class="show-for-sr" i18n:translate>Mark activity as favorite</span>
    </tal:b>
    <tal:b condition="booking.starred">
        <i id="star-${booking.id}" class="fa fa-star" aria-hidden="true"></i>
        <span class="show-for-sr" i18n:translate>Unmark activity as favorite</span>
    </tal:b>
</metal:star>

<metal:star define-macro="nobble" i18n:domain="onegov.feriennet">
    <tal:b define="booking_id booking.id|record.booking_id; nobbled booking.nobbled|record.booking_nobbled">
        <tal:b condition="not nobbled">
            <i id="nobble-${booking_id}" class="fa fa-fw fa-square-o" aria-hidden="true"></i>
            <span class="show-for-sr" i18n:translate>Increase the bookings priority</span>
        </tal:b>
        <tal:b condition="nobbled">
            <i id="nobble-${booking_id}" class="fa fa-fw fa-check-square-o" aria-hidden="true"></i>
            <span class="show-for-sr" i18n:translate>Decrease the bookings priority</span>
        </tal:b>
    </tal:b>
</metal:star>

<metal:hints define-macro="period_hints" i18n:domain="onegov.feriennet">
    <div tal:condition="period.is_prebooking_in_future"
         class="hint hint-prebooking" i18n:translate>
            Prebooking begins on <strong tal:content="layout.format_date(period.prebooking_start, 'date_long')" i18n:name="date" />.
    </div>

    <div tal:condition="period.is_currently_prebooking"
         class="hint hint-prebooking" i18n:translate>
            Prebooking is now active until <strong tal:content="layout.format_date(period.prebooking_end, 'date_long')" i18n:name="date" />.
    </div>

    <div tal:condition="period.is_prebooking_in_past and not period.finalized"
         class="hint hint-prebooking" i18n:translate>
            Prebooking has ended.
    </div>

    <div tal:condition="period.finalized"
         class="hint hint-finalized" i18n:translate>
            There cannot be any more bookings.
    </div>

    <div tal:condition="not period.finalized and period.confirmed and period.deadline_date"
         class="hint hint-deadline" i18n:translate>
            The deadline for last-minute bookings is the <tal:b i18n:name="date">${layout.format_date(period.deadline_date, 'date')}</tal:b>.
    </div>

    <div tal:condition="not period.finalized and period.confirmed and period.deadline_days"
         class="hint hint-deadline" i18n:translate>
            Last-minute bookings are possible up to <tal:b i18n:name="days">${period.deadline_days}</tal:b> days before each occasion.
    </div>

    <div tal:condition="not period.finalized and period.confirmed and period.cancellation_date"
         class="hint hint-cancellation" i18n:translate>
            The deadline for last-minute cancellations is the <tal:b i18n:name="date">${layout.format_date(period.cancellation_date, 'date')}</tal:b>.
    </div>

    <div tal:condition="not period.finalized and period.confirmed and period.deadline_days"
         class="hint hint-cancellation" i18n:translate>
            Last-minute cancellations are possible up to <tal:b i18n:name="days">${period.cancellation_days}</tal:b> days before each occasion.
    </div>

    <div tal:condition="period.all_inclusive and period.max_bookings_per_attendee"
         class="hint hint-max-activities" i18n:translate>
            Each child is assigned up to <tal:b i18n:name="count" tal:replace="period.max_bookings_per_attendee" /> activities. To ensure a good matching you can signup for more activities than those.
    </div>

    <div tal:condition="period.all_inclusive and period.booking_cost"
         class="hint hint-costs" i18n:translate>
            The passport costs <tal:b i18n:name="amount" tal:replace="period.booking_cost" /> CHF per child. Individual activities may incur additional charges.
    </div>

    <div tal:condition="period.minutes_between"
         class="hint hint-minutes" i18n:translate>
            Between each booking we enforce <tal:b i18n:name="minutes" tal:replace="period.minutes_between" /> minutes of block-time in which no other booking is permitted.
    </div>

    <div tal:condition="period.alignment == 'day'"
        class="hint hint-minutes">
        <tal:b i18n:translate>Attendees are limited to one activity per day</tal:b>.
    </div>
</metal:hints>

<metal:booking_state define-macro="booking_state" i18n:domain="onegov.feriennet">
    <tal:b switch="state">
        <div tal:case="'open'" class="state ${state}" i18n:translate>
            Open
        </div>
        <div tal:case="'accepted'" class="state ${state}" i18n:translate>
            Accepted
        </div>
        <div tal:case="'cancelled'" class="state ${state}" i18n:translate>
            Cancelled
        </div>
        <div tal:case="'denied'" class="state ${state}" i18n:translate>
            Denied
        </div>
        <div tal:case="'blocked'" class="state ${state}" i18n:translate>
            Blocked
        </div>
    </tal:b>
</metal:booking_state>

<metal:periods define-macro="periods" i18n:domain="onegov.feriennet" i18n:domain="onegov.feriennet">
    <div class="filter-panel" tal:condition="len(periods) > 1">
        <h2 class="filter-title" i18n:translate>Period</h2>
        <select onchange="location = this.value;">
            <option tal:repeat="p periods" value="${request.link(model.for_period(p))}" tal:attributes="selected p.id == period.id">
                ${p.title}
            </option>
        </select>
    </div>
</metal:periods>

<metal:users define-macro="users" i18n:domain="onegov.feriennet" i18n:domain="onegov.feriennet">
    <div class="filter-panel" tal:condition="request.is_admin and users">
        <h2 class="filter-title" i18n:translate>User</h2>
        <select onchange="location = this.value;">
            <tal:b repeat="u users">
                <option tal:condition="u.username == request.current_username or u.realname"
                        tal:attributes="selected u.id == user.id"
                        value="${user_select_link(u)}">
                    ${u.title}
                </option>
            </tal:b>
        </select>
    </div>
</metal:users>

<metal:actions_button define-macro="actions-button" i18n:domain="onegov.feriennet" i18n:domain="onegov.feriennet">
    <a href="#" data-dropdown="${action_id}" aria-expanded="false" class="tiny button actions-button">
        <span class="show-for-sr" i18n:translate>Actions</span>
        <i class="fa fa-ellipsis-h" aria-hidden="true"></i>
    </a>
    <ul id="${action_id}" data-dropdown-content class="f-dropdown" aria-hidden="true">
        <li
            tal:repeat="link links"
            tal:content="structure link(layout)"
        />
    </ul>
</metal:actions_button>

<metal:search_result_attendees define-macro="search_result_attendees" i18n:domain="onegov.feriennet">
    <a href="${request.link(result)}">${result.name}</a>
    <p i18n:translate>Attendee</p>
</metal:search_result_attendees>

<metal:ticket_status_page_message define-macro="ticket_status_page_message" i18n:domain="onegov.feriennet">
    <p i18n:translate tal:condition="ticket.state == 'open'">
        Your request will be processed shortly. To see the state of
        your process your may return to this page at any time.

        All information on this page has been sent to your e-mail address.
    </p>
    <p i18n:translate tal:condition="ticket.state == 'closed'">
        Your request has been completed.
    </p>
</metal:ticket_status_page_message>


<metal:payment_link_fallback define-macro="payment_link_fallback" i18n:domain="onegov.feriennet">
    <tal:b switch="link.__tablename__">
        <tal:b case="'invoice_items'">
            <div tal:condition="repeat.link.start">
                <a href="${request.link(link)}">
                    <strong>${request.app.user_titles_by_name[link.invoice.user.username]}</strong>
                </a>
                <div>
                    ${request.app.periods_by_id[link.invoice.period_id.hex].title}
                </div>
            </div>
        </tal:b>
    </tal:b>
</metal:payment_link_fallback>
