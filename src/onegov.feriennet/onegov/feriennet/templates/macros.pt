<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      i18n:domain="onegov.feriennet">
<body>

<metal:activity_ticket_summary define-macro="activity_ticket_summary">
    <h2>${activity.title}</h2>
    <metal:block use-macro="layout.macros.activity_detailed" tal:define="show_ticket_panel False" />
</metal:activity_ticket_summary>

<metal:activity_detailed define-macro="activity_detailed" i18n:domain="onegov.feriennet">

    <tal:block metal:use-macro="layout.macros.page_content"
        tal:define="lead activity.lead; text activity.text; coordinates activity.coordinates; people None; contact None; show_side_panel True;">

        <div metal:fill-slot="after-lead" tal:condition="activity.tags">
            <ul class="tags">
                <li tal:repeat="tag activity.ordered_tags(request)">
                    ${request.translate(tag)}
                </li>
            </ul>
        </div>

        <div metal:fill-slot="before-panels">
            <div class="page-content-panel activity-organiser-panel" tal:define="organiser activity.user">
                <h2 i18n:translate>Organiser</h2>
                <metal:block use-macro="layout.macros.organiser" />

                <small tal:condition="show_ticket_panel and not request.is_admin and organiser.username == request.identity.userid|nothing">
                    <a href="${request.return_here(request.link(request.app.org, 'benutzerprofil'))}" i18n:translate>Edit contact info</a>
                </small>

                <small tal:condition="show_ticket_panel and request.is_admin">
                    <a href="${request.return_here(request.link(activity.user))}" i18n:translate>Edit contact info</a>
                </small>
            </div>
        </div>

        <div metal:fill-slot="after-panels" tal:condition="show_ticket_panel and request.is_organiser">
            <div class="page-content-panel plain-panel activity-status-panel">
                <h2 class="show-for-sr" i18n:translate>Activity</h2>

                <dl>
                    <dt i18n:translate>
                        Status
                    </dt>
                    <dd>
                        <metal:block use-macro="layout.macros.activity_state" />
                    </dd>

                    <tal:block condition="ticket|nothing">
                        <dt i18n:translate>
                            Ticket
                        </dt>
                        <dd>
                            <span class="ticket-number">
                                <a tal:condition="request.is_admin" href="${request.link(ticket)}">${ticket.number}</a>
                                <a tal:condition="not:request.is_admin" href="${request.link(ticket, 'status')}">${ticket.number}</a>
                            </span>
                        </dd>
                    </tal:block>
                </dl>
            </div>
        </div>

    </tal:block>
</metal:activity_detailed>

<metal:activity_state define-macro="activity_state" i18n:domain="onegov.feriennet">
    <div class="activity-state activity-state-${activity.state}">
        <metal:block use-macro="layout.macros.activity_state_text" />
    </div>
</metal:activity_state>

<metal:activity_state_text define-macro="activity_state_text" i18n:domain="onegov.feriennet">
    <tal:block switch="activity.state">
        <tal:block i18n:translate case="string:preview">Preview</tal:block>
        <tal:block i18n:translate case="string:proposed">Proposed</tal:block>
        <tal:block i18n:translate case="string:accepted">Accepted</tal:block>
        <tal:block i18n:translate case="string:denied">Denied</tal:block>
        <tal:block i18n:translate case="string:archived">Archived</tal:block>
    </tal:block>
</metal:activity_state_text>


<metal:organiser define-macro="organiser" i18n:domain="onegov.feriennet">
    <div class="organiser">
        <ul>
            <li class="organiser-name"
                tal:condition="organiser.realname|nothing"
                tal:content="organiser.realname">
            </li>
            <li class="organiser-address"
                tal:condition="organiser.data.address|nothing"
                tal:content="organiser.data.address">
            </li>
            <li class="organiser-email" tal:define="email organiser.data.email or organiser.username|organiser.username">
                <a href="mailto:${email}">${email}</a>
            </li>
            <li class="organiser-phone" tal:condition="organiser.data.phone|nothing">
                <a href="tel:${organiser.data.phone}">${organiser.data.phone}</a>
            </li>
            <li class="organiser-website" tal:condition="organiser.data.website|nothing">
                <a href="${organiser.data.website}">${organiser.data.website.replace('http://', '').replace('https://', '')}</a>
            </li>
        </ul>
    </div>
</metal:organiser>
