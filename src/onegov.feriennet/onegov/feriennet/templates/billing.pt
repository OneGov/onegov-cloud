<div metal:use-macro="layout.base" i18n:domain="onegov.feriennet">
    <tal:block metal:fill-slot="title">
        ${title}
    </tal:block>
    <tal:block metal:fill-slot="content" tal:define="bills model.bills">

        <div class="callout panel">
            <div class="hints">
                <tal:block metal:use-macro="layout.macros.period_hints" />

                <div class="hint hint-costs" i18n:translate tal:condition="bills">
                    The total amount is <strong tal:content="'{:.2f}'.format(total)" i18n:name="amount" /> CHF.
                </div>

                <div class="hint hint-outstanding" i18n:translate tal:condition="bills">
                    The outstanding amount is <strong tal:content="'{:.2f}'.format(outstanding)" i18n:name="amount" /> CHF.
                </div>
            </div>
        </div>

        <div class="row">
            <div class="columns small-12 medium-8">
                <tal:block condition="not: bills" i18n:translate>No bills created yet.</tal:block>

                <div class="bills">
                    <div class="bill ${details.paid and 'paid' or 'unpaid'}" tal:repeat="(username, details) bills.items()">
                        <h3>${details.title}</h3>

                        <strong class="total">
                            ${'{:.2f}'.format(details.total)}

                            <a href="#" class="tiny button circle" data-dropdown="item-dropdown-${details.index}">
                                <span i18n:translate class="show-for-sr">Actions</span>
                                <i class="fa fa-wrench" aria-hidden="true"></i>
                            </a>
                            <ul id="item-dropdown-${details.index}" class="tiny f-dropdown" data-dropdown-content>
                              <li><a href="#">Mark whole bill as paid</a></li>
                            </ul>
                        </strong>

                        <button id="button-${details.index}" data-toggle="#details-${details.index}" class="untoggled">
                            <span i18n:translate class="show-for-sr">Show Details</span>
                            <i class="fa fa-angle-double-down" aria-hidden="true"></i>
                        </button>

                        <table id="details-${details.index}" class="invoice-items" style="display: none;">
                            <thead class="show-for-sr">
                                <tr>
                                    <th i18n:translate>Booking Text</th>
                                    <th i18n:translate>Amount</th>
                                    <th i18n:translate>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tal:block repeat="(group, groupitems) details.items.items()">
                                    <tr class="group">
                                        <td colspan="3">${group}</td>
                                    </tr>
                                    <tr tal:repeat="item groupitems" tal:define="groupid hash(groupitems)">
                                        <td>${item.text}</td>
                                        <td class="amount">${'{:.2f}'.format(item.amount)}</td>
                                        <td class="actions">
                                            <a href="#" class="tiny button circle" data-dropdown="item-dropdown-${details.index}-${groupid}-${repeat.item.index}">
                                                <span i18n:translate class="show-for-sr">Actions</span>
                                                <i class="fa fa-wrench" aria-hidden="true"></i>
                                            </a>
                                            <ul id="item-dropdown-${details.index}-${groupid}-${repeat.item.index}" class="tiny f-dropdown" data-dropdown-content>
                                              <li><a href="#">Mark position as paid</a></li>
                                            </ul>
                                        </td>
                                    </tr>
                                </tal:block>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="columns small-12 medium-4">
                <div class="page-content-panel form-panel">
                    <h4 i18n:translate>Billing</h4>

                    <tal:block condition="period.active and period.booking_phase">
                        <div metal:use-macro="layout.macros['form']" />
                    </tal:block>

                    <tal:block condition="period.active and not period.confirmed">
                        <p>
                            <i class="fa fa-lock fa-fw" aria-hidden="true"></i>
                            <span i18n:translate>
                                The matching of this period has not been confirmed yet.
                            </span>
                        </p>
                    </tal:block>

                    <tal:block condition="not period.active and not period.finalized">
                        <p>
                            <i class="fa fa-lock fa-fw" aria-hidden="true"></i>
                            <span i18n:translate>
                                This period is not active. Bills may only be created for the active period.
                            </span>
                        </p>
                    </tal:block>

                    <tal:block condition="period.finalized">
                        <p>
                            <i class="fa fa-lock fa-fw" aria-hidden="true"></i>
                            <span i18n:translate>
                                The billing for this period has been confirmed. You can still change the invoices manually but you can no longer generate them automatically.
                            </span>
                        </p>
                    </tal:block>
                </div>

                <tal:block metal:use-macro="layout.macros.periods" />
            </div>
        </div>
    </tal:block>
</div>
