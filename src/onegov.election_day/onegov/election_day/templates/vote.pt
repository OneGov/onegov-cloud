<div metal:use-macro="layout.base" i18n:domain="onegov.election_day">
    <tal:block metal:fill-slot="before-content">

        <h1>
            <small i18n:translate="" tal:condition="not:counted">Not yet counted.</small>
            <small tal:condition="vote.answer">
                <div tal:condition="not: vote.counter_proposal" metal:use-macro="layout.macros['answer']" tal:define="answer vote.answer"/>
                <div tal:condition="vote.counter_proposal">
                    <tal:block tal:define="proposal vote.proposal.accepted;
                                           counter_proposal vote.counter_proposal.accepted;
                                           tie_breaker vote.tie_breaker.accepted">
                        <span tal:condition="python: not proposal and not counter_proposal" class="answer rejected" i18n:translate="">
                            Proposal and counter proposal rejected
                        </span>
                        <span tal:condition="python: proposal and not counter_proposal" class="answer accepted" i18n:translate="">
                            Proposal accepted
                        </span>
                        <span tal:condition="python: not proposal and counter_proposal" class="answer accepted" i18n:translate="">
                            Counter proposal accepted
                        </span>
                        <tal:block tal:condition="python: proposal and counter_proposal">
                            <span tal:condition="tie_breaker" class="answer accepted" i18n:translate="">
                                Tie breaker in favor of the proposal
                            </span>
                            <span tal:condition="not: tie_breaker" class="answer rejected" i18n:translate="">
                                Tie breaker in favor of the counter proposal
                            </span>
                        </tal:block>
                    </tal:block>
                </div>
            </small>
            ${vote.title}
        </h1>

        <div class="download-results">
            <a data-dropdown="download-dropdown" data-options="align:left" aria-controls="download-dropdown" aria-expanded="false"><i class="fa fa-download"></i></a>
            <ul id="download-dropdown" class="f-dropdown" data-dropdown-content aria-hidden="true" tabindex="-1">
                <li><a href="${request.link(vote, 'data-json')}">JSON</a></li>
                <li><a href="${request.link(vote, 'data-csv')}">CSV</a></li>
                <li><a href="${request.link(vote, 'data-xlsx')}">XLSX</a></li>
                <li><a href="${layout.opendata_link}"><em i18n:translate="">Format Description</em></a></li>
            </ul>
        </div>

        <div class="clearfix"></div>

        <div class="row percentages">
            <div class="columns small-12 medium-6">
                <dl>
                    <dt i18n:translate="">Yeas</dt>
                    <dd class="accepted" >${'{0:.2f}'.format(vote.yeas_percentage)}%</dd>
                </dl>
            </div>
            <div class="columns small-12 medium-6 end">
                <dl style="text-align: right;">
                    <dt i18n:translate="">Nays</dt>
                    <dd class="rejected" >${'{0:.2f}'.format(vote.nays_percentage)}%</dd>
                </dl>
            </div>
        </div>

        <div class="percentage">
            <div class="yeas"></div>
            <div class="nays right" style="width:${'{0:.2f}'.format(vote.nays_percentage)}%"></div>
        </div>

    </tal:block>
    <tal:block metal:fill-slot="content">

        <div metal:use-macro="layout.macros['temporary_results_callout']" tal:define="last_change vote.last_result_change; counted vote.ballots and counted" />

        <h2 i18n:translate="">Results</h2>

        <tal:block tal:repeat="ballot vote.ballots">
            <h3 tal:condition="vote.counter_proposal">
                <metal:type use-macro="layout.macros['ballot-type']" tal:define="ballot_type ballot.type" />
            </h3>

            <ul class="small-block-grid-1 medium-block-grid-4 factoids">
                <li>
                    <span i18n:translate="">Turnout</span>
                    <strong>${'{0:.2f}'.format(ballot.turnout)} %</strong>
                </li>
                <li>
                    <span i18n:translate="">Elegible Voters</span>
                    <strong>${layout.format_number(ballot.elegible_voters)}</strong>
                </li>
                <li>
                    <span i18n:translate="">Cast Ballots</span>
                    <strong>${layout.format_number(ballot.cast_ballots)}</strong>
                </li>
                <li>
                    <span i18n:translate="">Counted</span>
                    <strong><span metal:use-macro="layout.macros['progress']" tal:define="progress ballot.progress" /></strong>
                </li>
            </ul>

            <div class="row" tal:condition="use_maps">
                <div class="small-12 small-centered medium-8 large-6 columns">
                    <div class="ballot-map" i18n:attributes="data-download-link; data-embed-link"
                        data-type="${ballot.type}"
                        data-canton="${layout.app.principal.canton}"
                        data-mapurl="${layout.get_topojson_link(layout.app.principal.id, vote.date.year)}"
                        data-dataurl="${request.link(ballot, name='by-entity')}"
                        data-download-link="Download"
                        data-embed-link="Embed"
                        data-embed-source="${request.link(ballot, name='map')}">

                        <div class="legend" data-left-hand="Yay" data-right-hand="Nay" i18n:attributes="data-left-hand; data-right-hand"></div>
                    </div>
                </div>
            </div>

            <div class="foldable folded">
                <h3 tal:condition="not:vote.counter_proposal" class="foldable-title" i18n:translate="">Electoral Districts</h3>
                <h4 tal:condition="vote.counter_proposal" class="foldable-title" i18n:translate="">Electoral Districts</h4>
                <div class="foldable-panel">
                    <table class="ballot-results stackable" tal:define="summarize len(ballot.results)!=1">
                        <thead>
                            <tr>
                                <th i18n:translate="">Electoral District</th>
                                <th i18n:translate="">Result</th>
                                <th i18n:translate="" class="right-aligned">Yeas</th>
                                <th i18n:translate="" class="right-aligned">Nays</th>
                                <th i18n:translate="" class="right-aligned">Empty</th>
                                <th i18n:translate="" class="right-aligned">Invalid</th>
                                <th i18n:translate="" class="right-aligned">Yes %</th>
                                <th i18n:translate="" class="right-aligned">No %</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="total" tal:condition="summarize">
                                <td i18n:translate="">Total</td>
                                <td class="answer" tal:condition="not:counted" i18n:translate="">Not yet counted.</td>
                                <td class="answer accepted" tal:condition="counted and ballot.accepted" i18n:translate="">Accepted</td>
                                <td class="answer rejected" tal:condition="counted and not ballot.accepted" i18n:translate="">Rejected</td>
                                <td class="right-aligned">${layout.format_number(ballot.yeas)}</td>
                                <td class="right-aligned">${layout.format_number(ballot.nays)}</td>
                                <td class="right-aligned">${layout.format_number(ballot.empty)}</td>
                                <td class="right-aligned">${layout.format_number(ballot.invalid)}</td>
                                <td class="right-aligned">${layout.format_number(ballot.yeas_percentage)}</td>
                                <td class="right-aligned">${layout.format_number(ballot.nays_percentage)}</td>
                            </tr>

                            <tr tal:repeat="result ballot.results" data-municipality-id="${result.entity_id}">
                                <tal:block condition="not: result.counted">
                                    <td tal:condition="summarize">${result.group}</td>
                                    <td class="answer" colspan="7" i18n:translate="">Not yet counted.</td>
                                </tal:block>
                                <tal:block condition="result.counted">
                                    <td>${result.group}</td>
                                    <td class="answer accepted" tal:condition="result.accepted" i18n:translate="">Accepted</td>
                                    <td class="answer rejected" tal:condition="not: result.accepted" i18n:translate="">Rejected</td>
                                    <td class="right-aligned">${layout.format_number(result.yeas)}</td>
                                    <td class="right-aligned">${layout.format_number(result.nays)}</td>
                                    <td class="right-aligned">${layout.format_number(result.empty)}</td>
                                    <td class="right-aligned">${layout.format_number(result.invalid)}</td>
                                    <td class="right-aligned">${layout.format_number(result.yeas_percentage)}</td>
                                    <td class="right-aligned">${layout.format_number(result.nays_percentage)}</td>
                                </tal:block>
                            </tr>

                            <tr class="total" tal:condition="summarize">
                                <td i18n:translate="">Total</td>
                                <td class="answer" tal:condition="not:counted" i18n:translate="">Not yet counted.</td>
                                <td class="answer accepted" tal:condition="counted and ballot.accepted" i18n:translate="">Accepted</td>
                                <td class="answer rejected" tal:condition="counted and not ballot.accepted" i18n:translate="">Rejected</td>
                                <td class="right-aligned">${layout.format_number(ballot.yeas)}</td>
                                <td class="right-aligned">${layout.format_number(ballot.nays)}</td>
                                <td class="right-aligned">${layout.format_number(ballot.empty)}</td>
                                <td class="right-aligned">${layout.format_number(ballot.invalid)}</td>
                                <td class="right-aligned">${layout.format_number(ballot.yeas_percentage)}</td>
                                <td class="right-aligned">${layout.format_number(ballot.nays_percentage)}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </tal:block>

        <div metal:use-macro="layout.macros['related_link']" tal:define="meta vote.meta" />

        <div metal:use-macro="layout.macros['archive']" />

    </tal:block>
</div>
