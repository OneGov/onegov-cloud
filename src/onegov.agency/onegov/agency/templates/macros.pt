<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      i18n:domain="onegov.agency">
<body>

    <metal:agency_card define-macro="agency_list_card" i18n:domain="onegov.agency">
        <div class="agency-card agency-list-card">
            <strong><a href="${request.link(agency)}">${agency.title}</a></strong>
            <ul>
                <li tal:repeat="child agency.children">
                    <a href="${request.link(child)}">${child.title}</a>
                </li>
            </ul>
        </div>
    </metal:agency_card>

    <metal:agency_card define-macro="agency_card" i18n:domain="onegov.agency">
        <div class="agency-card agency-single-item" tal:define="memberships list(agency.memberships); children list(agency.children)">
            <tal:block tal:condition="agency.portrait">
                <h3 i18n:translate>Portrait</h3>
                <div tal:content="structure agency.portrait_html"></div>
            </tal:block>

            <tal:block tal:condition="agency.organigram_file">
                <h3 i18n:translate>Organigram</h3>
                <img src="${request.link(agency.organigram)}">
            </tal:block>

            <tal:block tal:condition="children">
                <h3 i18n:translate>Suborganizations</h3>
                <ul class="children">
                    <li tal:repeat="child children">
                        <a href="${request.link(child)}">${child.title}</a>
                    </li>
                </ul>
            </tal:block>

            <tal:block tal:condition="memberships">
                <h3 i18n:translate>People</h3>
                <dl>
                    <tal:block tal:repeat="membership memberships">
                        <tal:block tal:condition="request.is_logged_in">
                            <dt><a style="text" href="${request.link(membership)}">${membership.title}</a></dt>
                            <dd>${membership.person.title}</dd>
                        </tal:block>
                        <tal:block tal:condition="not:request.is_logged_in">
                            <dt>${membership.title}</dt>
                            <dd><a href="${request.link(membership.person)}">${membership.person.title}</a></dd>
                        </tal:block>
                        <br>
                    </tal:block>
                </dl>
            </tal:block>

        </div>
    </metal:agency_card>

    <metal:person_card define-macro="person_list_card" i18n:domain="onegov.agency">
        <div class="person-card person-list-card">
            <ul>
                <li class="person-card-title">
                    <a href="${request.link(person)}">${person.title}</a>
                </li>
                <li tal:repeat="membership person.memberships_by_agency" class="person-card-function">
                    <em title="${layout.agency_path(membership.agency)|None}">${membership.title} ${membership.agency.title}</em>
                </li>
                <li tal:condition="layout.field_visible('email', model=person)|None" class="person-card-email">
                    <a href="mailto:${person.email}">${person.email}</a>
                </li>
                <li tal:condition="layout.field_visible('phone', model=person)|None" class="person-card-phone">
                    <a href="tel:${person.phone}">${person.phone}</a>
                </li>
            </ul>
            <div class="clearfix"></div>
        </div>
    </metal:person_card>

    <metal:person_card define-macro="person_card" i18n:domain="onegov.agency">
        <div class="person-card person-single-item" tal:define="memberships list(person.memberships_by_agency)">
            <dl>
                <tal:block tal:condition="layout.field_visible('salutation')">
                    <dt i18n:translate>Salutation</dt>
                    <dd>${person.salutation}</dd>
                </tal:block>

                <tal:block tal:condition="layout.field_visible('academic_title')">
                    <dt i18n:translate>Academic Title</dt>
                    <dd>${person.academic_title}</dd>
                </tal:block>

                <tal:block tal:condition="layout.field_visible('profession')">
                    <dt i18n:translate>Profession</dt>
                    <dd>${person.profession}</dd>
                </tal:block>

                <tal:block tal:condition="layout.field_visible('political_party')">
                    <dt i18n:translate>Political Party</dt>
                    <dd>${person.political_party}</dd>
                </tal:block>

                <tal:block tal:condition="layout.field_visible('year')">
                    <dt i18n:translate>Year</dt>
                    <dd>${person.year}</dd>
                </tal:block>

                <tal:block tal:condition="layout.field_visible('address')">
                    <dt i18n:translate>Address</dt>
                    <dd tal:content="structure person.address_html"></dd>
                </tal:block>

                <tal:block tal:condition="layout.field_visible('email')">
                    <dt i18n:translate>Email</dt>
                    <dd><a href="mailto:${person.email}">${person.email}</a></dd>
                </tal:block>

                <tal:block tal:condition="layout.field_visible('phone')">
                    <dt i18n:translate>Phone</dt>
                    <dd><a href="tel:${person.phone}">${person.phone}</a></dd>
                </tal:block>

                <tal:block tal:condition="layout.field_visible('direct_phone')">
                    <dt i18n:translate>Direct Phone</dt>
                    <dd><a href="tel:${person.direct_phone}">${person.direct_phone}</a></dd>
                </tal:block>

                <tal:block tal:condition="layout.field_visible('website')">
                    <dt i18n:translate>Website</dt>
                    <dd><a href="${person.website}">${person.website}</a></dd>
                </tal:block>

                <tal:block tal:condition="layout.field_visible('notes')">
                    <dt i18n:translate>Notes</dt>
                    <dd tal:content="structure person.notes_html"></dd>
                </tal:block>

                <dt tal:condition="memberships" i18n:translate>Memberships</dt>
                <dd tal:repeat="membership memberships" class="person-card-membership">
                    <a href="${request.link(membership.agency)}" title="${layout.agency_path(membership.agency)|None}">${membership.agency.title}</a> - ${membership.title}
                </dd>
            </dl>
        </div>
    </metal:person_card>

    <metal:membership_card define-macro="membership_card" i18n:domain="onegov.agency">
        <div class="membership-card membership-single-item">
            <dl>
                <tal:block tal:condition="membership.title">
                    <dt i18n:translate>Title</dt>
                    <dd>${membership.title}</dd>
                </tal:block>

                <tal:block tal:condition="membership.agency">
                    <dt i18n:translate>Agency</dt>
                    <dd><a href="${request.link(membership.agency)}">${membership.agency.title}</a></dd>
                </tal:block>

                <tal:block tal:condition="membership.person">
                    <dt i18n:translate>Person</dt>
                    <dd><a href="${request.link(membership.person)}">${membership.person.title}</a></dd>
                </tal:block>

                <tal:block tal:condition="membership.since">
                    <dt i18n:translate>Since</dt>
                    <dd>${membership.since}</dd>
                </tal:block>
            </dl>
        </div>
    </metal:membership_card>

    <metal:search_result_people define-macro="search_result_people" i18n:domain="onegov.agency">
        <a href="${request.link(result)}">${result.title}</a>
        <p tal:define="memberships result.memberships_by_agency">
            <span tal:repeat="membership memberships">${membership.title} ${membership.agency.title}<br></span>
            <span tal:condition="not:memberships|nothing" i18n:translate>People</span>
        </p>
    </metal:search_result_people>

    <metal:search_result_agencies define-macro="search_result_agencies" i18n:domain="onegov.agency">
        <a href="${request.link(result)}">${result.title}</a>
        <p tal:condition="result.description|nothing">${result.description}</p>
        <p tal:condition="not:result.description|nothing" i18n:translate>Agencies</p>
    </metal:search_result_agencies>

    <metal:search_result_agency_memberships define-macro="search_result_agency_memberships" i18n:domain="onegov.agency">
        <a href="${request.link(result.person)}">${result.person.title}</a>
        <p>${result.title} ${result.agency.title}</p>
    </metal:search_result_agency_memberships>

</body>
