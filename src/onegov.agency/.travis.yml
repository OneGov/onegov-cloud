cache: pip

matrix:
  include:
    - language: python
      python: "3.6"
      env: TOXENV=py36

    - language: python
      python: "3.6"
      env: TOXENV=pep8

addons:
  postgresql: "9.6"
  apt:
        packages:
            - ghostscript
            - libpoppler-cpp-dev

install:
    - pip install tox
    - if [ "$TOXENV" = 'py36' ]; then pip install coveralls; fi

script:
    - tox -e $TOXENV

after_success:
    - if [ "$TOXENV" = 'py36' ]; then coveralls; fi
    - 'if [ "$TOXENV" = "py36" ]; then $TRAVIS_BUILD_DIR/.tox/py36/bin/pip freeze | sed -r "s/^-e git.*?egg=([a-z\._]+)$/\1==${TRAVIS_TAG:1}/g" > $TRAVIS_BUILD_DIR/requirements.txt; fi'
    - if [ "$TOXENV" = 'py36' ]; then cat requirements.txt; fi

deploy:

  - provider: releases
    api_key:
        secure: "DFUhGiLHPhZvkKZHxE6XMe1av9CWPHqB1vj3fxmJLxcNHw77G1UgPPhJLIydlIwzvj0WwBFcnp3ev1LV8pyKnccL7ZYUUldQqzTpukoHPq9HNUFvwKxTk8CP4jYqtyLVMbDWZUUcEmZpv/3ECwxL5mwgju9wS2yyhTJ12jeeu6mHVDXa6vkz4agz1Y4tAmL9VyxC3Qhy5jowAXbBdJfqZ2GZHrYegLddW2NLVkrV6EVVHOpITfjJxPcBI0GX6VeZkxKTYNU4o5ReB4hz0t2P2quJrBG/ke9muHTDT2xxBWUQUfWn2OkeJMJg6LEdMvOKXeOCVpzL2v2DzBIM2sN58q/fFuRakWGI0EgsV6IcgvuEI748ZQ8hf0+DMMdUALQz7sYsr5UXKFGPDF+Cd49TBENViDkFfpq9SOy3i1lVp6zWOhtVInoTJhJbiHT1BNmClIZk49ddc9D7xtsr6PHVw3LO6heTvgBud3Qw/InrDolWiDRp566N0KNvCWMRnze9D1uXVo+3NwZN6dTPA4l+fwliaiXaiw50lJzL5gUsZqT9CIEj1BXB1XSt6E7w2gVYnGmjlxziKHHTAEG/UN3YvCpUxlTsuknA6lY/lKieMzLbktyDwtP0dAO4lHEhkPftCRR0W3RM9B15QJ2m/HHRXvpA5d+1sV4Dff2FqSrIFgs="
    file: requirements.txt
    skip_cleanup: true
    on:
        tags: true
        condition: $TOXENV = py36

  - provider: pypi
    distributions: "sdist bdist_wheel"
    user: seantis
    password:
        secure: ""
    on:
        tags: true
        condition: $TOXENV = py36
