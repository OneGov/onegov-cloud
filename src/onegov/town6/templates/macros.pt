<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      i18n:domain="onegov.town6">
<body>

<metal:favicon define-macro="favicon">
    <link tal:condition="layout.favicon_apple_touch_url|nothing" rel="apple-touch-icon" sizes="57x57" href="${layout.favicon_apple_touch_url}">
    <link tal:condition="layout.favicon_win_url|nothing" rel="icon" type="image/png" href="${layout.favicon_win_url}" sizes="16x16">
    <link tal:condition="layout.favicon_mac_url|nothing" rel="icon" type="image/png" href="${layout.favicon_mac_url}" sizes="32x32">
    <link tal:condition="layout.favicon_pinned_tab_safari_url|nothing" rel="mask-icon" href="${layout.favicon_pinned_tab_safari_url}" color="${layout.primary_color}">
    <link tal:condition="not layout.favicon_apple_touch_url|nothing and
            not layout.favicon_win_url|nothing and
            not layout.favicon_mac_url|nothing and
            not layout.favicon_pinned_tab_safari_url|nothing" rel="icon" href="data:;base64,iVBORw0KGgo=">
    <meta name="theme-color" content="${layout.primary_color}">
</metal:favicon>

<metal:b define-macro="before_directory_entry_lead">
    <!--! To be override by other applications -->
</metal:b>

<metal:b define-macro="extra_usermanagement_fields">
    <!--! To be override by other applications -->
</metal:b>

<metal:b define-macro="consume_messages" i18n:domain="onegov.town6">
    <div tal:repeat="message request.consume_messages()" data-closable class="callout alert-box ${message.type}">
        ${message.text}
        <button class="close-button" aria-label="Dismiss alert" type="button" data-close>
            <span aria-hidden="true">&times;</span>
        </button>
      </div>
</metal:b>

<metal:navigation define-macro="sort-items-nested">
    <a tal:condition="children">
        <span data-click-target="${link.attrs['href']}">${link.text}</span>
        <metal:b use-macro="layout.macros['access_hint']" tal:define="item page"/>
        <metal:b use-macro="layout.macros['publication_hint']" tal:define="item page"/>
    </a>
    <tal:b tal:condition="not: children">
        <a href="${link.attrs['href']}">
            <span>${link.text}</span>
            <metal:b use-macro="layout.macros['access_hint']" tal:define="item page"/>
            <metal:b use-macro="layout.macros['publication_hint']" tal:define="item page"/>
        </a>
    </tal:b>
    <ul class="vertical menu nested" tal:condition="children">
        <tal:b tal:repeat="(page, sublink, c) children">
            <li data-sortable-id="${page.id}">
                <metal:b use-macro="layout.macros['sort-items-nested']" tal:define="link sublink; children c" />
            </li>
        </tal:b>
    </ul>
</metal:navigation>

<metal:navigation define-macro="side-navigation-nested">
    <a tal:condition="children" tal:define="page page|None">
        <div class="navlink ${'current' if nav_page == page else ''}">
            <span data-click-target="${link.attrs['href']}">
                ${link.text}
                <metal:b use-macro="layout.macros['access_hint']" tal:define="item nav_page"/>
                <metal:b use-macro="layout.macros['publication_hint']" tal:define="item nav_page"/>
            </span>
        </div>
    </a>
    <tal:b tal:condition="not: children" tal:define="page page|None">
        <a href="${link.attrs['href']}">
            <div class="navlink ${'current' if nav_page == page else ''}">
                <span>
                    ${link.text}
                    <metal:b use-macro="layout.macros['access_hint']" tal:define="item nav_page"/>
                    <metal:b use-macro="layout.macros['publication_hint']" tal:define="item nav_page"/>
                </span>
            </div>
        </a>
    </tal:b>
    <tal:b tal:define="ancestors layout.model.ancestors|[]">
        <ul class="vertical menu nested ${'is-active current-list' if nav_page in ancestors else ''}"  tal:condition="children">
            <tal:b tal:repeat="(nav_page, sublink, c) children">
                <li data-sortable-id="${nav_page.id}">
                    <metal:b use-macro="layout.macros['side_navigation_nested']" tal:define="link sublink; children c" />
                </li>
            </tal:b>
        </ul>
    </tal:b>
</metal:navigation>

<metal:navigation define-macro="side-navigation">
    <ul class="vertical menu side-navigation drilldown" data-auto-height="true" data-responsive-menu="drilldown medium-accordion" data-back-button="${layout.drilldown_back}" tal:define="links top_navigation|layout.top_navigation">
        <li tal:repeat="(nav_page, link, children) links" data-sortable-id="${nav_page.id}">
            <metal:b use-macro="layout.macros['side_navigation_nested']" />
        </li>
    </ul>
</metal:navigation>

<metal:header_links define-macro="header_links">
    <div id="header_links" class="text-center" tal:define="links header_options.get('header_links')" tal:condition="links">
        <div class="grid-container">
            <div class="title-bar align-center" data-responsive-toggle="animated-menu" data-hide-for="medium">
                <button type="button" data-toggle><i class="fa fa-bars"></i> </button>
                </div>

                <div class="top-bar" id="animated-menu">
                <div class="top-bar-left">
                    <ul class="dropdown menu align-center" data-dropdown-menu>
                        <li tal:repeat="link links"><a href="${link[1]}">${link[0] if link[0] else link[1]}</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</metal:header_links>

<metal:header-text define-macro="header-text">
    <div id="header_text" tal:condition="header_options['left_header_name']|nothing" tal:define="color header_options.get('left_header_color'); rem_size header_options.get('left_header_rem', 1)">
        <div class="grid-container">
            <a class="h4" href="${header_options.get('left_header_url', '#')}"
                style="color:${color or '#fff'}; font-size: ${rem_size}rem">
                    ${header_options['left_header_name']}
            </a>
        </div>
    </div>
</metal:header-text>

<metal:editbar define-macro="dropdown-editbar">
        <ul class="dropdown menu edit-bar" data-dropdown-menu tal:condition="editbar_links">
            <li tal:repeat="group editbar_links|layout.editbar_links">
                <tal:b condition="group.links|nothing">
                    <a href="#" class="${' '.join(group.classes or ())}">${group.title}</a>
                    <ul class="menu">
                        <li tal:repeat="link group.links">
                            <tal:b replace="link(layout)" />
                        </li>
                    </ul>
                </tal:b>
                <tal:b condition="group.url|group.attrs|nothing" define="link group">
                    <tal:b replace="link(layout)" />
                </tal:b>
            </li>
        </ul>
</metal:editbar>

<metal:breadcrumbs define-macro="breadcrumbs">
    <tal:b tal:define="bc_level request.GET.get('bc-level', False)">
        <div id="breadcrumbs" class="${'show-in-iframe' if bc_level else ''}">
            <nav aria-label="You are here" role="navigation" i18n:attributes="aria-label">
                <ul class="breadcrumbs" tal:condition="layout.breadcrumbs" >
                    <tal:b repeat="link layout.breadcrumbs[int(bc_level or 0):]">
                        <li tal:content="link(layout)"></li>
                    </tal:b>
                </ul>
            </nav>
        </div>
    </tal:b>
</metal:breadcrumbs>

<metal:panel-links define-macro="panel-links">
    <ul class="${' '.join(classes) + ' panel-links' + (' callout' if as_callout else '')}" tal:define="as_callout as_callout|False; classes classes|[]">
        <li tal:repeat="link panel.links">
            <tal:b content="link(layout)" />
            <small tal:condition="show_subtitle|True">${link.subtitle}</small>
        </li>
    </ul>
</metal:panel-links>

<metal:footer define-macro="footer">
    <footer id="footer" class="footer-container">
        <div class="grid-container">
            <div class="grid-x grid-padding-x footer-content">
                <metal:b use-macro="layout.macros['footer_columns']" />
                <metal:b use-macro="layout.macros['footer_links']" />
            </div>
        </div>
    </footer>
</metal:footer>

<metal:footer_columns define-macro="footer_columns">
    <tal:b define="contact layout.org.contact_html|nothing;
        contact_url layout.org.contact_url|nothing;
        contact_url_label layout.org.contact_url_label|nothing;
        opening_hours layout.org.opening_hours_html|nothing;
        opening_hours_url_label layout.org.opening_hours_url_label|nothing;
        opening_hours_url layout.org.opening_hours_url|nothing;
        facebook layout.org.facebook_url|nothing;
        twitter layout.org.twitter_url|nothing;
        instagram layout.org.instagram_url|nothing;
        youtube layout.org.youtube_url|nothing;
        linkedin layout.org.linkedin_url|nothing;
        tiktok layout.org.tiktok_url|nothing;
        custom_links layout.custom_links|nothing;">
        <tal:b tal:condition="any((
            contact,
            contact_url,
            opening_hours,
            opening_hours_url,
            facebook,
            twitter,
            instagram,
            youtube,
            linkedin,
            tiktok,
            custom_links
        ))">
            <div class="small-12 medium-4 cell">
                <metal:b use-macro="layout.macros['footer_contact']" />
            </div>

            <div class="small-12 medium-4 cell">
                <metal:b use-macro="layout.macros['footer_opening_hours']" />
            </div>

            <div class="small-12 medium-4 cell">
                <metal:b use-macro="layout.macros['footer_social_media']" />
                <metal:b use-macro="layout.macros['footer_custom_links']" />
            </div>
        </tal:b>
    </tal:b>
</metal:footer_columns>

<metal:footer_custom_links define-macro="footer_custom_links">
    <tal:b define="custom_links layout.custom_links">
        <tal:b tal:condition="custom_links" tal:repeat="link custom_links">
            <h5 class="custom-links"><a class="footer-link" href="${link[1]}">${link[0]}</a></h5>
        </tal:b>
    </tal:b>
</metal:footer_custom_links>

<metal:footer_links define-macro="footer_links" i18n:domain="onegov.town6">
<div class="medium-4 cell"></div>
<div class="small-12 medium-6 cell footer-links">
    <tal:b condition="not request.app.org.hide_onegov_footer|True">
        <span>
            <a class="footer-link" href="https://www.admin.digital">OneGov Cloud</a> | <a class="footer-link" href="https://github.com/OneGov/onegov-cloud/blob/master/CHANGES.md#release-${layout.app.version.replace('.', '')}">${layout.app.version}</a>
        </span>
        <br/>
        <span>
            <a class="footer-link" href="https://www.admin.digital/datenschutz" i18n:translate>
                Privacy Protection
            </a>
        </span>
        <span tal:condition="request.app.org.impressum_url|None">
            <a class="footer-link" href="${request.app.org.impressum_url}" i18n:translate>
                Impressum
            </a>
        </span>
    </tal:b>
    <span tal:condition="not request.is_logged_in">
        <a class="footer-link" href="${layout.login_from_path()}" i18n:translate>
            Login
        </a>
    </span>
    <span tal:condition="request.app.org.citizen_login_enabled and not request.authenticated_email">
        <a href="${layout.citizen_login()}" i18n:translate>
            Citizen Login
        </a>
    </span>
    <span tal:define="about_url layout.org.meta.about_url|nothing" tal:condition="about_url">
        <a class="footer-link" href="${about_url}" i18n:translate>
            About
        </a>
    </span>
</div>
</metal:footer_links>

<metal:footer_contact define-macro="footer_contact" i18n:domain="onegov.town6">
    <h5 i18n:translate tal:condition="contact or contact_url">Contact</h5>
    <div tal:content="layout.org.contact_html" />
    <a class="footer-link" tal:condition="contact_url" tal:attributes="href contact_url">
        <strong>
            <tal:b tal:condition="not contact_url_label|nothing" i18n:translate>more</tal:b>…
            <tal:b tal:condition="contact_url_label|nothing" i18n:translate tal:content="contact_url_label" />…
        </strong>
    </a>
</metal:footer_contact>

<metal:footer_opening_hours define-macro="footer_opening_hours" i18n:domain="onegov.town6">
    <h5 i18n:translate tal:condition="opening_hours or opening_hours_url">Opening Hours</h5>
    <div tal:content="opening_hours" />
    <a class="footer-link" tal:condition="opening_hours_url" tal:attributes="href opening_hours_url">
        <strong>
            <tal:b tal:condition="not opening_hours_url_label|nothing" i18n:translate>more</tal:b>…
            <tal:b tal:condition="opening_hours_url_label|nothing" i18n:translate tal:content="opening_hours_url_label" />…
        </strong>
    </a>
</metal:footer_opening_hours>

<metal:footer_social_media define-macro="footer_social_media">
    <tal:b condition="any((
            facebook,
            twitter,
            instagram,
            youtube,
            linkedin,
            tiktok,
        ))">

        <h5 i18n:translate>Social Media</h5>
        <ul class="social-media-links">
            <li tal:condition="facebook">
                <a class="footer-link" tal:attributes="href facebook">
                    <i class="fab fa-facebook fa-fw"></i> Facebook
                </a>
            </li>
            <li tal:condition="twitter">
                <a class="footer-link" tal:attributes="href twitter">
                    <i class="fab fa-twitter fa-fw"></i> Twitter
                </a>
            </li>
            <li tal:condition="instagram">
                <a class="footer-link" tal:attributes="href instagram">
                    <i class="fab fa-instagram fa-fw"></i> Instagram
                </a>
            </li>
            <li tal:condition="youtube">
                <a class="footer-link" tal:attributes="href youtube">
                    <i class="fab fa-youtube fa-fw"></i> YouTube
                </a>
            </li>
            <li tal:condition="linkedin">
                <a class="footer-link" tal:attributes="href linkedin">
                    <i class="fab fa-linkedin fa-fw"></i> LinkedIn
                </a>
            </li>
            <li tal:condition="tiktok">
                <a class="footer-link" tal:attributes="href tiktok">
                    <i class="fab fa-tiktok fa-fw"></i> TikTok
                </a>
            </li>
        </ul>
    </tal:b>
</metal:footer_social_media>

<metal:footer_locales define-macro="footer_locales">
    <div class="footer-locales" tal:condition="layout.org.locales and len(layout.org.locales) > 1">
        <h5>Languages</h5>
        <div class="text-links">
            <tal:b repeat="(name, url) layout.locales">
                <a class="footer-link" tal:condition="request.locale not in url" href="${url}">${name}</a>
                <a class="footer-link" tal:condition="request.locale in url" style="cursor: default"><strong>${name}</strong></a>
            </tal:b>
        </div>
    </div>
</metal:footer_locales>

<metal:partners define-macro="partner-card">
    <div data-aos="fade" data-aos-duration="800" class="card" tal:condition="item.image_url">
        <a tal:attributes="href item.url">
            <img src="${item.image_url}" alt="${item.lead or ''}">
        </a>
        <div tal:condition="item.lead" class="card-section show-for-sr">${item.lead}</div>
    </div>
</metal:partners>

<metal:partners define-macro="partner-cards" i18n:domain="onegov.town6" tal:define="subpage subpage|False">
    <div class="partners grid-x grid-padding-x columns small-up-2 medium-up-3 large-up-4 align-center">
        <div class="cell" tal:repeat="item partners">
            <metal:b use-macro="layout.macros['partner-card']" />
        </div>
    </div>
</metal:partners>

<metal:events define-macro="event-item-card">
    <a href="${item.url}">
        <div class="card" data-aos="fade">
                <div class="${'' if item.image_url else 'no-image'}" style="width: 100%; padding-bottom: 55%; background-image: url(${item.image_url}); background-color: #a4a4a4; background-size: cover;"></div>
                <div class="image-placeholder no-image" tal:condition="not: item.image_url">
                    <i class="far fa-calendar-alt" aria-hidden="true"></i>
                </div>
                <div class="card-section" tal:condition="with_lead|False">
                    <h5>${item.lead}</h5>
                    <div class="date-place">
                        <div class="grid-x">
                            <div class="cell small-1 medium-2">
                                <i class="far fa-calendar-alt"></i>
                            </div>
                            <div class="cell small-11 medium-10">
                                ${item.subtitle}
                            </div>
                        </div>
                        <hr/>
                        <div class="grid-x">
                            <div class="cell small-1 medium-2">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div class="cell small-11 medium-10">
                                ${item.location}
                            </div>
                        </div>
                    </div>
                </div>
        </div>
    </a>
</metal:events>

<metal:panel define-macro="event-cards">
    <div tal:condition="event_panel|nothing" class="events grid-x grid-padding-x  align-center">
        <div class="cell small-12 medium-4 event-item flex-container" tal:repeat="item event_panel.links">
            <metal:b use-macro="layout.macros['event-item-card']" />
        </div>
    </div>
    <div class="newslist grid-x align-center">
        <a class="button hollow" href="${layout.events_url}" i18n:translate="">All events</a>
    </div>
</metal:panel>

<metal:card define-macro="directory-card">
    <div  data-aos="fade" data-aos-duration="800" class="card">
        <a tal:attributes="href link.url">
        <div class="card-section">
                <h5><i class="fa fa-list" aria-hidden="true"></i> ${link.text}</h5>
                <p>${link.subtitle}</p>
            </div>
        </a>
    </div>
</metal:card>

<metal:directory define-macro="directories-list">
    <div class="directories-list grid-x grid-padding-x align-center">
        <tal:b tal:repeat="link directory_panel.links[0:-1]">
            <div class="cell small-12 large-4 medium-6">
                <tal:b metal:use-macro="layout.macros['directory_card']" />
            </div>
        </tal:b>
    </div>
    <div class="grid-x align-center">
        <a class="button hollow" href="${layout.directories_url}" i18n:translate="">All directories</a>
    </div>
</metal:directory>

<metal:form define-macro="form">
    <form tal:attributes="action form.action|'.';data-image-upload-url layout.image_upload_json_url; data-image-list-url layout.image_list_url;data-file-upload-url layout.file_upload_json_url; data-file-list-url layout.file_list_url; data-sitecollection-url layout.sitecollection_url; id form_id|''" class="${form.css_class|''}" method="${form.method|'POST'}" enctype="multipart/form-data" tal:define="form_two_columns form_two_columns|False">
        <tal:b repeat="fieldset form.fieldsets">
            <fieldset tal:condition="fieldset.is_visible" id="fieldset-${fieldset.label.lower().replace(' ', '-')}">
                <legend>${fieldset.label}</legend>
                <div class="formfields ${'grid-x grid-padding-x wrapper' if form_two_columns else ''}">
                    <metal:fields use-macro="layout.macros['fields']" tal:define="fields fieldset.fields.values()" />
                </div>
            </fieldset>
            <tal:b condition="not:fieldset.is_visible">
                <div class="formfields ${'grid-x grid-padding-x wrapper' if form_two_columns else ''}">
                    <metal:fields use-macro="layout.macros['fields']" tal:define="fields fieldset.fields.values()" />
                </div>
            </tal:b>
        </tal:b>
        <metal:b define-slot="before-submit" />
        <tal:b condition="not: layout.edit_mode|False">
            <tal:b condition="cancel|nothing">
                <a class="button secondary cancel-button" href="${cancel}" role="button">
                    <tal:b condition="not:cancel_text|nothing" i18n:translate="">
                        Cancel
                    </tal:b>
                    <tal:b condition="cancel_text|nothing">
                        ${cancel_text}
                    </tal:b>
                </a>
            </tal:b>
            <tal:b condition="not: button_text|nothing">
                <input type="submit" value="Submit" class="button" i18n:attributes="value">
            </tal:b>
            <tal:b condition="button_text|nothing">
                <input type="submit" value="${button_text}" class="button" role="button">
            </tal:b>
            <a tal:condition="not hide_cancel|False" class="cancel-link" href="#" data-back-link> <span i18n:translate="">Cancel</span></a>
        </tal:b>
    </form>
</metal:form>

<metal:fields define-macro="fields">
    <tal:b repeat="field fields">
        <div tal:define="hidden form.is_hidden(field)|False" class="${'small-12 large-6 cell' if form_two_columns else 'grid-x'} field-${field.id} field-type-${field.type.lower()} ${'field-hidden' if hidden else ''}">
            <div class="large-12 cell">
                <tal:b define="input_type field.widget.input_type|None">
                    <tal:b condition="input_type == 'hidden'">
                        ${field()}
                        <small class="error" tal:repeat="error field.errors">${error}</small>
                    </tal:b>
                    <tal:b condition="input_type != 'hidden'" define="radio_field field.type == 'RadioField'; checkbox_fields (field.type == 'MultiCheckboxField' or field.type == 'OrderedMultiCheckboxField'); field_list field.type == 'UploadMultipleField'">
                        <label tal:attributes="class field.errors and not field_list and 'error' or None" tal:condition="not checkbox_fields and not radio_field">
                            <metal:b use-macro="layout.macros['field']" />
                        </label>

                <div tal:attributes="class field.errors and 'error group-label' or 'group-label'" tal:condition="checkbox_fields or radio_field">
                    <metal:b use-macro="layout.macros['field']" />
                </div>
                <tal:b tal:repeat="error field.errors">
                    <small class="error" tal:condition="not field_list and error != ''">
                        ${error}
                    </small>
                </tal:b>
            </tal:b>
        </tal:b>
    </div></div>
    </tal:b>
</metal:fields>

<metal:homepage-tiles define-macro="homepage-tile-card" i18n:domain="onegov.town6">
    <div class="card" data-aos="fade" data-aos-duration="800"  id="homepage-tile-${item.number}" tal:condition="item.links">
        <div class="card-divider">
            <a tal:condition="item.page.url" href="${item.page.url}"><h5>${item.page.text}</h5></a>
            <h5 tal:condition="not item.page.url">${item.page.text}</h5>
        </div>
        <div class="card-section">
            <ul class="more-list">
                <li tal:repeat="link item.links" tal:content="link(layout)" />
            </ul>
        </div>
    </div>
</metal:homepage-tiles>

<metal:homepage-tiles define-macro="homepage-tiles">
    <div>
        <div class="grid-x grid-padding-x align-center" >
            <tal:block tal:repeat="item tiles">
                <div class="cell small-12 medium-6 large-4 homepage-tile" tal:condition="item.links">
                    <metal:homepage-tiles use-macro="layout.macros['homepage-tile-card']" />
                </div>
            </tal:block>
        </div>
    </div>
</metal:homepage-tiles>

<metal:single_field define-macro="field">
     <!--! render the label after the field if it's a boolean field -->
    <tal:b condition="field.type == 'BooleanField'">
        ${field()}
        <span class="label-text" tal:condition="not field.hide_label|True">${field.label.text}</span>
        <span class="label-required" tal:condition="field.flags.required|nothing">*</span>
        <div class="field-help" tal:condition="field.description">
            <tal:b replace="request.translate(field.description)" />
        </div>
    </tal:b>
    <tal:b condition="field.type != 'BooleanField'">
        <!--
            Note how the field is rendered *first* in the 'define' step,
            before the label is accessed. This is due to the field call
            setting up translatable labels as a side-effect.

            See onegov.core.i18n.get_translation_bound_meta.render_field
        -->
        <tal:b define="(description, is_md) form.as_maybe_markdown(form.request.translate(field.description or '')); long_description form.additional_field_help(field); content field(placeholder=description if not long_description else '', iconfont='Font Awesome 5 Free')">
            <span class="label-text" tal:condition="not field.hide_label|True">${field.label.text}</span>
            <span class="label-required" tal:condition="field.flags.required|nothing">*</span>
            <div class="long-field-help" tal:condition="long_description">
                <tal:b replace="long_description"/>
            </div>

            <!--! The field is placed here -->
            <tal:b replace="content" />
        </tal:b>
    </tal:b>
</metal:single_field>

<metal:upload define-macro="upload" i18n:domain="onegov.town6">
    <form action="${upload_url}" class="upload" method="POST" enctype="multipart/form-data">
        <div class="upload-dropzone dropzone">
            <input type="file" id="fileElem" class="hidden" multiple>
            <label class="button" for="fileElem" i18n:translate>Select files</label>
            <p class="show-for-medium" i18n:translate>Drop files to upload</p>
        </div>

        <div class="upload-progress" metal:define-slot='upload-progress'></div>
        <div class="upload-filelist" metal:define-slot='upload-filelist'></div>

        <!--! fallback for integration tests -->
        <noscript>
            <input name="file" type="file" multiple />
            <input type="submit" value="Submit" class="button" i18n:attributes="value">
        </noscript>

    </form>
</metal:upload>

<metal:newslist define-macro="news-item-card" i18n:domain="onegov.town6">
    <div class="card news-card" data-aos="fade" data-aos-duration="800" tal:define="url request.link(item)">
        <a href="${url}">
            <div tal:condition="item.page_image and item.show_preview_image" style="width: 100%; padding-bottom: 55%; background-image: url(${item.page_image}); background-size: cover;"></div>
        </a>
        <div class="card-section">
            <a href="${url}">
                <div>
                    <h5>${item.title} <metal:hint use-macro="layout.macros['access_hint']" /> <metal:hint use-macro="layout.macros['publication_hint']" /></h5>
                    <p tal:condition="not:hide_date|False" class="subheader">${layout.format_date(item.published_or_created, 'date_long')}</p>
                    <p class="news-lead">${get_lead(item.content.lead, 300, consider_sentences=False)}</p>
                </div>
            </a>
            <a href="${url}" class="read-more-link" i18n:translate="">read more</a>
        </div>
    </div>
</metal:newslist>


<metal:newslist define-macro="news-item-full" i18n:domain="onegov.town6">
    <div class="news-item cell small-8" data-aos="fade" data-aos-duration="800" tal:define="url request.link(item)">
        <hr>
        <a href="${url}">
            <h3>${item.title} <metal:hint use-macro="layout.macros['access_hint']"/> <metal:hint use-macro="layout.macros['publication_hint']"/></h3>
            <img tal:condition="item.page_image and item.show_preview_image" style="width: 100%; margin-bottom: 20px; padding-bottom: 55%; background-image: url(${item.page_image}); background-size: cover;"></img>
            <div class="news-lead">${item.lead}</div>
            <div tal:condition="not:hide_date|False" class="subheader">${layout .format_date(item .published_or_created, 'date_long')}</div>
            <div class="news-text" tal:content="item.text"></div>
        </a>
    </div>
</metal:newslist>


<metal:newslist define-macro="newslist" i18n:domain="onegov.town6">
    <div tal:condition="newsletter.show_only_previews|True and news" class="newslist grid-x grid-padding-x align-center" >
        <div class="cell small-12 medium-${md_span|6} large-${lg_span|4} news-list-item" tal:repeat="item news">
            <metal:newlist use-macro="layout.macros['news-item-card']" tal:define="heading 'h4'" />
        </div>
    </div>
    <div tal:condition="not: newsletter.show_only_previews|True" class="newslist grid-x align-center" tal:repeat="item news">
        <metal:newlist use-macro="layout.macros['news-item-full']" tal:define="heading 'h4'" />
    </div>
    <div class="newslist grid-x align-center">
        <a href="${layout.news_url}" class="news-all-entries button hollow"><span i18n:translate="">All articles</span></a>
    </div>
</metal:newslist>

<metal:newsletter define-macro="newsletter_signup" i18n:domain="onegov.town6">

    <metal:b define-slot="pre_form"></metal:b>

    <div class="grid-x">
        <div class="cell small-12 medium-${span_md|9} large-${span_lg|6}">
            <form class="signup" action="${form.action}" method="POST">
                <div>${form.csrf_token}</div>
                <div class="grid-x">
                    <div class="cell small-12">
                        <label class="${'error' if form.address.errors else ''}">
                            <input data-typeahead-subject type="email"
                               name="address"
                               placeholder="E-Mail Address" i18n:attributes="placeholder"/>
                            <small class="error" tal:repeat="error form.address.errors">${error}</small>
                        </label>
                    </div>
                    <div class="cell small" tal:condition="form.subscribed_categories.data">
                        <label>
                            <tal:b i18n:translate>${form.subscribed_categories.description}</tal:b><p>
                            ${form.subscribed_categories}
                        </label>
                    </div>
                    <button type="submit" class="button" i18n:translate>
                        ${button_text or 'Sign up'}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <metal:b define-slot="after_form"></metal:b>

</metal:newsletter>

<metal:access_hint define-macro="access_hint" i18n:domain="onegov.town6">
    <tal:b tal:switch="item.access|False">
        <tal:b case="'private'">
            <i title="This site is private" i18n:attributes="title" class="private-hint"></i>
        </tal:b>
        <tal:b case="'member'">
            <i title="This site is private but can also be seen by members" i18n:attributes="title" class="member-hint"></i>
        </tal:b>
        <tal:b case="'mtan'">
            <i title="This site is public but requires submitting an mTAN" i18n:attributes="title" class="mtan-hint"></i>
        </tal:b>
        <tal:b case="'secret'">
            <i title="This site is secret" i18n:attributes="title" class="secret-hint"></i>
        </tal:b>
        <tal:b case="'secret_mtan'">
            <i title="This site is secret and requires submitting an mTAN" i18n:attributes="title" class="secret-mtan-hint"></i>
        </tal:b>
    </tal:b>
</metal:access_hint>

<metal:publication_hint define-macro="publication_hint" i18n:domain="onegov.town6">
    <tal:b condition="not: item.published">
        <i title="This site is not published." i18n:attributes="title" class="unpublished-hint"></i>
    </tal:b>
</metal:publication_hint>

<metal:access_hint_long define-macro="access_hint_long" i18n:domain="onegov.town6">
    <tal:b tal:switch="item.access|False">
        <tal:b tal:case="'private'">
            <div class="row">
                <div class="small-12 columns">
                    <div class="panel callout">
                        <p i18n:translate>
                            This site is not public.
                        </p>
                    </div>
                </div>
            </div>
        </tal:b>
        <tal:b tal:case="'member'">
            <div class="row">
                <div class="small-12 columns">
                    <div class="panel callout">
                        <p i18n:translate>
                            This site is not public but it can be seen by members.
                        </p>
                    </div>
                </div>
            </div>
        </tal:b>
    </tal:b>
</metal:access_hint_long>

<metal:publication_hint_long define-macro="publication_hint_long" i18n:domain="onegov.town6">
    <tal:b condition="not: item.published">
        <div class="grid-x">
            <div class="small-12 cell">
                <div class="panel">
                    <p i18n:translate>
                        This site is not published.
                    </p>
                </div>
            </div>
        </div>
    </tal:b>
</metal:publication_hint_long>

<metal:empty_lead_hint define-macro="empty_page_lead_hint" i18n:domain="onegov.town6">
    <tal:b condition="not item.lead and request.is_manager|nothing">
        <div class="grid-x">
            <div class="small-12 cell">
                <div class="panel">
                    <p i18n:translate>This site contains no lead. Leads are used for lists and search results.</p>
                </div>
            </div>
        </div>
    </tal:b>
</metal:empty_lead_hint>

<metal:page_content define-macro="page_content_sidebar" i18n:domain="onegov.town6">
    <div tal:condition="no_sidebar_offset|False" class="small-12 medium-4 cell sidebar ${'filter-panel' if filter_panel else ''}" tal:condition="people or contact or coordinates or files or show_side_panel or more_entries|False or sidepanel_links|False"
    tal:define="files files|None; highlight_contacts highlight_contacts|True; filter_panel filter_panel|False; sidepanel_contact page.sidepanel_contact|None;">
        <div class="sidebar-wrapper">
            <tal:b metal:define-slot="before-panels"></tal:b>
            <div tal:define="hide page.hide_contact|hide_contact|False" class="side-panel contact-panel" tal:condition="not hide and contact or coordinates or location">
                <div tal:condition="contact and not hide">
                    <h3 i18n:translate>Contact</h3>
                    <tal:b content="contact" />
                    <div tal:condition="sidepanel_contact|False">
                        <ul class="sidebar-links more-list">
                            <li tal:repeat="contact sidepanel_contact" tal:condition="contact">
                                <a class="list-link" href="${contact[1]}">
                                <i class="fa fa-link" aria-hidden="true"></i>
                                <span class="list-title">${contact[0]}</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <br tal:condition="coordinates and contact" />
                <h3 i18n:translate tal:condition="not contact">Map</h3>
                <div tal:condition="coordinates" class="marker-map" data-map-type="thumbnail" data-lat="${coordinates.lat}" data-lon="${coordinates.lon}" data-zoom="${coordinates.zoom}" data-marker-icon="${marker_icon|nothing}" data-marker-color="${marker_color|nothing}"></div><br>
                <div class="location" tal:condition="location">${location}</div>
            </div>
            <div class="side-panel people-panel" tal:condition="people and not show_people_on_main_page" tal:define="show_people_on_main_page page.show_people_on_main_page|resource.show_people_on_main_page|False; western_name_order page.western_name_order|resource.western_name_order|False">
                <h3 i18n:translate>People</h3>
                <ul class="more-list" data-sortable data-sortable-url="${layout.move_person_url_template}">
                    <li tal:repeat="person people" data-sortable-id="${request.is_manager and person.id}">
                        <div class="person-card person-list-card">
                            <div tal:define="url (person.picture_url and layout.thumbnail_url(person.picture_url))">
                                <a tal:condition="url" href="${request.link(person)}" aria-hidden="true" >
                                    <div class="person-card-portrait" style='${"border: 3px solid #DDDDDD;" if not url else ""}'>
                                        <div class="cover-image" style='background-image: url("${url}");'></div>
                                    </div>
                                </a>
                            </div>
                            <div>
                                <a href="${request.link(person)}">
                                    <b tal:condition="western_name_order" class="list-title">${person.first_name} ${person.last_name}</b>
                                    <b tal:condition="not western_name_order" class="list-title">${person.title}</b>
                                </a>
                                <a href="${request.link(person)}">
                                    <p class="list-lead preview">${person.context_specific_function}</p>
                                </a>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="side-panel files-panel" tal:condition="files and page.show_file_links_in_sidebar|True">
                <h3 i18n:translate>Documents</h3>
                <ul class="more-list">
                    <li tal:repeat="file python: sorted(files, key=lambda f: f.name)">
                        <a class="list-link" title="${file.name}" href="${request.link(file)}">
                            <i class="far ${layout.get_fa_file_icon(file.name)}" aria-hidden="true"></i>
                            <span class="list-title">${layout.get_filename_without_extension(file.name)}</span>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="side-panel links-panel" tal:condition="sidepanel_links|False">
                <h3 i18n:translate>Links</h3>
                <ul class="more-list">
                    <li tal:repeat="sl python: sorted(sidepanel_links, key=lambda sl: sl[0] if sl[0] else sl[1])">
                        <a class="list-link" title="${sl[0] if sl[0] else sl[1]}" href="${sl[1]}">
                            <i class="fa fa-link" aria-hidden="true"></i>
                            <span class="list-title">${sl[0] if sl[0] else sl[1]}</span>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="more-news side-panel" tal:condition="siblings|False">
                <h3 i18n:translate="">More news</h3>
                <ul class="more-list">
                    <li tal:repeat="sibling siblings">
                        <a href="${request.link(sibling)}" class="list-link">
                            <span class="list-title">${sibling.title}</span>
                        </a>
                        <a href="${request.link(sibling)}">
                            <p class="list-lead preview">
                                ${layout.format_date(sibling.published_or_created, 'date_long')}
                            </p>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="more-entries side-panel" tal:condition="more_entries|False">
                <h3 i18n:translate="">Other Entries</h3>
                <ul class="more-list">
                    <li tal:condition="prev_entry">
                        <a href="${request.link(prev_entry)}" class="list-link">
                            <i class="fa fa-chevron-left"></i><span
                                class="list-title" i18n:translate="">Previous Entry</span>
                        </a>
                        <a href="${request.link(prev_entry)}">
                            <p class="list-lead preview">
                                    ${prev_entry.title}
                            </p>
                        </a>
                    </li>
                    <li tal:condition="next_entry">
                        <a href="${request.link(next_entry)}" class="list-link">
                            <i class="fa fa-chevron-right"></i><span
                                class="list-title" i18n:translate="">Next Entry</span>
                        </a>
                        <a href="${request.link(next_entry)}">
                            <p class="list-lead preview">
                                    ${next_entry.title}
                            </p>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="side-panel content-panel" style="display: none;" data-toc-level="${layout.org.level_table_of_contents}">
                <h3 i18n:translate>Content</h3>
                <ul class="more-list"></ul>
            </div>
            <tal:b metal:define-slot="after-panels"><div id="after-panels"></div></tal:b>

        </div>
    </div>
</metal:page_content>

<metal:page_content define-macro="page_content" i18n:domain="onegov.town6">
    <div class="grid-x grid-padding-x wrapper" tal:define="show_side_panel show_side_panel|False; location location|False; show_page_image page.show_page_image|None; files files|None; sidepanel_links sidepanel_links|None; news page.type == 'news'|False; imageset page.photo_album|None; as_content layout.org.theme_options.get('page-image-position', 'as_content') ==  'as_content'; sidepanel_contact page.sidepanel_contact|None; no_sidebar_offset no_sidebar_offset|False;">
        <tal:b condition="not: people or files or contact or coordinates or location or show_side_panel or more_entries|False">
            <div class="small-12 cell page-content-main">
                <img class="page-image" tal:condition="show_page_image and page.page_image and (as_content or news)" src="${page.page_image}">
                <div metal:define-slot="before-lead"></div>
                <div class="limit-line-width">
                    <span class="page-lead h5" tal:condition="lead" tal:content="lead" />
                </div>
                <div metal:define-slot="after-lead"></div>

                <div class="page-text" tal:condition="text" tal:content="text" />
                <metal:b tal:condition="imageset" use-macro="layout.macros['render_inline_photo_album']"/>
                <div metal:define-slot="after-text"></div>

            </div>
        </tal:b>
        <tal:b condition="people or files or contact or coordinates or show_side_panel or more_entries|False">
            <div class="small-12 medium-7 cell page-content-main content">
                <div class="theiaStickySidebar">
                    <img class="page-image" tal:condition="show_page_image and page.page_image and (as_content or news)" src="${page.page_image}">

                    <div class="limit-line-width">
                        <span class="page-lead h5" tal:condition="lead" tal:content="lead" />
                    </div>
                    <div metal:define-slot="after-lead"></div>

                    <div class="page-text" tal:condition="text" tal:content="text" />
                    <metal:b tal:condition="imageset" use-macro="layout.macros['render_inline_photo_album']"/>

                    <div metal:define-slot="after-text"></div>

                    <div class="people-panel" tal:condition="people and show_people_on_main_page" tal:define="show_people_on_main_page page.show_people_on_main_page|resource.show_people_on_main_page|False; western_name_order page.western_name_order|resource.western_name_order|False">
                        <h3 i18n:translate>People</h3>
                        <ul data-sortable data-sortable-url="${layout.move_person_url_template}">
                            <li tal:repeat="person people" class="person-card person-list-card" data-sortable-id="${request.is_manager and person.id}">
                                <div>
                                    <a href="${request.link(person)}" aria-hidden="true" tal:define="url (person.picture_url and layout.thumbnail_url(person.picture_url))">
                                        <div class="person-card-portrait" style='${"border: 3px solid #DDDDDD;" if not url else ""}'>
                                            <i class="fa fa-user" tal:condition="not:url"></i>
                                            <div class="cover-image" style='background-image: url("${url}");'></div>
                                        </div>
                                    </a>
                                </div>
                                <div>
                                    <a href="${request.link(person)}">
                                        <b class="list-title" tal:condition="western_name_order">${person.first_name} ${person.last_name}</b>
                                        <b class="list-title" tal:condition="not western_name_order">${person.title}</b>
                                    </a>
                                        <p class="list-lead preview">${person.context_specific_function}</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <metal:b use-macro="layout.macros['page_content_sidebar']" tal:define="filter_panel filter_panel|False; no_sidebar_offset no_sidebar_offset|False;" />
        </tal:b>
    </div>
</metal:page_content>

<metal:display_form define-macro="display_form" i18n:domain="onegov.town6">

    <div metal:use-macro="layout.macros['progress_indicator']" tal:define="steps layout.get_step_sequence()|nothing"/>

    <div tal:condition="form" tal:repeat="fieldset form.fieldsets">
        <tal:b define="fields fieldset.non_empty_fields" condition="fields">
            <metal:b use-macro="layout.macros['display_fields']" tal:define="fields fields.values()">
        </tal:b>
    </div>
    <tal:b tal:condition="invoice_items|nothing">
        <h2 i18n:translate>Invoice Items</h2>
        <tal:b metal:use-macro="layout.macros['invoice_items']" />
    </tal:b>
    <tal:b tal:condition="price|nothing">
        <dl class="field-display">
            <dt i18n:translate>Total Amount</dt>
            <dd><metal:b use-macro="layout.macros['price']" /></dd>
        </dl>
    </tal:b>
</metal:display_form>


<metal:display_chat define-macro="display_chat" i18n:domain="onegov.town6">
    <div class="chat ticket-chat">
        <h3  i18n:translate>Chat History</h3>
        <div id="message-area">
            <tal:b tal:repeat="message chat.chat_history">
                <div class="card chat-card ${'right' if message.get('userId') != 'customer' else 'left'}">
                    <p class="info">${message['user']}</p>
                    <div class="card-section">
                        <p>${message['text']}</p>
                    </div>
                    <p class="info">${message['time']}</p>
                </div>
            </tal:b>
        </div>
    </div>
</metal:display_chat>

<metal:display_field define-macro="display_fields" i18n:domain="onegov.town6">
    <?python
        if fields:
            rendered_fields = ((f, form.render_display(f)) for f in fields)
            rendered_fields = ((f, rendered) for f, rendered in rendered_fields if rendered)

            rendered_fields = tuple(rendered_fields)
        else:
            rendered_fields = None
    ?>
    <h2 tal:condition="fieldset.is_visible and rendered_fields|nothing">${fieldset.label}</h2>

    <dl class="field-display" tal:repeat="(field, rendered) rendered_fields" tal:define="allow_downloads allow_downloads|request.is_manager; allow_views allow_views|False">
        <dt tal:condition="layout.show_label(field)">${field.label.text}</dt>
        <dd>
            <tal:b tal:switch="field.type" condition="allow_downloads or allow_views">
                <tal:b tal:case="'UploadField'">
                    <tal:b tal:define="url layout.field_download_link(field)">
                        <a href="${url}" tal:condition="not allow_views or not field.is_image">
                            ${rendered}
                        </a>
                        <div tal:define="as_thumbnail 'thumbnail' in url|''" tal:condition="allow_views and field.is_image">
                            <img tal:condition="not: as_thumbnail" src="${url}" alt="" />
                            <div class="photoswipe" tal:define="image layout.field_file(field)" tal:condition="image and as_thumbnail">
                                <p class="has-img thumbnail">
                                    <img src="${url}" alt="${image.note}" data-full-width="${image.reference.size[0]}" data-full-height="${image.reference.size[1]}" />
                                </p>
                            </div>
                            <tal:b metal:use-macro="layout.macros.photoswipe" />
                        </div>
                    </tal:b>
                </tal:b>
                <tal:b tal:case="'UploadMultipleField'" tal:repeat="iter sorted(zip(field, rendered.split(Markup('<br>'))), key=lambda i: i[1])">
                    <tal:b tal:define="subfield iter[0];
                                       rendered iter[1];
                                       url layout.field_download_link(subfield);
                                       show_image allow_views and subfield.is_image">
                        <a href="${url}" tal:condition="not show_image">
                            ${rendered}
                        </a>
                        <br tal:condition="not show_image and not repeat.iter.end" />
                        <div tal:define="as_thumbnail 'thumbnail' in url|''" tal:condition="show_image">
                            <img tal:condition="not: as_thumbnail" src="${url}" alt="" />
                            <div class="photoswipe" tal:define="image layout.field_file(subfield)" tal:condition="image and as_thumbnail">
                                <p class="has-img thumbnail">
                                    <img src="${url}" alt="${image.note}" data-full-width="${image.reference.size[0]}" data-full-height="${image.reference.size[1]}" />
                                </p>
                            </div>
                            <tal:b metal:use-macro="layout.macros.photoswipe" />
                        </div>

                    </tal:b>
                </tal:b>
            </tal:b>
            <tal:b condition="not (allow_downloads or allow_views) or field.type not in ('UploadField', 'UploadMultipleField')" >
                <tal:b tal:condition="field.pricing|nothing">
                    <tal:b tal:define="is_value field.type in ('IntegerField', 'FloatField', 'DecimalField')">
                        ${rendered} <span tal:condition="is_value" i18n:translate="">Item(s)</span>
                    </tal:b>
                </tal:b>
                <tal:b tal:condition="not: field.pricing|nothing" tal:switch="linkify_display|False">
                    <tal:b tal:case="True" replace="layout.linkify_field(field, rendered)" />
                    <tal:b tal:case="False" replace="rendered" />
                </tal:b>
            </tal:b>
        </dd>
    </dl>
</metal:display_field>

<metal:directory_entry_submission define-macro="directory_entry_submission" i18n:domain="onegov.town6">
    <h2 tal:condition="handler.kind == 'change-request'" i18n:translate>
        Change request
    </h2>

    <h2 tal:condition="handler.kind == 'new-entry'" i18n:translate>
        New Entry
    </h2>

    <div class="directory-entry-submission-summary" tal:condition="not: handler.deleted">
        <dl>
            <div>
                <dt i18n:translate>Directory</dt>
                <dd><a href="${request.link(handler.directory)}">${handler.directory.title}</a></dd>
            </div>

            <div tal:condition="handler.entry">
                <dt i18n:translate>Entry</dt>
                <dd><a href="${request.link(handler.entry)}">${handler.entry.title}</a></dd>
            </div>
        </dl>
    </div>

    <metal:b use-macro="layout.macros['display_form']" />
</metal:directory_entry_submission>

<metal:price define-macro="price">
    <tal:b tal:define="show_fee show_fee|False; show_vat show_vat|False">
        ${layout.format_number(price.net_amount if show_fee else price.amount)} ${price.currency}
        <tal:b condition="show_fee and price.fee">
            (+ ${layout.format_number(price.fee)} <tal:b i18n:translate>Credit Card Fee</tal:b>)
        </tal:b>
        <tal:b tal:define="vat_amount layout.get_vat_amount(price.amount); hide_vat_amount hide_vat_amount|False" tal:condition="show_vat and layout.vat_rate and vat_amount">
            <br>
            (<tal:b i18n:translate>VAT</tal:b> <tal:b i18n:translate><tal:b i18n:name="vat_rate">${layout.format_number(layout.vat_rate, 1)}</tal:b>% included</tal:b><tal:b tal:condition="not:hide_vat_amount">: ${layout.format_number(vat_amount, 2)} ${price.currency}</tal:b>)
        </tal:b>
    </tal:b>
</metal:price>

<metal:payment define-macro="payment" i18n:domain="onegov.town6">
    <tal:b tal:define="show_fee show_fee|False" tal:condition="payment|nothing">
        <h2 i18n:translate>Payment</h2>
        <dl class="field-display">
            <dt i18n:translate>Total Amount</dt>
            <dd>${layout.format_number(payment.amount)} ${payment.currency}</dd>
        </dl>
        <dl class="field-display" tal:define="show_vat show_vat|False; vat_amount layout.get_vat_amount(payment.amount); hide_vat_amount hide_vat_amount|False" tal:condition="show_vat and layout.vat_rate and vat_amount">
            <dt i18n:translate>Value Added Tax</dt>
            <dd><tal:b i18n:translate><tal:b i18n:name="vat_rate">${layout.format_number(layout.vat_rate, 1)}</tal:b>% included</tal:b><tal:b tal:condition="not:hide_vat_amount">: ${layout.format_number(vat_amount, 2)} ${payment.currency}</tal:b></dd>
        </dl>
        <dl class="field-display">
            <dt i18n:translate>State</dt>
            <dd><tal:b metal:use-macro="layout.macros['payment_status']" /></dd>
        </dl>
        <dl class="field-display" tal:condition="not:show_fee">
            <dt i18n:translate>Payment Method</dt>
            <dd tal:switch="payment.source">
                <tal:b tal:case="'manual'" i18n:translate>Offline Payment</tal:b>
                <tal:b tal:case="default" i18n:translate>Online Payment</tal:b>
            </dd>
        </dl>
        <dl class="field-display" tal:condition="show_fee">
            <dt i18n:translate>Source</dt>
            <dd tal:switch="payment.source">
                <tal:b tal:case="'manual'" i18n:translate>Manual</tal:b>
                <tal:b tal:case="'datatrans'" i18n:translate>Datatrans</tal:b>
                <tal:b tal:case="'stripe_connect'" i18n:translate>Stripe Connect</tal:b>
                <tal:b tal:case="'worldline_saferpay'" i18n:translate>Worldline Saferpay</tal:b>
            </dd>
        </dl>
        <dl tal:condition="show_fee and payment.fee" class="field-display">
            <dt i18n:translate>Fee</dt>
            <dd>${layout.format_number(payment.fee)</dd>
        </dl>
    </tal:b>
</metal:payment>

<metal:person_card define-macro="person_list_card" i18n:domain="onegov.town6">
    <div class="person-card person-list-card card-section" tal:define="link request.link(person); exclude request.app.org.excluded_person_fields(request)">
        <a href="${link}" aria-hidden="true" tal:define="url (person.picture_url and layout.thumbnail_url(person.picture_url))">
            <div class="person-card-portrait" tal:condition="url" style='${"border: 3px solid #DDDDDD;" if not url else ""}'>
                <i class="fa fa-user" tal:condition="not:url"></i>
                <div class="cover-image"  style='background-image: url("${url}");'></div>
            </div>
        </a>
        <ul class="person-card-details">
            <li class="person-card-title" tal:define="western_name_order page.western_name_order|resource.western_name_order|False">
                <a href="${link}">
                    <span tal:condition="western_name_order">${person.first_name} ${person.last_name}</span>
                    <span tal:condition="not western_name_order">${person.title}</span>
                </a>
            </li>
            <li tal:condition="person.function" class="person-card-function">
                <span title="${person.function}">${person.function}</span>
            </li>
            <tal:b define="organisations organisations_as_dict(person)" tal:condition="'organisation' not in exclude">
                <li tal:repeat="top_organisation organisations.keys()" class="person-card-organisation">
                    <span tal:define="sub_organisations organisations[top_organisation]" i18n:attributes="title" title="Organisation">${top_organisation}${' - ' if sub_organisations else ''}${', '.join(sub_organisations)}</span>
                </li>
            </tal:b>
            <li tal:condition="person.email and 'email' not in exclude" class="person-card-email">
                <a href="mailto:${person.email}">${person.email}</a>
            </li>
            <li tal:condition="person.phone and 'phone' not in exclude" class="person-card-phone">
                <a href="tel:${layout.format_phone_number(person.phone)}">${layout.format_phone_number(person.phone)}</a>
            </li>
            <li tal:condition="person.phone_direct and 'phone_direct' not in exclude" class="person-card-phone_direct">
                <a href="tel:${layout.format_phone_number(person.phone_direct)}">${layout.format_phone_number(person.phone_direct)}</a>
            </li>
        </ul>
        <a href="${link}"><i class="fa fa-chevron-right"></i></a>
    </div>
</metal:person_card>

<metal:person_card define-macro="person_card" i18n:domain="onegov.town6">
    <div class="person-card person-single-item" tal:define="exclude request.app.org.excluded_person_fields(request)">
        <div class="grid-x" tal:define="url person.picture_url">
            <div class="cell small-12 medium-5 large-4" tal:condition="url" >
                <div aria-hidden="true">
                    <div class="person-card-portrait">
                        <div class="cover-image" style='background-image: url("${url}");'></div>
                    </div>
                </div>
            </div>
            <div class="cell small-12 ${'medium-7 large-8' if url else ''}">
                <ul>
                    <li tal:condition="person.function" class="person-card-function">
                        <em>${person.function}</em>
                    </li>
                    <tal:b define="organisations organisations_as_dict(person)" tal:condition="'organisation' not in exclude">
                        <li tal:repeat="top_organisation organisations.keys()" class="person-card-organisation">
                            <span tal:define="sub_organisations organisations[top_organisation]" i18n:attributes="title" title="Organisation">${top_organisation}${' - ' if sub_organisations else ''}${', '.join(sub_organisations)}</span>
                        </li>
                    </tal:b>
                    <li class="person-card-personal">
                        <span tal:condition="person.born and 'born' not in exclude">${person.born}</span>
                        <span tal:condition="person.academic_title and 'academic_title' not in exclude">${person.academic_title}</span>
                        <span tal:condition="person.profession and 'profession' not in exclude">${person.profession}</span>
                        <span tal:condition="person.political_party and 'political_party' not in exclude">${person.political_party}</span>
                        <span tal:condition="person.parliamentary_group and 'parliamentary_group' not in exclude">${person.parliamentary_group}</span>
                    </li>
                    <li tal:condition="person.location_address and 'location_address' not in exclude" class="person-card-address">
                        <span title="_('Location address')">${person .location_address}</span>
                    </li>
                    <li tal:condition="person.location_code_city and 'location_code_city' not in exclude" class="person-card-address">
                        <span title="Hover text für location code and
                        city">${person.location_code_city}</span>
                    </li>
                    <li tal:condition="person.postal_address and 'postal_address' not in exclude" class="person-card-address">
                        <span>${person.postal_address}</span>
                    </li>
                    <li tal:condition="person.postal_code_city and 'postal_code_city' not in exclude" class="person-card-address">
                        <span>${person.postal_code_city}</span>
                    </li>
                    <li tal:condition="person.email and 'email' not in exclude" class="person-card-email">
                        <a href="mailto:${person.email}">${person.email}</a>
                    </li>
                    <li tal:condition="person.phone and 'phone' not in exclude" class="person-card-phone">
                        <a href="tel:${layout.format_phone_number(person.phone)}">${layout.format_phone_number(person.phone)}</a>
                    </li>
                    <li tal:condition="person.phone_direct and 'phone_direct' not in exclude" class="person-card-phone-direct">
                        <a href="tel:${layout.format_phone_number(person.phone_direct)}">${layout.format_phone_number(person.phone_direct)}</a>
                    </li>
                    <li tal:condition="person.website and 'website' not in exclude" class="person-card-website">
                        <a href="${person.website}">${person.website}</a>
                    </li>
                    <li tal:condition="person.website_2 and 'website_2' not in exclude" class="person-card-website">
                        <a href="${person.website_2}">${person.website_2}</a>
                    </li>
                    <div class="person-card-context-specific-functions" tal:condition="python: organization_to_function">
                        <span i18n:translate="">Functions:</span>
                        <ul>
                            <li tal:repeat="item organization_to_function">
                                <tal:block tal:repeat="line python: item.split('\n')">
                                    <span tal:content="line"></span><br tal:condition="not:repeat['line'].index == repeat['line'].length - 1" />
                                </tal:block>
                            </li>
                        </ul>
                    </div>
                    <li class="person-card-notes" tal:condition="person.notes and 'notes' not in exclude">
                        <span>${person.notes}</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</metal:person_card>

<metal:sidebar define-macro="sidebar" i18n:domain="onegov.town6">
    <nav role="navigation">
        <ul class="side-nav" data-sortable data-sortable-url="${layout.sortable_url_template}">
            <tal:b repeat="link layout.sidebar_links">
                <li tal:define="is_group hasattr(link, 'links')" class="${is_group and 'active' or ''}" data-sortable-id="${request.is_manager and link.model.id}">
                    <tal:b condition="not:is_group" replace="link(layout)" />
                    <tal:b condition="is_group">
                        <a href="#" class="group-title">${link.title}
                            <metal:b use-macro="layout.macros['access_hint']" tal:define="item link"/>
                            <metal:b use-macro="layout.macros['publication_hint']" tal:define="item link.model"/>
                        </a>
                        <ul class="children" tal:condition="link.links"
                            data-sortable data-sortable-url="${layout.sortable_url_template}">
                            <li tal:repeat="child link.links" data-sortable-id="${request.is_manager and child.model.id}">
                                <tal:b replace="child(layout)" />
                            </li>
                        </ul>
                    </tal:b>
                </li>
            </tal:b>
        </ul>
    </nav>
</metal:sidebar>

<metal:ticket_status define-macro="ticket_status" i18n:domain="onegov.town6">
    <div i18n:translate tal:condition="ticket.state == 'open'" class="ticket-state-open">
        Open
    </div>
    <div i18n:translate tal:condition="ticket.state == 'pending'" class="ticket-state-pending">
        Pending
    </div>
    <div i18n:translate tal:condition="ticket.state == 'closed'" class="ticket-state-closed">
        Closed
    </div>
    <div i18n:translate tal:condition="ticket.state == 'archived'" class="ticket-state-archived">
        Archived
    </div>
</metal:ticket_status>

<metal:payment_status define-macro="payment_status" i18n:domain="onegov.town6">
    <div i18n:translate tal:condition="payment.state == 'open'" class="payment-state payment-state-open">
        Open
    </div>
    <div i18n:translate tal:condition="payment.state == 'paid'" class="payment-state payment-state-paid">
        Paid
    </div>
    <div i18n:translate tal:condition="payment.state == 'failed'" class="payment-state payment-state-failed">
        Failed
    </div>
    <div i18n:translate tal:condition="payment.state == 'cancelled'" class="payment-state payment-state-cancelled">
        Refunded
    </div>
    <div i18n:translate tal:condition="payment.state == 'invoiced'" class="payment-state payment-state-invoiced">
        Invoiced
    </div>
</metal:payment_status>

<metal:payment_source define-macro="payment_source" i18n:domain="onegov.town6">
    <div i18n:translate tal:condition="payment.source == 'manual'">
        Manual
    </div>
    <div tal:condition="payment.source == 'datatrans'">
        <a href="${payment.remote_url}">
            Datatrans
        </a>
    </div>
    <div tal:condition="payment.source == 'stripe_connect'">
        <a href="${payment.remote_url}">
            Stripe Connect
        </a>
    </div>
    <div tal:condition="payment.source == 'worldline_saferpay'">
        <a href="${payment.remote_url}">
            Worldline Saferpay
        </a>
    </div>
</metal:payment_source>

<metal:ticket_callout define-macro="ticket_callout" i18n:domain="onegov.town6">
    <div tal:condition="ticket">
        <h3 i18n:translate>Ticket</h3>
            <div class="ticket-number side-panel-with-bg"><a href="${request.link(ticket)}">${ticket.number}</a></div>
    </div>
</metal:ticket_callout>

<metal:pagination define-macro="pagination" i18n:domain="onegov.town6">
    <nav  aria-label="Pagination" tal:define="centered pagination_centered|False; name collection.name_of_view">
        <ul class="pagination ${'text-center' if centered else ''}" tal:condition="collection.pages_count > 1">
            <tal:b repeat="page collection.pages">
                <tal:b define="
                    previous current_page.previous;
                    next current_page.next;
                    is_current current_page == page;
                    is_visible abs(current_page.page-page.page) < 6;
                ">
                    <tal:b condition="repeat.page.start and previous">
                        <li class="pagination-previous">
                            <a href="${request.link(previous, name)}" aria-label="Previous Page" i18n:attributes="aria-label"><i class="fa fa-chevron-left"></i></a>
                        </li>
                    </tal:b>

                    <li tal:condition="is_visible" class="${is_current and 'current' or ''}">
                        <a href="${request.link(page, name)}"><span class="show-for-sr" i18n:translate>You're on page </span><span>${page.page + 1}</span></a>
                    </li>

                    <tal:b condition="repeat.page.end and next">
                        <li class="pagination-next">
                            <a href="${request.link(next, name)}" aria-label="Next Page" i18n:attributes="aria-label"><i class="fa fa-chevron-right"></i></a>
                        </li>
                    </tal:b>
                </tal:b>
            </tal:b>
        </ul>
    </nav>

</metal:pagination>

<metal:reservations define-macro="reservation_infos" i18n:domain="onegov.town6">
    <div tal:condition="reservation_infos" tal:define="failed failed_reservations|set()" class="reservation-selection large">
        <div class="reservation-selection-inner" tal:define="blocked blocked|set()">
            <ul>
                <li class="${(info.reservation.id in failed or info.reservation.id in blocked) and 'reservation failed' or 'reservation'}" tal:repeat="info reservation_infos">
                    <span class="reservation-date" data-quota="${info.reservation.quota}">
                        ${layout.format_date(info.reservation.display_start(), 'weekday_long')},
                        ${layout.format_date(info.reservation.display_start(), 'date_long')}
                        <span class="reservation-warning" title="${info.warning}" tal:condition="info.warning">
                            <i class="fa fa-clock-o" aria-hidden="true"></i>
                        </span>
                    </span>
                    <span class="reservation-time">
                        ${info.time}
                    </span>
                    <span class="reservation-price" tal:condition="info.price">
                        ${'{:.2f}'.format(info.price.amount)} ${info.price.currency}
                    </span>
                    <div class="reservation-denied" tal:condition="info.reservation.id in blocked">
                        <tal:b i18n:translate>
                            Persons living outside the following zipcodes may only reserve this
                            allocation on the <strong i18n:name="date">${layout.format_date(blocked[info.reservation.id], 'date_long')}</strong>:
                            <ol i18n:name="zipcodes">
                                <li tal:repeat="zipcode zipcodes">${zipcode}</li>
                            </ol>
                        </tal:b>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</metal:reservations>

<metal:reservations define-macro="reservations" i18n:domain="onegov.town6">
    <ul tal:condition="reservations" tal:define="get_links get_links|None; get_occupancy_url get_occupancy_url|None" class="reservations">
        <li tal:repeat="reservation reservations" tal:attributes="class 'reservation' if get_links else None">
            <tal:b define="start reservation.display_start(); end reservation.display_end(); links get_links(reservation, request) if get_links else []; url get_occupancy_url(reservation, request) if get_occupancy_url else None">
                <div class="reservation-details" tal:omit-tag="not:links">
                    <a href="${url}" title="Occupancy" tal:omit-tag="not:url" i18n:attributes="title">
                        <strong>
                            ${layout.format_date(start, 'weekday_long')},
                            ${layout.format_date(start, 'date_long')}
                        </strong>
                    </a>
                    <!--! simple whole day check: -->
                    <span tal:condition="start.time() != end.time()">
                        <br>
                        ${layout.format_time_range(start, end)}
                    </span>
                    <br><span i18n:translate>Quota</span>
                    <span>
                        ${reservation.quota}
                    </span>
                <div class="reservation-actions text-links" tal:condition="links">
                    <tal:b repeat="link links" content="link(layout)" />
                </div>
            </tal:b>
        </li>
    </ul>
</metal:reservations>

<metal:display_event define-macro="display_event" i18n:domain="onegov.town6">
    <dl>
        <tal:b condition="request.is_manager">
            <dt i18n:translate>State</dt>
            <dd i18n:translate tal:condition="event.state == 'initiated'">Initiated</dd>
            <dd i18n:translate tal:condition="event.state == 'submitted'">Submitted</dd>
            <dd i18n:translate tal:condition="event.state == 'published'">Published</dd>
            <dd i18n:translate tal:condition="event.state == 'withdrawn'">Withdrawn</dd>

            <tal:b define="submitter event.meta.get('submitter_email') if event.meta else ''">
                <dt i18n:translate>Submitter</dt>
                <dd>${submitter}</dd>
            </tal:b>
        </tal:b>

        <dt i18n:translate>Title</dt>
        <dd>${event.title}</dd>

        <dt i18n:translate>Description</dt>
        <dd tal:content="escape(event.description).replace('\n', Markup('<br>'))" />

        <dt i18n:translate>List Preview</dt>
        <dd tal:define="occurrence event.latest_occurrence or event.virtual_occurrence; use_links False">
            <metal:b use-macro="layout.macros['occurrence_list_view']" />
        </dd>

        <tal:b condition="event.image">
            <dt i18n:translate>Image</dt>
            <dd>
                <img src="${request.link(event.image)}">
            </dd>
        </tal:b>

        <tal:b condition="event.pdf">
            <dt i18n:translate>Additional Information</dt>
            <dd>
                <a href="${request.link(event.pdf)}">${event.pdf.name}</a>
            </dd>
        </tal:b>

        <dt i18n:translate>Location</dt>
        <dd>${event.location}</dd>

        <tal:b tal:condition="event.price">
            <dt i18n:translate>Price</dt>
            <dd tal:content="escape(event.price).replace('\n', Markup('<br>'))"></dd>
        </tal:b>

        <tal:b condition="event.coordinates">
            <dt i18n:translate>Map</dt>
            <dd>
                <div class="marker-map" data-map-type="thumbnail" data-lat="${event.coordinates.lat}" data-lon="${event.coordinates.lon}" data-zoom="${event.coordinates.zoom}"></div>
            </dd>
        </tal:b>

        <tal:b condition="event.organizer">
            <dt i18n:translate>Organizer</dt>
            <dd tal:content="event.organizer" />
        </tal:b>

        <tal:b condition="event.organizer_email">
            <dt i18n:translate>Organizer E-Mail address</dt>
            <dd><a href="mailto:${event.organizer_email}" tal:content="event.organizer_email" /></dd>
        </tal:b>
        <tal:b condition="event.organizer_phone">
            <dt i18n:translate>Organizer phone number</dt>
            <dd><a href="tel:${layout.format_phone_number(event.organizer_phone)}" tal:content="layout.format_phone_number(event.organizer_phone)" /></dd>
        </tal:b>

        <tal:b condition="event.tags and show_tags">
            <dt i18n:translate>Tags</dt>
            <dd>
                <ul class="no-margin-bottom">
                    <li tal:repeat="tag event.tags" i18n:translate>${tag}</li>
                </ul>
            </dd>
        </tal:b>

        <tal:b condition="event.filter_keywords and show_filters">
            <dt i18n:translate>Filters</dt>
            <dd>
                <ul tal:repeat="filter event.filter_keywords.items()" class="no-margin-bottom">
                    <li tal:condition="filter[1]">
                        <span>${filter[0].title()}:</span>
                        <span tal:define="tags ', '.join(f for f in filter[1])" tal:condition="isinstance (filter[1], list)" i18n:translate>${tags}</span>
                        <span tal:condition="not isinstance(filter[1], list) and filter[1]" i18n:translate>${filter[1]}</span>
                    </li>
                </ul>
            </dd>
        </tal:b>

        <dt i18n:translate>Date and time</dt>
        <dd>
            ${layout.format_datetime_range(event.localized_start, event.localized_end, with_year=True)}
        </dd>

        <!-- we can have reucrrences which we do not display, therefore we check the displayed value -->
        <tal:b define="recurrence event.recurrence and layout.format_recurrence(event.recurrence)" condition="recurrence">
            <dt i18n:translate>Recurrence</dt>
            <dd>${recurrence}</dd>
        </tal:b>

        <tal:b define="dates event.occurrence_dates(localize=True)" condition="len(dates) > 1">
            <dt i18n:translate>All dates</dt>
            <dd tal:define="occurrences event.occurrence_dates(localize=True)">
                <ul>
                    <li tal:repeat="occurrence occurrences">${layout.format_date(occurrence, 'weekday_long')} ${layout.format_date(occurrence, 'date')}</li>
                </ul>
            </dd>
        </tal:b>
    </dl>
</metal:display_event>

<metal:atoz define-macro="atoz" i18n:domain="onegov.town6">
    <div class="atoz-block" tal:repeat="item items">
        <h2>${item[0]}</h2>
        <div class="grid-x grid-padding-x subpage-cards">
            <div class="cell small-12 medium-6" tal:repeat="detail item[1]">
                <div class="card">
                    <div metal:define-slot="item-detail">
                        <a href="${request.link(detail)}">${detail.title}</a>
                        <metal:hint tal:define="item detail" use-macro="layout.macros['access_hint']" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</metal:atoz>

<metal:calendar_day define-macro="calendar-day" i18n:domain="onegov.town6">
    <h2 class="calendar-day">
        <metal:b use-macro="layout.macros['calendar-day-content']" />
    </h2>
</metal:calendar_day>

<metal:calendar_day_content define-macro="calendar-day-content" i18n:domain="onegov.town6">
    <a href="${link|nothing}" tal:condition="image|nothing"
        class="calendar-day-thumbnail"
        style="background-image: url(${request.link(image, name='thumbnail')});">
    </a>

    <a href="${link|nothing}" tal:condition="not:image|nothing" class="calendar-day-thumbnail">
        <i class="far fa-calendar" aria-hidden="true"></i>
    </a>

    <div class="calendar-day-date" tal:condition="date|nothing">
        <div class="weekday">${layout.format_date(date, 'weekday_short').rstrip('.')}</div>
        <div class="date">
            ${date.day}.
            <tal:b define="month layout.format_date(date, 'month_long')">
                <span class="long-month">${month}</span>
                <span class="short-month">${month[:3]}</span>
            </tal:b>
        </div>
    </div>
</metal:calendar_day_content>

<metal:occurrences define-macro="occurrences" i18n:domain="onegov.town6">
        <div class="grid-x grid-padding-x events" >
    <tal:b repeat="occurrence occurrences">
            <metal:b use-macro="layout.macros['occurrence_list_view']" />
    </tal:b>
        </div>
    <tal:b condition="not occurrences">
        <p i18n:translate>No events found.</p>
        <br><a tal:condition="'range' not in request.url" href="${no_event_link}" class="button hollow" i18n:translate>Past events</a>
    </tal:b>
</metal:occurrences>

<metal:occurrence_list_view define-macro="occurrence_list_view" i18n:domain="onegov.town6">
    <div class="occurrence subpage-cards medium-12 small-12 cell" tal:define="use_links use_links|True">
        <div class="card">
            <a href="${use_links and request.link(occurrence)}">
                <div class="show-for-small-only" tal:condition="occurrence.event.image" style="width: 100%; padding-bottom: 60%; background-image: url(${request.link(occurrence.event.image, name='thumbnail')}); background-size: cover;"></div>
                <div class="grid-x align-middle">
                    <div class="cell medium-7 card-section">
                        <h5>${occurrence.title}</h5>
                        <tal:b tal:define="
                            date occurrence.localized_start;
                            link use_links and request.link(occurrence)
                        ">
                            <metal:hint use-macro="layout.macros['access_hint']" tal:define="item occurrence" />

                            <div class="date-place">
                                <div class="grid-x">
                                    <div class="cell small-1 medium-2">
                                        <i class="far fa-calendar-alt"></i>
                                    </div>
                                    <div class="cell small-11 medium-10" tal:define="time layout.format_time_range(occurrence.localized_start, occurrence.localized_end)">
                                        <b>
                                            ${layout.format_date(date, 'weekday_short').rstrip('.')}, ${date.day}. ${layout.format_date(date, 'month_long')}  ${date.year}
                                        </b>
                                    </div>
                                </div>
                                <hr/>
                                <div class="grid-x">
                                    <div class="cell small-1 medium-2">
                                        <i class="fa fa-clock"></i>
                                    </div>
                                    <div class="cell small-11 medium-10" tal:define="time layout.format_time_range(occurrence.localized_start, occurrence.localized_end); suffix time_suffix|nothing">
                                        <div tal:condition="python: '00:00' not in time"> ${time[0].upper()}${time[1:]}${' ' + suffix if suffix else ''}</div>
                                        <div tal:condition="python: '00:00' in time"> ${time[0].upper()}${time[1:]}</div>
                                    </div>
                                </div>
                                <hr/>
                                <div class="grid-x">
                                    <div class="cell small-1 medium-2">
                                        <i class="fas fa-map-marker-alt"></i>
                                    </div>
                                    <div class="cell small-11 medium-10">
                                        <div>${occurrence.location}</div>
                                    </div>
                                </div>
                                <hr/>
                                <div class="grid-x">
                                    <div class="cell small-11 medium-12">
                                        <div tal:condition="occurrence.tags and show_tags" class="occurrence-tags">
                                            <span tal:repeat="tag occurrence.tags" class="blank-label" i18n:translate>${tag}</span>
                                        </div>
                                        <div tal:condition="occurrence.filter_keywords and show_filters">
                                            <div tal:repeat="filter occurrence.filter_keywords_ordered().items()">
                                                <span tal:condition="filter[1]" class="blank-label-description">${filter[0].title()}:</span>
                                                <span tal:repeat="tag filter[1]" tal:condition="isinstance(filter[1], list)" class="blank-label">${tag}</span>
                                                <span tal:condition="not isinstance(filter[1], list) and filter[1]" class="blank-label">${filter[1]}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </tal:b>
                    </div>
                    <div class="cell medium-5 align-self-top">
                        <div class="show-for-medium" tal:condition="occurrence.event.image" style="width: 100%; padding-bottom: 60%; background-image: url(${request.link(occurrence.event.image, name='thumbnail')}); background-size: cover; border-radius: 0 .7rem;"></div>
                        <span class="button hollow event-more-link" style="margin: 1.5rem 1rem 1.5rem 0.7rem; display: block;" i18n:translate="">Learn more</span>
                    </div>
                </div>
            </a>
        </div>
    </div>
</metal:occurrence_list_view>

<metal:date_range_selector define-macro="date-range-selector" i18n:domain="onegov.town6">
    <div class="date-range-selector">
        <form action="" method="GET">
            <div metal:define-slot="before-date-range"></div>

            <div class="grid-x grid-padding-x date-range-selector">
                <div class="large-6 cell">
                    <div class="grid-x">
                        <label i18n:translate>From</label>
                        <input class="small" name="start" type="date" value="${start}" placeholder="${layout.today().isoformat()}">
                    </div>
                </div>
                <div class="large-6 cell">
                    <div class="grid-x">
                        <label i18n:translate>To</label>
                        <input class="small" name="end" type="date" value="${end}" placeholder="${layout.today().isoformat()}">
                    </div>
                </div>
            </div>
            <noscript>
                <div class="grid-x">
                    <div class="large-6 cell">
                        <div class="grid-x">
                            <input type="submit" value="Filter by date" class="button" i18n:attributes="value">
                        </div>
                    </div>
                </div>
            </noscript>
        </form>
    </div>
</metal:date_range_selector>

<metal:role_singular define-macro="role-singular" i18n:domain="onegov.town6">
    <tal:b switch="role">
        <tal:b case="'admin'" i18n:translate>Administrator</tal:b>
        <tal:b case="'editor'" i18n:translate>Editor</tal:b>
        <tal:b case="'supporter'" i18n:translate>Supporter</tal:b>
        <tal:b case="'member'" i18n:translate>Member</tal:b>
    </tal:b>
</metal:role_singular>

<metal:role_plural define-macro="role-plural" i18n:domain="onegov.town6">
    <tal:b switch="role">
        <tal:b case="'admin'" i18n:translate>Administrators</tal:b>
        <tal:b case="'editor'" i18n:translate>Editors</tal:b>
        <tal:b case="'supporter'" i18n:translate>Supporters</tal:b>
        <tal:b case="'member'" i18n:translate>Members</tal:b>
    </tal:b>
</metal:role_plural>

<metal:user_source define-macro="user-source" i18n:domain="onegov.town6">
    <tal:b switch="source">
        <tal:b case="'msal'">AzureAD</tal:b>
        <tal:b case="'ldap'">LDAP</tal:b>
        <tal:b case="'ldap_kerberos'">LDAP Kerberos</tal:b>
        <tal:b case="default" i18n:translate>${source}</tal:b>
    </tal:b>
</metal:user_source>

<metal:identicon define-macro="identicon" i18n:domain="onegov.town6">
    <tal:b define="identicon_size size|'small'">
        <span class="user-initials-${identicon_size}" style="background-color: ${layout.get_user_color(username)}" title="${username}">
            ${initials}
        </span>
    </tal:b>
</metal:identicon>

<metal:photoswipe define-macro="photoswipe" i18n:domain="onegov.town6">
    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="pswp__bg"></div>
        <div class="pswp__scroll-wrap">

            <div class="pswp__container">
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
            </div>

            <div class="pswp__ui pswp__ui--hidden">

                <div class="pswp__top-bar">

                    <div class="pswp__counter"></div>

                    <button class="pswp__button pswp__button--close" title="Close (Esc)" i18n:attributes="title"></button>
                    <button class="pswp__button pswp__button--share" title="Share" i18n:attributes="title"></button>
                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen" i18n:attributes="title"></button>
                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out" i18n:attributes="title"></button>

                    <div class="pswp__preloader">
                        <div class="pswp__preloader__icn">
                          <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                          </div>
                        </div>
                    </div>
                </div>

                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                    <div class="pswp__share-tooltip"></div>
                </div>

                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
                </button>

                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
                </button>

                <div class="pswp__caption">
                    <div class="pswp__caption__center"></div>
                </div>

            </div>
        </div>
    </div>
</metal:photoswipe>

<metal:autoplay_video define-macro="autoplay_video" i18n:domain="onegov.town6">
    <div tal:condition="link_mp4 or link_webm" class="homepage-video" data-max-height="${max_height if max_height else '100vh'}"
    >
        <video id="autoplay-video" autoplay playsinline loop muted
            data-link-mp4="${link_mp4}"
            data-link-mp4-low-res="${link_mp4_low_res}"
            data-link-webm="${link_webm}"
            data-link-webm-low-res="${link_webm_low_res}"
        >
            Your browser does not support the video tag.
        </video>
        <div style="height: 0; width: 100%; padding-bottom: calc(9 / 16 *100%);" id="spacer">
            <div class="dark-overlay" tal:condition="text"></div>
            <div class="grid-container" tal:condition="text">
                <div class="text">
                    <p tal:condition="text and button_url">
                        <tal:b >
                            <span>${text}</span>
                        </tal:b>
                    </p>
                    <tal:b tal:condition="text and not button_url">
                        <span>${text}</span>
                    </tal:b>
                    <tal:b tal:condition="button_url|False">
                        <a class="button" href="${button_url}">${button_text}<tal:b condition="not: button_text" i18n:translate="">Show more</tal:b></a>
                    </tal:b>
                </div>
            </div>
        </div>
    </div>
</metal:autoplay_video>

<metal:testimonial define-macro="testimonial" i18n:domain="onegov.town6">
    <div class="testimonial grid-x grid-padding-x" data-aos="fade" condition="description and image and quote">
        <div class="small-4 medium-2 cell">
            <div class="square-container">
                <img src="${image}"/>
            </div>
        </div>
        <div class="small-8 medium-10 cell">
            <div class="text">
                <p class="description">
                    ${description}
                </p>
                <p class="quote">
                    <i class="fas fa-angle-double-left"></i>
                    ${quote}
                    <i class="fas fa-angle-double-right"></i>
                </p>
            </div>
        </div>
    </div>
</metal:testimonial>

<metal:icon_links define-macro="icon_link" i18n:domain="onegov.town6">
        <div tal:condition="title and icon" class="icon-link card inverted-${str(invert).lower()}" data-aos="fade">
            <a href="${link}">
                <h5 class="title"><i class="fa ${icon} icon"></i> <span>${title}</span></h5>
                <p tal:condition="text" >${text}</p>
            </a>
        </div>
</metal:icon_links>

<metal:slider define-macro="slider" i18n:domain="onegov.town6">
    <div tal:condition="images" class="orbit slider homepage-image-slider" role="region" aria-label="Homepage Image Slider" data-orbit data-timer-delay="7200" tal:define="height height|None;">
        <div class="orbit-wrapper">
            <div tal:condition="images and len(images) > 1" class="orbit-controls show-for-medium">
                <button class="orbit-previous"><span class="show-for-sr">Previous Slide</span><i class="fa fa-chevron-left"></i></button>
                <button class="orbit-next"><span class="show-for-sr">Next Slide</span><i class="fa fa-chevron-right"></i></button>
            </div>
            <ul class="orbit-container" data-height-m="${height_m}" data-height-d="${height_d}">
                <li tal:repeat="image images" class="orbit-slide">
                    <figure class="orbit-figure">
                        <div class="orbit-image" style="background-image:url(${image.src})" data-image-url="${image.src}"></div>
                        <div class="dark-overlay" tal:condition="image.note"></div>
                        <div class="grid-container" tal:condition="image.note">
                            <div class="text">
                                <span>${image.note}</span>
                            </div>
                        </div>
                    </figure>
                </li>
            </ul>
        </div>
        <metal:b tal:condition="images and len(images) > 1" use-macro="layout.macros['orbit-bullets']" />
    </div>
    <div class="slider no-images" tal:condition="not images and request.is_manager">
        <div class="grid-container">
            <tal:b i18n:translate>
                This space holds images from your photo-albums. To show photos add a few
                photos to an album and mark it as available for the homepage.
            </tal:b>
        </div>
    </div>
</metal:slider>


<metal:testimonial_slider define-macro="testimonial_slider" i18n:domain="onegov.town6">
<tal:b tal:condition="description_1 and image_1 and quote_1">
    <div class="orbit slider testimonial-slider" role="region" aria-label="Homepage Testimonal Slider" data-orbit data-timer-delay="7200">
        <div class="orbit-wrapper">
            <ul class="orbit-container">
                <li class="orbit-slide">
                    <div class="testimonial grid-x grid-padding-x" data-aos="fade">
                        <div class="small-4 medium-2 cell"><div class="square-container">
                            <img src="${image_1}"/>
                        </div></div>
                        <div class="small-8 medium-10 cell"><div class="text">
                            <p class="description">${description_1}</p>
                            <p class="quote">
                            <i class="fas fa-angle-double-left"></i>
                            ${quote_1}
                            <i class="fas fa-angle-double-right"></i>
                            </p>
                        </div></div>
                    </div>
                </li>
                <li class="orbit-slide" tal:condition="description_2 and image_2 and quote_2">
                    <div class="testimonial grid-x grid-padding-x" data-aos="fade">
                        <div class="small-4 medium-2 cell"><div class="square-container">
                            <img src="${image_2}"/>
                        </div></div>
                        <div class="small-8 medium-10 cell"><div class="text">
                            <p class="description">${description_2}</p>
                            <p class="quote">
                            <i class="fas fa-angle-double-left"></i>
                            ${quote_2}
                            <i class="fas fa-angle-double-right"></i>
                            </p>
                        </div></div>
                    </div>
                </li>
                <li class="orbit-slide" tal:condition="description_3 and image_3 and quote_3">
                    <div class="testimonial grid-x grid-padding-x" data-aos="fade">
                        <div class="small-4 medium-2 cell"><div class="square-container">
                            <img src="${image_3}"/>
                        </div></div>
                        <div class="small-8 medium-10 cell"><div class="text">
                            <p class="description">${description_3}</p>
                            <p class="quote">
                            <i class="fas fa-angle-double-left"></i>
                            ${quote_3}
                            <i class="fas fa-angle-double-right"></i>
                            </p>
                        </div></div>
                    </div>
                </li>
            </ul>
            <div class="orbit-controls" tal:condition="image_2 and image_2 and quote_2">
                <button class="orbit-previous"><span class="show-for-sr">Previous Slide</span><i class="fa fa-chevron-left"></i></button>
                <button class="orbit-next"><span class="show-for-sr">Next Slide</span><i class="fa fa-chevron-right"></i></button>
            </div>
        </div>
    </div>
</tal:b>
</metal:testimonial_slider>

<metal:bullets define-macro="orbit-bullets" i18n:domain="onegov.town6">
    <div class="orbit-bullet-wrapper show-for-medium">
        <nav class="orbit-bullets">
            <button tal:repeat="image images" class="${'is-active' if repeat.image.start else ''}" tal:attributes="data-slide repeat.image.index">
                <span class="show-for-sr" tal:condition="image.note">${image.note}</span>
                <span tal:condition="repeat.image.start" class="show-for-sr" data-slide-active-label i18n:translate>Current Image</span>
            </button>
        </nav>
    </div>
</metal:bullets>

<metal:search_results define-macro="search_results" i18n:domain="onegov.town6">
    <ul class="more-list search-results">
        <tal:b repeat="result model.load_batch_results">
            <li class="search-result-${result.__tablename__}" tal:condition="result">
                <tal:b
                    define="macro 'search_result_{}'.format(result.__tablename__); tenant_macro 'search_result_{}_{}'.format(result.__tablename__, request.app.application_id.split('/')[-1])"
                    metal:use-macro="layout.macros[tenant_macro]|layout.macros[macro]|layout.macros['search_result_default']"
                />
            </li>
        </tal:b>
    </ul>
</metal:search_results>

<metal:search_result_users define-macro="search_result_users" i18n:domain="onegov.town6">
    <a href="${request.return_here(request.link(result))}" class="list-link">
        <h5 class="list-title">${result.title} <metal:hint use-macro="layout.macros['access_hint']" tal:define="item result" /></h5>
    </a>
    <p class="search-preview">
        ${translate(result.role.capitalize())}
    </p>
</metal:search_result_users>


<metal:search_result_files define-macro="search_result_files" i18n:domain="onegov.town6">
    <a class="list-link" href="${request.return_here(request.link(result))}">
        <h5 class="list-title">
            ${result.name} <metal:hint use-macro="layout.macros['access_hint']" tal:define="item result" />
        </h5>
    </a>
    <a href="${request.return_here(request.link(result))}">
        <p class="search-preview">
            <tal:b condition="result.signed">
                <span i18n:translate>Has a digital seal</span>,
            </tal:b>
            <span>
                <tal:b i18n:translate tal:condition="result.stats.get('pages', 0) == 1">
                    <tal:b i18n:name="count">${result.stats.get('pages', 0)}</tal:b> page
                </tal:b>

                <tal:b i18n:translate tal:condition="result.stats.get('pages', 0) > 1">
                    <tal:b i18n:name="count">${result.stats.get('pages', 0)}</tal:b> pages
                </tal:b>
            </span>
        </p>
    </a>
</metal:search_result_files>


<metal:search_result_tickets define-macro="search_result_tickets" i18n:domain="onegov.town6">
    <a class="list-link" href="${request.link(result)}">
        <h5 class="list-title">
            ${result.number}
            <i title="This site is private" i18n:attributes="title" class="private-hint"></i>
        </h5>
    </a>
    <a href="${request.link(result)}">
        <p class="search-preview">
            <tal:b>${translate(result.group)}</tal:b><br/>
            <tal:b tal:content="result.title"></tal:b><br/>
            <tal:b tal:content="result.subtitle"></tal:b>
        </p>
    </a>
</metal:search_result_tickets>


<metal:search_result_events define-macro="search_result_events" i18n:domain="onegov.town6">
    <a class="list-link" href="${request.link(result, 'latest')}">
        <h5 class="list-title">
            ${result.title} <metal:hint use-macro="layout.macros['access_hint']" tal:define="item result" />
        </h5>
    </a>
    <p tal:define="latest result.latest_occurrence" class="search-preview">
        <tal:b tal:condition="latest">
            ${
            '{}, {} - {}'.format(
                layout.format_date(latest.localized_start, 'event'),
                layout.format_date(latest.localized_start, 'time'),
                layout.format_date(latest.localized_end, 'time')
                )
            }<br/>
        </tal:b>
        <tal:b tal:condition="result.location">
        ${result.location}</tal:b>
    </p>
    <tal:b tal:condition="future_occ" tal:define="future_occ result.future_occurrences(offset=1).all()">
        <ul>
            <li><span i18n:translate="">Further occurrences:</span>
                <div class="event-child-results">
                    <ul>
                        <tal:b tal:repeat="occ future_occ">
                            <li>
                                <a href="${request.link(occ)}">
                                    ${
                                    '{}, {} - {}'.format(
                                        layout.format_date(occ.localized_start, 'event'),
                                        layout.format_date(occ.localized_start, 'time'),
                                        layout.format_date(occ.localized_end, 'time')
                                        )
                                    }
                                </a>
                            </li>
                        </tal:b>
                    </ul>
                </div></li>
        </ul>
    </tal:b>
</metal:search_result_events>


<metal:search_result_people define-macro="search_result_people" i18n:domain="onegov.town6">
    <a href="${request.link(result)}" class="list-link">
        <h5 class="list-title">${result.title} <metal:hint use-macro="layout.macros['access_hint']" tal:define="item result" /></h5>
    </a>
        <p class="search-preview" tal:condition="result.function|nothing">${result.function}</p>
        <p class="search-preview" tal:condition="not:result.function|nothing" i18n:translate>People</p>
</metal:search_result_people>


<metal:search_result_external_links define-macro="search_result_external_links" i18n:domain="onegov.town6">
    <a href="${result.url}" class="list-link">
        <span class="h5 list-title">${result.title} <metal:hint use-macro="layout.macros['access_hint']" tal:define="item result" /></span>
    </a>
    <a tal:condition="result.lead" href="${result.url}">
        <p class="search-preview">
            ${result.lead[:160]}<tal:b condition="len(result.lead) > 160">…</tal:b>
        </p>
    </a>
    <a class="edit-link" href="${request.link(result, name='edit')}" tal:condition="request.is_manager"><i class="far fa-edit"></i></a>
</metal:search_result_external_links>


<metal:search_result_default define-macro="search_result_default" i18n:domain="onegov.town6">
    <a href="${request.link(result)}" class="list-link">
        <h5 class="list-title">${result.title} <metal:hint use-macro="layout.macros['access_hint']" tal:define="item result" /></h5>
    </a>
    <a tal:condition="result.lead|None" href="${request.link(result)}">
        <p class="search-preview">
            ${result.lead[:160]}<tal:b condition="len(result.lead) > 160">…</tal:b>
        </p>
    </a>
</metal:search_result_default>


<metal:ticket_status_page_message define-macro="ticket_status_page_message" i18n:domain="onegov.town6" tal:define="mute_all request.app.org.mute_all_tickets; skip request.app.org.tickets_skip_opening_email or []">
    <tal:b tal:condition="ticket.state == 'open'">
        <tal:b tal:switch="not mute_all and ticket.handler_code in skip">
            <p tal:case="False" i18n:translate>
                Your request will be processed shortly. To see the state of
                your process your may return to this page at any time.

                All information on this page has been sent to your e-mail address.
            </p>
            <p tal:case="True" i18n:translate>
                Your request will be processed shortly. To see the state of
                your process your may return to this page at any time.
            </p>
        </tal:b>
    </tal:b>

    <p i18n:translate tal:condition="ticket.state == 'closed'">
        Your request has been completed.
    </p>
</metal:ticket_status_page_message>


<metal:checkout_form define-macro="checkout_form" i18n:domain="onegov.town6">
    <form action="${complete_link}" method="POST" class="checkout">
        <dl class="field-display" tal:condition="show_privacy_settings|nothing">
            <dt i18n:translate>Privacy</dt>
            <dd>
                <label class="common-text">
                    <input type="checkbox" name="send_by_email" value="yes" checked>
                    <span class="label-text" i18n:translate style="max-width: 100%">
                        Send me my entered data by e-mail.
                    </span>
                </label>
            </dd>
        </dl>

        <tal:b tal:condition="price" switch="'cc' if price.credit_card_payment else payment_method">
            <tal:b case="'manual'">
                <label style="display: none;">
                    <input type="radio" name="payment_method" value="manual" checked>
                </label>
            </tal:b>
            <tal:b case="'cc'">
                <label style="display: none;">
                    <input type="radio" name="payment_method" value="online" checked>
                </label>
            </tal:b>
            <tal:b case="'free'">
                <div class="field-display">
                    <div class="field-display-block">
                        <div class="field-display-label" i18n:translate>Payment</div>
                        <div class="field-display-data">
                            <label class="common-text">
                                <input type="radio" name="payment_method" value="online" checked>
                                <span>
                                    <tal:b i18n:translate>Pay Online Now</tal:b>
                                    <tal:b tal:condition="price.fee|nothing">
                                        (+ ${layout.format_number(price.fee)} ${price.currency} <tal:b i18n:translate>Credit Card Fee</tal:b>)
                                    </tal:b>
                                </span>
                            </label>
                            <label class="common-text">
                                <input type="radio" name="payment_method" value="manual">
                                <span i18n:translate>Pay Offline later</span>
                            </label>
                        </div>
                    </div>
                </div>
            </tal:b>

            <div data-depends-on="payment_method/online">
                <tal:b replace="checkout_button" />
                <metal:b define-slot="after-submit" />
            </div>
            <div data-depends-on="payment_method/manual">
                <input type="submit" value="Complete" class="button" i18n:attributes="value">
                <metal:b define-slot="after-submit" />
            </div>
        </tal:b>

        <tal:b condition="not price">
            <input type="submit" value="Complete" class="button" i18n:attributes="value">
            <metal:b define-slot="after-submit" />
        </tal:b>
    </form>
</metal:checkout_form>

<metal:tags define-macro="tags">
    <ul class="tags" >
        <li tal:repeat="link tags" class="click-through">
            <span tal:content="link(layout)"
                class="${link.active and 'active' or ''} blank-label ${getattr(link, 'rounded', None) and 'rounded'}"
            />
        </li>
    </ul>
</metal:tags>

<metal:generic_message define-macro="generic_message" i18n:domain="onegov.town6">
    <div class="title">
        <metal:b define-slot="title" />
    </div>
    <div class="identicon">
        <metal:b use-macro="layout.macros.identicon"
                 tal:define="
                    initials owner.initials if not layout.org.hide_personal_email or model.meta.get('origin') == 'external' or request.is_logged_in else layout.org.general_email[0];
                    username owner.username if not layout.org.hide_personal_email or model.meta.get('origin') == 'external' or request.is_logged_in else layout.org.general_email;
                    size 'large';
                "
        />
    </div>
    <div class="timestamp">
        <b>${owner.name if not layout.org.hide_personal_email or model.meta.get('origin') == 'external' or request.is_logged_in else layout.org.general_email}</b>

        <tal:b i18n:translate>
            at <tal:b i18n:name="time">${layout.format_date(model.created, 'time')}</tal:b>
        </tal:b>
    </div>
    <div class="text">
        <metal:b define-slot="text" />
    </div>
    <div class="file" tal:condition="model.file">
        <a href="${request.link(model.file)}">${model.file.name}</a>
    </div>
    <div class="actions">
        <metal:b define-slot="actions" />
    </div>
</metal:generic_message>

<metal:payments define-macro="payments" i18n:domain="onegov.town6">
    <table class="payments-table" tal:condition="payments">
        <thead>
            <tr>
                <th i18n:translate tal:condition="tickets|nothing">
                    Object
                </th>
                <th i18n:translate tal:condition="reservation_dates_formatted|nothing">
                    Reservation
                </th>
                <th i18n:translate>
                    Net Amount
                </th>
                <th i18n:translate>
                    Fee
                </th>
                <th i18n:translate>
                    Payment Provider
                </th>
                <th i18n:translate>
                    State
                </th>
                <th i18n:translate>
                    Created
                </th>
                <th i18n:translate>
                    Disbursed
                </th>
                <th tal:condition="payment_actions|nothing"></th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="payment payments">
                <td tal:condition="tickets|nothing">
                    <tal:b define="ticket tickets[payment.id] | nothing">
                        <div tal:condition="ticket">
                            <a tal:condition="ticket" href="${request.link(ticket)}">
                                <strong>${ticket.number}</strong> - ${ticket.group}
                            </a>
                            <tal:b tal:switch="ticket.handler_code">
                                <div tal:case="'RSV'">
                                    ${ticket.ticket_email}
                                </div>
                                <div tal:case="default">
                                    ${ticket.title}
                                </div>
                            </tal:b>
                        </div>
                    </tal:b>
                </td>
                <!-- Cell for Reservation Dates -->
                <td tal:condition="reservation_dates_formatted|nothing">
                    <span tal:replace="reservation_dates_formatted.get(payment.id, '')" />
                </td>
                <td>${'{0:.2f}'.format(payment.net_amount)} ${payment.currency}</td>
                <td>
                    <tal:b condition="payment.fee|nothing">
                        + ${'{0:.2f}'.format(payment.fee)} ${payment.currency}
                    </tal:b>
                </td>
                <td>
                    <span tal:condition="payment.provider_id">
                        ${providers[payment.provider_id].title}
                    </span>
                    <span tal:condition="not:payment.provider" i18n:translate>
                        Manual
                    </span>
                </td>
                <td>
                    <metal:b use-macro="layout.macros['payment_status']" />
                </td>
                <td>
                    ${layout.format_date(payment.created, 'datetime')}
                </td>
                <td>
                    <tal:b condition="payment.payout_date|nothing">
                        ${layout.format_date(payment.payout_date, 'date')}
                    </tal:b>
                </td>
                <td tal:condition="payment_actions|nothing" class="text-links">
                    <tal:b repeat="link payment_actions(payment)">
                        <tal:b replace="link(layout)" />
                    </tal:b>
                </td>
            </tr>
        </tbody>
    </table>
</metal:payments>

<metal:invoices define-macro="invoices" i18n:domain="onegov.town6">
    <table class="invoices-table" tal:condition="invoices">
        <thead>
            <tr>
                <th class="select-all-checkbox-cell">
                    <input type="checkbox" aria-label="Select all invoices" />
                </th>
                <th i18n:translate>
                    Object
                </th>
                <th i18n:translate tal:condition="reservation_dates_formatted|nothing">
                    Reservation
                </th>
                <th i18n:translate>
                    Net Amount
                </th>
                <th i18n:translate>
                    Invoiced
                </th>
                <th i18n:translate>
                    Paid
                </th>
                <th i18n:translate>
                    Created
                </th>
                <th tal:condition="invoice_actions|nothing"></th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="invoice invoices" class="${'' if invoice.invoiced else 'un'}invoiced ${'' if invoice.paid else 'un'}paid">
                <td class="invoice-checkbox-cell">
                    <input type="checkbox" name="selected_invoices" value="${invoice.id}" aria-label="Select this invoice" i18n:attributes="aria-label" />
                </td>
                <td>
                    <div>
                        <a href="${request.link(invoice.ticket)}">
                            <strong>${invoice.ticket.number}</strong> - ${invoice.ticket.group}
                        </a>
                        <tal:b tal:switch="invoice.ticket.handler_code">
                            <div tal:case="'RSV'">
                                ${invoice.ticket.ticket_email}
                            </div>
                            <div tal:case="default">
                                ${invoice.ticket.title}
                            </div>
                        </tal:b>
                    </div>
                </td>
                <!-- Cell for Reservation Dates -->
                <td tal:condition="reservation_dates_formatted|nothing">
                    <span tal:replace="reservation_dates_formatted.get(invoice.id, '')" />
                </td>
                <td>${'{0:.2f}'.format(invoice.total_amount)}</td>
                <td class="invoiced-state">
                    <tal:b tal:condition="invoice.invoiced">
                        <i class="fa fa-check-circle" aria-hidden="true" title="Invoiced" i18n:attributes="title"></i>
                        <span i18n:translate class="show-for-sr">Invoiced</span>
                    </tal:b>
                    <tal:b tal:condition="not:invoice.invoiced">
                        <i class="fa fa-times-circle" aria-hidden="true" title="Uninvoiced" i18n:attributes="title"></i>
                        <span i18n:translate class="show-for-sr">Uninvoiced</span>
                    </tal:b>
                </td>
                <td class="paid-state">
                    <tal:b tal:condition="invoice.paid">
                        <i class="fa fa-check-circle" aria-hidden="true" title="Paid" i18n:attributes="title"></i>
                        <span i18n:translate class="show-for-sr">Paid</span>
                    </tal:b>
                    <tal:b tal:condition="not:invoice.paid">
                        <i class="fa fa-times-circle" aria-hidden="true" title="Unpaid" i18n:attributes="title"></i>
                        <span i18n:translate class="show-for-sr">Unpaid</span>
                    </tal:b>
                </td>
                <td>
                    ${layout.format_date(invoice.ticket.created, 'datetime')}
                </td>
                <td tal:condition="invoice_actions|nothing" class="text-links">
                    <tal:b repeat="link invoice_actions(invoice)">
                        <tal:b replace="link(layout)" />
                    </tal:b>
                </td>
            </tr>
        </tbody>
    </table>
</metal:invoices>

<metal:directory_error define-macro="directory_error" i18n:domain="onegov.town6">
    <ul class="dense">
        <li tal:repeat="(field_id, messages) error.errors.items()">
            <div tal:condition="error.link|nothing">
                <strong><a href="${error.link}">${error.entry.title}</a></strong>
            </div>
            <div tal:condition="not:error.link|nothing">
                <strong>${error.entry.title}</strong>
            </div>
            <div>
                ${directory.field_by_id(field_id).human_id}: ${error_translate(' '.join(messages))}
            </div>
        </li>
    </ul>
</metal:directory_error>

<metal:group_by_column define-macro="group_by_column" i18n:domain="onegov.town6">
    <tal:b repeat="group grouped" tal:define="link_func link_func|request.link; add_pagerefs add_pagerefs|False;">
        <a class="category-anchor" id="${group}"></a>
        <div class="group-title align-justify">
            <h2 tal:condition="len(grouped) > 1">
                ${group}
                <metal:b tal:condition="add_pagerefs" use-macro="layout.macros['pageref']" tal:define="pageref_id group" />
            </h2>
        </div>
        <ul class="forms-list more-list">
            <tal:b tal:repeat="record grouped[group]">
                <metal:b use-macro="layout.macros['group_record']"/>
            </tal:b>
        </ul>
    </tal:b>
</metal:group_by_column>

<metal:group_record define-macro="group_record" i18n:domain="onegov.town6">
    <li tal:define="link edit_link(record)|nothing">
        <a class="list-link" tal:attributes="href link_func(record); target link">
                <span class="h5 list-title">${record.title}</span>
                <metal:hint use-macro="layout.macros['access_hint']" tal:define="item record" />
        </a>
        <a tal:attributes="href link_func(record); target link" tal:define="lead lead_func(record)|layout.linkify(record.meta.get('lead'))"
                tal:content="lead" tal:condition="lead">
            <p class="list-lead preview" >
            </p>
            <div class="list-hint hints" tal:define="hint hint(record)|False"
                tal:content="hint" tal:condition="hint">
            </div>
        </a>
        <a class="edit-link" href="${link}" tal:condition="link"><i class="far fa-edit"></i></a>
    </li>
</metal:group_record>

<metal:resource_groups define-macro="resource_groups" i18n:domain="onegov.town6">
    <tal:b repeat="group resources" tal:define="link_func link_func|request.link; add_pagerefs add_pagerefs|False;">
        <a class="category-anchor" id="${group.title}"></a>
        <div class="group-title align-justify">
            <h2 tal:condition="len(resources) > 1">
                ${group.title}
                <metal:b tal:condition="add_pagerefs" use-macro="layout.macros['pageref']" tal:define="pageref_id group.title" />
            </h2>
            <a tal:condition="group.find_your_spot" tal:attributes="href link_func(group.find_your_spot)" class="button hollow narrow find-your-spot-link"><i class="fa fa-calendar"></i> <span i18n:translate="">Find Your Spot</span></a>
        </div>
        <ul class="forms-list more-list">
            <tal:b tal:repeat="record group.entries" tal:switch="record.__class__.__name__">
                <li tal:case="'ResourceSubgroup'" class="medium-6 more-list-level-2">
                    <metal:b tal:define="subgroup record" use-macro="layout.macros['resource_subgroup']"/>
                </li>
                <metal:b tal:case="default" use-macro="layout.macros['group_record']"/>
            </tal:b>
        </ul>
    </tal:b>
</metal:resource_groups>

<metal:resource_subgroup define-macro="resource_subgroup" i18n:domain="onegov.town6">
    <tal:b tal:define="pageref_id f'{group.title}-{subgroup.title}'">
        <a class="category-anchor" id="${pageref_id}"></a>
        <div class="subgroup-title align-justify">
            <h5>
                ${subgroup.title}
                <metal:b tal:condition="add_pagerefs" use-macro="layout.macros['pageref']" />
            </h5>
            <a tal:condition="subgroup.find_your_spot" tal:attributes="href link_func(subgroup.find_your_spot)" class="button hollow narrow find-your-spot-link"><i class="fa fa-calendar"></i> <span i18n:translate="">Find Your Spot</span></a>
        </div>
        <ul class="forms-list more-list">
            <tal:b tal:repeat="record subgroup.entries">
                <metal:b use-macro="layout.macros['group_record']"/>
            </tal:b>
        </ul>
    </tal:b>
</metal:resource_subgroup>

<metal:file_details define-macro="file-details" i18n:domain="onegov.town6">
    <div class="file-details">
        <a class="file-preview" href="${request.link(file)}" tal:condition="extension == 'pdf'">
            <img class="pdf-preview" src="${request.link(file, name='medium')}">
        </a>
        <a class="file-preview" href="${request.link(file)}" tal:condition="extension != 'pdf'">
            <svg width="204px" height="261px" viewBox="0 0 204 261" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="position:relative; left: -6px;">
                <defs>
                    <filter x="-7.8%" y="-5.9%" width="120.0%" height="115.3%" filterUnits="objectBoundingBox" id="filter-1">
                        <feOffset dx="4" dy="4" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>
                        <feGaussianBlur stdDeviation="5" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>
                        <feColorMatrix values="0 0 0 0 0.392156863   0 0 0 0 0.392156863   0 0 0 0 0.392156863  0 0 0 0.4 0" type="matrix" in="shadowBlurOuter1" result="shadowMatrixOuter1"></feColorMatrix>
                        <feMerge>
                            <feMergeNode in="shadowMatrixOuter1"></feMergeNode>
                            <feMergeNode in="SourceGraphic"></feMergeNode>
                        </feMerge>
                    </filter>
                    <path d="M180,55.8004032 L180,233.892177 C180,235.962291 178.328034,237.640449 176.26556,237.640449 L3.73443983,237.640449 C1.67196566,237.640449 0,235.962291 0,233.892177 L0,3.74827207 C0,1.67815857 1.67196566,0 3.73443983,0 L124.368614,7.10542736e-15 C127.027185,1.13396268e-14 129.576325,1.05864997 131.452741,2.94201554 L177.084127,48.7424188 C178.9515,50.6167086 180,53.1546434 180,55.8004032 Z" id="path-2"></path>
                    <path d="M180,55.8004032 L180,233.892177 C180,235.962291 178.328034,237.640449 176.26556,237.640449 L3.73443983,237.640449 C1.67196566,237.640449 0,235.962291 0,233.892177 L0,3.74827207 C0,1.67815857 1.67196566,0 3.73443983,0 L124.368614,7.10542736e-15 C127.027185,1.13396268e-14 129.576325,1.05864997 131.452741,2.94201554 L177.084127,48.7424188 C178.9515,50.6167086 180,53.1546434 180,55.8004032 Z" id="path-4"></path>
                </defs>
                <g id="Artboard" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                    <g id="Group" filter="url(#filter-1)" transform="translate(7.000000, 7.000000)">
                        <g id="Page">
                            <mask id="mask-3" fill="white">
                                <use xlink:href="#path-2"></use>
                            </mask>
                            <use id="Mask" stroke="#DDDDDD" stroke-width="2" fill="#F7F8F8" fill-rule="nonzero" xlink:href="#path-2"></use>
                            <rect id="Corner" fill="#DDDDDD" mask="url(#mask-3)" x="127.717842" y="-3.74827207" width="56.0165975" height="56.2240811" rx="4"></rect>
                        </g>
                        <mask id="mask-5" fill="white">
                            <use xlink:href="#path-4"></use>
                        </mask>
                        <use id="Mask" stroke="#DDDDDD" stroke-width="2" fill="#F7F8F8" fill-rule="nonzero" xlink:href="#path-4"></use>
                        <rect id="Corner" fill="#DDDDDD" mask="url(#mask-5)" x="128.426966" y="-5.05617978" width="55.6179775" height="56.6292135" rx="4"></rect>
                        <path d="M-0.0112359551,167.853933 L-0.0112359551,233.651685 C-0.0112359551,235.860824 1.77962505,237.651685 3.98876404,237.651685 L176.011236,237.651685 C178.220375,237.651685 180.011236,235.860824 180.011236,233.651685 L180.011236,167.853933 L-0.0112359551,167.853933 Z" id="Banner" stroke="#DDDDDD" stroke-width="2" fill="${color}" mask="url(#mask-5)"></path>
                        <text id="PDF" mask="url(#mask-5)" font-family="OpenSans-Bold, Open Sans, Helvetica Neue, Arial, sans-serif" font-size="41" font-weight="bold" fill="#FFFFFF" text-anchor="middle" y="216" x="44.5%">${extension.upper()}</text>
                    </g>
                </g>
            </svg>
        </a>
    </div>
    <div class="file-status">

        <tal:block tal:condition="not: hide_publication|False">

            <h3 i18n:translate>Access</h3>
            <div class="publication" tal:define="
                post_url layout.csrf_protected_url(request.link(file, name='update-publish-date'));
                publish_end_date file.publish_end_date and layout.to_timezone(file.publish_end_date, layout.timezone);
                publish_date file.publish_date and layout.to_timezone(file.publish_date, layout.timezone);"
                >
                <div tal:condition="file.published" class="file-status-tag">
                    <a ic-post-to="${layout.csrf_protected_url(request.link(file, name='unpublish'))}"
                       ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))"
                       class="is-published">
                        <i class="far fa-fw fa-check-circle" aria-hidden="true"></i> <span i18n:translate>Public</span>
                    </a>
                </div>
                <div tal:condition="not:file.published" class="file-status-tag">
                    <a ic-post-to="${layout.csrf_protected_url(request.link(file, name='publish'))}"
                       ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))"
                       class="is-not-published">
                        <i class="far fa-fw fa-eye-slash" aria-hidden="true"></i> <span i18n:translate>Private</span>
                    </a>
                </div>

                <div class="publication-settings publication-date-set">
                    <form method="POST">
                        <div tal:condition="not:file.published">
                            <fieldset>
                                <legend tal:condition="publish_date" i18n:translate>Will be published on:</legend>
                                <legend tal:condition="not:publish_date" i18n:translate>Publication date:</legend>
                                <div class="publication-settings-input">
                                    <input type="date" name="date" class="small" ic-post-to="${post_url}" ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))" value="${publish_date and publish_date.date().isoformat() or ''}" required="required">

                                    <select name="hour" ic-post-to="${post_url}" ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))">
                                        <option tal:condition="not:publish_date"></option>
                                        <tal:b repeat="hour range(24)" tal:define="publish_time publish_date and '{:0>2}:00'.format(publish_date.hour)">
                                            <option tal:define="time '{:0>2}:00'.format(hour)" tal:attributes="selected publish_time == time" value="${time}">${time}</option>
                                        </tal:b>
                                    </select>

                                    <a ic-post-to="${post_url}&clear_start_date=1" ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))">
                                        <i class="far fa-times-circle"></i>
                                        <span class="show-for-sr" i18n:translate>Reset</span>
                                    </a>
                                </div>
                            </fieldset>
                        </div>
                        <fieldset>
                            <legend tal:condition="publish_end_date" i18n:translate>Will be published until:</legend>
                            <legend tal:condition="not:publish_end_date" i18n:translate>Publication end date:</legend>
                            <div class="publication-settings-input">
                                <input type="date" name="end-date" class="small" ic-post-to="${post_url}" ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))" value="${publish_end_date and publish_end_date.date().isoformat() or ''}" required="required">

                                <select name="end-hour" ic-post-to="${post_url}" ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))">
                                    <option tal:condition="not:publish_end_date"></option>
                                    <tal:b repeat="hour range(24)" tal:define="publish_end_time publish_end_date and '{:0>2}:00'.format(publish_end_date.hour)">
                                        <option tal:define="end_time '{:0>2}:00'.format(hour)" tal:attributes="selected publish_end_time == end_time" value="${end_time}">${end_time}</option>
                                    </tal:b>
                                </select>

                                <a ic-post-to="${post_url}&clear_end_date=1" ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))">
                                    <i class="far fa-times-circle"></i>
                                    <span class="show-for-sr" i18n:translate>Reset</span>
                                </a>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>

            <h3 i18n:translate>Publication</h3>
            <div class="publication" tal:define="
                post_url layout.csrf_protected_url(request.link(file, name='update-publish-date'));
                publish_date file.publish_date and layout.to_timezone(file.publish_date, layout.timezone);
                publish_end_date file.publish_end_date and layout.to_timezone(file.publish_end_date, layout.timezone);"
                >
                <div tal:condition="file.publication" class="file-status-tag">
                    <a ic-post-to="${layout.csrf_protected_url(request.link(file, name='toggle-publication'))}"
                       ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))"
                       class="is-a-publication">
                        <i class="far fa-fw fa-check-circle" aria-hidden="true"></i> <span i18n:translate>Publication</span>
                    </a>
                </div>

                <div tal:condition="not:file.publication" class="file-status-tag">
                    <a ic-post-to="${layout.csrf_protected_url(request.link(file, name='toggle-publication'))}"
                       ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))"
                       class="is-not-a-publication">
                        <i class="far fa-fw fa-times-circle" aria-hidden="true"></i> <span i18n:translate>Not a publication</span>
                    </a>
                </div>
            </div>
        </tal:block>

        <tal:b condition="request.app.enable_yubikey and file.reference['content_type'] == 'application/pdf'">
            <h3 i18n:translate>Digital seal</h3>
            <div class="signature">
                <div class="file-status-tag">
                    <metal:b use-macro="layout.macros['signature_status']"/>
                </div>
            </div>
        </tal:b>

        <tal:b condition="file.reference['content_type'] == 'application/pdf'">
            <h3 i18n:translate>Content</h3>
            <div class="file-content">
                <div class="file-status-tag">
                    <div tal:condition="file.stats.get('pages', 0) <= 1">
                        <i class="far fa-fw fa-file-alt" aria-hidden="true"></i>
                        <span i18n:translate>1 page</span>
                    </div>
                    <div tal:condition="file.stats.get('pages', 0) > 1">
                        <i class="far fa-fw fa-file-alt" aria-hidden="true"></i>
                        <span i18n:translate><tal:b i18n:name="count">${file.stats.get('pages', 0)}</tal:b> pages</span>
                    </div>
                    <div tal:define="words file.stats.get('words', 0)">
                        <tal:b condition="words == 0">
                            <i class="fas fa-fw fa-exclamation-triangle" aria-hidden="true"></i>
                            <span i18n:translate>Contains no readable text</span>
                        </tal:b>
                        <tal:b condition="words == 1">
                            <i class="fas fa-fw fa-font" aria-hidden="true"></i>
                            <span i18n:translate>1 word</span>
                        </tal:b>
                        <tal:b condition="words > 1">
                            <i class="fas fa-fw fa-font" aria-hidden="true"></i>
                            <span i18n:translate><tal:b i18n:name="count">${words}</tal:b> words</span>
                        </tal:b>
                    </div>
                </div>
            </div>
        </tal:b>
    </div>
    <div class="file-actions">
        <a class="button secondary confirm delete" role="button"
            ic-delete-from="${request.link(file)}?csrf-token=${layout.csrf_token}"
            ic-on-success="
                var cfd = $(elt).closest('tr');  // current file details row
                var cfi = cfd.prev();  // current file info row
                var rbfi = cfi.prev();  // row before current file info
                var rafd = cfd.next();  // row after current file details

                cfi.remove();  // remove current file info row
                cfd.remove();  // remove current file details row

                // if file is last in group, remove the group tr as well
                if (!rbfi.is('[id^=\'details-\']') &&
                    !rbfi.hasClass('file-info') &&
                    !rafd.is('[id^=\'details-\']') &&
                    !rafd.hasClass('file-info')) {
                    rbfi.remove();  // remove line before file-info row
                }
            "
            data-confirm="Do you really want to delete this file?"
            data-confirm-extra="${file.name}"
            data-confirm-yes="Delete File"
            data-confirm-no="Cancel"
            i18n:attributes="data-confirm;data-confirm-yes;data-confirm-no">
            <span class="fa fa-trash" aria-hidden="true"></span>
            <span i18n:translate >Delete</span>
        </a>
        <a class="button secondary rename prompt" role="button"
            data-prompt="Please provide the new name for the file"
            data-prompt-ok="Rename"
            data-prompt-cancel="Cancel"
            data-prompt-value="${file.name}"
            data-prompt-success="(function(value) {
                var url = '${request.link(file, 'rename')}?csrf-token=${layout.csrf_token}';
                var ext = '.${file.name.split('.')[-1].strip()}';
                var elt = $(this);

                value = value.substring(value.length - ext.length, value.length) === ext && value || value + ext;

                jQuery.post(url, {'name': value}, function() {
                    var actions = elt;

                    actions.closest('tr').prev().find('td:first').text(value);
                    actions.find('a.prompt').data('prompt-value', value);
                    actions.find('a.delete').data('confirm-extra', value);
                });
            })"
            i18n:attributes="data-prompt;data-prompt-ok;data-prompt-cancel" >
           <span class="fa fa-edit" aria-hidden="true"></span>
           <span i18n:translate>Rename</span>
        </a>
        <a class="button secondary" role="button" href="${request.link(file)}">
            <span class="fa fa-download" aria-hidden="true"></span>
            <span i18n:translate>Download</span>
        </a>
        <a class="button secondary" role="button"
           ic-get-from="${request.link(file, 'links')}"
           ic-target="#links-${id}"
           ic-on-success="
               var modal = $('#links-${id}-modal');
               modal.foundation();
               modal.foundation('open');
               modal.focus();
           ">
            <span class="fa fa-link" aria-hidden="true"></span>
            <span i18n:translate>Linked Pages</span>
            <span class="ic-indicator fa fa-spinner fa-spin" style="display: none"></span>
       </a>
    </div>
    <div style="display:none;">
        <div id="links-${id}-modal" class="reveal large dialog" data-reveal>
            <h2 i18n:translate>Links to <tal:b i18n:name="filename">${file.name}</tal:b></h2>
            <ul id="links-${id}"></ul>
        </div>
    </div>
</metal:file_details>

<metal:file_links define-macro="file-links" i18n:domain="onegov.town6">
    <ul class="more-list">
        <tal:b repeat="result file.links">
            <li class="search-result-${result.__tablename__}" tal:condition="result">
                <tal:b
                    define="macro 'search_result_{}'.format(result.__tablename__); tenant_macro 'search_result_{}_{}'.format(result.__tablename__, request.app.application_id.split('/')[-1])"
                    metal:use-macro="layout.macros[tenant_macro]|layout.macros[macro]|layout.macros['search_result_default']"
                />
            </li>
        </tal:b>
    </ul>
</metal:file_links>

<metal:sign_result define-macro="sign_result" i18n:domain="onegov.town6">
    <metal:b use-macro="layout.macros['consume_messages']" />
    <metal:b use-macro="layout.macros['signature_status']" />
</metal:sign_result>

<metal:signature_status define-macro="signature_status" i18n:domain="onegov.town6">
    <tal:b condition="file.reference.content_type == 'application/pdf'" define="may_sign request.app.enable_yubikey and request.is_admin">
        <div tal:condition="file.signed" class="is-signed signature-status">
            <i class="fa fa-fw fa-lock" aria-hidden="true"></i>

            <span i18n:translate>
                Digital seal applied by <tal:b i18n:name="signee">${layout.get_user_title(file.signature_metadata['signee'])}</tal:b>
                on <span class="nowrap" i18n:name="date">${layout.format_date(layout.parse_isodate(file.signature_metadata['timestamp']), 'datetime_long')}</span>
            </span>
        </div>
        <tal:b condition="not file.signed and may_sign">
            <a tal:condition="not:file.signed" class="is-not-signed signature-status"
                role="button"
                data-prompt="Please enter your yubikey to apply a digital seal to this file"
                data-prompt-ok="Sign"
                data-prompt-cancel="Cancel"
                data-prompt-placeholder="Plug your YubiKey into a USB slot and press it."
                data-prompt-info="Published documents with a digital seal can be discovered through the site-search and in the list of documents with a digital seal. This action will be logged and cannot be undone."
                data-prompt-success="(function(value) {
                    var url = '${request.link(file, 'sign')}?csrf-token=${layout.csrf_token}';
                    var elt = $(this);
                    var row = elt.closest('tr');

                    elt.toggleClass('signing', true);
                    window.elt = elt;

                    jQuery.post(url, {'token': value}, function(data) {
                        var target = elt.closest('.signature-status').parent();
                        target.html(data);
                        processCommonNodes(target);
                        row.prev().addClass('signed');
                    }).always(function() {
                        elt.toggleClass('signing', false);
                    });
                })"
                i18n:attributes="data-prompt;data-prompt-ok;data-prompt-cancel;data-prompt-info;data-prompt-placeholder"
            >
                <i class="fa fa-fw fa-unlock" aria-hidden="true"></i>

                <span i18n:translate class="hide-on-hover">
                    Without digital seal
                </span>

                <span i18n:translate class="show-on-hover">
                    Apply digital seal now
                </span>
            </a>
        </tal:b>
        <tal:b condition="not file.signed and not may_sign">
            <div class="is-not-signed signature-status">
                <i class="fa fa-fw fa-lock" aria-hidden="true"></i>

                <span i18n:translate class="hide-on-hover">
                    Without digital seal
                </span>

                <span i18n:translate class="show-on-hover">
                    You are not authorised to apply digital seals to documents
                </span>
            </div>
        </tal:b>
    </tal:b>
</metal:signature_status>

<metal:file_info define-macro="file-info" i18n:domain="onegov.town6">
    <tal:b define="
        file_number file.number|file.id;
        file_upload file.upload_date|file.created;
        file_publish_end file.publish_end_date|None;
    ">
        <tr class="file-info ${'signed' if file.signed else ''}">
            <td>
                ${file.name}
            </td>
            <td>
                <a id="button-${file_number}" data-ogc-toggle="#details-${file_number}">
                    <i class="fa fa-chevron-down rotate" aria-hidden="true"></i>
                </a>
            </td>
            <td>
                ${extension(file)}
            </td>
            <td>
                ${format_date(file_upload)}
            </td>
            <td>
                ${format_date(file_publish_end)}
            </td>
        </tr>
        <!-- Hidden Detail-Row -->
        <tr id="details-${file_number}" class="hidden">
            <td colspan="5">
                <div ic-trigger-from="#button-${file_number}"
                     ic-trigger-on="click once"
                     ic-get-from="${actions_url(file.id)}"
                     class="file-preview-wrapper"
                >
                </div>
            </td>
        </tr>
    </tal:b>
</metal:file_info>

<metal:uploaded_image define-macro="uploaded_image" i18n:domain="onegov.town6">
    <div id="image-${index}" class="image-container">
        <a href="${image.url}" tal:condition="image" class="editable-alt" data-note-update-url="${image.extra}">
            <img tal:condition="image.alt" data-src="${image.src}" class="lazyload static-alt" alt="${image.alt}" width="${image.width}" height="${image.height}" />
            <img tal:condition="not:image.alt" data-src="${image.src}" class="lazyload missing-alt static-alt" alt="Click to add a description" i18n:attributes="alt" width="${image.width}" height="${image.height}"/>
        </a>
        <a class="delete confirm"
           ic-delete-from="${image.url}?csrf-token=${layout.csrf_token}"
           ic-on-success="$('#image-${index}').remove();"
           data-confirm="Do you really want to delete the image?"
           data-confirm-yes="Delete Image"
           data-confirm-no="Cancel"
           i18n:attributes="data-confirm;data-confirm-yes;data-confirm-no"><i class="fa fa-times" aria-hidden="true"></i></a>
    </div>
</metal:uploaded_image>

<metal:digest_result define-macro="digest_result" i18n:domain="onegov.town6">
    <div class="digest-result digest-${is_known and 'is-known' or 'is-not-known'}" tal:switch="is_known">
        <tal:b case="True">
            <div>
                <i class="fa fa-fw fa-check-circle" aria-hidden="true"></i>
            </div>
            <div i18n:translate>
                <span i18n:name="name">${name}</span>
                was provided with a digital seal on
                <span i18n:name="date">${layout.format_date(date, 'datetime')}</span>
            </div>
        </tal:b>
        <tal:b case="False">
            <div>
                <i class="fa fa-fw fa-exclamation-circle" aria-hidden="true"></i>
            </div>
            <div i18n:translate>
                <span i18n:name="name">${name}</span>
                is not in our database
            </div>
        </tal:b>
    </div>
</metal:digest_result>

<metal:publication define-macro="publication" i18n:domain="onegov.town6">
    <div tal:define="file_link link(publication)" class="publication-item">
        <a class="file-preview" href="${file_link}">
            <img class="pdf-preview lazyload" data-no-alt data-src="${link(publication, name='medium')}">
        </a>

        <ul class="dense">
            <li class="publication-title">
                <a href="${file_link}">${name_without_extension(publication.name)}</a>
            </li>
            <li class="publication-date">
                <span>
                    ${layout.format_date(publication.created, 'date')}
                </span>
            </li>
            <li tal:define="pages publication.stats.get('pages') or 0" class="publication-stats">
                <span>
                    <i class="fa fa-fw fa-file-text-o" aria-hidden="true"></i>
                    <tal:b tal:condition="pages == 0 or pages > 1" i18n:translate>
                        <tal:b i18n:name="count">${pages}</tal:b> pages
                    </tal:b>
                    <tal:b tal:condition="pages == 1" i18n:translate>
                        1 page
                    </tal:b>
                </span>
            </li>
        </ul>
    </div>
</metal:publication>

<metal:holidays define-macro="holidays" i18n:domain="onegov.town6">
    <ul class="holidays">
        <li tal:repeat="(holiday, descriptions) holidays.all(year)">
            ${layout.format_date(holiday, 'date')} - ${', '.join(descriptions)}
        </li>
    </ul>
</metal:holidays>

<metal:tickets_table_row define-macro="tickets_table_row" i18n:domain="onegov.town6">
    <tr tal:define="ticket_url request.link(ticket); has_access request.is_manager_for_model(ticket)"
            class="ticket ticket-handler-${ticket.handler_code} ticket-row-state-${ticket.state}" tal:attributes="data-url action_link(ticket) if has_access else nothing">
        <tal:block tal:condition="has_access">
          <td class="ticket-number-plain">
              <a href="${ticket_url}">
                  ${ticket.number}
              </a>
          </td>
          <td class="ticket-group" colspan="2">
              <div>${translate(ticket.group)}</div>
              <div>${ticket.title}</div>
              <div>${ticket.subtitle}</div>
              <tal:b define="payment ticket.handler.payment" tal:condition="payment">
                  <div class="payment-state payment-state-${payment.state}">
                      ${layout.format_number(payment.amount)} ${payment.currency}
                  </div>
              </tal:b>
          </td>
          <td class="ticket-date">
              ${layout.format_date(ticket.created, 'datetime')}
          </td>
          <td class="ticket-action" tal:condition="ticket.state == 'open'" colspan="2">
              <a class="ticket-accept ticket-button button small success" href="${request.link(ticket, 'accept')}" i18n:translate>
                  Accept
              </a>
          </td>
          <td class="ticket-state" tal:condition="ticket.state != 'open'">
              <tal:b condition="ticket.state == 'pending'" i18n:translate>
                  Pending
              </tal:b>
              <tal:b condition="ticket.state == 'closed'" i18n:translate>
                  Closed
              </tal:b>
          </td>
          <td class="ticket-user" tal:condition="ticket.state != 'open'">
              <metal:identicon tal:condition="ticket.user" use-macro="layout.macros.identicon" tal:define="initials ticket.user.initials|None; username ticket.user.username|None" />
          </td>
        </tal:block>
        <tal:block tal:condition="not has_access">
          <td class="ticket-number-plain" colspan="6">
              ${ticket.number}
          </td>
        </tal:block>
        <td tal:condition="archive_tickets" class="archive-tickets">
            <input tal:condition="has_access" type="checkbox">
       </td>
    </tr>
</metal:tickets_table_row>

<metal:focus define-macro="focus-title" i18n:domain="onegov.town6">
    <tal:b i18n:translate="">Focus</tal:b>
</metal:focus>

<metal:focus define-macro="focus-panel" i18n:domain="onegov.town6">
        <div class="focus-image" tal:condition="image_src">
            <div style="width: 100%; padding-bottom: 55%; background-image: url(${image_src}); background-size: cover;"></div>
            <tal:block tal:condition="text_on_image|False and title">
                <div class="focus-title">
                    <div class="gradient"></div>
                    <div class="text-on-image">
                        <h5>${title}</h5>
                        <tal:block tal:condition="lead">
                            <p class="lead">${lead}</p>
                        </tal:block>
                    </div>
                </div>
            </tal:block>
        </div>
        <div class="panel" tal:condition="python: not image_src">
            <p i18n:translate="">Available options for the focus widget:</p>
            <code>&lt;focus<br>
                image-src="https://..."<br>
                focus-url="https://on-image-click.com"<br>
                title="..."<br>
                lead="..."<br>
                text-on-image="True"<br>
                &emsp;&lt;text&gt;...&lt;/text&gt;<br>
                &lt;/focus&gt;
            </code>
        </div>
</metal:focus>

<metal:chat define-macro="chat" i18n:domain="onegov.town6">
    <tal:b define="enable_chat layout.org.meta.get('enable_chat', 'disabled')">
        <div tal:condition="enable_chat == 'chatbot' or enable_chat == 'people_chat' and (layout.app.chat_open(request) or request.is_logged_in)" class="sticky floaty-chat" data-sticky  data-sticky-on="small" data-stick-to="bottom">
            <div class="grid-container">
                <a tal:condition="enable_chat == 'people_chat'" class="chat-button no-icon" href="${chat_link}">
                    <p><i class="fas fa-comments"></i> Chat</p>
                </a>
                <!-- Left Bottom -->
                <a tal:condition="enable_chat == 'chatbot'" class="chat-button no-icon"  type="button" data-toggle="example-dropdown-left-bottom"><p><i class="fas fa-comments"></i> Chat</p></a>
                <div class="dropdown-pane" data-position="top" data-alignment="right" id="example-dropdown-left-bottom" data-dropdown data-auto-focus="true">
                    <!-- Close-->
                    <button class="close-button" data-close aria-label="Close" type="button">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 i18n:translate="">Experimental AI Chatbot</h4>
                    <p i18n:translate="">This chatbot is experimental and may produce incorrect or misleading information. Please verify any information provided by the chatbot with official sources.</p>
                    <a href="${chat_link}" class="button" i18n:translate>Try it out</a>
                </div>
            </div>
        </div>
    </tal:b>
</metal:chat>

<metal:progress_indicator define-macro="progress_indicator">
<ol class="${'with-title ' if show_title else ''}progress-indicator" tal:define="show_number show_number|True; show_title show_title|True" tal:condition="steps|nothing">

    <tal:b tal:repeat="step steps">
        <li tal:define="complete step.position < layout.step_position; current step.position == layout.step_position"
                tal:attributes="data-step step.position if show_number else ''" class="${'is-current' if current else '' + 'is-complete' if complete else ''}">
            <span tal:condition="show_title">${request.translate(step.title)}</span>
        </li>
    </tal:b>
</ol>
</metal:progress_indicator>

<metal:modal define-macro="modal">
<div id="${modal_id}" class="reveal" data-reveal>
    <tal:block metal:define-slot="modal_content"></tal:block>
    <button class="close-button" data-close aria-label="Close" type="button">
        <span aria-hidden="true">&times;</span>
    </button>
</div>
</metal:modal>

<metal:pageref define-macro="pageref" i18n:domain="onegov.town6">
    <div
        class="pageref"
        title="Copy to clipboard"
        i18n:attributes="title"
        data-clipboard-action="copy"
        data-clipboard-text="${request.url + '#' + pageref_id}"
        tal:condition="not: layout.org.disable_page_refs"
    ></div>
</metal:pageref>


<metal:jobs define-macro="jobs-cards">
    <?python
            parsed_rss_feed = rss_widget_builder(rss_feed) if rss_widget_builder else None ?>
    <div class= "job-widget card aos-init aos-animate" tal:condition="parsed_rss_feed and jobs_card_title">
        <div id="pj-widget-container1" class="pj-widget-jobs-container" tal:define="channel parsed_rss_feed">

            <style>

                    .pj-widget-jobs-container * {
                        -webkit-box-sizing: border-box;
                        -moz-box-sizing: border-box;
                        box-sizing: border-box;
                    }

                    .pj-widget-jobs-container a {
                        color: #337ab7;
                        text-decoration: none;
                    }

                    ul.pj-widget-job-results .list-group-item:nth-child(2n-1) {
                        background-color: rgba(179, 179, 179, 0.8);
                    }

                    ul.pj-widget-job-results .list-group-item:nth-child(2n) {
                        background-color: rgba(114, 110, 110, 0.2);
                    }

                    .pj-widget-job-results .list-group-item:first-child {
                        border-top-left-radius: 4px;
                        border-top-right-radius: 4px;
                    }

                    .pj-widget-job-results .list-group-item:last-child {
                        border-bottom-left-radius: 4px;
                        border-bottom-right-radius: 4px;
                    }

                    .pj-widget-job-results .list-group-item {
                        position: relative;
                        display: block;
                        padding: 10px 15px;
                        margin-bottom: -1px;
                        background-color: #fff;
                        border: 1px solid #ddd;
                    }

                    ul.pj-widget-job-results a {
                        color: #333;
                    }

                    .job-companyLogo > img {
                        max-height: 50px;
                        max-width: 100%;
                        background-color: white;
                        display: block;
                        margin-right: auto;
                        margin-left: auto;
                    }

                    ul.pj-widget-job-results li.list-group-item span.pj-widget-arrow {
                        border-color: black;
                        right: 10px;
                        top: 40%;
                        transform: rotate(45deg);
                    }


                    .pj-widget-row {
                        margin-right: -15px;
                        margin-left: -15px;
                    }

                    .pj-widget-row::before, .pj-widget-row::after {
                        display: table;
                        content: " ";
                    }

                    .pj-widget-row::after {
                        clear: both;
                    }

                    .pj-widget-col-xs-12 {
                        width: 100%;
                    }

                    @media (min-width: 768px) {
                        .pj-widget-col-sm-3 {
                            width: 25%;
                        }

                        .pj-widget-col-sm-6 {
                            width: 50%;
                        }

                        .pj-widget-col-sm-6 > p {
                            margin-bottom: 0!important; // additional fix
                        }
                    }

                    .pj-widget-col-md-12, .pj-widget-col-sm-3, .pj-widget-col-sm-6, .pj-widget-col-sm-9, .pj-widget-col-md-4 {
                        float: left;
                        position: relative;
                        min-height: 1px;
                        padding-left: 15px;
                        padding-right: 15px;
                    }

                    .pj-widget-list-unstyled {
                        list-style: none;
                    }

                    .pj-widget-list-group {
                        padding-left: 0;
                        margin-bottom: 20px;
                    }

                    .pj-widget-arrow {
                        position: absolute;
                        border-top: 3px solid #337ab7;
                        border-right: 3px solid #337ab7;
                        width: 9px;
                        height: 9px;
                    }


                    .pj-widget-jobmail-container .pj-widget-input-group .pj-widget-form-control {
                        border-radius: 0;
                    }


                    .pj-widget-input-group .pj-widget-form-control:focus {
                        z-index: 3;
                    }

                    .pj-widget-input-group .pj-widget-form-control {
                        position: relative;
                        z-index: 2;
                        float: left;
                        width: 100%;
                        margin-bottom: 0;
                    }

                    .pj-widget-input-group .pj-widget-form-control:last-child {
                        border-top-left-radius: 0;
                        border-bottom-left-radius: 0;
                    }

                    .pj-widget-panel-default > .pj-widget-panel-heading {
                        color: #333;
                        background-color: #f5f5f5;
                        border-color: #ddd;
                    }


                    .pj-widget-panel > .table {
                        margin-bottom: 0;
                    }


                    .pj-widget-table > tbody > tr > td {
                        padding: 8px;
                        line-height: 1.42857143;
                        vertical-align: top;
                        border-top: 1px solid #ddd;
                    }

                    .pj-widget-panel > .pj-widget-table > tbody:first-child > tr:first-child td {
                        border-top: 0;
                    }

                    .pj-widget-panel > .pj-widget-table {
                        margin-bottom: 0;
                    }


                    ul.pj-widget-job-results > .list-group-item {
                        border-top-color: #009476 !important;
                        border-bottom-color: #009476 !important;
                        border-left: transparent !important;
                        border-right: transparent !important;
                        border-radius: 0px !important;
                        background-color: transparent !important;
                        padding-left: 5px !important
                    }

            </style>

        <div class="card-section">
            <h5>${jobs_card_title}</h5>

            <ul class="pj-widget-job-results pj-widget-list-unstyled pj-widget-list-group" tal:repeat="item channel.items">
                <li class="list-group-item">
                    <a target="_blank" href="${item.guid}" rel="nofollow">
                        <span class="pj-widget-arrow"></span>
                        <div class="pj-widget-row">
                            <div class="pj-widget-col-sm-6 pj-widget-col-xs-12">
                                <p class="homepage-text" style="font-size: 1.1em;">${item.title}</p>
                                <p class="homepage-text">${item.description}</p>
                            </div>
                            <div class="pj-widget-col-sm-3 pj-widget-col-xs-12">${layout.format_date(item.pubDate, 'date')}</div>
                        </div>
                    </a>
                </li>
            </ul>
        </div>
      </div>

        <div style="width:100%;display:block;font-size:12px;color:#999999;text-align:center;padding-top:5px;margin-bottom: 2rem;">
            Jobs bereitgestellt von <a href="https://www.publicjobs.ch/" target="_blank">publicjobs.ch</a></div>
    </div>

</metal:jobs>

<metal:display_results define-macro="display_results">
    <tal:b tal:condition="not submission_count" i18n:translate="">No submissions yet.</tal:b>
    <p tal:condition="submission_count"><b><tal:b i18n:translate="">Number of participants</tal:b>:</b><br/> ${submission_count}</p><br/>
    <div tal:repeat="field fields" tal:condition="submission_count" class="card">
        <div class="card-section">
            <a id="${field.id}" class="category-anchor"></a>
            <span class="result-field">${field.label.text}</span>
            <p tal:condition="field.type not in aggregated">
                <tal:b tal:condition="field.type == 'StringField'">
                    "${'", "'.join(results.get(field.id, []))}"
                </tal:b>
                <tal:b tal:condition="field.type == 'TextAreaField'">
                    <p tal:repeat="value results.get(field.id, [])">"${value}"</p>
                </tal:b>
            </p>
            <tal:b tal:condition="field.type in aggregated">
                <div class="chart-wrap" tal:condition="field.type == 'MultiCheckboxField'">
                    <div tal:define="maximum max(results[field.id].values())" class="grid horizontal">
                        <tal:b tal:repeat="choice field.choices">
                            <tal:b tal:define="val results[field.id][choice[0]]; max max(maximum, 1)">
                                <div class="bar" style="--bar-value:${val/max*100}%;" data-name="${choice[1]} (${val})" title="${choice[1]} (${val})"></div>
                            </tal:b>
                        </tal:b>
                    </div>
                </div>
                <div class="chart-wrap" tal:condition="field.type == 'RadioField'">
                    <div tal:define="sum sum(results[field.id].values())" class="grid horizontal">
                        <tal:b tal:repeat="choice field.choices" >
                            <tal:b tal:define="val results[field.id][choice[0]]">
                                <div class="bar" style="--bar-value:${val/sum*100}%;" data-name="${choice[1]} (${val}/${sum})" title="${choice[1]} (${val}/${sum})"></div>
                            </tal:b>
                        </tal:b>
                    </div>
                </div>
            </tal:b>
        </div>
    </div>
</metal:display_results>

<metal:b define-macro="render_inline_photo_album">
    <tal:b tal:condition="imageset and imageset.files">
        <!--! Inline imagesets are always rendered as grid -->
        <div class="page-text grid-imageset photoswipe">
            <div class="image-grid">
                <div tal:repeat="image imageset.ordered_files" class="image-container">
                    <tal:b define="width image.reference.thumbnail_small.size[0]|image.reference.size[0]; height image.reference.thumbnail_small.size[1]|image.reference.size[1]">
                        <!--! the first eight images are loaded conventionally, the rest are loaded lazily -->
                        <img src="${request.link(image, 'thumbnail')}" alt="${image.note}" width="${width}" height="${height}" tal:condition="repeat.image.number <= 8" data-full-width="${image.reference.size[0]}" data-full-height="${image.reference.size[1]}" />
                        <img src="${request.link(image, 'thumbnail')}" alt="${image.note}" width="${width}" height="${height}" class="lazyload" tal:condition="repeat.image.number > 8" data-full-width="${image.reference.size[0]}" data-full-height="${image.reference.size[1]}" />
                    </tal:b>
                </div>
            </div>
        </div>

    <tal:b metal:use-macro="layout.macros.photoswipe" />

    </tal:b>
</metal:b>

<metal:invoice_items define-macro="invoice_items" i18n:domain="onegov.town6">
    <table class="invoice-items" tal:define="total_amount total_amount|None; total_vat total_vat|None; total_paid total_paid|False; show_cost_object any(item.cost_object for items in invoice_items.values() for item in items); show_vat total_vat or any(item.vat for items in invoice_items.values() for item in items); show_quantity any(item.quantity != 1.0 for items in invoice_items.values() for item in items); item_actions item_actions|None; show_payment_state show_payment_state|False">
        <thead>
            <tr>
                <th i18n:translate>Booking Text</th>
                <th tal:condition="show_cost_object" i18n:translate>Cost center / cost unit</th>
                <th tal:condition="show_quantity" class="centered" i18n:translate>Unit</th>
                <th tal:condition="show_quantity" class="centered" i18n:translate>Quantity</th>
                <th tal:condition="show_vat" class="centered" i18n:translate>VAT Rate</th>
                <th tal:condition="show_vat" class="centered" i18n:translate>VAT</th>
                <th class="centered" i18n:translate>Amount</th>
                <th tal:condition="item_actions">
                    <span i18n:translate class="show-for-sr">Actions</span>
                </th>
            </tr>
        </thead>
        <tal:b tal:repeat="(group, items) invoice_items.items()">
            <thead>
                <tr class="group">
                    <th tal:switch="group" colspan="${2 + (1 if show_cost_object else 0) + (2 if show_quantity else 0) + (2 if show_vat else 0) + (1 if item_actions else 0)}">
                        <tal:b tal:case="'reservation'" i18n:translate>
                            Reservations
                        </tal:b>
                        <tal:b tal:case="'submission'" i18n:translate>
                            Submission
                        </tal:b>
                        <tal:b tal:case="'form'" i18n:translate>
                            Selected Options
                        </tal:b>
                        <tal:b tal:case="'manual'" i18n:translate>
                            Discounts / Surcharges
                        </tal:b>
                        <tal:b tal:case="'migration'" i18n:translate>
                            Lump sum
                        </tal:b>
                        <tal:b tal:case="default">
                            ${item.group}
                        </tal:b>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tal:b tal:repeat="item items">
                    <tr tal:define="groupid hash(str(item.group) + str(repeat.item.index)); paid total_paid or item.paid|False" tal:attributes="class ('paid' if paid else 'unpaid') if show_payment_state else None">
                        <td>${item.text}</td>
                        <td tal:condition="show_cost_object" class="cost-object">${item.cost_object}</td>
                        <td tal:condition="show_quantity" class="unit">${'{:.2f}'.format(item.unit)}</td>
                        <td tal:condition="show_quantity" class="quantity">${'{:.2f}'.format(item.quantity)}</td>
                        <td tal:condition="show_vat" class="vat-rate">${'{:.1f}%'.format(item.vat_rate or 0.0)}</td>
                        <td tal:condition="show_vat" class="vat">${'{:.2f}'.format(item.vat)}</td>
                        <td class="amount">
                            ${'{:.2f}'.format(item.amount)}
                            <tal:b tal:condition="show_payment_state and paid">
                                <i class="fa ${item.source in ('datatrans', 'stripe_connect', 'worldline_saferpay') and 'fa-credit-card' or 'fa-check-circle'}" aria-hidden="true" title="Paid" i18n:attributes="title"></i>
                                <span i18n:translate class="show-for-sr">Paid</span>
                            </tal:b>
                            <tal:b tal:condition="show_payment_state and not paid">
                                <i class="fa fa-exclamation-triangle" aria-hidden="true" title="Unpaid" i18n:attributes="title"></i>
                                <span i18n:translate class="show-for-sr">Unpaid</span>
                            </tal:b>
                        </td>
                        <td class="actions" tal:condition="item_actions">
                            <tal:b tal:repeat="action actions" tal:define="actions item_actions(item)">
                                ${action(layout)}
                            </tal:b>
                        </td>
                    </tr>
                </tal:b>
            </tbody>
        </tal:b>
        <tfoot tal:condition="total_amount is not None">
            <tr class="total${(' paid' if total_paid else ' unpaid') if show_payment_state else ''}">
                <td i18n:translate>Total</td>
                <td tal:condition="show_cost_object"></td>
                <td tal:condition="show_quantity" class="unit"></td>
                <td tal:condition="show_quantity" class="quantity"></td>
                <td tal:condition="show_vat" class="vat-rate"></td>
                <td tal:condition="show_vat" class="vat">
                    ${'{:.2f}'.format(total_vat)}
                </td>
                <td class="amount">
                    ${'{:.2f}'.format(total_amount)}
                    <tal:b tal:condition="show_payment_state and total_paid">
                        <i class="fa fa-check-circle" aria-hidden="true" title="Paid" i18n:attributes="title"></i>
                        <span i18n:translate class="show-for-sr">Paid</span>
                    </tal:b>
                    <tal:b tal:condition="show_payment_state and not total_paid">
                        <i class="fa fa-exclamation-triangle" aria-hidden="true" title="Unpaid" i18n:attributes="title"></i>
                        <span i18n:translate class="show-for-sr">Unpaid</span>
                    </tal:b>
                </td>
                <td tal:condition="item_actions"></td>
            </tr>
        </tfoot>
    </table>
</metal:invoice_items>
