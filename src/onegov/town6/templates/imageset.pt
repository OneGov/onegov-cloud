<div metal:use-macro="layout.base" i18n:domain="onegov.town6">
    <tal:b metal:fill-slot="title">
        ${title}
    </tal:b>
    <tal:b metal:fill-slot="content">
        <tal:b metal:use-macro="layout.macros.page_content"
             tal:define="lead layout.linkify(imageset.meta.get('lead')); text None; people None; contact None; coordinates None;" />

        <p tal:condition="not:imageset.files" i18n:translate>
            This album does not contain any images yet.
        </p>

        <div tal:repeat="image imageset.ordered_files" tal:condition="imageset.view == 'full'" class="page-text full-imageset photoswipe">
            <!--! the first three images are loaded conventionally, the rest are loaded lazily -->
            <tal:b tal:define="size getattr(image.reference, 'size', None)">
                <p class="has-img" tal:condition="repeat.image.number <= 3">
                    <img src="${request.link(image)}" alt="${image.note}"
                         tal:attributes="width size and size[0] or None;
                                         height size and size[1] or None" />
                </p>
                <p class="has-img" tal:condition="repeat.image.number > 3">
                    <img data-src="${request.link(image)}" class="lazyload" alt="${image.note}"
                         tal:attributes="width size and size[0] or None;
                                         height size and size[1] or None" />
                </p>
            </tal:b>
        </div>

        <div tal:condition="imageset.view == 'grid'" class="page-text grid-imageset photoswipe">
            <div class="image-grid">
                <div tal:repeat="image imageset.ordered_files" class="image-container">
                    <tal:b tal:define="size getattr(image.reference, 'size', None);
                                       thumb_size getattr(image.reference, 'thumbnail_small', None) and getattr(getattr(image.reference, 'thumbnail_small', None), 'size', None) or size;
                                       width thumb_size and thumb_size[0] or None;
                                       height thumb_size and thumb_size[1] or None;
                                       full_width size and size[0] or None;
                                       full_height size and size[1] or None">
                        <!--! the first eight images are loaded conventionally, the rest are loaded lazily -->
                        <img src="${request.link(image, 'thumbnail')}" alt="${image.note}" tal:condition="repeat.image.number <= 8"
                             tal:attributes="width width; height height; data-full-width full_width; data-full-height full_height" />
                        <img src="${request.link(image, 'thumbnail')}" alt="${image.note}" class="lazyload" tal:condition="repeat.image.number > 8"
                             tal:attributes="width width; height height; data-full-width full_width; data-full-height full_height" />
                    </tal:b>
                </div>
            </div>
        </div>

        <tal:b metal:use-macro="layout.macros.photoswipe" />
    </tal:b>
</div>