<div metal:use-macro="layout.base" i18n:domain="onegov.town6">
    <tal:b metal:fill-slot="title">
        ${title}
    </tal:b>
    <tal:b metal:fill-slot="content">
        <tal:b metal:use-macro="layout.macros.page_content"
             tal:define="lead layout.linkify(imageset.meta.get('lead')); text None; people None; contact None; coordinates None;" />

        <p tal:condition="not:imageset.files" i18n:translate>
            This album does not contain any images yet.
        </p>

        <div tal:repeat="image imageset.ordered_files" tal:condition="imageset.view == 'full'" class="page-text full-imageset photoswipe">
            <!--! the first three images are loaded conventionally, the rest are loaded lazily -->
            <tal:b tal:define="size getattr(image.reference, 'size', None)">
                <span tal:condition="not size">
                    <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                    <span i18n:translate="">Cannot display</span> ${image.name}
                </span>
                <p class="has-img" tal:condition="size and repeat.image.number <= 3">
                    <img src="${request.link(image)}" alt="${image.note}"
                         tal:attributes="width size and size[0];
                                         height size and size[1]" />
                </p>
                <p class="has-img" tal:condition="size and repeat.image.number > 3">
                    <img data-src="${request.link(image)}" class="lazyload" alt="${image.note}"
                         tal:attributes="width size and size[0];
                                         height size and size[1]" />
                </p>
            </tal:b>
        </div>

        <div tal:condition="imageset.view == 'grid'" class="page-text grid-imageset photoswipe">
            <div class="image-grid">
                <div tal:repeat="image imageset.ordered_files" class="image-container">
                    <tal:b tal:define="size getattr(image.reference, 'size', None);
                            thumb_size getattr(image.reference, 'thumbnail_small') and getattr(getattr(image.reference, 'thumbnail_small'), 'size') or size;">
                        <span tal:condition="not size">
                            <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                            <span i18n:translate="">Cannot display</span> ${image.name}
                        </span>
                        <tal:b tal:condition="size" tal:define="size getattr(image.reference, 'size', None);
                                thumb_size getattr(image.reference, 'thumbnail_small') and getattr(getattr(image.reference, 'thumbnail_small'), 'size') or size;
                                width thumb_size and thumb_size[0];
                                height thumb_size and thumb_size[1];
                                full_width size and size[0];
                                full_height size and size[1]">
                            <!--! the first eight images are loaded conventionally, the rest are loaded lazily -->
                            <img src="${request.link(image, 'thumbnail')}" alt="${image.note}" width="${width}" height="${height}" tal:condition="repeat.image.number <= 8" data-full-width="${image.reference.size[0]}" data-full-height="${image.reference.size[1]}" />
                            <img src="${request.link(image, 'thumbnail')}" alt="${image.note}" width="${width}" height="${height}" class="lazyload" tal:condition="repeat.image.number > 8" data-full-width="${image.reference.size[0]}" data-full-height="${image.reference.size[1]}" />
                        </tal:b>
                    </tal:b>
                </div>
            </div>
        </div>

        <tal:b metal:use-macro="layout.macros.photoswipe" />
    </tal:b>
</div>
