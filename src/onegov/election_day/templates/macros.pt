<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal">
<body>

<metal:gender-singular define-macro="gender-singular" i18n:domain="onegov.election_day">
    <tal:b switch="gender">
        <tal:b case="'female'" i18n:translate>female</tal:b>
        <tal:b case="'male'" i18n:translate>male</tal:b>
        <tal:b case="'undetermined'" i18n:translate>undetermined</tal:b>
    </tal:b>
</metal:gender-singular>

<metal:notification-type-translation define-macro="notification-type-translation" i18n:domain="onegov.election_day">
    <tal:block tal:switch="notification_type">
        <tal:block tal:case="'email'" i18n:translate="">email</tal:block>
        <tal:block tal:case="'sms'" i18n:translate="">SMS</tal:block>
        <tal:block tal:case="default">${notification_type}</tal:block>
    </tal:block>
</metal:notification-type-translation>

<metal:title-translation define-macro="title-translation" i18n:domain="onegov.election_day">
    <tal:b switch="item.title == item.title_translations.get(request.locale)|True">
        <tal:b case="True">${item.title}</tal:b>
        <tal:b case="False"><span lang="${request.default_locale.replace('_', '-')}">${item.title}</span></tal:b>
    </tal:b>
</metal:title-translation>

<metal:short-title-translation define-macro="short-title-translation" i18n:domain="onegov.election_day">
    <tal:block tal:condition="item.short_title">
        <tal:b switch="item.short_title == item.short_title_translations.get(request.locale)|True">
            <tal:b case="True">${item.short_title}</tal:b>
            <tal:b case="False"><span lang="${request.default_locale.replace('_', '-')}">${item.short_title}</span></tal:b>
        </tal:b>
    </tal:block>
    <tal:block tal:condition="not item.short_title" metal:use-macro="layout.macros['title-translation']" />
</metal:short-title-translation>

<metal:redirect-filters define-macro="redirect-filters" i18n:domain="onegov.election_day">
    <tal:block tal:repeat="(name, options) redirect_filters.items()">
        <div metal:use-macro="layout.macros['redirect-dropdown']"/>
    </tal:block>
</metal:redirect-filters>


<metal:redirect-dropdown define-macro="redirect-dropdown" i18n:domain="onegov.election_day">
    <div class="row">
        <div class="small-12 columns">
            <form tal:define="id name.lower()">
                <label for="filter-${id}">${name}</label>
                <select id="filter-${id}" name="filter-${id}" class="redirect-dropdown">
                    <tal:block tal:repeat="(name, active, link) options">
                        <option tal:condition="active" selected>${name}</option>
                        <option tal:condition="not active" data-redirect="${link}">${name}</option>
                    </tal:block>
                </select>
            </form>
        </div>
    </div>
</metal:redirect-dropdown>

<metal:election-actions define-macro="election-actions" i18n:domain="onegov.election_day">
    <div tal:condition="request.is_logged_in" class="clearfix">
        <div class="pull-right">
            <ul class="actions" data-title="Actions" i18n:attributes="data-title">
                <li>
                    <a i18n:translate="" class="action-view" href="${request.link(election)}">View</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-edit" href="${request.link(election, 'edit')}">Edit</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-upload" href="${request.link(election, 'upload')}">Upload results</a>
                </li>
                <li tal:condition="election.type == 'proporz' and election.has_results">
                    <a i18n:translate="" class="action-upload" href="${request.link(election, 'upload-party-results')}">Upload party results</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-clear" href="${request.link(election, 'clear')}">Clear results</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-clear" href="${request.link(election, 'clear-media')}">Clear media</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-trigger" href="${request.link(election, 'trigger')}">Trigger notifications</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-delete" href="${request.link(election, 'delete')}">Delete</a>
                </li>
            </ul>
        </div>
    </div>
</metal:election-actions>

<metal:election-compound-actions define-macro="election-compound-actions" i18n:domain="onegov.election_day">
    <div tal:condition="request.is_logged_in" class="clearfix" tal:define="compound compound|election_compound">
        <div class="pull-right">
            <ul class="actions" data-title="Actions" i18n:attributes="data-title">
                <li>
                    <a i18n:translate="" class="action-view" href="${request.link(compound)}">View</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-edit" href="${request.link(compound, 'edit')}">Edit</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-upload" href="${request.link(compound, 'upload')}">Upload results</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-upload" href="${request.link(compound, 'upload-party-results')}">Upload party results</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-clear" href="${request.link(compound, 'clear')}">Clear results</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-clear" href="${request.link(compound, 'clear-media')}">Clear media</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-trigger" href="${request.link(compound, 'trigger')}">Trigger notifications</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-delete" href="${request.link(compound, 'delete')}">Delete</a>
                </li>
            </ul>
        </div>
    </div>
</metal:election-compound-actions>

<metal:vote-actions define-macro="vote-actions" i18n:domain="onegov.election_day">
    <div tal:condition="request.is_logged_in" class="clearfix">
        <div class="pull-right">
            <ul class="actions" data-title="Actions" i18n:attributes="data-title">
                <li>
                    <a i18n:translate="" class="action-view" href="${request.link(vote)}">View</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-edit" href="${request.link(vote, 'edit')}">Edit</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-upload" href="${request.link(vote, 'upload')}">Upload results</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-clear" href="${request.link(vote, 'clear')}">Clear results</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-clear" href="${request.link(vote, 'clear-media')}">Clear media</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-trigger" href="${request.link(vote, 'trigger')}">Trigger notifications</a>
                </li>
                <li>
                    <a i18n:translate="" class="action-delete" href="${request.link(vote, 'delete')}">Delete</a>
                </li>
            </ul>
        </div>
    </div>
</metal:vote-actions>

<metal:intermediate-results-popup define-macro="intermediate-results-popup" i18n:domain="onegov.election_day">
    <tal:b tal:condition="skip_rendering|nothing">
        <div class="panel">
            <h5>${help_text}</h5>
        </div>
    </tal:b>
</metal:intermediate-results-popup>

<metal:ballot-entities-table define-macro="ballot-entities-table" i18n:domain="onegov.election_day">
    <table
        class="ballot-entities-table results tablesaw sortable"
        data-tablesaw-mode="columntoggle"
        data-tablesaw-mode-switch="" data-tablesaw-mode-exclude="swipe"
        data-tablesaw-minimap="">
        <thead>
            <tr>
                <th data-tablesaw-priority="persist" i18n:translate="" class="column-entity left-aligned">${layout.principal.label('entity')}</th>
                <th data-tablesaw-priority="3" i18n:translate="" class="column-district left-aligned" tal:condition="layout.has_districts">${layout.principal.label('district')}</th>
                <th data-tablesaw-priority="1" i18n:translate="" class="column-result left-aligned">Result</th>
                <th data-tablesaw-priority="5" i18n:translate="" class="column-yeas right-aligned">${layout.label('Yeas')}</th>
                <th data-tablesaw-priority="5" i18n:translate="" class="column-nays right-aligned">${layout.label('Nays')}</th>
                <th data-tablesaw-priority="2" i18n:translate="" class="column-yeas-percentage right-aligned">${layout.label('Yes %')}</th>
                <th data-tablesaw-priority="2" i18n:translate="" class="column-nays-percentage right-aligned">${layout.label('No %')}</th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="result results|ballot.results" tal:attributes="class python: 'counted' if result.counted else 'not-counted'">
                <tal:b condition="not: result.counted">
                    <th class="column-entity">${layout.format_name(result)}</th>
                    <td class="column-district" tal:condition="layout.has_districts">${result.district}</td>
                    <td class="column-result answer" colspan="5" i18n:translate="">Not yet counted</td>
                </tal:b>
                <tal:b condition="result.counted">
                    <th class="column-entity">${layout.format_name(result)}</th>
                    <td class="column-district" tal:condition="layout.has_districts">${result.district}</td>
                    <td tal:condition="result.accepted" class="column-result answer accepted" i18n:translate="">${layout.label('Accepted')}</td>
                    <td tal:condition="not result.accepted" class="column-result answer rejected" i18n:translate="">${layout.label('Rejected')}</td>
                    <td class="column-yeas right-aligned" data-text="${result.yeas}">${layout.format_number(result.yeas)}</td>
                    <td class="column-nays right-aligned" data-text="${result.nays}">${layout.format_number(result.nays)}</td>
                    <td class="column-yeas-percentage right-aligned">${layout.format_number(result.yeas_percentage)}</td>
                    <td class="column-nays-percentage right-aligned">${layout.format_number(result.nays_percentage)}</td>
                </tal:b>
            </tr>
        </tbody>
        <tfoot tal:condition="len(ballot.results) != 1">
            <tr class="total">
                <td class="column-entity" i18n:translate="">Total</td>
                <td class="column-district" tal:condition="layout.has_districts"></td>
                <td tal:condition="not ballot.vote.completed" class="column-result answer" i18n:translate="">Not yet counted</td>
                <td tal:condition="ballot.vote.completed and ballot.accepted" class="column-result answer accepted" i18n:translate="">${layout.label('Accepted')}</td>
                <td tal:condition="ballot.vote.completed and not ballot.accepted" class="column-result answer rejected" i18n:translate="">${layout.label('Rejected')}</td>
                <td class="column-yeas right-aligned">${layout.format_number(ballot.yeas)}</td>
                <td class="column-nays right-aligned">${layout.format_number(ballot.nays)}</td>
                <td class="column-yeas-percentage right-aligned">${layout.format_number(ballot.yeas_percentage)}</td>
                <td class="column-nays-percentage right-aligned">${layout.format_number(ballot.nays_percentage)}</td>
            </tr>
        </tfoot>
    </table>
</metal:ballot-entities-table>

<metal:ballot-districts-table define-macro="ballot-districts-table" i18n:domain="onegov.election_day">
    <table
        class="results tablesaw sortable"
        data-tablesaw-mode="columntoggle"
        data-tablesaw-mode-switch="" data-tablesaw-mode-exclude="swipe"
        data-tablesaw-minimap="">
        <thead>
            <tr>
                <th data-tablesaw-priority="persist" i18n:translate="" class="left-aligned">${layout.principal.label('district')}</th>
                <th data-tablesaw-priority="1" i18n:translate="" class="left-aligned">Result</th>
                <th data-tablesaw-priority="5" i18n:translate="" class="column-yeas right-aligned">${layout.label('Yeas')}</th>
                <th data-tablesaw-priority="5" i18n:translate="" class="column-nays right-aligned">${layout.label('Nays')}</th>
                <th data-tablesaw-priority="2" i18n:translate="" class="column-yeas-percentage right-aligned">${layout.label('Yes %')}</th>
                <th data-tablesaw-priority="2" i18n:translate="" class="column-nays-percentage right-aligned">${layout.label('No %')}</th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="result ballot.results_by_district" tal:attributes="class python: 'counted' if result.counted else 'not-counted'">
                <tal:b condition="not: result.counted">
                    <td>${layout.format_name(result)}</td>
                    <td class="answer" colspan="7" i18n:translate="">Not yet counted</td>
                </tal:b>
                <tal:b condition="result.counted">
                    <th>${layout.format_name(result)}</th>
                    <td tal:condition="result.accepted" class="answer accepted" i18n:translate="">${layout.label('Accepted')}</td>
                    <td tal:condition="not result.accepted" class="answer rejected" i18n:translate="">${layout.label('Rejected')}</td>
                    <td class="right-aligned">${layout.format_number(result.yeas)}</td>
                    <td class="right-aligned">${layout.format_number(result.nays)}</td>
                    <td class="right-aligned">${layout.format_number(result.yeas_percentage)} %</td>
                    <td class="right-aligned">${layout.format_number(result.nays_percentage)} %</td>
                </tal:b>
            </tr>
        </tbody>
        <tfoot tal:condition="len(ballot.results) != 1">
            <tr class="total">
                <td i18n:translate="">Total</td>
                <td tal:condition="not ballot.vote.completed" class="answer" i18n:translate="">Not yet counted</td>
                <td tal:condition="ballot.vote.completed and ballot.accepted" class="answer accepted" i18n:translate="">${layout.label('Accepted')}</td>
                <td tal:condition="ballot.vote.completed and not ballot.accepted" class="answer rejected" i18n:translate="">${layout.label('Rejected')}</td>
                <td class="right-aligned">${layout.format_number(ballot.yeas)}</td>
                <td class="right-aligned">${layout.format_number(ballot.nays)}</td>
                <td class="right-aligned">${layout.format_number(ballot.yeas_percentage)} %</td>
                <td class="right-aligned">${layout.format_number(ballot.nays_percentage)} %</td>
            </tr>
        </tfoot>
    </table>
</metal:ballot-districts-table>

<metal:ballot-statistics-table define-macro="ballot-statistics-table" i18n:domain="onegov.election_day">
    <table
        class="ballot-statistics-table results tablesaw sortable"
        data-tablesaw-mode="columntoggle"
        data-tablesaw-mode-switch="" data-tablesaw-mode-exclude="swipe"
        data-tablesaw-minimap=""
        tal:define="expats ballot.expats">
        <thead>
            <tr>
                <th data-tablesaw-priority="persist" i18n:translate="" class="column-entity left-aligned">${layout.principal.label('entity')}</th>
                <th data-tablesaw-priority="0" i18n:translate="" class="column-district left-aligned" tal:condition="layout.has_districts">${layout.principal.label('district')}</th>
                <th data-tablesaw-priority="2" i18n:translate="" class="column-empty right-aligned">eligible_voters_vote</th>
                <th data-tablesaw-priority="5" i18n:translate="" class="column-empty right-aligned" tal:condition="expats">Expats</th>
                <th data-tablesaw-priority="4" i18n:translate="" class="column-empty right-aligned">Cast Ballots</th>
                <th data-tablesaw-priority="5" i18n:translate="" class="column-empty right-aligned">Empty votes</th>
                <th data-tablesaw-priority="5" i18n:translate="" class="column-invalid right-aligned">Invalid votes</th>
                <th data-tablesaw-priority="1" i18n:translate="turnout_vote" class="column-turnout right-aligned" tal:condition="layout.completed">Turnout</th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="result ballot.results" tal:attributes="class python: 'counted' if result.counted else 'not-counted'">
                <tal:b condition="not: result.counted">
                    <th class="column-entity">${layout.format_name(result)}</th>
                    <td class="column-district" tal:condition="layout.has_districts">${result.district}</td>
                    <td class="answer" colspan="5" i18n:translate="">Not yet counted</td>
                </tal:b>
                <tal:b condition="result.counted">
                    <th class="column-entity">${layout.format_name(result)}</th>
                    <td class="column-district" tal:condition="layout.has_districts">${result.district}</td>
                    <td class="column-empty right-aligned" data-text="${result.eligible_voters}">${layout.format_number(result.eligible_voters)}</td>
                    <td class="column-empty right-aligned" data-text="${result.expats}" tal:condition="expats">${layout.format_number(result.expats or 0)}</td>
                    <td class="column-empty right-aligned" data-text="${result.cast_ballots}">${layout.format_number(result.cast_ballots)}</td>
                    <td class="column-empty right-aligned" data-text="${result.empty}">${layout.format_number(result.empty)}</td>
                    <td class="column-invalid right-aligned" data-text="${result.invalid}">${layout.format_number(result.invalid)}</td>
                    <td class="column-turnout right-aligned" tal:condition="layout.completed">${'{0:.2f} %'.format(result.turnout)}</td>
                </tal:b>
            </tr>
        </tbody>
        <tfoot tal:condition="len(ballot.results) != 1">
            <tr class="total">
                <td class="column-entity" i18n:translate="">Total</td>
                <td class="column-district" tal:condition="layout.has_districts"></td>
                <td class="column-empty right-aligned">${layout.format_number(ballot.eligible_voters)}</td>
                <td class="column-empty right-aligned" tal:condition="expats">${layout.format_number(expats)}</td>
                <td class="column-empty right-aligned">${layout.format_number(ballot.cast_ballots)}</td>
                <td class="column-empty right-aligned">${layout.format_number(ballot.empty)}</td>
                <td class="column-invalid right-aligned">${layout.format_number(ballot.invalid)}</td>
                <td class="column-turnout right-aligned" tal:condition="layout.completed">${'{0:.2f} %'.format(ballot.turnout)}</td>
            </tr>
        </tfoot>
    </table>
</metal:ballot-statistics-table>

<metal:ballot-entities-map define-macro="ballot-entities-map" i18n:domain="onegov.election_day">
    <tal:block tal:condition="embed">
        <div class="entities-map"
            data-canton="${layout.principal.id}"
            data-mapurl="${layout.get_topojson_link(layout.principal.id, ballot.vote.date.year)}"
            data-dataurl="${request.link(ballot, name='by-entity')}"
            data-embed-link="Embed map"
            data-embed-source="${layout.map_link}"
            data-thumbs="true"
            data-color-scale="rb"
            data-label-left-hand="${layout.label('Nay')}"
            data-label-right-hand="${layout.label('Yay')}"
            data-label-expats="Expats"
            i18n:attributes="data-embed-link; data-label-expats"
            >
        </div>
    </tal:block>
    <tal:block tal:condition="not: embed">
        <div class="entities-map"
            data-canton="${layout.principal.id}"
            data-mapurl="${layout.get_topojson_link(layout.principal.id, ballot.vote.date.year)}"
            data-dataurl="${request.link(ballot, name='by-entity')}"
            data-thumbs="true"
            data-color-scale="rb"
            data-label-left-hand="${layout.label('Nay')}"
            data-label-right-hand="${layout.label('Yay')}"
            data-label-expats="Expats"
            i18n:attributes="data-label-expats"
            >
        </div>
    </tal:block>
</metal:ballot-entities-map>

<metal:ballot-districts-map define-macro="ballot-districts-map" i18n:domain="onegov.election_day">
    <tal:block tal:condition="embed">
        <div class="districts-map"
            data-canton="${layout.app.principal.id}"
            data-mapurl="${layout.get_topojson_link(layout.app.principal.id, ballot.vote.date.year)}"
            data-dataurl="${request.link(ballot, name='by-district')}"
            data-embed-link="Embed map"
            data-embed-source="${layout.map_link}"
            data-thumbs="true"
            data-color-scale="rb"
            data-label-left-hand="${layout.label('Nay')}"
            data-label-right-hand="${layout.label('Yay')}"
            data-label-expats="Expats"
            i18n:attributes="data-embed-link; data-label-expats"
            >
        </div>
    </tal:block>
    <tal:block tal:condition="not: embed">
        <div class="districts-map"
            data-canton="${layout.app.principal.id}"
            data-mapurl="${layout.get_topojson_link(layout.app.principal.id, ballot.vote.date.year)}"
            data-dataurl="${request.link(ballot, name='by-district')}"
            data-thumbs="true"
            data-color-scale="rb"
            data-label-left-hand="${layout.label('Nay')}"
            data-label-right-hand="${layout.label('Yay')}"
            data-label-expats="Expats"
            i18n:attributes="data-label-expats"
            >
        </div>
    </tal:block>
</metal:ballot-districts-map>


<metal:election-connections-table define-macro="election-connections-table" i18n:domain="onegov.election_day">
    <div class="embedded-widget">

    </div>
    <tal:block tal:repeat="(name,conn) connections.items()">
        <table class="results">
            <thead>
                <tr>
                    <th><span i18n:translate="">List connection</span> ${name}</th>
                    <th i18n:translate="single_votes" class="right-aligned">Votes</th>
                </tr>
            </thead>
            <tbody>
                <tr tal:repeat="(name, votes) conn.get('lists', {}).items()">
                    <td>${name}</td>
                    <td class="right-aligned">${layout.format_number(votes)}</td>
                </tr>
                <tal:block tal:repeat="(name, subconn) conn.get('subconns', {}).items()">
                    <tr>
                        <td><span i18n:translate="">Sublist connection</span> ${name}</td>
                        <td></td>
                    </tr>
                    <tr tal:repeat="(name, votes) subconn.get('lists', {}).items()">
                        <td>${name}</td>
                        <td class="right-aligned">${layout.format_number(votes)}</td>
                    </tr>
                    <tr class="subtotal">
                        <td i18n:translate="">Subtotal</td>
                        <td class="right-aligned">${layout.format_number(subconn['total_votes'])}</td>
                    </tr>
                </tal:block>
            </tbody>
            <tfoot>
                <tr class="total">
                    <td i18n:translate="">Total</td>
                    <td class="right-aligned">${layout.format_number(conn['total_votes'])}</td>
                </tr>
            </tfoot>
        </table>
        </tal:block>
</metal:election-connections-table>

<metal:election-compound-seat-allocation-table define-macro="election-compound-seat-allocation-table" i18n:domain="onegov.election_day">
    <table
        class="results tablesaw sortable"
        data-tablesaw-mode="columntoggle"
        data-tablesaw-mode-switch="" data-tablesaw-mode-exclude="swipe"
        data-tablesaw-minimap=""
        tal:condition="party_years"
        >
        <thead>
            <tr>
                <th data-tablesaw-priority="persist" i18n:translate="">Party</th>
                <th tal:repeat="year party_years" data-tablesaw-priority="1" class="right-aligned">${year}</th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="line seat_allocations">
                <tal:block tal:repeat="cell line">
                    <td tal:condition="repeat.cell.start">${cell}</td>
                    <td tal:condition="not: repeat.cell.start" class="right-aligned">${cell}</td>
                </tal:block>
            </tr>
        </tbody>
    </table>
</metal:election-compound-seat-allocation-table>


<metal:election-compound-districts-table define-macro="election-compound-districts-table" i18n:domain="onegov.election_day">
    <table
        class="election-compound-districts-table results tablesaw sortable"
        data-tablesaw-mode="columntoggle"
        data-tablesaw-mode-switch="" data-tablesaw-mode-exclude="swipe"
        data-tablesaw-minimap=""
        >
        <thead>
            <tr>
                <th data-tablesaw-priority="persist" i18n:translate="" class="column-district left-aligned">${layout.label('district')}</th>
                <th data-tablesaw-priority="4" i18n:translate="" class="column-superregion left-aligned" tal:condition="layout.has_superregions" data-sorter="false">${layout.label('superregion')}</th>
                <th data-tablesaw-priority="3" i18n:translate="" class="column-mandates right-aligned" tal:condition="layout.proporz" data-sorter="false">${layout.label('mandates')}</th>
                <th data-tablesaw-priority="3" i18n:translate="" class="column-mandates right-aligned" tal:condition="layout.majorz" data-sorter="false">Seats</th>
                <th data-tablesaw-priority="2" i18n:translate="" class="column-counted right-aligned" data-sorter="false">Counted</th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="election election_compound.elections">
                <th class="column-district left-aligned"><a href="${request.link(election)}">${election.domain_segment}</a></th>
                <td class="column-superregion left-aligned" tal:condition="layout.has_superregions">${election.domain_supersegment}</td>
                <td class="column-mandates right-aligned"><tal:block metal:use-macro="layout.macros['progress']" tal:define="progress (election.allocated_mandates, election.number_of_mandates)" /></td>
                <td class="column-counted right-aligned"><tal:block metal:use-macro="layout.macros['progress']" tal:define="progress election.progress" /></td>
            </tr>
        </tbody>
    </table>
</metal:election-compound-districts-table>


<metal:election-compound-districts-map define-macro="election-compound-districts-map" i18n:domain="onegov.election_day">
    <tal:block tal:define="map_type 'entities' if election_compound.domain_elections == 'municipality' else 'districts'">
        <tal:block tal:condition="embed">
            <div class="${map_type}-map"
                data-canton="${layout.principal.id}"
                data-mapurl="${layout.get_topojson_link(layout.principal.id, election_compound.date.year)}"
                data-dataurl="${request.link(election_compound, name='by-district')}"
                data-embed-link="Embed map"
                data-embed-source="${request.link(election_compound, name='districts-map', query_params={'locale': request.locale})}"
                data-thumbs="false"
                data-color-scale="b"
                data-label-left-hand=""
                data-label-right-hand=""
                data-label-expats="Expats"
                data-hide-percentages="true"
                data-hide-legend="true"
                i18n:attributes="data-embed-link; data-label-expats"
                >
            </div>
        </tal:block>
        <tal:block tal:condition="not: embed">
            <div class="${map_type}-map"
                data-canton="${layout.principal.id}"
                data-mapurl="${layout.get_topojson_link(layout.principal.id, election_compound.date.year)}"
                data-dataurl="${request.link(election_compound, name='by-district')}"
                data-thumbs="false"
                data-color-scale="b"
                data-label-left-hand=""
                data-label-right-hand=""
                data-label-expats="Expats"
                data-hide-percentages="true"
                data-hide-legend="true"
                i18n:attributes="data-label-expats"
                >
            </div>
        </tal:block>
    </tal:block>
</metal:election-compound-districts-map>


<metal:election-compound-superregions-table define-macro="election-compound-superregions-table" i18n:domain="onegov.election_day">
    <table
        class="election-compound-superregions-table results tablesaw sortable"
        data-tablesaw-mode="columntoggle"
        data-tablesaw-mode-switch="" data-tablesaw-mode-exclude="swipe"
        data-tablesaw-minimap=""
        >
        <thead>
            <tr>
                <th data-tablesaw-priority="4" i18n:translate="" class="column-superregion left-aligned" data-sorter="false">${layout.label('superregion')}</th>
                <th data-tablesaw-priority="3" i18n:translate="" class="column-mandates right-aligned" data-sorter="false">${layout.label('mandates')}</th>
                <th data-tablesaw-priority="2" i18n:translate="" class="column-counted right-aligned" data-sorter="false">Counted</th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="superregion superregions">
                <th class="column-superregion left-aligned" tal:condition="layout.has_superregions"><a href="${request.link(superregions[superregion]['superregion'])}">${superregion}</a></th>
                <td class="column-mandates right-aligned"><tal:block metal:use-macro="layout.macros['progress']" tal:define="progress (superregions[superregion]['mandates']['allocated'], superregions[superregion]['mandates']['total'])" /></td>
                <td class="column-counted right-aligned"><tal:block metal:use-macro="layout.macros['progress']" tal:define="progress (superregions[superregion]['progress']['counted'], superregions[superregion]['progress']['total'])" /></td>
            </tr>
        </tbody>
    </table>
</metal:election-compound-superregions-table>


<metal:election-compound-superregions-map define-macro="election-compound-superregions-map" i18n:domain="onegov.election_day">
    <tal:block tal:condition="embed">
        <div class="districts-map"
            data-canton="${layout.principal.id}"
            data-mapurl="${layout.get_topojson_link(layout.principal.id, election_compound.date.year)}"
            data-dataurl="${request.link(election_compound, name='by-superregion')}"
            data-embed-link="Embed map"
            data-embed-source="${request.link(election_compound, name='superregions-map', query_params={'locale': request.locale})}"
            data-thumbs="false"
            data-color-scale="b"
            data-label-left-hand=""
            data-label-right-hand=""
            data-label-expats="Expats"
            data-hide-percentages="true"
            data-hide-legend="true"
            i18n:attributes="data-embed-link; data-label-expats"
            >
        </div>
    </tal:block>
    <tal:block tal:condition="not: embed">
        <div class="districts-map"
            data-canton="${layout.principal.id}"
            data-mapurl="${layout.get_topojson_link(layout.principal.id, election_compound.date.year)}"
            data-dataurl="${request.link(election_compound, name='by-superregion')}"
            data-thumbs="false"
            data-color-scale="b"
            data-label-left-hand=""
            data-label-right-hand=""
            data-label-expats="Expats"
            data-hide-percentages="true"
            data-hide-legend="true"
            i18n:attributes="data-label-expats"
            >
        </div>
    </tal:block>
</metal:election-compound-superregions-map>


<metal:election-statistics-table define-macro="election-statistics-table" i18n:domain="onegov.election_day">
    <table
    class="results tablesaw sortable"
    data-tablesaw-mode="columntoggle"
    data-tablesaw-mode-switch="" data-tablesaw-mode-exclude="swipe"
    data-tablesaw-minimap=""
    tal:define="expats election.expats"
    >
        <thead>
            <tr>
                <th data-tablesaw-priority="persist" i18n:translate="" class="left-aligned">${layout.principal.label('entity')}</th>
                <th data-tablesaw-priority="0" i18n:translate="" class="left-aligned" tal:condition="layout.has_districts">${layout.label('district')}</th>
                <th data-tablesaw-priority="0" i18n:translate="" class="left-aligned" tal:condition="layout.has_superregions">${layout.label('superregion')}</th>
                <th data-tablesaw-priority="2" i18n:translate="" class="right-aligned">eligible Voters</th>
                <th data-tablesaw-priority="5" i18n:translate="" class="right-aligned" tal:condition="expats">Expats</th>
                <th data-tablesaw-priority="4" i18n:translate="" class="right-aligned">Received Ballots</th>
                <th data-tablesaw-priority="5" i18n:translate="" class="right-aligned">Accounted Ballots</th>
                <th data-tablesaw-priority="5" i18n:translate="" class="right-aligned">Blank Ballots</th>
                <th data-tablesaw-priority="5" i18n:translate="" class="right-aligned">Invalid Ballots</th>
                <th data-tablesaw-priority="4" i18n:translate="" class="right-aligned">Accounted Votes</th>
                <th data-tablesaw-priority="1" i18n:translate="" class="right-aligned" tal:condition="layout.completed">Turnout</th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="result layout.results" tal:attributes="class python: 'counted' if result.counted else 'not-counted'">
                <tal:block condition="not: result.counted">
                    <th>${layout.format_name(result)}</th>
                    <td tal:condition="layout.has_districts">${result.district}</td>
                    <td class="answer" colspan="7" i18n:translate="">Not yet counted</td>
                </tal:block>
                <tal:block condition="result.counted">
                    <th>${layout.format_name(result)}</th>
                    <td tal:condition="layout.has_districts">${result.district}</td>
                    <td tal:condition="layout.has_superregions">${result.superregion}</td>
                    <td class="right-aligned" data-text="${result.eligible_voters}">${layout.format_number(result.eligible_voters)}</td>
                    <td class="right-aligned" data-text="${result.eligible_voters}" tal:condition="expats">${layout.format_number(result.expats)}</td>
                    <td class="right-aligned" data-text="${result.received_ballots}">${layout.format_number(result.received_ballots)}</td>
                    <td class="right-aligned" data-text="${result.accounted_ballots}">${layout.format_number(result.accounted_ballots)}</td>
                    <td class="right-aligned" data-text="${result.blank_ballots}">${layout.format_number(result.blank_ballots)}</td>
                    <td class="right-aligned" data-text="${result.invalid_ballots}">${layout.format_number(result.invalid_ballots)}</td>
                    <td class="right-aligned" data-text="${result.accounted_votes}">${layout.format_number(result.accounted_votes)}</td>
                    <td class="right-aligned" tal:condition="layout.completed">${'{0:.2f}'.format(result.turnout)} %</td>
                </tal:block>
            </tr>
        </tbody>
        <tfoot tal:condition="layout.summarize">
            <tr class="total">
                <td i18n:translate="">Total</td>
                <td tal:condition="layout.has_districts"></td>
                <td class="right-aligned">${layout.format_number(election.eligible_voters)}</td>
                <td class="right-aligned" tal:condition="expats">${layout.format_number(election.expats)}</td>
                <td class="right-aligned">${layout.format_number(election.received_ballots)}</td>
                <td class="right-aligned">${layout.format_number(election.accounted_ballots)}</td>
                <td class="right-aligned">${layout.format_number(election.blank_ballots)}</td>
                <td class="right-aligned">${layout.format_number(election.invalid_ballots)}</td>
                <td class="right-aligned">${layout.format_number(election.accounted_votes)}</td>
                <td class="right-aligned" tal:condition="layout.completed">${'{0:.2f}'.format(election.turnout)} %</td>
            </tr>
        </tfoot>
    </table>
</metal:election-statistics-table>

<metal:election-compound-statistics-table define-macro="election-compound-statistics-table" i18n:domain="onegov.election_day">
    <table
    class="results tablesaw sortable"
    data-tablesaw-mode="columntoggle"
    data-tablesaw-mode-switch="" data-tablesaw-mode-exclude="swipe"
    data-tablesaw-minimap=""
    tal:define="expats sum([r.expats for r in layout.results])"
    >
        <thead>
            <tr>
                <th data-tablesaw-priority="persist" i18n:translate="" class="column-district left-aligned">${layout.label('district')}</th>
                <th data-tablesaw-priority="0" i18n:translate="" class="column-superregion left-aligned" tal:condition="layout.has_superregions" data-sorter="false">${layout.label('superregion')}</th>
                <th data-tablesaw-priority="2" i18n:translate="" class="right-aligned">eligible Voters</th>
                <th data-tablesaw-priority="2" i18n:translate="" class="right-aligned" tal:condition="expats">Expats</th>
                <th data-tablesaw-priority="4" i18n:translate="" class="right-aligned">Received Ballots</th>
                <th data-tablesaw-priority="5" i18n:translate="" class="right-aligned">Accounted Ballots</th>
                <th data-tablesaw-priority="5" i18n:translate="" class="right-aligned">Blank Ballots</th>
                <th data-tablesaw-priority="5" i18n:translate="" class="right-aligned">Invalid Ballots</th>
                <th data-tablesaw-priority="4" i18n:translate="" class="right-aligned">Accounted Votes</th>
                <th data-tablesaw-priority="1" i18n:translate="" class="right-aligned" tal:condition="layout.completed">Turnout</th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="result layout.results" tal:attributes="class python: 'counted' if result.counted else 'not-counted'">
                <tal:block condition="not: result.counted">
                    <th class="column-district left-aligned">${result.domain_segment}</th>
                    <td class="column-superregion left-aligned" tal:condition="layout.has_superregions">${result.domain_supersegment}</td>
                    <td class="answer" colspan="7" i18n:translate="">Not yet counted</td>
                </tal:block>
                <tal:block condition="result.counted">
                    <th class="column-district left-aligned">${result.domain_segment}</th>
                    <td class="column-superregion left-aligned" tal:condition="layout.has_superregions">${result.domain_supersegment}</td>
                    <td class="right-aligned" data-text="${result.eligible_voters}">${layout.format_number(result.eligible_voters)}</td>
                    <td class="right-aligned" data-text="${result.expats}" tal:condition="expats">${layout.format_number(result.expats)}</td>
                    <td class="right-aligned" data-text="${result.received_ballots}">${layout.format_number(result.received_ballots)}</td>
                    <td class="right-aligned" data-text="${result.accounted_ballots}">${layout.format_number(result.accounted_ballots)}</td>
                    <td class="right-aligned" data-text="${result.blank_ballots}">${layout.format_number(result.blank_ballots)}</td>
                    <td class="right-aligned" data-text="${result.invalid_ballots}">${layout.format_number(result.invalid_ballots)}</td>
                    <td class="right-aligned" data-text="${result.accounted_votes}">${layout.format_number(result.accounted_votes)}</td>
                    <td class="right-aligned" tal:condition="layout.completed">${'{0:.2f}'.format(result.turnout)} %</td>
                </tal:block>
            </tr>
        </tbody>
        <tfoot>
            <tr class="total">
                <td i18n:translate="">Total</td>
                <td class="column-superregion left-aligned" tal:condition="layout.has_superregions"></td>
                <td class="right-aligned" data-text="${layout.totals.eligible_voters}">${layout.format_number(layout.totals.eligible_voters)}</td>
                <td class="right-aligned" data-text="${layout.totals.expats}" tal:condition="expats">${layout.format_number(layout.totals.expats)}</td>
                <td class="right-aligned" data-text="${layout.totals.received_ballots}">${layout.format_number(layout.totals.received_ballots)}</td>
                <td class="right-aligned" data-text="${layout.totals.accounted_ballots}">${layout.format_number(layout.totals.accounted_ballots)}</td>
                <td class="right-aligned" data-text="${layout.totals.blank_ballots}">${layout.format_number(layout.totals.blank_ballots)}</td>
                <td class="right-aligned" data-text="${layout.totals.invalid_ballots}">${layout.format_number(layout.totals.invalid_ballots)}</td>
                <td class="right-aligned" data-text="${layout.totals.accounted_votes}">${layout.format_number(layout.totals.accounted_votes)}</td>
                <td class="right-aligned" tal:condition="layout.completed">${'{0:.2f}'.format(layout.totals.turnout)} %</td>
            </tr>
        </tfoot>
    </table>
</metal:election-compound-statistics-table>

<metal:election-compound-candidates-table define-macro="election-compound-candidates-table" i18n:domain="onegov.election_day">
    <table
        class="election-compound-candidates-table results tablesaw sortable"
        data-tablesaw-mode="columntoggle"
        data-tablesaw-mode-switch="" data-tablesaw-mode-exclude="swipe"
        data-tablesaw-minimap=""
        >
        <thead>
            <tr>
                <th data-tablesaw-priority="persist" i18n:translate="" class="column-candidate">Candidate</th>
                <th data-tablesaw-priority="1" i18n:translate="" class="column-party right-aligned" tal:condition="layout.majorz">Party</th>
                <th data-tablesaw-priority="1" i18n:translate="" class="column-list right-aligned" tal:condition="layout.proporz">List</th>
                <th data-tablesaw-priority="3" i18n:translate="" class="column-superregion right-aligned" tal:condition="layout.has_superregions">${layout.label('superregion')}</th>
                <th data-tablesaw-priority="2" i18n:translate="" class="column-district right-aligned">${layout.label('district')}</th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="candidate elected_candidates">
                <tal:block tal:define="district districts.get(candidate.election_id, None)">
                    <th class="column-candidate">${candidate.family_name} ${candidate.first_name}</th>
                    <td class="column-party right-aligned" tal:condition="layout.majorz">${candidate.party}</td>
                    <td class="column-list right-aligned" tal:condition="layout.proporz">${candidate.list}</td>
                    <td class="column-list right-aligned" tal:condition="layout.has_superregions">
                        <tal:block tal:condition="district">${district[2]}</tal:block>
                    </td>
                    <td class="column-district right-aligned">
                        <a tal:condition="district" tal:attributes="href district[1]">${district[0]}</a>
                    </td>
                </tal:block>
            </tr>
        </tbody>
    </table>
</metal:election-compound-candidates-table>

<metal:election-candidates-table define-macro="election-candidates-table" i18n:domain="onegov.election_day">
    <table
        tal:condition="layout.has_candidates"
        class="election-candidates-table results tablesaw collapsible collapsed sortable"
        data-tablesaw-mode="columntoggle"
        data-tablesaw-mode-switch="" data-tablesaw-mode-exclude="swipe"
        data-tablesaw-minimap=""
        tal:define="lists [n.strip() for n in lists.split(',') if n.strip()]|[]; show_percentage show_percentage|False"
        >
        <thead>
            <tr>
                <th data-tablesaw-priority="persist" i18n:translate="" class="column-candidate">Candidate</th>
                <th data-tablesaw-priority="2" tal:condition="not:layout.tacit" i18n:translate="single_votes" class="column-votes right-aligned">Votes</th>
                <th data-tablesaw-priority="3" tal:condition="layout.majorz" i18n:translate="" class="column-party right-aligned">Party</th>
                <th data-tablesaw-priority="3" tal:condition="layout.proporz" i18n:translate="" class="column-list right-aligned">List</th>
                <th data-tablesaw-priority="3" tal:condition="layout.majorz and show_percentage" i18n:translate="single_votes" class="column-votes-percentage right-aligned">Votes</th>
                <th data-tablesaw-priority="1" i18n:translate="" class="column-elected right-aligned">Elected</th>
            </tr>
        </thead>
        <tbody>
            <tal:block tal:repeat="candidate candidates">
                <tr tal:condition="not lists or candidate.party in lists or candidate.list_name in lists" tal:attributes="class 'sticky-row' if not layout.completed or candidate.elected > 0 else ''">
                    <th class="column-candidate">${candidate.family_name} ${candidate.first_name}</th>
                    <td tal:condition="not:layout.tacit" class="column-votes right-aligned" data-text="${candidate.votes}">${layout.format_number(candidate.votes)}</td>
                    <td tal:condition="layout.majorz" class="column-party right-aligned">${candidate.party}</td>
                    <td tal:condition="layout.proporz" class="column-list right-aligned">${candidate.list_name}</td>
                    <td tal:condition="layout.majorz and show_percentage" class="column-votes-percentage right-aligned">${layout.format_number(candidate.percentage, 1)}%</td>
                    <td class="column-elected answer accepted right-aligned" tal:condition="election.completed and candidate.elected is True" i18n:translate="">Yes</td>
                    <td class="column-elected answer rejected right-aligned" tal:condition="election.completed and candidate.elected is False" i18n:translate="">No</td>
                    <td class="column-elected answer right-aligned" tal:condition="not election.completed" i18n:translate="">Pending</td>
                    <td class="column-elected answer right-aligned" tal:condition="candidate.elected is None" i18n:translate=""></td>
                </tr>
            </tal:block>
        </tbody>
        <tfoot>
            <tr class="more" tal:condition="not: election.tacit">
                <td colspan="4" i18n:translate="">All candidates</td>
            </tr>
            <tr class="less" tal:condition="not: election.tacit">
                <td colspan="4" i18n:translate="">Elected candidates only</td>
            </tr>
        </tfoot>
    </table>
</metal:election-candidates-table>

<metal:election-candidates-by-entity-table define-macro="election-candidates-by-entity-table" i18n:domain="onegov.election_day">
    <table
        tal:condition="layout.has_candidates"
        class="election-candidates-by-entity-table results tablesaw sortable"
        data-tablesaw-mode="columntoggle"
        data-tablesaw-mode-switch="" data-tablesaw-mode-exclude="swipe"
        data-tablesaw-minimap=""
        tal:define="candidates candidates_by_entites[0]; results candidates_by_entites[1]"
        >
        <thead>
            <tr>
                <th data-tablesaw-priority="persist" class="column-entity" i18n:translate="">${layout.principal.label('entity')}</th>
                <th data-tablesaw-priority="1" class="column-candidate right-aligned" tal:repeat="candidate candidates">${candidate.family_name} ${candidate.first_name}</th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="result results">
                <th class="column-entity" i18n:translate="">${result[0]}</th>
                <td class="column-candidate right-aligned" tal:repeat="candidate result[1]">${layout.format_number(candidate.votes)}</td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <td class="column-entity" i18n:translate="">${layout.principal.label('entity')}</td>
                <td class="column-candidate right-aligned" tal:repeat="candidate candidates">${candidate.family_name} ${candidate.first_name}</td>
            </tr>
            <tr>
                <td class="column-entity" i18n:translate="">Total</td>
                <td class="column-candidate right-aligned" tal:repeat="candidate candidates">${layout.format_number(candidate.votes)}</td>
            </tr>
        </tfoot>
    </table>
</metal:election-candidates-by-entity-table>


<metal:election-lists-table define-macro="election-lists-table" i18n:domain="onegov.election_day">
    <table
        class="election-lists-table results tablesaw sortable"
        data-tablesaw-mode="columntoggle"
        data-tablesaw-mode-switch="" data-tablesaw-mode-exclude="swipe"
        data-tablesaw-minimap=""
        tal:define="names [n.strip() for n in names.split(',') if n.strip()]|[]"
        >
        <thead>
            <tr>
                <th data-tablesaw-priority="persist" i18n:translate="" class="column-list">List</th>
                <th data-tablesaw-priority="1" i18n:translate="single_votes" class="column-votes right-aligned">Votes</th>
                <th data-tablesaw-priority="1" i18n:translate="" class="column-mandates right-aligned">${layout.label('mandates')}</th>
            </tr>
        </thead>
        <tbody>
            <tal:block tal:repeat="list lists">
                <tr tal:condition="not names or list.name in names">
                    <th class="column-list">${list.name}</th>
                    <td class="right-aligned column-votes" data-text="${list.votes or 0}">${layout.format_number(list.votes or 0)}</td>
                    <td class="column-mandates right-aligned">${list.number_of_mandates}</td>
                </tr>
            </tal:block>
        </tbody>
    </table>
</metal:election-lists-table>

<metal:election-compound-list-groups-table define-macro="election-compound-list-groups-table" i18n:domain="onegov.election_day">
    <table
        class="election-compound-list-groups-table results tablesaw sortable"
        data-tablesaw-mode="columntoggle"
        data-tablesaw-mode-switch="" data-tablesaw-mode-exclude="swipe"
        data-tablesaw-minimap=""
        >
        <thead>
            <tr>
                <th data-tablesaw-priority="persist" i18n:translate="" class="column-list-group">List group</th>
                <th data-tablesaw-priority="1" i18n:translate="" class="column-voters-count right-aligned">Voters count</th>
                <th data-tablesaw-priority="1"  i18n:translate="" class="column-mandates right-aligned">${layout.label('mandates')}</th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="group groups">
                <th class="column-list-group">${group.name}</th>
                <td class="column-voters-count right-aligned" data-text="${group.voters_count or 0}">${layout.format_number(group.voters_count or 0)}</td>
                <td class="column-mandates right-aligned">${group.number_of_mandates}</td>
            </tr>
        </tbody>
    </table>
</metal:election-compound-list-groups-table>

<metal:ballot-result-bar define-macro="ballot-result-bar">
    <div class="ballot-result-bar" tal:condition="layout.has_results and ballot">
        <ul class="percentages flex-container justify-between align-center">
            <li>
                <span i18n:translate="">${layout.label('Yeas')}</span><br/>
                <span class="accepted" >${'{0:.2f}'.format(ballot.yeas_percentage)}%</span>
            </li>
            <li>
                <span i18n:translate="">${layout.label('Nays')}</span><br/>
                <span class="rejected" >${'{0:.2f}'.format(ballot.nays_percentage)}%</span>
            </li>
        </ul>
        <div class="percentage">
            <div class="yeas"></div>
            <div class="nays right" style="width:${'{0:.2f}'.format(ballot.nays_percentage)}%"></div>
        </div>
    </div>
</metal:ballot-result-bar>

<metal:candidates-chart define-macro="candidates-chart" i18n:domain="onegov.election_day">
    <tal:block tal:define="limit limit|''; lists lists|''; elected elected|''; sort_by_lists sort_by_lists|''; entity entity|''">
        <tal:block tal:condition="embed">
            <div class="bar-chart"
                i18n:attributes="data-embed-link"
                data-dataurl="${request.link(model, name='candidates-data', query_params={'limit': limit, 'lists': lists, 'elected': elected, 'sort_by_lists': sort_by_lists, 'entity': entity})}"
                data-embed-link="Embed diagram"
                data-embed-source="${request.link(model, name='candidates-chart', query_params={'entity': entity, 'locale': request.locale})}">
            </div>
        </tal:block>
        <tal:block tal:condition="not: embed">
            <div class="bar-chart"
                data-dataurl="${request.link(model, name='candidates-data', query_params={'limit': limit, 'lists': lists, 'elected': elected, 'sort_by_lists': sort_by_lists, 'entity': entity})}">
            </div>
        </tal:block>
    </tal:block>
</metal:candidates-chart i18n:domain="onegov.election_day">

<metal:lists-chart define-macro="lists-chart" i18n:domain="onegov.election_day">
    <tal:block tal:define="limit limit|''; names names|''; sort_by_names sort_by_names|''; entity entity|''">
        <tal:block tal:condition="embed">
            <div class="bar-chart"
                i18n:attributes="data-embed-link"
                data-dataurl="${request.link(model, name='lists-data', query_params={'limit': limit, 'names': names, 'sort_by_names': sort_by_names, 'entity': entity})}"
                data-embed-link="Embed diagram"
                data-embed-source="${request.link(model, name='lists-chart', query_params={'entity': entity, 'locale': request.locale})}">
            </div>
        </tal:block>
        <tal:block tal:condition="not: embed">
            <div class="bar-chart"
                data-dataurl="${request.link(model, name='lists-data', query_params={'limit': limit, 'names': names, 'sort_by_names': sort_by_names, 'entity': entity})}">
            </div>
        </tal:block>
    </tal:block>
</metal:lists-chart i18n:domain="onegov.election_day">

<metal:list-groups-chart define-macro="list-groups-chart" i18n:domain="onegov.election_day">
    <tal:block tal:condition="embed">
        <div class="bar-chart"
            i18n:attributes="data-embed-link"
            data-dataurl="${request.link(model, name='list-groups-data')}"
            data-embed-link="Embed diagram"
            data-embed-source="${request.link(model, name='list-groups-chart', query_params={'locale': request.locale})}">
        </div>
    </tal:block>
    <tal:block tal:condition="not: embed">
        <div class="bar-chart"
            data-dataurl="${request.link(model, name='list-groups-data')}">
        </div>
    </tal:block>
</metal:list-groups-chart i18n:domain="onegov.election_day">

<metal:seat-allocation-chart define-macro="seat-allocation-chart" i18n:domain="onegov.election_day">
    <tal:block tal:condition="embed">
        <div class="grouped-bar-chart"
            i18n:attributes="data-embed-link"
            data-dataurl="${request.link(model, name='seat-allocation-data')}"
            data-show-back="false"
            data-embed-link="Embed diagram"
            data-embed-source="${request.link(model, name='seat-allocation-chart', query_params={'locale': request.locale})}">
        </div>
    </tal:block>
    <tal:block tal:condition="not: embed">
        <div class="grouped-bar-chart"
            data-dataurl="${request.link(model, name='seat-allocation-data')}"
            data-show-back="false">
        </div>
    </tal:block>
</metal:seat-allocation-chart i18n:domain="onegov.election_day">

<metal:party-strengths-chart define-macro="party-strengths-chart" i18n:domain="onegov.election_day">
    <tal:block tal:condition="not horizontal">
        <tal:block tal:condition="embed">
            <div class="grouped-bar-chart"
                i18n:attributes="data-embed-link"
                data-dataurl="${request.link(model, name='party-strengths-data', query_params={'horizontal': horizontal})}"
                data-show-back="true"
                data-embed-link="Embed diagram"
                data-embed-source="${request.link(model, name='party-strengths-chart', query_params={'locale': request.locale})}">
            </div>
        </tal:block>
        <tal:block tal:condition="not: embed">
            <div class="grouped-bar-chart"
                data-dataurl="${request.link(model, name='party-strengths-data', query_params={'horizontal': horizontal})}"
                data-show-back="true">
            </div>
        </tal:block>
    </tal:block>
    <tal:block tal:condition="horizontal">
        <tal:block tal:condition="embed">
            <div class="bar-chart"
                i18n:attributes="data-embed-link"
                data-dataurl="${request.link(model, name='party-strengths-data', query_params={'horizontal': horizontal})}"
                data-embed-link="Embed diagram"
                data-embed-source="${request.link(model, name='party-strengths-chart', query_params={'locale': request.locale})}">
            </div>
        </tal:block>
        <tal:block tal:condition="not: embed">
            <div class="bar-chart"
                data-dataurl="${request.link(model, name='party-strengths-data', query_params={'horizontal': horizontal})}">
            </div>
        </tal:block>
    </tal:block>
</metal:party-strengths-chart i18n:domain="onegov.election_day">

<metal:connections-chart define-macro="connections-chart" i18n:domain="onegov.election_day">
    <tal:block tal:condition="embed">
        <div class="sankey-chart"
            i18n:attributes="data-embed-link"
            data-dataurl="${request.link(model, name='connections-data')}"
            data-inverse="true"
            data-embed-link="Embed diagram"
            data-embed-source="${request.link(model, name='connections-chart', query_params={'locale': request.locale})}">
        </div>
    </tal:block>
    <tal:block tal:condition="not: embed">
        <div class="sankey-chart"
            data-dataurl="${request.link(model, name='connections-data')}"
            data-inverse="true">
        </div>
    </tal:block>
</metal:connections-chart i18n:domain="onegov.election_day">


<metal:lists-panachage-chart define-macro="lists-panachage-chart" i18n:domain="onegov.election_day">
    <tal:block tal:condition="embed">
        <div class="sankey-chart"
            i18n:attributes="data-embed-link"
            data-dataurl="${request.link(model, name='lists-panachage-data')}"
            data-inverse="false"
            data-embed-link="Embed diagram"
            data-embed-source="${request.link(model, name='lists-panachage-chart', query_params={'locale': request.locale})}">
        </div>
    </tal:block>
    <tal:block tal:condition="not: embed">
        <div class="sankey-chart"
            data-dataurl="${request.link(model, name='lists-panachage-data')}"
            data-inverse="false">
        </div>
    </tal:block>
</metal:lists-panachage-chart i18n:domain="onegov.election_day">

<metal:parties-panachage-chart define-macro="parties-panachage-chart" i18n:domain="onegov.election_day">
    <tal:block tal:condition="embed">
        <div class="sankey-chart"
            i18n:attributes="data-embed-link"
            data-dataurl="${request.link(model, name='parties-panachage-data')}"
            data-inverse="false"
            data-embed-link="Embed diagram"
            data-embed-source="${request.link(model, name='parties-panachage-chart', query_params={'locale': request.locale})}">
        </div>
    </tal:block>
    <tal:block tal:condition="not: embed">
        <div class="sankey-chart"
            data-dataurl="${request.link(model, name='parties-panachage-data')}"
            data-inverse="false">
        </div>
    </tal:block>
</metal:parties-panachage-chart i18n:domain="onegov.election_day">

<metal:embedded_widget define-macro="embedded_widget" i18n:domain="onegov.election_day">
    <div tal:condition="embed_link" class="embedded-widget"
        data-embed-link="Embed table"
        data-embed-source="${embed_link}"
        i18n:attributes="data-embed-link"
        >
    </div>
</metal:embedded_widget>

<metal:answer define-macro="answer" i18n:domain="onegov.election_day">
    <span tal:condition="answer == 'accepted'" class="answer accepted" i18n:translate="">
        Accepted
    </span>
    <span tal:condition="answer == 'rejected'" class="answer rejected" i18n:translate="">
        Rejected
    </span>
    <span tal:condition="answer == 'proposal'" class="answer accepted" i18n:translate="">
        Proposal
    </span>
    <tal:block tal:condition="answer == 'counter-proposal'">
        <span tal:condition="direct" class="answer rejected" i18n:translate="">
            Direct Counter Proposal
        </span>
        <span tal:condition="not direct" class="answer rejected" i18n:translate="">
            Indirect Counter Proposal
        </span>
    </tal:block>
</metal:answer>

<metal:progress define-macro="progress" i18n:domain="onegov.election_day">
    <tal:b condition="progress[1]" i18n:translate="">
        <span tal:replace="progress[0]" i18n:name='counted' />
        of
        <span tal:replace="progress[1]" i18n:name='total' />
    </tal:b>
</metal:progress>

<metal:search define-macro="form" i18n:domain="onegov.election_day">
    <form tal:attributes="action form.action; method form_method|'POST'" enctype="multipart/form-data">
        <tal:b repeat="fieldset form.fieldsets">
            <fieldset tal:condition="fieldset.is_visible" id="fieldset-${fieldset.label.lower()}">
                <legend>${fieldset.label}</legend>
                <div class="formfields">
                    <metal:fields use-macro="layout.macros['fields']" tal:define="fields fieldset.fields.values()" />
                    <div class="clearfix"></div>
                </div>
            </fieldset>
            <tal:b condition="not:fieldset.is_visible">
                <div class="formfields">
                    <metal:fields use-macro="layout.macros['fields']" tal:define="fields fieldset.fields.values()" />
                    <div class="clearfix"></div>
                </div>
            </tal:b>
        </tal:b>
        <tal:b condition="cancel|nothing">
            <a class="button secondary cancel-button" href="${cancel}" i18n:translate="">Cancel</a>
        </tal:b>
        <tal:b condition="not: button_text|nothing">
            <input type="submit" value="Submit" class="button ${button_class|nothing}" i18n:attributes="value">
        </tal:b>
        <tal:b condition="button_text|nothing">
            <input type="submit" value="${button_text}" class="button ${button_class|nothing}">
        </tal:b>
    </form>
</metal:search>

<metal:fields define-macro="fields" i18n:domain="onegov.election_day">
  <div class="row">
      <tal:block repeat="field fields">
            <div class="small-12 columns medium-${field.render_kw['size']|12} field-type-${field.type.lower()}" tal:condition="not field.render_kw.get('hidden', False)|True">
                <tal:block define="input_type field.widget.input_type|None">
                    <tal:block condition="input_type == 'hidden'">
                        ${field()}
                        <p><small class="error" tal:repeat="error field.errors">${error}</small></p>
                    </tal:block>

                    <tal:block condition="input_type != 'hidden'" define="radio_field field.type == 'RadioField'; checkbox_fields (field.type == 'MultiCheckboxField' or field.type == 'OrderedMultiCheckboxField')">
                        <p class="visually-hidden" tal:condition="field.type == 'LazyWolvesField'" i18n:translate>The next field is a spam protection, please do not fill it out.</p>
                        <label tal:attributes="class field.errors and 'error' or None" tal:condition="not checkbox_fields and not radio_field">
                            <metal:b use-macro="layout.macros['field']" />
                        </label>

                        <div tal:attributes="class field.errors and 'error group-label' or 'group-label'" tal:condition="checkbox_fields or radio_field">
                            <metal:b use-macro="layout.macros['field']" />
                        </div>

                        <p tal:condition="field.errors"><small id="${field.name}-error" class="error" tal:repeat="error field.errors">${error}</small></p>
                    </tal:block>
               </tal:block>
            </div>
            <div class="clearfix" tal:condition="field.render_kw['clear']|True"></div>
        </tal:block>
  </div>
</metal:fields>

<metal:field define-macro="field" i18n:domain="onegov.election_day">
    <tal:block condition="field.type == 'BooleanField'">
        ${field(placeholder=request.translate(field.description))}
        <span class="label-text">${field.label.text}</span>
        <span tal:condition="field.description|nothing" data-tooltip aria-haspopup="true" class="has-tip" title="${field.description}">?</span>
        <span class="label-required" tal:condition="field.flags.required|nothing">*</span>
    </tal:block>
    <tal:block condition="field.type != 'BooleanField'">

        <!--!
            Note how the field is rendered *first* in the 'define' step,
            before the label is accessed. This is due to the field call
            setting up translatable labels as a side-effect.

            See onegov.core.i18n.get_translation_bound_meta.render_field
        -->
        <tal:b define="(description, is_md) form.as_maybe_markdown(form.request.translate(field.description or '')); long_description form.additional_field_help(field); content field(placeholder=description if not long_description else '')">
            <span class="label-text" tal:condition="(not field.hide_label)|(not field.render_kw['hide_label'])|True">${field.label.text}</span>
            <tal:b tal:condition="long_description">
                <span data-tooltip aria-haspopup="true" class="has-tip" title="${long_description}">?</span>
            </tal:b>
            <span class="label-required" tal:condition="field.flags.required|nothing">*</span>

            <!--! The field is placed here -->
            <tal:b replace="content" />
        </tal:b>

    </tal:block>
</metal:field>

<metal:related_link define-macro="related_link" i18n:domain="onegov.election_day">
    <tal:block tal:define="explanations_pdf layout.explanations_pdf;
                           upper_apportionment_pdf getattr(layout.model, 'upper_apportionment_pdf', None);
                           lower_apportionment_pdf getattr(layout.model, 'lower_apportionment_pdf', None)">
        <div class="row related" tal:condition="layout.related_link or explanations_pdf or upper_apportionment_pdf or lower_apportionment_pdf">
            <div class="columns small-12">
                <h2 i18n:translate="">Related link</h2>
                <p>
                    <a tal:condition="layout.explanations_pdf" href="${request.link(layout.explanations_pdf)}" class="related-link" i18n:translate="">Explanations (PDF)</a>
                    <a tal:condition="upper_apportionment_pdf" href="${request.link(upper_apportionment_pdf)}" class="related-link" i18n:translate="">Upper apportionment (PDF)</a>
                    <a tal:condition="lower_apportionment_pdf" href="${request.link(lower_apportionment_pdf)}" class="related-link" i18n:translate="">Lower apportionment (PDF)</a>
                    <a tal:condition="layout.related_link and layout.related_link_label" href="${layout.related_link}" class="related-link">${layout.related_link_label}</a>
                    <a tal:condition="layout.related_link and not layout.related_link_label" href="${layout.related_link}" class="related-link">${layout.related_link}</a>
                </p>
            </div>
        </div>
    </tal:block>
</metal:related_link>

<metal:related_elections define-macro="related_elections" i18n:domain="onegov.election_day">
    <div class="row related" tal:define="related_elections layout.related_elections|layout.related_compounds|None" tal:condition="related_elections">
        <div class="columns small-12">
            <h2 i18n:translate="">Related elections</h2>
            <p tal:repeat="(title, link) related_elections">
                <a href="${link}" class="related-link">${title}</a>
            </p>
        </div>
    </div>
</metal:related_elections>

<metal:pagination define-macro="pagination" i18n:domain="onegov.election_day">
    <h3 class="visually-hidden">Pagination</h3>
    <ul class="pagination" role="menubar" aria-label="Pagination">
        <tal:block repeat="page collection.pages">
            <tal:block define="
                previous current_page.previous;
                next current_page.next;
                is_current current_page == page;
                is_visible (abs(current_page.page-page.page) < 4) or repeat.page.start or repeat.page.end;
            ">
                <tal:block condition="repeat.page.start and previous">
                    <li role="none" class="arrow">
                        <a role="menuitem" href="${request.link(previous)}" aria-label="Previous Page" i18n:attributes="aria-label"><i class="fa fa-chevron-left"></i></a>
                    </li>
                </tal:block>

                <li tal:condition="is_visible" role="none" class="${'current' if is_current else ''} ${repeat.page.start and 'first' or ''} ${repeat.page.end and 'last' or ''}">
                    <a role="menuitem" href="${request.link(page)}">${page.page + 1}<span tal:condition="is_current" i18n:translate="" class="visually-hidden"> (active)</span></a>
                </li>

                <tal:block condition="repeat.page.end and next">
                    <li role="none" class="arrow">
                        <a role="menuitem" href="${request.link(next)}" aria-label="Next Page" i18n:attributes="aria-label"><i class="fa fa-chevron-right"></i></a>
                    </li>
                </tal:block>
            </tal:block>
        </tal:block>
    </ul>
</metal:pagination>

<metal:breadcrumbs define-macro="breadcrumbs" i18n:domain="onegov.election_day">
    <nav role="navigation" aria-label="You are here" i18n:attributes="aria-label">
        <ul class="breadcrumbs" tal:condition="layout.breadcrumbs">
            <tal:block repeat="breadcrumb layout.breadcrumbs">
                <li class="${breadcrumb[2]}"><a href="${breadcrumb[1]}">${breadcrumb[0]}</a></li>
            </tal:block>
        </ul>
    </nav>
</metal:breadcrumbs>

<metal:tab_menu define-macro="tab_menu" i18n:domain="onegov.election_day">
    <div class="tab-navigation clearfix" tal:condition="layout.menu">
        <nav class="top-bar clearfix" data-topbar="" data-options="back_text: &lt;; is_hover: false; mobile_show_parent_link: false" role="navigation">
            <ul class="title-area">
                <li class="name menu-icon"><span>${layout.title()}</span></li>
                <li class="toggle-topbar menu-icon"><a href="#"><span></span></a></li>
            </ul>
            <div class="top-bar-section">
                <ul class="left">
                    <tal:block repeat="(title, link, active, submenu) layout.menu">
                        <li tal:condition="not submenu" tal:attributes="class 'active' if active else '';aria-current 'true' if active else 'false'">
                            <a href="${link}">${title}</a>
                        </li>
                        <li tal:condition="submenu" tal:attributes="class 'has-dropdown active' if active else 'has-dropdown';aria-current 'true' if active else 'false'">
                            <a href="#">${title}</a>
                            <ul class="dropdown">
                                <tal:block repeat="(title, link, active, submenu) submenu">
                                    <li tal:attributes="class 'active' if active else '';aria-current 'true' if active else 'false'">
                                        <a href="${link}">${title}</a>
                                    </li>
                                </tal:block>
                            </ul>
                        </li>
                    </tal:block>
                </ul>
            </div>
        </nav>
    </div>
</metal:tab_menu>

<metal:status_callout define-macro="status_callout" i18n:domain="onegov.election_day">
    <div class="panel" tal:condition="not:layout.completed">
         <h5 i18n:translate="" tal:condition="not layout.has_results">No results yet</h5>
         <h5 i18n:translate="" tal:condition="layout.has_results">Intermediate results</h5>
         <p tal:condition="layout.has_results">
             <span i18n:translate="">Last change</span>: ${layout.format_date(layout.last_result_change, 'datetime_long')}
         </p>
    </div>
    <div class="panel" tal:condition="layout.completed">
        <p>
            <span i18n:translate="">Last change</span>: ${layout.format_date(layout.last_result_change, 'datetime_long')}
        </p>
    </div>
</metal:status_callout>

<metal:subscription_links define-macro="subscription_links" i18n:domain="onegov.election_day">
    <tal:block tal:condition="python: not request.browser_session.get('headerless')">
        <div class="row subscription-links" tal:condition="layout.principal.email_notification or layout.principal.sms_notification">
            <div class="columns small-12" tal:define='both python: layout.principal.email_notification and layout.principal.sms_notification;
                                                      email_only python: layout.principal.email_notification and not layout.principal.sms_notification;
                                                      sms_only python: not layout.principal.email_notification and layout.principal.sms_notification'>
                <h2 tal:condition="both" i18n:translate>Alerts</h2>
                <h2 tal:condition="email_only" i18n:translate>Email alerts</h2>
                <h2 tal:condition="sms_only" i18n:translate>SMS alerts</h2>
                <p tal:condition="both" i18n:translate>The service provides free information on the publication of new results (intermediate results, final results):</p>
                <p tal:condition="email_only" i18n:translate>The email service provides free information on the publication of new results (intermediate results, final results):</p>
                <p tal:condition="sms_only" i18n:translate>The SMS service provides free information on the publication of new results (intermediate results, final results):</p>
                <ul tal:condition="layout.principal.email_notification">
                    <li><a href="${request.link(layout.principal, 'subscribe-email')}" i18n:translate>Get email alerts</a></li>
                    <li><a href="${request.link(layout.principal, 'unsubscribe-email')}" i18n:translate>Stop email subscription</a></li>
                </ul>
                <ul tal:condition="layout.principal.sms_notification">
                    <li><a href="${request.link(layout.principal, 'subscribe-sms')}" i18n:translate>Get SMS alerts</a></li>
                    <li><a href="${request.link(layout.principal, 'unsubscribe-sms')}" i18n:translate>Stop SMS subscription</a></li>
                </ul>
            </div>
        </div>
    </tal:block>
</metal:subscription_links>

<metal:election_day_link define-macro="election_day_link" i18n:domain="onegov.election_day">
    <nav role="navigation" aria-label="Breadcrumb Navigation">
        <ul class="breadcrumbs back-links" tal:define="compound item.election_compound|None">
            <li><a href="${layout.homepage_link}" i18n:translate="homepage">Start</a></li>
            <li><a href="${request.link(layout.archive.for_date(item.date.year))}">${item.date.year}</a></li>
            <li><a href="${request.link(layout.archive.for_date(item.date))}">${layout.format_date(item.date, 'day_long')}</a></li>
            <li tal:condition="compound"><a href="${request.link(compound)}"><span metal:use-macro="layout.macros['short-title-translation']" tal:define="item compound"/></a></li>
            <li><a href="${request.link(item)}" aria-current="page"><span metal:use-macro="layout.macros['short-title-translation']" tal:define="item item"/></a></li>
        </ul>
    </nav>
</metal:election_day_link>

<metal:election_header define-macro="election_header" i18n:domain="onegov.election_day">
    <div metal:use-macro="layout.macros['election_day_link']" tal:define="item election"/>
    <h1><span metal:use-macro="layout.macros['title-translation']" tal:define="item election"/></h1>
    <hr>
</metal:election_header>

<metal:vote_header define-macro="vote_header" i18n:domain="onegov.election_day">
    <h1>
        <span metal:use-macro="layout.macros['title-translation']" tal:define="item vote"/>
        <tal:b tal:condition="layout.answer">
            <br>
            <tal:b tal:condition="layout.type == 'simple'" metal:use-macro="layout.macros['answer']" tal:define="answer layout.answer; direct layout.direct"/>
            <tal:b tal:condition="layout.type == 'complex'">
                <tal:block tal:define="proposal vote.proposal.accepted;
                                       counter_proposal vote.counter_proposal.accepted;
                                       tie_breaker vote.tie_breaker.accepted;
                                       direct vote.direct">
                    <tal:block tal:condition="python: not proposal and not counter_proposal">
                        <span tal:condition="direct" class="answer rejected" i18n:translate="">
                            Proposal and direct counter proposal rejected
                        </span>
                        <span tal:condition="not direct" class="answer rejected" i18n:translate="">
                            Proposal and indirect counter proposal rejected
                        </span>
                    </tal:block>
                    <span tal:condition="python: proposal and not counter_proposal" class="answer accepted" i18n:translate="">
                        Proposal accepted
                    </span>
                    <tal:block tal:condition="python: not proposal and counter_proposal">
                        <span tal:condition="direct" class="answer accepted" i18n:translate="">
                            Direct counter proposal accepted
                        </span>
                        <span tal:condition="not direct" class="answer accepted" i18n:translate="">
                            Indirect counter proposal accepted
                        </span>
                    </tal:block>
                    <tal:block tal:condition="python: proposal and counter_proposal">
                        <span tal:condition="tie_breaker" class="answer accepted" i18n:translate="">
                            Tie breaker in favor of the proposal
                        </span>
                        <tal:block tal:condition="not: tie_breaker">
                            <span tal:condition="direct" class="answer rejected" i18n:translate="">
                                Tie breaker in favor of the direct counter proposal
                            </span>
                            <span tal:condition="not direct" class="answer rejected" i18n:translate="">
                                Tie breaker in favor of the indirect counter proposal
                            </span>
                        </tal:block>
                    </tal:block>
                </tal:block>
            </tal:b>
        </tal:b>
    </h1>

    <div class="clearfix"></div>
    <metal metal:use-macro="layout.macros['ballot-result-bar']" />
    <tal:block tal:condition="not: layout.has_results and ballot">
        <hr>
    </tal:block>
</metal:vote_header>

<metal:election_factoids define-macro="election_factoids" i18n:domain="onegov.election_day">
    <tal:block tal:condition="not election.tacit">
        <ul class="small-block-grid-1 medium-block-grid-4 factoids">
            <li>
                <span i18n:translate="">Turnout</span>
                <strong>${'{0:.2f}'.format(election.turnout)} %</strong>
            </li>
            <li>
                <span i18n:translate="">eligible Voters</span>
                <strong>${layout.format_number(election.eligible_voters)}</strong>
            </li>
            <li>
                <span i18n:translate="">Received Ballots</span>
                <strong>${layout.format_number(election.received_ballots)}</strong>
            </li>
            <li>
                <span i18n:translate="">Counted</span>
                <strong><span metal:use-macro="layout.macros['progress']" tal:define="progress election.progress" /></strong>
            </li>
            <li>
                <span i18n:translate="" tal:condition="layout.majorz">Seats</span>
                <span i18n:translate="" tal:condition="layout.proporz">${layout.label('mandates')}</span>
                <strong><span metal:use-macro="layout.macros['progress']" tal:define="progress (election.allocated_mandates, election.number_of_mandates)" /></strong>
            </li>
            <li tal:condition="layout.majorz and election.majority_type=='absolute'">
                <span i18n:translate="">Absolute majority</span>
                <strong tal:condition="election.absolute_majority and layout.completed">${layout.format_number(election.absolute_majority or 0)}</strong>
            </li>
        </ul>
    </tal:block>
</metal:election_factoids>

<metal:election_compound_factoids define-macro="election_compound_factoids" i18n:domain="onegov.election_day">
    <ul class="small-block-grid-1 medium-block-grid-4 factoids">
        <li>
            <span i18n:translate="">Counted</span>
            <strong><span metal:use-macro="layout.macros['progress']" tal:define="progress election_compound.progress" /></strong>
        </li>
        <li>
            <span i18n:translate="" tal:condition="layout.majorz">Seats</span>
            <span i18n:translate="" tal:condition="layout.proporz">${layout.label('mandates')}</span>
            <strong><span metal:use-macro="layout.macros['progress']" tal:define="progress (election_compound.allocated_mandates, election_compound.number_of_mandates)" /></strong>
        </li>
    </ul>
</metal:election_compound_factoids>

<metal:vote_factoids define-macro="vote_factoids" i18n:domain="onegov.election_day">
    <ul class="small-block-grid-1 medium-block-grid-4 factoids">
        <li>
            <span i18n:translate="turnout_vote">Voter turnout</span>
            <strong>${'{0:.2f}'.format(ballot.turnout)} %</strong>
        </li>
        <li>
            <span i18n:translate="eligible_voters_vote">eligible Voters</span>
            <strong>${layout.format_number(ballot.eligible_voters)}</strong>
        </li>
        <li>
            <span i18n:translate="">Cast Ballots</span>
            <strong>${layout.format_number(ballot.cast_ballots)}</strong>
        </li>
        <li>
            <span i18n:translate="">Counted</span>
            <strong><span metal:use-macro="layout.macros['progress']" tal:define="progress ballot.progress" /></strong>
        </li>
    </ul>
</metal:vote_factoids>

<metal:pdf_download define-macro="pdf_download" i18n:domain="onegov.election_day">
    <tal:block tal:condition="layout.pdf_path">
        <h4>PDF</h4>
        <p><span i18n:translate="">Download a PDF with all the results:</span> <a i18n:translate="" href="${request.link(model, 'pdf')}">PDF Results</a></p>
    </tal:block>
</metal:pdf_download>

<metal:open_data_download define-macro="open_data_download" i18n:domain="onegov.election_day">
    <tal:block tal:define="has_candidate_results layout.type in ('compound', 'majorz', 'proporz');
                           has_party_results getattr(layout, 'has_party_results', False)">
        <h4 i18n:translate="">Open Data</h4>
        <h5 tal:condition="has_candidate_results" i18n:translate="">Candidate results</h5>
        <p tal:condition="has_candidate_results" i18n:translate="">The raw data of the candidates are available in the following formats:</p>
        <p tal:condition="not: has_candidate_results" i18n:translate="">The raw data are available in the following formats:</p>
        <ol>
            <li><a href="${request.link(model, 'data-json')}">JSON</a></li>
            <li><a href="${request.link(model, 'data-csv')}">CSV</a></li>
        </ol>

        <h5 tal:condition="has_party_results" i18n:translate="">Party results</h5>
        <p tal:condition="has_party_results" i18n:translate="">The raw data of the parties are available in the following formats:</p>
        <ol tal:condition="has_party_results">
            <li><a href="${request.link(model, 'data-parties-json')}">JSON</a></li>
            <li><a href="${request.link(model, 'data-parties-csv')}">CSV</a></li>
        </ol>

        <p><span i18n:translate="">The format of the data is described here:</span> <a href="${layout.opendata_link}"><span i18n:translate="">Format Description</span></a>.</p>

        <h5 i18n:translate="">Terms of use</h5>
        <p i18n:translate="">Open use. Must provide the source.</p>
        <ul>
            <li i18n:translate="">You may use this dataset for non-commercial purposes.</li>
            <li i18n:translate="">You may use this dataset for commercial purposes.</li>
            <li>
                <tal:block i18n:translate="">You must provide the source (author, title and link to the dataset).</tal:block>
                <ol class="citations">
                    <li>${layout.principal.name} (${layout.format_date(layout.last_result_change, 'datetime_long')}). <cite>${model.title} (JSON)</cite>. ${request.link(model, 'data-json')}.</li>
                    <li>${layout.principal.name} (${layout.format_date(layout.last_result_change, 'datetime_long')}). <cite>${model.title} (CSV)</cite>. ${request.link(model, 'data-csv')}.</li>
                    <li tal:condition="has_party_results">${layout.principal.name} (${layout.format_date(layout.last_result_change, 'datetime_long')}). <cite>${model.title} (JSON)</cite>. ${request.link(model, 'data-parties-json')}.</li>
                    <li tal:condition="has_party_results">${layout.principal.name} (${layout.format_date(layout.last_result_change, 'datetime_long')}). <cite>${model.title} (CSV)</cite>. ${request.link(model, 'data-parties-csv')}.</li>
                </ol>
            </li>
        </ul>
        <p><a href="${layout.terms_link}"><img width="100" height="80" src="${layout.terms_icon}" i18n:attributes="alt" alt="Terms of use"></a></p>
    </tal:block>
</metal:open_data_download>

<metal:upload_errors define-macro="upload_errors" i18n:domain="onegov.election_day">
    <div class="after-upload" tal:condition="errors">
        <div class="alert-box alert" i18n:translate="">
            Your results could not be uploaded.
        </div>
        <tal:block metal:use-macro="layout.macros['file_import_errors']" />
    </div>
</metal:upload_errors>

<metal:file_import_errors define-macro="file_import_errors" i18n:domain="onegov.election_day">
    <ul>
        <li tal:repeat="error errors">
            <span class="error-line" tal:condition="error.filename">${error.filename}</span>
            <span class="error-line" tal:condition="error.line"><span i18n:translate="">Line </span>${error.line}</span>
            <span class="error-message">${error.error}</span>
        </li>
    </ul>
</metal:file_import_errors>

<metal:seat_allocation_figure define-macro="seat_allocation_figure" i18n:domain="onegov.election_day">
    <figure>
        <tal:block metal:use-macro="layout.macros['seat-allocation-chart']" tal:define="embed True"/>
        <a class="svg-download" tal:condition="layout.svg_path" href="${layout.svg_link}">
            <i class="fa fa-download"></i><tal:block i18n:translate="">Download</tal:block>
        </a>
    </figure>
</metal:seat_allocation_figure>


<metal:party_strengths_figure define-macro="party_strengths_figure" i18n:domain="onegov.election_day">
    <figure>
        <tal:block metal:use-macro="layout.macros['party-strengths-chart']" tal:define="embed True; horizontal model.horizontal_party_strengths|False"/>
        <a class="svg-download" tal:condition="layout.svg_path" href="${layout.svg_link}">
            <i class="fa fa-download"></i><tal:block i18n:translate="">Download</tal:block>
        </a>
            <figcaption i18n:translate="figcaption_party_strengths" tal:condition="not: model.horizontal_party_strengths|False">
            The diagram shows the votes and mandates of the parties. The rimmed bars
            (left scale) correspond to the number of mandates, the colored bars (right scale)
            to the voices (percentages).
        </figcaption>
    </figure>
</metal:party_strengths_figure>

<metal:party-strengths-table define-macro="party-strengths-table" i18n:domain="onegov.election_day">
    <tal:block tal:define="voters_counts layout.model.voters_counts|False; year year|None">
        <div class="tab-navigation clearfix" tal:condition="party_years and not year">
            <nav class="top-bar" data-topbar="" role="navigation">
                <ul class="title-area">
                    <li class="name menu-icon"><span i18n:translate="">Year</span></li>
                    <li class="toggle-topbar menu-icon"><a href="#"><span></span></a></li>
                </ul>
                <div class="top-bar-section">
                    <ul class="left tabs" data-tab="">
                        <tal:block tal:repeat="year sorted(party_years, reverse=True)">
                            <li tal:attributes="class 'active' if repeat.year.start else ''"><a href="#panel_${year}">${year}</a></li>
                        </tal:block>
                    </ul>
                </div>
            </nav>
        </div>
        <div class="tabs-content" tal:condition="party_years">
            <tal:block tal:repeat="current_year sorted(party_years, reverse=True)">
                <div tal:attributes="class 'content active' if repeat.current_year.start or year == current_year else 'content'" id="panel_${current_year}" tal:condition="not year or year == current_year">
                    <table
                        class="results tablesaw sortable"
                        data-tablesaw-mode="columntoggle"
                        data-tablesaw-mode-switch="" data-tablesaw-mode-exclude="swipe"
                        data-tablesaw-minimap=""
                        >
                        <thead>
                            <tr>
                                <th data-tablesaw-priority="persist" i18n:translate="">Party</th>
                                <th data-tablesaw-priority="1" class="right-aligned" i18n:translate="">${layout.label('mandates')}</th>
                                <th tal:condition="not voters_counts" data-tablesaw-priority="2" class="right-aligned" i18n:translate="single_votes">Votes</th>
                                <th tal:condition="not voters_counts" data-tablesaw-priority="2" class="right-aligned" i18n:translate="single_votes">Votes</th>
                                <th tal:condition="voters_counts" data-tablesaw-priority="2" class="right-aligned" i18n:translate="">Voters count</th>
                                <th tal:condition="voters_counts" data-tablesaw-priority="2" class="right-aligned" i18n:translate="">Voters count</th>
                                <th data-tablesaw-priority="5" class="right-aligned" i18n:translate="" tal:condition="party_deltas">Difference</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr tal:repeat="line party_results[current_year]">
                                <tal:block tal:repeat="cell line">
                                    <td tal:condition="repeat.cell.start">${cell}</td>
                                    <td tal:condition="not: repeat.cell.start" class="right-aligned">${cell}</td>
                                </tal:block>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </tal:block>
        </div>
    </tal:block>
</metal:party-strengths-table>

<metal:figcaption_panachage define-macro="figcaption_panachage" i18n:domain="onegov.election_day">
    <figcaption i18n:translate="figcaption_panachage">
        The diagram shows the origin of votes won and lost by panache.
        On the left side are the lost votes, on the right side the won votes.
        The width of the bars and the connections is proportional to the number of votes.
    </figcaption>
</metal:figcaption_panachage>

<metal:parties_panachage_figure define-macro="parties_panachage_figure" i18n:domain="onegov.election_day">
    <tal:block metal:use-macro="layout.macros['parties-panachage-chart']" tal:define="embed True"/>
    <a class="svg-download" tal:condition="layout.svg_path" href="${layout.svg_link}">
        <i class="fa fa-download"></i><tal:block i18n:translate="">Download</tal:block>
    </a>
    <figure metal:use-macro="layout.macros['figcaption_panachage']" />
</metal:parties_panachage_figure>

<metal:candidate-statistics define-macro="candidate-statistics" i18n:domain="onegov.election_day">
    <div class="candidate-statistics" tal:condition="candidate_statistics">
        <table
            class="statistics tablesaw sortable"
            data-tablesaw-mode="columntoggle"
            data-tablesaw-mode-switch="" data-tablesaw-mode-exclude="swipe"
            data-tablesaw-minimap=""
            >
            <thead>
                <tr>
                    <th data-tablesaw-priority="persist" i18n:translate="">Elected candidates</th>
                    <th data-tablesaw-priority="persist" class="right-aligned" i18n:translate="">Count</th>
                    <th data-tablesaw-priority="persist" class="right-aligned" i18n:translate="">Average age</th>
                </tr>
            </thead>
            <tbody>
                <tal:block tal:repeat="gender sorted(candidate_statistics)">
                    <tr tal:condition="gender != 'total'">
                        <th><metal:b use-macro="layout.macros['gender-singular']"/></th>
                        <td class="right-aligned">${candidate_statistics[gender]['count']}</td>
                        <td class="right-aligned">${candidate_statistics[gender]['age']}</td>
                    </tr>
                </tal:block>
            </tbody>
            <tfoot>
                <tr class="total">
                    <td i18n:translate>Total</td>
                    <td class="right-aligned">${candidate_statistics['total']['count']}</td>
                    <td class="right-aligned">${candidate_statistics['total']['age']}</td>
                </tr>
            </tfoot>
        </table>
    </div>
</metal:candidate-statistics>

<metal:mail_election_compound_result define-macro="mail_election_compound_result" i18n:domain="onegov.election_day">
    <h1>${layout.model_title(election_compound)}</h1>
    <p tal:condition="not election_compound.has_results" i18n:translate>No results yet</p>
    <tal:block tal:condition="election_compound.has_results and not election_compound.completed">
        <!--! Intermediate results -->
        <h2 i18n:translate>Intermediate results</h2>
        <dl tal:define="elected_candidates python: sorted([(c[1], c[0]) for c in election_compound.elected_candidates])">
            <dt i18n:translate>Counted</dt>
            <dd><span metal:use-macro="layout.macros['progress']" tal:define="progress election_compound.progress" /></dd>
            <dt i18n:translate tal:condition="elected_candidates">Elected Candidates</dt>
            <dd tal:repeat="name elected_candidates">${name[0]} ${name[1]}</dd>
        </dl>
    </tal:block>
    <tal:block tal:condition="election_compound.has_results and election_compound.completed">
        <!--! Final results -->
        <dl>
            <dt i18n:translate>Elected Candidates</dt>
            <dd tal:repeat="name election_compound.elected_candidates">${name[1]} ${name[0]}</dd>
        </dl>
    </tal:block>
    <p><a href="${layout.model_url(election_compound)}" i18n:translate>View all details online</a></p>
</metal:mail_election_compound_result>

<metal:mail_election_result define-macro="mail_election_result" i18n:domain="onegov.election_day">
    <h1>${layout.model_title(election)}</h1>
    <p tal:condition="not election.has_results" i18n:translate>No results yet</p>
    <tal:block tal:condition="election.has_results and not election.completed and election.type == 'majorz'">
        <!--! Intermediate results, majorz -->
        <h2 i18n:translate>Intermediate results</h2>
        <dl>
            <dt i18n:translate>Counted</dt>
            <dd><span metal:use-macro="layout.macros['progress']" tal:define="progress election.progress" /></dd>
        </dl>
        <dl tal:define="candidates python: sorted([(c.votes, c.family_name, c.first_name) for c in election.candidates], reverse=True)">
            <dt><span i18n:translate>Candidates</span> / <span i18n:translate="single_votes">Votes</span></dt>
            <dd tal:repeat="candidate candidates"><span>${candidate[1]} ${candidate[2]}<span> / <span>${layout.format_number(candidate[0])}</span></dd>
        </dl>
    </tal:block>
    <tal:block tal:condition="election.has_results and not election.completed and election.type == 'proporz'">
        <!--! Intermediate results, proporz -->
        <h2 i18n:translate>Intermediate results</h2>

        <dl>
            <dt i18n:translate>Counted</dt>
            <dd><span metal:use-macro="layout.macros['progress']" tal:define="progress election.progress" /></dd>
        </dl>

        <dl tal:define="lists python: sorted([(l.votes, l.name) for l in election.lists], reverse=True)">
            <dt><span i18n:translate>Lists</span> / <span i18n:translate="single_votes">Votes</span></dt>
            <dd tal:repeat="list lists"><span>${list[1]}</span> / <span>${layout.format_number(list[0])}</span></dd>
        </dl>
    </tal:block>
    <tal:block tal:condition="election.has_results and election.completed and election.type == 'majorz'">
        <!--! Final results, majorz -->
        <dl>
            <dt i18n:translate>Elected Candidates</dt>
            <dd tal:repeat="name election.elected_candidates">${name[1]} ${name[0]}</dd>
            <dt i18n:translate>Turnout</dt>
            <dd>${'{0:.2f}'.format(election.turnout)} %</dd>
        </dl>
    </tal:block>
    <tal:block tal:condition="election.has_results and election.completed and election.type == 'proporz'">
        <!--! Final results, proporz -->
        <dl tal:define="lists python: sorted([(l.number_of_mandates, l.name) for l in election.lists if l.number_of_mandates], reverse=True)">
            <dt><span i18n:translate>Lists</span> / <span i18n:translate>${layout.label('mandates')}</span></dt>
            <dd tal:repeat="list lists"><span>${list[1]}<span> / <span>${list[0]}</span></dd>
            <dt i18n:translate>Elected Candidates</dt>
            <dd tal:repeat="name election.elected_candidates">${name[1]} ${name[0]}</dd>
            <dt i18n:translate>Turnout</dt>
            <dd>${'{0:.2f}'.format(election.turnout)} %</dd>
        </dl>
    </tal:block>
    <p><a href="${layout.model_url(election)}" i18n:translate>View all details online</a></p>
</metal:mail_election_result>

<metal:mail_vote_result define-macro="mail_vote_result" i18n:domain="onegov.election_day">
    <h1>${layout.model_title(vote)}</h1>
    <p tal:condition="not vote.has_results" i18n:translate>No results yet</p>
    <tal:block tal:condition="vote.has_results and not vote.completed and vote.type == 'simple'">
        <!--! Intermediate results, simple vote -->
        <h2 i18n:translate>Intermediate results</h2>
        <dl>
            <dt i18n:translate>Counted</dt>
            <dd><span metal:use-macro="layout.macros['progress']" tal:define="progress vote.progress" /></dd>
            <dt i18n:translate>Yeas</dt>
            <dd>${'{0:.2f}'.format(vote.proposal.yeas_percentage)}%</dd>
            <dt i18n:translate>Nays</dt>
            <dd>${'{0:.2f}'.format(vote.proposal.nays_percentage)}%</dd>
        </dl>
    </tal:block>
    <tal:block tal:condition="vote.has_results and not vote.completed and vote.type == 'complex'">
        <!--! Intermediate results, complex vote -->
        <h2 i18n:translate>Intermediate results</h2>
        <dt i18n:translate>Counted</dt>
        <dl>
            <dd><span metal:use-macro="layout.macros['progress']" tal:define="progress vote.progress" /></dd>
            <dt i18n:translate>Proposal</dt>
            <dd>
                ${'{0:.2f}'.format(vote.proposal.yeas_percentage)}% <tal:block i18n:translate>Yeas</tal:block> /
                ${'{0:.2f}'.format(vote.proposal.nays_percentage)}% <tal:block i18n:translate>Nays</tal:block>
            </dd>
            <dt i18n:translate>Counter Proposal</dt>
            <dd>
                ${'{0:.2f}'.format(vote.counter_proposal.yeas_percentage)}% <tal:block i18n:translate>Yeas</tal:block> /
                ${'{0:.2f}'.format(vote.counter_proposal.nays_percentage)}% <tal:block i18n:translate>Nays</tal:block>
            </dd>
            <dt i18n:translate>Tie-Breaker</dt>
            <dd>
                ${'{0:.2f}'.format(vote.tie_breaker.yeas_percentage)}% <tal:block i18n:translate>Yeas</tal:block> /
                ${'{0:.2f}'.format(vote.tie_breaker.nays_percentage)}% <tal:block i18n:translate>Nays</tal:block>
            </dd>
        </dl>
    </tal:block>
    <tal:block tal:condition="vote.has_results and vote.completed and vote.type == 'simple'">
        <!--! Final results, simple vote -->
        <h2><tal:block metal:use-macro="layout.macros['answer']" tal:define="answer vote.answer; direct vote.direct"/></h2>
        <dl>
            <dt i18n:translate>Yeas</dt>
            <dd>${'{0:.2f}'.format(vote.proposal.yeas_percentage)}%</dd>
            <dt i18n:translate>Nays</dt>
            <dd>${'{0:.2f}'.format(vote.proposal.nays_percentage)}%</dd>
            <dt i18n:translate="turnout_vote">Voter turnout</dt>
            <dd>${'{0:.2f}'.format(vote.turnout)} %</dd>
        </dl>
    </tal:block>
    <tal:block tal:condition="vote.has_results and vote.completed and vote.type == 'complex'">
        <!--! Final results, complex vote -->
        <h2 tal:define="proposal vote.proposal.accepted; counter_proposal vote.counter_proposal.accepted; tie_breaker vote.tie_breaker.accepted; direct vote.direct">
            <tal:block tal:condition="python: not proposal and not counter_proposal and direct" i18n:translate>Proposal and direct counter proposal rejected</tal:block>
            <tal:block tal:condition="python: not proposal and not counter_proposal and not direct" i18n:translate>Proposal and indirect counter proposal rejected</tal:block>
            <tal:block tal:condition="python: proposal and not counter_proposal" i18n:translate>Proposal accepted</tal:block>
            <tal:block tal:condition="python: not proposal and counter_proposal and direct" i18n:translate>Direct counter proposal accepted</tal:block>
            <tal:block tal:condition="python: not proposal and counter_proposal and not direct" i18n:translate>Indirect counter proposal accepted</tal:block>
            <tal:block tal:condition="python: proposal and counter_proposal and tie_breaker" i18n:translate>Tie breaker in favor of the proposal</tal:block>
            <tal:block tal:condition="python: proposal and counter_proposal and not tie_breaker and direct" i18n:translate>Tie breaker in favor of the direct counter proposal</tal:block>
            <tal:block tal:condition="python: proposal and counter_proposal and not tie_breaker and not direct" i18n:translate>Tie breaker in favor of the indirect counter proposal</tal:block>
        </h2>
        <dl>
            <dt i18n:translate>Proposal</dt>
            <dd>
                ${'{0:.2f}'.format(vote.proposal.yeas_percentage)}% <tal:block i18n:translate>Yeas</tal:block> /
                ${'{0:.2f}'.format(vote.proposal.nays_percentage)}% <tal:block i18n:translate>Nays</tal:block>
            </dd>
            <dt i18n:translate>Counter Proposal</dt>
            <dd>
                ${'{0:.2f}'.format(vote.counter_proposal.yeas_percentage)}% <tal:block i18n:translate>Yeas</tal:block> /
                ${'{0:.2f}'.format(vote.counter_proposal.nays_percentage)}% <tal:block i18n:translate>Nays</tal:block>
            </dd>
            <dt i18n:translate>Tie-Breaker</dt>
            <dd>
                ${'{0:.2f}'.format(vote.tie_breaker.yeas_percentage)}% <tal:block i18n:translate>Yeas</tal:block> /
                ${'{0:.2f}'.format(vote.tie_breaker.nays_percentage)}% <tal:block i18n:translate>Nays</tal:block>
            </dd>
            <dt i18n:translate="turnout_vote">Voter turnout</dt>
            <dd>${'{0:.2f}'.format(vote.turnout)} %</dd>
        </dl>
    </tal:block>
    <p><a href="${layout.model_url(vote)}" i18n:translate>View all details online</a></p>
</metal:mail_vote_result>

</body>
