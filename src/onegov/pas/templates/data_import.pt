<div metal:use-macro="layout.base" i18n:domain="onegov.pas">
    <tal:b metal:fill-slot="title">
            ${title}
    </tal:b>
    <tal:b metal:fill-slot="content">
        <!-- Explicitly display form errors for debugging -->
        <div tal:condition="form.errors" class="callout alert">
            <p i18n:translate="">Please correct the errors below:</p>
            <ul>
                <li tal:repeat="field_errors form.errors.items()">
                    <strong tal:content="field_errors[0]" />:
                    <span tal:repeat="error field_errors[1]" tal:content="error" />
                </li>
            </ul>
        </div>

        <!-- After form submit, don't show the form again but show the import details. -->
        <div metal:use-macro="layout.macros['form']" tal:condition="form and not import_details" />

        <div tal:condition="error_message" class="callout alert import-error">
            <h4 i18n:translate="">Import Error</h4>
            <pre tal:content="error_message" />
        </div>

        <div tal:condition="import_details" class="import-results">
            <h4 i18n:translate="">Import Results</h4>


            <!-- Detailed Breakdown per Category -->
            <tal:block repeat="category_details import_details.items()">
                <!-- Section for Created Items -->
                <div tal:condition="category_details[1]['created']" class="callout success">
                        <h5 i18n:translate="">
                            ${category_details[1]['category_title']} Created (${category_details[1]['created_count']}/${category_details[1]['processed']})
                        </h5>
                        <ul>
                            <li tal:repeat="item category_details[1]['created']">
                                <span tal:content="get_item_display_title(item)">
                                   <!-- Display title generated by helper -->
                                </span>
                            </li>
                        </ul>
                    </div>

                    <!-- Section for Updated Items -->
                    <div tal:condition="category_details[1]['updated']" class="callout warning">
                         <h5 i18n:translate="">
                             ${category_details[1]['category_title']} Updated (${category_details[1]['updated_count']}/${category_details[1]['processed']})
                         </h5>
                        <ul>
                            <li tal:repeat="item category_details[1]['updated']">
                                 <span tal:content="get_item_display_title(item)">
                                    <!-- Display title generated by helper -->
                                 </span>
                            </li>
                        </ul>
                    </div>

                     <!-- Notice if category was processed but had no changes -->
                     <div tal:condition="category_details[1]['processed'] > 0 and not category_details[1]['created'] and not category_details[1]['updated']"
                          class="callout secondary category-no-changes">
                          <h5 tal:content="string:${category_details[1]['category_title']} (${category_details[1]['processed']})"></h5>
                          <p i18n:translate="">No changes needed for this category.</p>
                     </div>
            </tal:block> <!-- End repeat block -->
        </div>
    </tal:b>
</div>
