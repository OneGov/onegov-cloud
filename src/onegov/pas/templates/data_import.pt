<div metal:use-macro="layout.base" i18n:domain="onegov.pas">
    <tal:b metal:fill-slot="title">
            ${title}
    </tal:b>
    <tal:b metal:fill-slot="content">
        <!-- Explicitly display form errors for debugging -->
        <div tal:condition="form.errors" class="callout alert">
            <p i18n:translate="">Please correct the errors below:</p>
            <ul>
                <li tal:repeat="field_errors form.errors.items()">
                    <strong tal:content="field_errors[0]" />:
                    <span tal:repeat="error field_errors[1]" tal:content="error" />
                </li>
            </ul>
        </div>

        <!-- After form submit, don't show the form again but show the import details. -->
        <div metal:use-macro="layout.macros['form']" tal:condition="form and not import_details" />

        <div tal:condition="error_message" class="callout alert import-error">
            <h4 i18n:translate="">Import Error</h4>
            <pre tal:content="error_message" />
        </div>

        <div tal:condition="import_details" class="import-results">
            <h4 i18n:translate="">Import Details</h4>
            
            <div tal:condition="not any(details.get('created') or details.get('updated') for details in import_details.values())" 
                 class="callout primary">
                <p i18n:translate="">No changes were made. All data is already up to date.</p>
            </div>

            <tal:block repeat="category_name import_details.keys()">
                <tal:block define="details import_details[category_name]">
                    <tal:block define="created details.get('created', [])">
                        <div tal:condition="created" class="callout success">
                            <h5 i18n:translate=""
                                tal:content="string:${category_name.replace('_', ' ').title()} Created (${len(created)})"
                            />
                            <ul>
                                <li tal:repeat="item created">
                                    <a tal:attributes="href request.link(item)"
                                       tal:content="item.title if hasattr(item, 'title') else (item.name if hasattr(item, 'name') else (item.parliamentarian.title + ' in ' + item.commission.name if hasattr(item, 'parliamentarian') and hasattr(item, 'commission') else (item.parliamentarian.title + ' - ' + item.role if hasattr(item, 'parliamentarian') and hasattr(item, 'role') else 'Unknown Object')))"
                                    />
                                </li>
                            </ul>
                        </div>
                    </tal:block>
                    <tal:block define="updated details.get('updated', [])">
                        <div tal:condition="updated" class="callout warning">
                             <h5 i18n:translate=""
                                tal:content="string:${category_name.replace('_', ' ').title()} Updated (${len(updated)})"
                            />
                            <ul>
                                <li tal:repeat="item updated">
                                     <a tal:attributes="href request.link(item)"
                                       tal:content="item.title if hasattr(item, 'title') else (item.name if hasattr(item, 'name') else (item.parliamentarian.title + ' in ' + item.commission.name if hasattr(item, 'parliamentarian') and hasattr(item, 'commission') else (item.parliamentarian.title + ' - ' + item.role if hasattr(item, 'parliamentarian') and hasattr(item, 'role') else 'Unknown Object')))"
                                    />
                                </li>
                            </ul>
                        </div>
                    </tal:block>
                </tal:block>
            </tal:block>
        </div>
    </tal:b>
</div>
