<div metal:use-macro="layout.base" i18n:domain="onegov.fsi">
    <tal:b metal:fill-slot="title">
        ${layout.title}
    </tal:b>
    <tal:b metal:fill-slot="content">
        <div class="row">
            <div class="columns small-12">
                <div class="row">
                    <div tal:condition="show_form|True" class="columns small-12 medium-8">
                        <div class="filter-panel">
                            <div metal:use-macro="layout.macros['form']" />
                        </div>
                        <div class="filter-panel">
                            <p class="label-text" i18n:translate>By last name</p>
                            <div metal:use-macro="layout.macros['tags']" tal:define="tags letters" />
                        </div>
                    </div>
                    <div class="columns small-12 medium-4">
                        <div class="info-panel hide-for-print">
                            <tal:b metal:use-macro="layout.macros['color_code_snippet']" />
                        </div>
                    </div>
                </div>
                <div class="row hide-for-print">
                    <div class="columns small-12 medium-8">
                        <a class="button ${'' if email_recipients else 'disabled'}" tal:attributes="href python: f'mailto:{email_recipients}?subject={subject}' if email_recipients else ''" ><i class="fa fa-envelope"></i> Einnerungsmails</a>
                        <p tal:condition="email_recipients">Öffnet eine Leere Nachricht in ihrem Mailprogramm mit den hier sichtbar gefilterten Kursteilnehmern, welche den fälligen Kurs weder besucht haben, noch angemeldet sind (nächste Teilnahme).</p>
                        <p tal:condition="not email_recipients">Wählen Sie eine oder mehrere Organisationen aus. Wenn Personen in der gefilterten Ansicht den fälligen Kurs weder besucht haben, noch angemeldet sind (nächste Teilnahme), kann mit dem Button an diese eine Erinnerungsmail gesendet werden.</p>
                    </div>
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="columns small-12 end">
                <div class="row">
                    <div class="columns small-12">
                        <tal:b condition="results">
                            <table class="tablesaw hover fullwidth">
                                <thead>
                                <th class="text-left" i18n:translate="">Name</th>
                                <th class="text-left" i18n:translate="">Shortcode</th>
                                    <th class="text-left" i18n:translate="">Last Event</th>
                                    <th class="text-center" i18n:translate="">Attended</th>
                                    <th class="text-left" i18n:translate="">Due by (every <span i18n:name="refresh_interval">${layout.format_refresh_interval(model.course.refresh_interval)}</span>)</th>
                                    <th class="text-left" i18n:translate="">Next Subscription</th>
                                </thead>
                                <tbody>
                                    <tal:b tal:repeat="result results">
                                        <tr tal:define="date layout.next_event_date(result.start, result.refresh_interval)">
                                            <td>${result.last_name}, ${result.first_name}</td>
                                            <td>${result.source_id}</td>
                                            <td>${layout.format_date(result.start, 'datetime')} <span i18n:translate="" tal:condition="result.start">h</span></td>
                                            <td class="text-center">
                                                <span tal:condition="result.event_completed" class="check-icon"></span>
                                                <span tal:condition="not result.event_completed">-</span>
                                            </td>
                                            <td>
                                                <tal:b tal:condition="date">
                                                    <span class="text-red" tal:condition="now > date">${date.year}</span>
                                                    <span class="${'text-orange' if date.year == now.year and result.event_completed else 'text-green'}" tal:condition="now < date">${date.year}</span>
                                                </tal:b>
                                                <span class="text-red" tal:condition="not: date">${now.year}</span>
                                            </td>
                                            <td tal:define="next_subscription next_subscriptions.get(result.id, None)">
                                                <tal:b tal:condition="next_subscription">
                                                    <a href="${next_subscription[0]}" class="next-subscription">${layout.format_date(next_subscription[1], 'date')}</a>
                                                </tal:b>
                                            </td>
                                        </tr>
                                    </tal:b>
                                </tbody>
                            </table>
                            <div class="pagination-centered">
                                <div metal:use-macro="layout.macros['pagination']" tal:define="collection model; current_page model;" />
                            </div>
                        </tal:b>
                    </div>
                </div>
            </div>
        </div>
    </tal:b>
</div>
