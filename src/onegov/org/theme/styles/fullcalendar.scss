/*
    Fullcalendar Integration
*/

@keyframes fadeout-box-shadow {
    to {box-shadow: none;}
}

.calendar {

    margin-bottom: 1.5rem;

    button:focus {
        // XXX fullcalendar focuses the buttons when they are clicked,
        // resulting in the chrome accessibility outline.. now this is
        // helpful in allmost all the cases (and should not be disabled)
        // however, the calendar is not accessible as it is, so we might
        // as well remove this otherwise very jaring looking outline
        // -> the fullcalendar needs an accessible alternative, it can't
        // really be made accessible because it's a huge blob of html
        // tables designed to show a calendar...
        outline: none;
    }

    .fc-content {
        // pass through pointer events to the background, where we have the
        // hover and javascript handling
        pointer-events: none;
    }

    .fc-toolbar {
        margin-bottom: 0;

        h2 {
            clear: both;
            display: block;
            float: none;
            margin-bottom: 1rem;
            text-align: left;
        }

        .fc-left {
            float: none;

            button {
                margin-bottom: 15px;
                margin-left: 0;
            }
        }
    }

    .partition-occupied {
        background: repeating-linear-gradient(
            45deg,
            $steel,
            $steel 10px,
            $iron 10px,
            $iron 20px
        );
    }

    .partition-free:hover {
        background: url('data:image/svg+xml;charset=utf-8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+DQo8c3ZnIHdpZHRoPSIyNnB4IiBoZWlnaHQ9IjI2cHgiIHZpZXdCb3g9IjAgMCAyNiAyNiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4NCiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4NCiAgICAgICAgPHBhdGggZD0iTTE3LjAzNDQ4MjgsOC45NjU1MTcyNCBMMTcuMDM0NDgyOCwwIEw4Ljk2NTUxNzI0LDAgTDguOTY1NTE3MjQsOC45NjU1MTcyNCBMMCw4Ljk2NTUxNzI0IEwwLDE3LjAzNDQ4MjggTDguOTY1NTE3MjQsMTcuMDM0NDgyOCBMOC45NjU1MTcyNCwyNiBMMTcuMDM0NDgyOCwyNiBMMTcuMDM0NDgyOCwxNy4wMzQ0ODI4IEwyNiwxNy4wMzQ0ODI4IEwyNiw4Ljk2NTUxNzI0IEwxNy4wMzQ0ODI4LDguOTY1NTE3MjQgWiIgaWQ9IkNvbWJpbmVkLVNoYXBlIiBmaWxsPSIjMDAwMDAwIj48L3BhdGg+DQogICAgPC9nPg0KPC9zdmc+');
        background-position: center;
        background-repeat: no-repeat;
    }

    .changing {
        .calendar-occupied {
            background: none;
        }
    }

    .fc-helper-skeleton *,
    .changing,
    .changing * {
        background-color: $primary-color !important;
    }

    .fc-month-view {
        .fc-day-number {
            font-size: .875rem;
            padding: .25rem .5rem;
        }
    }

    table {
        background-color: transparent;
        margin-bottom: 0;

        tr {
            background-color: transparent;
        }

        .fc-today {
            background: $yellow-pastel !important;

            &.fc-day {
                background: $yellow-pastel !important;
            }

            &.fc-day-top,
            &.fc-day-header, {
                background: $yellow-light !important;
                opacity: 1;
            }
        }

        .event-in-past {
            filter: grayscale(1);
        }

        .fc-day-header,
        .fc-day-number {
            font-size: .9em;
        }

        .fc-event {
            border: 0;
            border-radius: 2px;
            margin: 0 0 2px;
            padding: 2px 4px;
        }

        .fc-bg {
            background: none;
        }

        .event-unavailable {
            background-color: $red;
        }

        .event-partly-available {
            background-color: $orange;
        }

        .event-available {
            background-color: $green;
        }

        // fix borders missing with zurb foundation
        tbody div.fc-content-skeleton td {
            border-color: $gainsboro;
        }
    }

    .fc-event {
        div.fc-time,
        span.fc-time {
            display: none;
        }

        .fc-title {
            font-size: .8rem;
            padding: 0;
        }

        &.fc-short .fc-title {
            display: inline-block;
            overflow: hidden;
            text-overflow: ellipsis;

            br {
                display: none;
            }
        }

        &.highlight {
            @include prefix(animation-delay, 3s);
            @include prefix(animation-duration, 2s);
            @include prefix(animation-fill-mode, forwards);
            @include prefix(animation-iteration-count, 1);
            @include prefix(animation-name, fadeout-box-shadow);
            box-shadow: 0 5px 0 $yellow;
        }
    }

    .fc button,
    .fc-button {
        //@include button(
        //    $padding: $button-tny,
        //    $bg: $smoke
        //);
        background-image: none;
        box-shadow: none;
        font-size: .9rem;
        height: 2.25rem;
        text-shadow: none;

        &.fc-state-active,
        &.fc-state-disabled {
            background: $charcoal;
            color: $white;
            opacity: 1;
        }
    }
}

.calendar-footer {
    background: $white-smoke;
    border: 1px solid $gainsboro;
    color: $steel;
    font-size: .8rem;
    margin-bottom: 1.5rem;
    margin-top: calc(-1.5rem - 1px);
    padding: 2px 5px;
    text-align: center;
    width: 80%;
}

/*
    Fullcalendar responsive design
*/
@include breakpoint(medium up) {
    .fc .fc-toolbar {
        width: 100%;
    }
}

@include breakpoint(large only) {
    .fc .fc-toolbar {
        width: 80%;
    }
}

@media screen and (max-width: 850px) {
    .fc-center {
        display: block;
        width: 100%;
    }
}

@media screen and (min-width: 850px) {
    .fc-center {
        display: inline-block;
        width: 40%;
    }
}

@include breakpoint(small only) {
    .calendar-footer {
        display: none !important;
    }
}

@include breakpoint(medium only) {
    .calendar-footer {
        width: 75%;
    }
}

/*
    Calendar day display
*/

// raise the importance a bit by double-selecting
.calendar-day.calendar-day {
    $border-radius: 4px;
    $icon-size: 3rem;

    background-color: $topbar-bg-color;
    border-radius: $border-radius $border-radius 0 0;
    font-size: .875rem;
    width: 100%;

    .calendar-day-thumbnail {
        background-position: center top;
        background-size: cover;
        border-radius: $border-radius $border-radius 0 0;
        display: block;
        padding-top: 75%;
        position: relative;
        width: 100%;

        .fa {
            bottom: 0;
            color: $iron;
            font-size: $icon-size;
            height: $icon-size;
            left: 0;
            margin: auto;
            position: absolute;
            right: 0;
            top: 0;
            width: $icon-size;
        }
    }

    .calendar-day-date {
        @include primary-color-background;
        border-radius: 0 0 $border-radius $border-radius;
        line-height: 2.25rem;

        > div {
            display: inline-block;
        }

        .weekday {
            background: $black;
            border-radius: 0 0 0 $border-radius;
            color: $white;
            padding: 0 .5rem;
            text-transform: uppercase;
        }

        .date {
            overflow: hidden;
            padding: 0 0 0 .5rem;
            position: absolute;
            text-overflow: ellipsis;
            white-space: nowrap;
            width: 60%;

            .long-month {
                display: inline;
            }

            .short-month {
                display: none;
            }
        }
    }
}

@include breakpoint(small only) {
    .occurrece {
        margin-bottom: 1rem !important;
    }

    .calendar-day {
        .calendar-day-date {
            font-size: .875rem;

            .date {
                .long-month {
                    display: none;
                }

                .short-month {
                    display: inline;
                }
            }
        }
    }

    .calendar-text-column {
        padding-left: 0;

        h3 {
            font-size: 1rem !important;
        }

        .occurrence-location,
        .occurrence-time {
            font-size: .875rem !important;
        }

        .occurrence-tags {
            display: none;
        }
    }
}