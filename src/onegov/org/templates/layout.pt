<!DOCTYPE html>
<html class="no-js" lang="${request.html_lang}"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      i18n:domain="onegov.org"
      metal:define-macro="layout">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--! use DELETE/PUT instead of POST as we target IE 11+ -->
    <meta name="intercoolerjs:use-actual-http-method" content="true" />

    <title><div metal:define-slot="title"></div></title>
    <!-- This site is running on the
          ___              ____               ____ _                 _
         / _ \ _ __   ___ / ___| _____   __  / ___| | ___  _   _  __| |
        | | | | '_ \ / _ \ |  _ / _ \ \ / / | |   | |/ _ \| | | |/ _` |
        | |_| | | | |  __/ |_| | (_) \ V /  | |___| | (_) | |_| | (_| |
         \___/|_| |_|\___|\____|\___/ \_/    \____|_|\___/ \__,_|\__,_|

         Have a look at the source code: https://onegov.readthedocs.org
     -->
    <!--! Sliders do not render nicely until all css/js has been loaded, so we hide them until that happens (see also: common.js) -->
    <style>.slider{opacity:0;}</style>
    <link rel="stylesheet" type="text/css" href="${request.theme_link}">
    <link rel="stylesheet" type="text/css" href="${layout.font_awesome_path}">

    <tal:b metal:use-macro="layout.macros.favicon" />

    <tal:b condition="layout.app.sentry_dsn">
      <script src="https://browser.sentry-cdn.com/5.6.2/bundle.min.js" crossorigin="anonymous"></script>
      <script>
        Sentry.init({
            dsn: '${layout.app.sentry_dsn}',
            release: '${layout.app.sentry_version}',
            username: '${request.current_username}',
            environment: '${layout.app.sentry_environment}',
            role: '${request.current_role}',
            ignoreUrls: [/\/(gtm|ga|analytics)\.js/i],
            shouldSendCallback: function(data) {
                var crumbs = (data.breadcrumbs && data.breadcrumbs.values || []);
                var errors = (data.exception.values && data.exception.values || []);

                if (crumbs.length > 0 && errors.length > 0) {

                  // if the last occurrence in the breadcrumbs is an XHR error
                  // and the error itself is by intercooler we can ignore it
                  // as we would see the error in the backend and we will
                  // have informed the user in the frontend
                  if (crumbs[crumbs.length - 1].category === 'xhr') {
                    if ((errors[errors.length - 1].value || {}).namespace === 'ic') {
                        return false;
                    }
                  }
                }

                return true;
            }
        });
      </script>
    </tal:b>
</head>

<body id="${layout.page_id}" class="${' '.join(cls for cls in layout.body_classes)}" data-default-marker-color="${layout.primary_color}" data-default-lat="${layout.default_map_view.lat|nothing}" data-default-lon="${layout.default_map_view.lon|nothing}" data-default-zoom="${layout.default_map_view.zoom|nothing}" tal:attributes="layout.custom_body_attributes">
    <!--! Adds a 'framed' class to the body if this document is shown inside an iframe -->
    <script>if (window !== window.parent) { document.querySelector('body').className += " framed"; }</script>

    <!--! Skip navigation link for screenreaders -->
    <a class="show-for-sr" href="#content" i18n:translate>Skip navigation</a>


    <div class="ie-11-wrapper">
      <main>
        <header>
          <div class="globals top-bar">
              <div class="top-bar-right">
                <div class="grid-container">
                  <div class="grid-x">
                      <div class="cell small-12">
                        <ul tal:condition="global_tools|nothing" class="vertical medium-horizontal menu" data-responsive-menu="accordion medium-dropdown">
                          <li tal:repeat="tool global_tools">
                            <tal:b condition="tool.links|nothing" define="dropdown_id 'global-dropdown-{}'.format(repeat.tool.number)">
                              <a href="#" data-dropdown="${dropdown_id}" class="dropdown ${' '.join(tool.classes or '')}" tal:attributes="data-count tool.attributes['data-count']|nothing">${tool.title}</a>
                              <ul id="${dropdown_id}" data-dropdown-content class="vertical menu f-dropdown">
                                  <li tal:repeat="link tool.links">
                                      <tal:b replace="structure link(layout)" />
                                  </li>
                              </ul>
                            </tal:b>
                            <tal:b condition="tool.url|tool.id|nothing" define="link tool">
                              <tal:b replace="structure link(layout)" />
                            </tal:b>
                          </li>
                        </ul>
                      </div>
                    </div>
                </div>
              </div>
          </div>
      </main>
    </div>

    <tal:b tal:content="structure layout.org.meta.analytics_code|nothing" />
</body>

</html>
