<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      i18n:domain="onegov.org">
<body>

<metal:favicon define-macro="favicon">
    <link tal:condition="layout.favicon_apple_touch_url|nothing" rel="apple-touch-icon" sizes="57x57" href="${layout.favicon_apple_touch_url}">
    <link tal:condition="layout.favicon_win_url|nothing" rel="icon" type="image/png" href="${layout.favicon_win_url}" sizes="16x16">
    <link tal:condition="layout.favicon_mac_url|nothing" rel="icon" type="image/png" href="${layout.favicon_mac_url}" sizes="32x32">
    <link tal:condition="layout.favicon_pinned_tab_safari_url|nothing" rel="mask-icon" href="${layout.favicon_pinned_tab_safari_url}" color="${layout.primary_color}">
    <link tal:condition="not layout.favicon_apple_touch_url|nothing and
            not layout.favicon_win_url|nothing and
            not layout.favicon_mac_url|nothing and
            not layout.favicon_pinned_tab_safari_url|nothing" rel="icon" href="data:;base64,iVBORw0KGgo=">
    <meta name="theme-color" content="${layout.primary_color}">
</metal:favicon>

<metal:b define-macro="before_directory_entry_lead">
    <!--! To be override by other applications -->
</metal:b>

<metal:b define-macro="extra_usermanagement_fields">
    <!--! To be override by other applications -->
</metal:b>

<metal:b define-macro="extra_usergroup_fields">
    <!--! To be override by other applications -->
</metal:b>

<metal:b define-macro="consume_messages" i18n:domain="onegov.org">
    <div tal:repeat="message request.consume_messages()" data-alert class="alert-box ${message.type}">
        ${message.text}
        <a href="#" class="close">&times;</a>
      </div>
</metal:b>

<metal:navigation define-macro="top_navigation">
    <div class="main-navigation ${not links and 'empty'}" tal:define="links top_navigation|layout.top_navigation">
        <nav class="top-bar" data-topbar role="navigation" tal:condition="links">
            <ul class="title-area">
                <!--! this section needs to be included (even though it's empty),
                or the responsive menu bar icon won't be rendered -->
                <li class="name" style="width: 0;"></li>
                <li class="toggle-topbar menu-icon">
                    <a href="#"><span>Menu</span></a>
                </li>
            </ul>
            <section class="top-bar-section">
                <ul class="left">
                    <li tal:repeat="link links" tal:content="link(layout)" />
                </ul>
            </section>
        </nav>
        <div class="clearfix"></div>
    </div>
</metal:navigation>

<metal:editbar define-macro="editbar">
    <tal:b define="editbar_links editbar_links|layout.editbar_links if not layout.edit_mode else layout.editmode_links">
        <div class="row sub-navigation" tal:condition="editbar_links">
            <div class="small-12 columns">
                <div class="edit-bar clearfix">
                    <tal:b repeat="group editbar_links">
                        <tal:b condition="group.links|nothing" define="dropdown_id 'editbar-dropdown-{}'.format(repeat.group.number)">
                            <button href="#" data-dropdown="${dropdown_id}" class="${group.right_side and 'right-side'} tiny button dropdown">
                                ${group.title}
                            </button>
                            <ul id="${dropdown_id}" data-dropdown-content class="f-dropdown disable-scroll">
                                <li tal:repeat="link group.links">
                                    <tal:b replace="link(layout)" />
                                </li>
                            </ul>
                        </tal:b>
                        <tal:b condition="group.url|group.attrs|nothing" define="link group">
                            <tal:b replace="link(layout, ('tiny', 'button'))" />
                        </tal:b>
                    </tal:b>
                </div>
            </div>
        </div>
    </tal:b>
</metal:editbar>

<metal:breadcrumbs define-macro="breadcrumbs">
    <nav role="navigation" aria-label="You are here" i18n:attributes="aria-label">
        <ul class="breadcrumbs" tal:condition="layout.breadcrumbs">
            <tal:b repeat="link layout.breadcrumbs">
                <li tal:attributes="class repeat.link.end and 'current' or ''"
                    tal:content="link(layout)">
                </li>
            </tal:b>
        </ul>
    </nav>
</metal:breadcrumbs>

<metal:panel-links define-macro="panel-links">
    <ul class="panel-links">
        <li tal:repeat="link panel.links">
            <tal:b content="link(layout)" />
            <small>${link.subtitle}</small>
        </li>
    </ul>
</metal:panel-links>

<metal:footer define-macro="footer">
    <footer>
        <div class="row footer-content">
            <div class="small-12 columns">
                <metal:b use-macro="layout.macros['footer_columns']" />
                <metal:b use-macro="layout.macros['footer_partner']" />
                <metal:b use-macro="layout.macros['footer_links']" />
            </div>
        </div>
    </footer>
</metal:footer>

<metal:footer_columns define-macro="footer_columns">
    <tal:b define="contact layout.org.contact_html|nothing;
                       contact_url layout.org.contact_url|nothing;
                       opening_hours layout.org.opening_hours_html|nothing;
                       opening_hours_url layout.org.opening_hours_url|nothing;
                       facebook layout.org.facebook_url|nothing;
                       twitter layout.org.twitter_url|nothing;
                       instagram layout.org.instagram_url|nothing;
                       youtube layout.org.youtube_url|nothing;
                       linkedin layout.org.linkedin_url|nothing;
                       tiktok layout.org.tiktok_url|nothing;
                       custom_links layout.custom_links|nothing;">
        <div class="row footer-columns" tal:condition="any((
            contact,
            contact_url,
            opening_hours,
            opening_hours_url,
            facebook,
            twitter,
            instagram,
            youtube,
            linkedin,
            tiktok,
            custom_links
        ))">
            <div class="small-12 columns medium-${request.app.org.footer_left_width}">
                <metal:b use-macro="layout.macros['footer_contact']" />
            </div>

            <div class="small-12 columns medium-${request.app.org.footer_center_width}">
                <metal:b use-macro="layout.macros['footer_opening_hours']" />
            </div>

            <div class="small-12 columns medium-${request.app.org.footer_right_width}">
                <metal:b use-macro="layout.macros['footer_social_media']" />
                <metal:b use-macro="layout.macros['footer_custom_links']" />
            </div>
        </div>
    </tal:b>
</metal:footer_columns>

<metal:footer_custom_links define-macro="footer_custom_links">
    <tal:b>
        <tal:b tal:condition="custom_links" tal:repeat="link custom_links">
            <h2 class="custom-links"><a href="${link[1]}">${link[0]}</a></h2>
        </tal:b>
    </tal:b>
</metal:footer_custom_links>

<metal:footer_links define-macro="footer_links" i18n:domain="onegov.org">
    <div class="row footer-links">
      <div class="small-12 columns">
        <tal:b condition="not request.app.org.hide_onegov_footer|True">
            <span>
                <a href="https://www.admin.digital">OneGov Cloud</a><a href="https://github.com/OneGov/onegov-cloud/blob/master/CHANGES.md#release-${layout.app.version.replace('.', '')}"> ${layout.app.version}</a>
            </span>
            <span>
                <a href="https://www.admin.digital/datenschutz" i18n:translate>
                    Privacy Protection
                </a>
            </span>
        </tal:b>
        <span tal:define="about_url layout.org.meta.about_url|nothing" tal:condition="about_url">
            <a href="${about_url}" i18n:translate>
                About
            </a>
        </span>
      </div>
    </div>
</metal:footer_links>

<metal:footer_partner define-macro="footer_partner" i18n:domain="onegov.org">
    <div tal:define="org layout.org" tal:condition="org.partner_1_img or org.partner_2_img or org.partner_3_img or org.partner_4_img|nothing" class="footer-partner">
        <h2 i18n:translate>Partner</h2>
        <ul>
            <li class="${not org.partner_1_img and 'empty'}">
               <a tal:attributes="href org.partner_1_url"
                  tal:condition="org.partner_1_img"
                  style="background-image: url(${org.partner_1_img})">
                    <span class="show-for-sr">
                      ${org.partner_1_name or ''}
                    </span>
                  </a>
            </li>
            <li class="${not org.partner_2_img and 'empty'}">
               <a tal:attributes="href org.partner_2_url"
                  tal:condition="org.partner_2_img"
                  style="background-image: url(${org.partner_2_img})">
                      <span class="show-for-sr">
                        ${org.partner_2_name or ''}
                      </span>
                  </a>
            </li>
            <li class="${not org.partner_3_img and 'empty'}">
               <a tal:attributes="href org.partner_3_url"
                  tal:condition="org.partner_3_img"
                  style="background-image: url(${org.partner_3_img})">
                      <span class="show-for-sr">
                        ${org.partner_3_name or ''}
                      </span>
                  </a>
            </li>
            <li class="${not org.partner_4_img and 'empty'}">
               <a tal:attributes="href org.partner_4_url"
                  tal:condition="org.partner_4_img"
                  style="background-image: url(${org.partner_4_img})">
                      <span class="show-for-sr">
                        ${org.partner_4_name or ''}
                      </span>
                  </a>
            </li>
        </ul>
    </div>
</metal:footer_partner>

<metal:footer_contact define-macro="footer_contact" i18n:domain="onegov.org">
    <h2 i18n:translate tal:condition="contact or contact_url">Contact</h2>
    <div tal:content="layout.org.contact_html" />
    <a tal:condition="contact_url" tal:attributes="href contact_url"><strong i18n:translate>more…</strong></a>
</metal:footer_contact>

<metal:footer_opening_hours define-macro="footer_opening_hours" i18n:domain="onegov.org">
    <h2 i18n:translate tal:condition="opening_hours or opening_hours_url">Opening Hours</h2>
    <div tal:content="opening_hours" />
    <a tal:condition="opening_hours_url" tal:attributes="href opening_hours_url"><strong i18n:translate>more…</strong></a>
</metal:footer_opening_hours>

<metal:footer_social_media define-macro="footer_social_media">
    <tal:b condition="any((facebook, twitter, instagram, youtube, linkedin, tiktok))">
        <h2 i18n:translate>Social Media</h2>

        <ul class="social-media-links">
            <li tal:condition="facebook">
                <a tal:attributes="href facebook">
                    <i class="fa fa-facebook-official fa-fw"></i> Facebook
                </a>
            </li>
            <li tal:condition="twitter">
                <a tal:attributes="href twitter">
                    <i class="fa fa-twitter fa-fw"></i> Twitter
                </a>
            </li>
            <li tal:condition="instagram">
                <a tal:attributes="href instagram">
                    <i class="fa fa-instagram fa-fw"></i> Instagram
                </a>
            </li>
            <li tal:condition="youtube">
                <a tal:attributes="href youtube">
                    <i class="fa fa-youtube fa-fw"></i> YouTube
                </a>
            </li>
            <li tal:condition="linkedin">
                <a tal:attributes="href linkedin">
                    <i class="fa fa-linkedin fa-fw"></i> LinkedIn
                </a>
            </li>
            <li tal:condition="tiktok">
                <a tal:attributes="href tiktok">
                    <img class="tiktok" src="static/font-awesome/tiktok-brands-solid.svg" height="14px"></img> TikTok
                </a>
            </li>
        </ul>
    </tal:b>
</metal:footer_social_media>

<metal:footer_locales define-macro="footer_locales">
    <div class="footer-locales" tal:condition="layout.org.locales and len(layout.org.locales) > 1">
        <h2>Languages</h2>
        <div class="text-links">
            <tal:b repeat="(name, url) layout.locales">
                <a tal:condition="request.locale not in url" href="${url}">${name}</a>
                <a tal:condition="request.locale in url" style="cursor: default"><strong>${name}</strong></a>
            </tal:b>
        </div>
    </div>
</metal:footer_locales>

<metal:panel define-macro="events-panel">
    <h2 i18n:translate>Events</h2>
    <metal:b use-macro="layout.macros['panel-links']" tal:define="panel event_panel"/>
</metal:panel>

<metal:panel define-macro="directories-panel">
    <tal:b condition="directory_panel.links">
        <h2 i18n:translate>Directories</h2>
        <metal:b use-macro="layout.macros['panel-links']" tal:define="panel directory_panel" />
    </tal:b>
</metal:panel>

<metal:form define-macro="form">
    <form tal:attributes="action form.action|'.';data-image-upload-url layout.image_upload_json_url; data-image-list-url layout.image_list_url;data-file-upload-url layout.file_upload_json_url; data-file-list-url layout.file_list_url; data-sitecollection-url layout.sitecollection_url; id form_id|''" class="${form.css_class|''}" method="${form.method|'POST'}" enctype="multipart/form-data" tal:define="form_two_columns form_two_columns|False">
        <tal:b repeat="fieldset form.fieldsets">
            <fieldset tal:condition="fieldset.is_visible" id="fieldset-${fieldset.label.lower().replace(' ', '-')}">
                <legend>${fieldset.label}</legend>
                <div class="formfields ${'row' if form_two_columns else ''}">
                    <metal:fields use-macro="layout.macros['fields']" tal:define="fields fieldset.fields.values()" />
                    <div class="clearfix"></div>
                </div>
            </fieldset>
            <tal:b condition="not:fieldset.is_visible">
                <div class="formfields ${'row' if form_two_columns else ''}">
                    <metal:fields use-macro="layout.macros['fields']" tal:define="fields fieldset.fields.values()" />
                    <div class="clearfix"></div>
                </div>
            </tal:b>
        </tal:b>
        <metal:b define-slot="before-submit" />
        <tal:b condition="not: layout.edit_mode|False">
            <tal:b condition="cancel|nothing">
                <a class="button secondary cancel-button" href="${cancel}" i18n:translate="" role="button">
                    <tal:b condition="not:cancel_text|nothing">
                        Cancel
                    </tal:b>
                    <tal:b condition="cancel_text|nothing">
                        ${cancel_text}
                    </tal:b>
                </a>
            </tal:b>
            <tal:b condition="not: button_text|nothing">
                <input type="submit" value="Submit" class="button" i18n:attributes="value">
            </tal:b>
            <tal:b condition="button_text|nothing">
                <input type="submit" value="${button_text}" class="button" role="button">
            </tal:b>
        </tal:b>
    </form>
</metal:form>

<metal:fields define-macro="fields">
    <tal:b repeat="field fields">
        <div tal:define="hidden form.is_hidden(field)|False" class="${'small-12 large-6 columns' if form_two_columns else 'row'} field-${field.id} field-type-${field.type.lower()} ${hidden and 'field-hidden'}"><div class="${'' if form_two_columns else 'large-12 columns'}">
        <tal:b define="input_type field.widget.input_type|None">
            <tal:b condition="input_type == 'hidden'">
                ${field()}
                <small class="error" tal:repeat="error field.errors">${error}</small>
            </tal:b>
            <tal:b condition="input_type != 'hidden'" define="radio_field field.type == 'RadioField'; checkbox_fields (field.type == 'MultiCheckboxField' or field.type == 'OrderedMultiCheckboxField'); field_list field.type == 'UploadMultipleField'">
                <label tal:attributes="class field.errors and not field_list and 'error' or field.type" tal:condition="not checkbox_fields and not radio_field">
                    <metal:b use-macro="layout.macros['field']" />
                </label>

                <div tal:attributes="class field.errors and 'error group-label' or 'group-label'" tal:condition="checkbox_fields or radio_field">
                    <metal:b use-macro="layout.macros['field']" />
                </div>
                <small class="error" tal:condition="not field_list" tal:repeat="error field.errors">${error}</small>
            </tal:b>
        </tal:b>
    </div></div>
    </tal:b>
</metal:fields>

<metal:homepage-tiles define-macro="homepage-tiles" i18n:domain="onegov.org">
    <div tal:define="show_title show_title|nothing">
        <h2 i18n:translate class="${'' if show_title else 'show-for-sr'}">Selected Topics</h2>
        <div class="homepage-tiles">
            <div tal:repeat="tile tiles" class="homepage-tile" id="homepage-tile-${tile.number}">
                <a href="${tile.page.url}" class="tile-link">
                    <h3>${tile.page.text}</h3>
                </a>
                <div class="child-links">
                    <tal:b repeat="link tile.links" tal:content="link(layout)" />
                </div>
            </div>
        </div>
    </div>
</metal:homepage-tiles>

<metal:single_field define-macro="field">
     <!--! render the label after the field if it's a boolean field -->
    <tal:b condition="field.type == 'BooleanField'">
        ${field()}
        <span class="label-text" tal:condition="not field.hide_label|True">${field.label.text}</span>
        <span class="label-required" tal:condition="field.flags.required|nothing">*</span>
        <div class="field-help" tal:condition="field.description">
            <tal:b replace="request.translate(field.description)" />
        </div>
    </tal:b>
    <tal:b condition="field.type != 'BooleanField'">
        <!--!
            Note how the field is rendered *first* in the 'define' step,
            before the label is accessed. This is due to the field call
            setting up translatable labels as a side-effect.

            See onegov.core.i18n.get_translation_bound_meta.render_field
        -->
        <tal:b define="(description, is_md) form.as_maybe_markdown(form.request.translate(field.description or '')); long_description form.additional_field_help(field); content field(placeholder=description if not long_description else '')">
            <span class="label-text" tal:condition="not field.hide_label|True">${field.label.text}</span>
            <span class="label-required" tal:condition="field.flags.required|nothing">*</span>
            <div class="long-field-help" tal:condition="long_description">
                <tal:b replace="long_description" />
            </div>

            <!--! The field is placed here -->
            <tal:b replace="content" />
        </tal:b>
    </tal:b>
</metal:single_field>

<metal:upload define-macro="upload" i18n:domain="onegov.org">
    <form action="${upload_url}" class="upload" method="POST" enctype="multipart/form-data">
        <div class="upload-dropzone dropzone" i18n:translate>
            Drop files to upload
        </div>

        <div class="upload-progress" metal:define-slot='upload-progress'></div>
        <div class="upload-filelist" metal:define-slot='upload-filelist'></div>

        <!--! fallback for integration tests -->
        <noscript>
            <input name="file" type="file" multiple />
            <input type="submit" value="Submit" class="button" i18n:attributes="value">
        </noscript>

    </form>
</metal:upload>

<metal:newslist define-macro="newslist" i18n:domain="onegov.org">
    <div class="newslist" tal:condition="news">
        <h2 i18n:translate tal:condition="not:hide_title|False">Latest news</h2>

        <div class="row">
            <div class="small-12 columns news-list-item" tal:repeat="item news">
                <hr>
                <div class="row">
                    <div class="small-12 medium-6 columns">
                        <div tal:condition="item.page_image and item.show_preview_image" style="width: 100%; padding-bottom: 50%; background-image: url(${item.page_image}); background-size: cover;"></div>
                    </div>
                </div>
                <a tal:attributes="href request.link(item)">
                    <h2 tal:condition="heading == 'h2'|True">${item.title} <metal:hint use-macro="layout.macros['access_hint']" />  <metal:hint use-macro="layout.macros['publication_hint']" /></h2>
                    <h3 tal:condition="heading == 'h3'|nothing">${item.title} <metal:hint use-macro="layout.macros['access_hint']" />  <metal:hint use-macro="layout.macros['publication_hint']" /></h3>
                </a>
                <p class="news-date" tal:condition="not:hide_date|False">${layout.format_date(item.published_or_created, 'relative')}</p>
                <p class="news-lead">${item.content.lead}</p>
            </div>
        </div>

        <h3 class="all-news" tal:condition="show_all_news_link|nothing">
            <a href="${layout.news_url}" i18n:translate>All news</a>
            <a tal:condition="layout.org.show_newsletter" href="${layout.newsletter_url}" i18n:translate>Newsletter</a>
        </h3>
    </div>
</metal:newslist>

<metal:access_hint define-macro="access_hint" i18n:domain="onegov.org">
    <tal:b tal:switch="item.access|False">
        <tal:b case="'private'">
            <i title="This site is private" i18n:attributes="title" class="private-hint"></i>
        </tal:b>
        <tal:b case="'member'">
            <i title="This site is private but can also be seen by members" i18n:attributes="title" class="member-hint"></i>
        </tal:b>
        <tal:b case="'mtan'">
            <i title="This site is public but requires submitting an mTAN" i18n:attributes="title" class="mtan-hint"></i>
        </tal:b>
        <tal:b case="'secret'">
            <i title="This site is secret" i18n:attributes="title" class="secret-hint"></i>
        </tal:b>
        <tal:b case="'secret_mtan'">
            <i title="This site is secret and requires submitting an mTAN" i18n:attributes="title" class="secret-mtan-hint"></i>
        </tal:b>
    </tal:b>
</metal:access_hint>

<metal:publication_hint define-macro="publication_hint" i18n:domain="onegov.org">
    <tal:b condition="not: item.published">
        <i title="This site is not published." i18n:attributes="title" class="unpublished-hint"></i>
    </tal:b>
</metal:publication_hint>

<metal:access_hint_long define-macro="access_hint_long" i18n:domain="onegov.org">
    <tal:b tal:switch="item.access|False">
        <tal:b tal:case="'private'">
            <div class="row">
                <div class="small-12 columns">
                    <div class="panel callout">
                        <p i18n:translate>
                            This site is not public.
                        </p>
                    </div>
                </div>
            </div>
        </tal:b>
        <tal:b tal:case="'member'">
            <div class="row">
                <div class="small-12 columns">
                    <div class="panel callout">
                        <p i18n:translate>
                            This site is not public but it can be seen by members.
                        </p>
                    </div>
                </div>
            </div>
        </tal:b>
    </tal:b>
</metal:access_hint_long>

<metal:publication_hint_long define-macro="publication_hint_long" i18n:domain="onegov.org">
    <tal:b condition="not: item.published">
        <div class="row">
            <div class="small-12 columns">
                <div class="panel callout">
                    <p i18n:translate>
                        This site is not published.
                    </p>
                </div>
            </div>
        </div>
    </tal:b>
</metal:publication_hint_long>

<metal:empty_lead_hint define-macro="empty_page_lead_hint" i18n:domain="onegov.org">
    <tal:b condition="not item.lead and request.is_manager|nothing">
        <div class="row">
            <div class="small-12 columns">
                <div class="panel callout">
                    <p i18n:translate>This site contains no lead. Leads are used for lists and search results.</p>
                </div>
            </div>
        </div>
    </tal:b>
</metal:empty_lead_hint>

<metal:page_content define-macro="page_content" i18n:domain="onegov.org">
    <div class="row" tal:define="show_side_panel show_side_panel|False; location location|False; files files|None">
        <tal:b condition="not: people or contact or coordinates or location or files or show_side_panel or sidepanel_links|False">
            <div class="small-12 columns page-content-main">
                <div class="row">
                    <div class="small-12 medium-6 columns">
                        <img class="page-image" tal:condition="page.page_image | None" src="${page.page_image}">
                    </div>
                </div>
                <div metal:define-slot="before-lead"></div>
                <span class="page-lead" tal:condition="lead" tal:content="lead" />
                <div metal:define-slot="after-lead"></div>

                <div class="page-text" tal:condition="text" tal:content="text" />
                <div metal:define-slot="after-text"></div>
            </div>
        </tal:b>
        <tal:b condition="people or contact or coordinates or files or show_side_panel or sidepanel_links|False">
            <div class="small-12 medium-8 columns page-content-main">
                <span class="page-lead" tal:condition="lead" tal:content="lead" />
                <div metal:define-slot="after-lead"></div>

                <div class="page-text" tal:condition="text" tal:content="text" />
                <div metal:define-slot="after-text"></div>
                <div class="people-panel" tal:condition="people and show_people_on_main_page" tal:define="show_people_on_main_page page.show_people_on_main_page|resource.show_people_on_main_page|False; western_name_order page.western_name_order|resource.western_name_order|False">
                    <h3 i18n:translate>People</h3>
                    <ul data-sortable data-sortable-url="${layout.move_person_url_template}">
                        <li tal:repeat="person people" class="person-card person-list-card" data-sortable-id="${request.is_manager and person.id}">
                            <div>
                                <a href="${request.link(person)}" aria-hidden="true" tal:define="url (person.picture_url and layout.thumbnail_url(person.picture_url))">
                                    <div class="person-card-portrait" style='${"border: 3px solid #DDDDDD;" if not url else ""}'>
                                        <i class="fa fa-user" tal:condition="not:url"></i>
                                        <div class="cover-image" style='background-image: url("${url}");'></div>
                                    </div>
                                </a>
                            </div>
                            <div class="with-lead" style="margin-top: .9rem">
                                <a href="${request.link(person)}" class="list-title">
                                    <b tal:condition="western_name_order">${person.first_name} ${person.last_name}</b>
                                    <span tal:condition="not western_name_order">${person.title}</span>
                                </a>
                                <a href="${request.link(person)}">
                                <p class="list-lead preview" tal:condition="person.context_specific_function" tal:content="escape(person.context_specific_function).replace('\n', Markup('<br />'))" />
                                </a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="small-12 medium-4 columns page-content-sidebar" tal:condition="people or contact or coordinates or files or show_side_panel or sidepanel_links|False" tal:define="highlight_contacts highlight_contacts|True">
                <div metal:define-slot="before-panels"></div>
                <div class="side-panel without-title ${highlight_contacts and 'highlighted'}" tal:condition="contact or coordinates or location" tal:define="hide page.hide_contact|False">
                        <tal:b condition="contact and not hide" content="contact" />
                    <br tal:condition="coordinates and contact" />
                    <h2 i18n:translate tal:condition="not contact">Map</h2>
                    <div tal:condition="coordinates" class="marker-map" data-map-type="thumbnail" data-lat="${coordinates.lat}" data-lon="${coordinates.lon}" data-zoom="${coordinates.zoom}" data-marker-icon="${marker_icon|nothing}" data-marker-color="${marker_color|nothing}"></div>
                    <div class="location" tal:condition="location">${location}</div>
                </div>
                <div class="side-panel files-panel" tal:condition="files and page.show_file_links_in_sidebar|True">
                    <h2 i18n:translate>Documents</h2>
                    <ul class="panel-links">
                        <li tal:repeat="file python: sorted(files, key=lambda f: f.name)">
                            <a title="${file.name}" href="${request.link(file)}">${file.name}</a>
                        </li>
                    </ul>
                </div>
                <div class="side-panel links-panel" tal:condition="sidepanel_links|False">
                    <h2 i18n:translate>Links</h2>
                    <ul class="panel-links">
                        <li tal:repeat="sl python: sorted(sidepanel_links, key=lambda sl: sl[0] if sl[0] else sl[1])">
                            <a class="list-link" title="${sl[0] if sl[0] else sl[1]}" href="${sl[1]}">
                                <span class="list-title">${sl[0] if sl[0] else sl[1]}</span>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="side-panel people-panel" tal:condition="people and not show_people_on_main_page" tal:define="show_people_on_main_page page.show_people_on_main_page|resource.show_people_on_main_page|False; western_name_order page.western_name_order|resource.western_name_order|False; collapsible len(people or []) > 3">
                    <h2 i18n:translate>People</h2>
                    <ul class="panel-links" data-sortable data-sortable-url="${layout.move_person_url_template}">
                        <li tal:repeat="person people" data-sortable-id="${request.is_manager and person.id}" class="${repeat.person.index > 2 and 'hidden hideable' or ''}">
                            <a tal:condition="western_name_order" href="${request.link(person)}">${person.first_name} ${person.last_name}</a>
                            <a tal:condition="not western_name_order" href="${request.link(person)}">${person.title}</a>
                            <small>${person.context_specific_function}</small>
                        </li>
                        <li tal:condition="collapsible" class="expand-people">
                            <a href="#">...</a>
                        </li>
                    </ul>
                </div>
                <div metal:define-slot="after-panels"></div>
            </div>
        </tal:b>
    </div>
</metal:page_content>

<metal:display_form define-macro="display_form" i18n:domain="onegov.org">
    <div tal:condition="form" tal:repeat="fieldset form.fieldsets">
        <tal:b define="fields fieldset.non_empty_fields" condition="fields">
            <metal:b use-macro="layout.macros['display_fields']" tal:define="fields fields.values()">
        </tal:b>
    </div>
    <tal:b tal:condition="invoice_items|nothing">
        <h2 i18n:translate>Invoice Items</h2>
        <tal:b metal:use-macro="layout.macros['invoice_items']" />
    </tal:b>
    <tal:b tal:condition="price|nothing">
        <dl class="field-display">
            <dt i18n:translate>Total Amount</dt>
            <dd><metal:b use-macro="layout.macros['price']" /></dd>
        </dl>
    </tal:b>
</metal:display_form>

<metal:display_field define-macro="display_fields" i18n:domain="onegov.org">
    <?python
        if fields:
            rendered_fields = ((f, form.render_display(f)) for f in fields)
            rendered_fields = ((f, rendered) for f, rendered in rendered_fields if rendered)

            rendered_fields = tuple(rendered_fields)
        else:
            rendered_fields = None
    ?>
    <h2 tal:condition="fieldset.is_visible and rendered_fields|nothing">${fieldset.label}</h2>

    <dl class="field-display" tal:repeat="(field, rendered) rendered_fields" tal:define="allow_downloads allow_downloads|request.is_manager; allow_views allow_views|False">
        <dt tal:condition="layout.show_label(field)">${field.label.text}</dt>
        <dd>
            <tal:b tal:switch="field.type" tal:condition="allow_downloads or allow_views">
                <tal:b tal:case="'UploadField'">
                        <tal:b tal:define="url layout.field_download_link(field)">
                        <a href="${url}" tal:condition="not allow_views or not field.is_image">
                            ${rendered}
                        </a>
                        <div tal:define="as_thumbnail 'thumbnail' in url|''" tal:condition="allow_views and field.is_image">
                            <img tal:condition="not: as_thumbnail" src="${url}" alt="" />
                            <div class="photoswipe" tal:define="image layout.field_file(field)" tal:condition="image and as_thumbnail">
                                <p class="has-img thumbnail">
                                    <img src="${url}" alt="${image.note}" data-full-width="${image.reference.size[0]}" data-full-height="${image.reference.size[1]}" />
                                </p>
                            </div>
                            <tal:b metal:use-macro="layout.macros.photoswipe" />
                        </div>

                    </tal:b>
                </tal:b>
                <tal:b tal:case="'UploadMultipleField'" tal:repeat="iter sorted(zip(field, rendered.split(Markup('<br>'))), key=lambda i: i[1])">
                    <tal:b tal:define="subfield iter[0];
                                       rendered iter[1];
                                       url layout.field_download_link(subfield);
                                       show_image allow_views and subfield.is_image">
                        <a href="${url}" tal:condition="not show_image">
                            ${rendered}
                        </a>
                        <br tal:condition="not show_image and not repeat.iter.end" />
                        <div tal:define="as_thumbnail 'thumbnail' in url|''" tal:condition="show_image">
                            <img tal:condition="not: as_thumbnail" src="${url}" alt="" />
                            <div class="photoswipe" tal:define="image layout.field_file(subfield)" tal:condition="image and as_thumbnail">
                                <p class="has-img thumbnail">
                                    <img src="${url}" alt="${image.note}" data-full-width="${image.reference.size[0]}" data-full-height="${image.reference.size[1]}" />
                                </p>
                            </div>
                            <tal:b metal:use-macro="layout.macros.photoswipe" />
                        </div>

                    </tal:b>
                </tal:b>
            </tal:b>
            <tal:b condition="not (allow_downloads or allow_views) or field.type not in ('UploadField', 'UploadMultipleField')" >
                <tal:b tal:condition="field.pricing|nothing">
                    <tal:b tal:define="is_value field.type in ('IntegerField', 'FloatField', 'DecimalField')">
                        ${rendered} <span tal:condition="is_value" i18n:translate="">Item(s)</span>
                    </tal:b>
                </tal:b>
                <tal:b tal:condition="not: field.pricing|nothing" tal:switch="linkify_display|False">
                    <tal:b tal:case="True" replace="layout.linkify_field(field, rendered)" />
                    <tal:b tal:case="False" replace="rendered" />
                </tal:b>
            </tal:b>
        </dd>
        <div class="clearfix"></div>
    </dl>
</metal:display_field>

<metal:directory_entry_submission define-macro="directory_entry_submission" i18n:domain="onegov.org">
    <h2 tal:condition="handler.kind == 'change-request'" i18n:translate>
        Change request
    </h2>

    <h2 tal:condition="handler.kind == 'new-entry'" i18n:translate>
        New Entry
    </h2>

    <div class="directory-entry-submission-summary" tal:condition="not: handler.deleted">
        <dl>
            <div>
                <dt i18n:translate>Directory</dt>
                <dd><a href="${request.link(handler.directory)}">${handler.directory.title}</a></dd>
            </div>

            <div tal:condition="handler.entry">
                <dt i18n:translate>Entry</dt>
                <dd><a href="${request.link(handler.entry)}">${handler.entry.title}</a></dd>
            </div>
        </dl>
    </div>

    <metal:b use-macro="layout.macros['display_form']" />
</metal:directory_entry_submission>

<metal:price define-macro="price" i18n:domain="onegov.org">
    <tal:b tal:define="show_fee show_fee|False; show_vat show_vat|False">
        ${layout.format_number(price.net_amount)} ${price.currency}
        <tal:b tal:condition="show_fee and price.fee">
            (+ ${layout.format_number(price.fee)} <tal:b i18n:translate>Credit Card Fee</tal:b>)
        </tal:b>
        <tal:b tal:define="vat_amount layout.get_vat_amount(price.amount); hide_vat_amount hide_vat_amount|False" tal:condition="show_vat and layout.vat_rate and vat_amount">
            <br>
            (<tal:b i18n:translate>VAT</tal:b> <tal:b i18n:translate><tal:b i18n:name="vat_rate">${layout.format_number(layout.vat_rate, 1)}</tal:b>% included</tal:b><tal:b tal:condition="not:hide_vat_amount">: ${layout.format_number(vat_amount, 2)} ${price.currency}</tal:b>)
        </tal:b>
    </tal:b>
</metal:price>

<metal:payment define-macro="payment" i18n:domain="onegov.org">
    <tal:b tal:define="show_fee show_fee|False" tal:condition="payment|nothing">
        <h2 i18n:translate>Payment</h2>
        <dl class="field-display">
            <dt i18n:translate>Total Amount</dt>
            <dd>${layout.format_number(payment.amount)} ${payment.currency}</dd>
        </dl>
        <dl class="field-display" tal:define="show_vat show_vat|False; vat_amount layout.get_vat_amount(payment.amount); hide_vat_amount hide_vat_amount|False" tal:condition="show_vat and layout.vat_rate and vat_amount">
            <dt i18n:translate>Value Added Tax</dt>
            <dd><tal:b i18n:translate><tal:b i18n:name="vat_rate">${layout.format_number(layout.vat_rate, 1)}</tal:b>% included</tal:b><tal:b tal:condition="not:hide_vat_amount">: ${layout.format_number(vat_amount, 2)} ${payment.currency}</tal:b></dd>
        </dl>
        <dl class="field-display">
            <dt i18n:translate>State</dt>
            <dd><tal:b metal:use-macro="layout.macros['payment_status']" /></dd>
        </dl>
        <dl class="field-display" tal:condition="not:show_fee">
            <dt i18n:translate>Payment Method</dt>
            <dd tal:switch="payment.source">
                <tal:b tal:case="'manual'" i18n:translate>Offline Payment</tal:b>
                <tal:b tal:case="default" i18n:translate>Online Payment</tal:b>
            </dd>
        </dl>
        <dl class="field-display" tal:condition="show_fee">
            <dt i18n:translate>Source</dt>
            <dd tal:switch="payment.source">
                <tal:b tal:case="'manual'" i18n:translate>Manual</tal:b>
                <tal:b tal:case="'datatrans'" i18n:translate>Datatrans</tal:b>
                <tal:b tal:case="'stripe_connect'" i18n:translate>Stripe Connect</tal:b>
                <tal:b tal:case="'worldline_saferpay'" i18n:translate>Worldline Saferpay</tal:b>
            </dd>
        </dl>
        <dl tal:condition="show_fee and payment.fee" class="field-display">
            <dt i18n:translate>Fee</dt>
            <dd>${layout.format_number(payment.fee)</dd>
        </dl>
    </tal:b>
</metal:payment>

<metal:person_card define-macro="person_list_card" i18n:domain="onegov.org">
    <div class="person-card person-list-card" tal:define="link request.link(person); exclude request.app.org.excluded_person_fields(request)">
        <a href="${link}" aria-hidden="true" tal:define="url (person.picture_url and layout.thumbnail_url(person.picture_url))">
            <div class="person-card-portrait">
                <i class="fa fa-user" tal:condition="not:url"></i>
                <div class="cover-image" tal:condition="url" style='background-image: url("${url}");'></div>
            </div>
        </a>
        <ul>
            <li class="person-card-title">
                <a href="${link}">
                    <span>${person.title}</span>
                </a>
            </li>
            <li tal:condition="person.function" class="person-card-function">
                <em>${person.function}</em>
            </li>
            <tal:b define="organisations organisations_as_dict(person)" tal:condition="'organisation' not in exclude">
                <li tal:repeat="top_organisation organisations.keys()" class="person-card-organisation">
                    <span tal:define="sub_organisations organisations[top_organisation]" i18n:attributes="title" title="Organisation">${top_organisation}${' - ' if sub_organisations else ''}${', '.join(sub_organisations)}</span>
                </li>
            </tal:b>
            <li tal:condition="person.email and 'email' not in exclude" class="person-card-email">
                <a href="mailto:${person.email}">${person.email}</a>
            </li>
            <li tal:condition="person.phone and 'phone' not in exclude" class="person-card-phone">
                <a href="tel:${layout.format_phone_number(person.phone)}">${layout.format_phone_number(person.phone)}</a>
            </li>
        </ul>
        <div class="clearfix"></div>
    </div>
</metal:person_card>

<metal:person_card define-macro="person_card" i18n:domain="onegov.org">
    <div class="person-card person-single-item" tal:define="exclude request.app.org.excluded_person_fields(request)">
        <div class="row">
            <div class="columns small-12 medium-4 large-3">
                <div aria-hidden="true" tal:define="url person.picture_url">
                    <div class="person-card-portrait">
                        <i class="fa fa-user" tal:condition="not:url"></i>
                        <div class="cover-image" tal:condition="url" style='background-image: url("${url}");'></div>
                    </div>
                </div>
            </div>
            <div class="columns small-12 medium-8 large-9">
                <ul>
                    <li tal:condition="person.function" class="person-card-function">
                        <em>${person.function}</em>
                    </li>
                    <tal:b define="organisations organisations_as_dict(person)" tal:condition="'organisation' not in exclude">
                        <li tal:repeat="top_organisation organisations.keys()" class="person-card-organisation">
                            <span tal:define="sub_organisations organisations[top_organisation]" i18n:attributes="title" title="Organisation">${top_organisation}${' - ' if sub_organisations else ''}${', '.join(sub_organisations)}</span>
                        </li>
                    </tal:b>
                    <li class="person-card-personal">
                        <span tal:condition="person.born and 'born' not in exclude">${person.born}</span>
                        <span tal:condition="person.academic_title and 'academic_title' not in exclude">${person.academic_title}</span>
                        <span tal:condition="person.profession and 'profession' not in exclude">${person.profession}</span>
                        <span tal:condition="person.political_party and 'political_party' not in exclude">${person.political_party}</span>
                        <span tal:condition="person.parliamentary_group and 'parliamentary_group' not in exclude">${person.parliamentary_group}</span>
                    </li>
                    <li tal:condition="person.location_address and 'location_address' not in exclude" class="person-card-address">
                        <span>${person.location_address}</span>
                    </li>
                    <li tal:condition="person.location_code_city and 'location_code_city' not in exclude" class="person-card-address">
                        <span>${person.location_code_city}</span>
                    </li>
                    <li tal:condition="person.postal_address and 'postal_address' not in exclude" class="person-card-address">
                        <span>${person.postal_address}</span>
                    </li>
                    <li tal:condition="person.postal_code_city and 'postal_code_city' not in exclude" class="person-card-address">
                        <span>${person.postal_code_city}</span>
                    </li>
                    <li tal:condition="person.email and 'email' not in exclude" class="person-card-email">
                        <a href="mailto:${person.email}">${person.email}</a>
                    </li>
                    <li tal:condition="person.phone and 'phone' not in exclude" class="person-card-phone">
                        <a href="tel:${layout.format_phone_number(person.phone)}">${layout.format_phone_number(person.phone)}</a>
                    </li>
                    <li tal:condition="person.phone_direct and 'phone_direct' not in exclude" class="person-card-phone-direct">
                        <a href="tel:${layout.format_phone_number(person.phone_direct)}">${layout.format_phone_number(person.phone_direct)}</a>
                    </li>
                    <li tal:condition="person.website and 'website' not in exclude" class="person-card-website">
                        <a href="${person.website}">${person.website}</a>
                    </li>
                    <li tal:condition="person.website_2 and 'website_2' not in exclude" class="person-card-website">
                        <a href="${person.website_2}">${person.website_2}</a>
                    </li>
                    <li class="person-card-notes" tal:condition="person.notes and 'notes' not in exclude">
                        <span>${person.notes}</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</metal:person_card>

<metal:sidebar define-macro="sidebar" i18n:domain="onegov.org">
    <nav role="navigation">
        <ul class="side-nav">
            <tal:b repeat="link layout.sidebar_links">
                <li tal:define="is_group hasattr(link, 'links')" class="${is_group and 'active' or ''}"  >
                    <tal:b condition="not:is_group" replace="link(layout)" />
                    <tal:b condition="is_group">
                        <a href="#" class="group-title">${link.title}
                            <metal:b use-macro="layout.macros['access_hint']" tal:define="item link"/>
                            <metal:b use-macro="layout.macros['publication_hint']" tal:define="item link.model"/>
                        </a>
                        <ul class="children" tal:condition="link.links">
                            <li tal:repeat="child link.links">
                                <tal:b replace="child(layout)" />
                            </li>
                        </ul>
                    </tal:b>
                </li>
            </tal:b>
        </ul>
    </nav>
</metal:sidebar>

<metal:ticket_status define-macro="ticket_status" i18n:domain="onegov.org">
    <div i18n:translate tal:condition="ticket.state == 'open'" class="ticket-state-open">
        Open
    </div>
    <div i18n:translate tal:condition="ticket.state == 'pending'" class="ticket-state-pending">
        Pending
    </div>
    <div i18n:translate tal:condition="ticket.state == 'closed'" class="ticket-state-closed">
        Closed
    </div>
    <div i18n:translate tal:condition="ticket.state == 'archived'" class="ticket-state-archived">
        Archived
    </div>
</metal:ticket_status>

<metal:payment_status define-macro="payment_status" i18n:domain="onegov.org">
    <div i18n:translate tal:condition="payment.state == 'open'" class="payment-state payment-state-open">
        Open
    </div>
    <div i18n:translate tal:condition="payment.state == 'paid'" class="payment-state payment-state-paid">
        Paid
    </div>
    <div i18n:translate tal:condition="payment.state == 'failed'" class="payment-state payment-state-failed">
        Failed
    </div>
    <div i18n:translate tal:condition="payment.state == 'cancelled'" class="payment-state payment-state-cancelled">
        Refunded
    </div>
    <div i18n:translate tal:condition="payment.state == 'invoiced'" class="payment-state payment-state-invoiced">
        Invoiced
    </div>
</metal:payment_status>

<metal:payment_source define-macro="payment_source" i18n:domain="onegov.org">
    <div i18n:translate tal:condition="payment.source == 'manual'">
        Manual
    </div>
    <div tal:condition="payment.source == 'datatrans'">
        <a href="${payment.remote_url}">
            Datatrans
        </a>
    </div>
    <div tal:condition="payment.source == 'stripe_connect'">
        <a href="${payment.remote_url}">
            Stripe Connect
        </a>
    </div>
    <div tal:condition="payment.source == 'worldline_saferpay'">
        <a href="${payment.remote_url}">
            Worldline Saferpay
        </a>
    </div>
</metal:payment_source>

<metal:ticket_callout define-macro="ticket_callout" i18n:domain="onegov.org">
    <div class="borderless-side-panel" tal:condition="ticket">
        <h2 i18n:translate>Ticket</h2>
        <div class="ticket-number"><a href="${request.link(ticket)}">${ticket.number}</a></div>
    </div>
</metal:ticket_callout>

<metal:pagination define-macro="pagination" i18n:domain="onegov.org">
    <ul class="pagination" role="menubar" aria-label="Pagination" tal:condition="collection.pages_count > 1">
        <tal:b repeat="page collection.pages">
            <tal:b define="
                previous current_page.previous;
                next current_page.next;
                is_current current_page == page;
                is_visible abs(current_page.page-page.page) < 6;
            ">
                <tal:b condition="repeat.page.start and previous">
                    <li class="arrow">
                        <a href="${request.link(previous)}" aria-label="Previous Page" i18n:attributes="aria-label"><i class="fa fa-chevron-left"></i></a>
                    </li>
                </tal:b>

                <li tal:condition="is_visible" class="${is_current and 'current' or ''}">
                    <a href="${request.link(page)}">${page.page + 1}</a>
                </li>

                <tal:b condition="repeat.page.end and next">
                    <li class="arrow">
                        <a href="${request.link(next)}" aria-label="Next Page" i18n:attributes="aria-label"><i class="fa fa-chevron-right"></i></a>
                    </li>
                </tal:b>
            </tal:b>
        </tal:b>
    </ul>
</metal:pagination>

<metal:reservations define-macro="reservation_infos" i18n:domain="onegov.org">
    <div tal:condition="reservation_infos" tal:define="failed failed_reservations|set()" class="reservation-selection large">
        <div class="reservation-selection-inner" tal:define="blocked blocked|set()">
            <ul>
                <li class="${(info.reservation.id in failed or info.reservation.id in blocked) and 'reservation failed' or 'reservation'}" tal:repeat="info reservation_infos">
                    <span class="reservation-date" data-quota="${info.reservation.quota}">
                        ${layout.format_date(info.reservation.display_start(), 'weekday_long')},
                        ${layout.format_date(info.reservation.display_start(), 'date_long')}
                        <span class="reservation-warning" title="${info.warning}" tal:condition="info.warning">
                            <i class="fa fa-clock-o" aria-hidden="true"></i>
                        </span>
                    </span>
                    <span class="reservation-time">
                        ${info.time}
                    </span>
                    <span class="reservation-price" tal:condition="info.price">
                        ${'{:.2f}'.format(info.price.amount)} ${info.price.currency}
                    </span>
                    <div class="reservation-denied" tal:condition="info.reservation.id in blocked">
                        <tal:b i18n:translate>
                            Persons living outside the following zipcodes may only reserve this
                            allocation on the <strong i18n:name="date">${layout.format_date(blocked[info.reservation.id], 'date_long')}</strong>:
                            <ol i18n:name="zipcodes">
                                <li tal:repeat="zipcode zipcodes">${zipcode}</li>
                            </ol>
                        </tal:b>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</metal:reservations>

<metal:reservations define-macro="reservations" i18n:domain="onegov.org">
    <ul tal:condition="reservations" tal:define="get_links get_links|None; get_occupancy_url get_occupancy_url|None" class="reservations">
        <li tal:repeat="reservation reservations" tal:attributes="class 'reservation' if get_links else None">
            <tal:b define="start reservation.display_start(); end reservation.display_end(); links get_links(reservation, request) if get_links else []; url get_occupancy_url(reservation, request) if get_occupancy_url else None">
                <div class="reservation-details" tal:omit-tag="not:links">
                    <a href="${url}" title="Occupancy" tal:omit-tag="not:url" i18n:attributes="title">
                        <strong>
                            ${layout.format_date(start, 'weekday_long')},
                            ${layout.format_date(start, 'date_long')}
                        </strong>
                    </a>
                    <!--! simple whole day check: -->
                    <span tal:condition="start.time() != end.time()">
                        <br>
                        ${layout.format_time_range(start, end)}
                    </span>
                    <br><span i18n:translate>Quota</span>
                    <span>
                        ${reservation.quota}
                    </span>
                </div>
                <div class="reservation-actions text-links" tal:condition="links">
                    <tal:b repeat="link links" content="link(layout)" />
                </div>
            </tal:b>
        </li>
    </ul>
</metal:reservations>

<metal:display_event define-macro="display_event" i18n:domain="onegov.org">
    <dl>
        <tal:b condition="request.is_manager">
            <dt i18n:translate>State</dt>
            <dd i18n:translate tal:condition="event.state == 'initiated'">Initiated</dd>
            <dd i18n:translate tal:condition="event.state == 'submitted'">Submitted</dd>
            <dd i18n:translate tal:condition="event.state == 'published'">Published</dd>
            <dd i18n:translate tal:condition="event.state == 'withdrawn'">Withdrawn</dd>

            <tal:b define="submitter event.meta.get('submitter_email') if event.meta else ''">
                <dt i18n:translate>Submitter</dt>
                <dd>${submitter}</dd>
            </tal:b>
        </tal:b>

        <dt i18n:translate>Title</dt>
        <dd>${event.title}</dd>

        <dt i18n:translate>Description</dt>
        <dd tal:content="escape(event.description).replace('\n', Markup('<br>'))" />

        <dt i18n:translate>List Preview</dt>
        <dd tal:define="occurrence event.latest_occurrence or event.virtual_occurrence; use_links False">
            <div class="row">
                <metal:b use-macro="layout.macros['occurrence_list_view']" />
            </div>
        </dd>

        <tal:b condition="event.image">
            <dt i18n:translate>Image</dt>
            <dd>
                <img src="${request.link(event.image)}">
            </dd>
        </tal:b>

        <tal:b condition="event.pdf">
            <dt i18n:translate>Additional Information</dt>
            <dd>
                <a href="${request.link(event.pdf)}">${event.pdf.name}</a>
            </dd>
        </tal:b>

        <dt i18n:translate>Location</dt>
        <dd>${event.location}</dd>

        <tal:b tal:condition="event.price">
            <dt i18n:translate>Price</dt>
            <dd tal:content="escape(event.price).replace('\n', Markup('<br>'))"></dd>
        </tal:b>

        <tal:b condition="event.coordinates">
            <dt i18n:translate>Map</dt>
            <dd>
                <div class="marker-map" data-map-type="thumbnail" data-lat="${event.coordinates.lat}" data-lon="${event.coordinates.lon}" data-zoom="${event.coordinates.zoom}"></div>
            </dd>
        </tal:b>

        <tal:b condition="event.organizer">
            <dt i18n:translate>Organizer</dt>
            <dd tal:content="event.organizer" />
        </tal:b>

        <tal:b condition="event.organizer_email">
            <dt i18n:translate>Organizer E-Mail address</dt>
            <dd><a href="mailto:${event.organizer_email}" tal:content="event.organizer_email" /></dd>
        </tal:b>

        <tal:b condition="event.organizer_phone">
            <dt i18n:translate>Organizer phone number</dt>
            <dd><a href="tel:${layout.format_phone_number(event.organizer_phone)}" tal:content="layout.format_phone_number(event.organizer_phone)" /></dd>
        </tal:b>

        <tal:b condition="event.tags and show_tags">
            <dt i18n:translate>Tags</dt>
            <dd>
                <ul class="no-margin-bottom">
                    <li tal:repeat="tag event.tags" i18n:translate>${tag}</li>
                </ul>
            </dd>
        </tal:b>

        <tal:b condition="event.filter_keywords and show_filters">
            <dt i18n:translate>Filters</dt>
            <dd>
                <ul tal:repeat="filter event.filter_keywords.items()" class="no-margin-bottom">
                    <li tal:condition="filter[1]">
                        <span>${filter[0].title()}:</span>
                        <span tal:define="tags ', '.join(f for f in filter[1])" tal:condition="isinstance (filter[1], list)" i18n:translate>${tags}</span>
                        <span tal:condition="not isinstance(filter[1], list) and filter[1]" i18n:translate>${filter[1]}</span>
                    </li>
                </ul>
            </dd>
        </tal:b>

        <dt i18n:translate>Date and time</dt>
        <dd>
            ${layout.format_datetime_range(event.localized_start, event.localized_end, with_year=True)}
        </dd>

        <!-- we can have reucrrences which we do not display, therefore we check the displayed value -->
        <tal:b define="recurrence event.recurrence and layout.format_recurrence(event.recurrence)" condition="recurrence">
            <dt i18n:translate>Recurrence</dt>
            <dd>${recurrence}</dd>
        </tal:b>

        <tal:b define="dates event.occurrence_dates(localize=True)" condition="len(dates) > 1">
            <dt i18n:translate>All dates</dt>
            <dd tal:define="occurrences event.occurrence_dates(localize=True)">
                <ul>
                    <li tal:repeat="occurrence occurrences">${layout.format_date(occurrence, 'weekday_long')} ${layout.format_date(occurrence, 'date')}</li>
                </ul>
            </dd>
        </tal:b>
    </dl>
</metal:display_event>

<metal:atoz define-macro="atoz" i18n:domain="onegov.org">
    <div class="atoz-block" tal:repeat="item items">
        <h2>${item[0]}</h2>
        <ul>
            <li tal:repeat="detail item[1]">
                <div metal:define-slot="item-detail">
                    <a href="${request.link(detail)}">${detail.title}</a>
                    <metal:hint tal:define="item detail" use-macro="layout.macros['access_hint']" />
                </div>
            </li>
        </ul>
    </div>
</metal:atoz>

<metal:calendar_day define-macro="calendar-day" i18n:domain="onegov.org">
    <h2 class="calendar-day">
        <metal:b use-macro="layout.macros['calendar-day-content']" />
    </h2>
</metal:calendar_day>

<metal:calendar_day_content define-macro="calendar-day-content" i18n:domain="onegov.org">
    <a href="${link|nothing}" tal:condition="image|nothing"
        class="calendar-day-thumbnail"
        style="background-image: url(${request.link(image, name='thumbnail')});">
    </a>

    <a href="${link|nothing}" tal:condition="not:image|nothing" class="calendar-day-thumbnail">
        <i class="fa fa-calendar-o" aria-hidden="true"></i>
    </a>

    <div class="calendar-day-date">
        <div class="weekday">${layout.format_date(date, 'weekday_short').rstrip('.')}</div>
        <div class="date">
            ${date.day}.
            <tal:b define="month layout.format_date(date, 'month_long')">
                <span class="long-month">${month}</span>
                <span class="short-month">${month[:3]}</span>
            </tal:b>
        </div>
    </div>
</metal:calendar_day_content>

<metal:occurrences define-macro="occurrences" i18n:domain="onegov.org">
    <tal:b repeat="occurrence occurrences">
        <div class="row">
            <metal:b use-macro="layout.macros['occurrence_list_view']" />
        </div>
    </tal:b>
    <tal:b condition="not occurrences" >
        <p i18n:translate>No events found.</p>
        <br><a tal:condition="'range' not in request.url" href="${no_event_link}" class="button hollow" i18n:translate>Past events</a>
    </tal:b>
</metal:occurrences>

<metal:occurrence_list_view define-macro="occurrence_list_view">
    <div class="occurrence" tal:define="use_links use_links|True">
        <div class="large-3 medium-4 small-5 columns calendar-day-column">
            <metal:b
                tal:define="
                    date occurrence.localized_start;
                    image occurrence.event.image;
                    link use_links and request.link(occurrence)
                "
                use-macro="layout.macros['calendar-day']"
            />
        </div>
        <div class="large-9 medium-8 small-7 columns calendar-text-column">
            <h3>
                <a href="${use_links and request.link(occurrence)}">${occurrence.title}</a>
                <metal:hint use-macro="layout.macros['access_hint']" tal:define="item occurrence" />
            </h3>
            <div class="occurrence-date show-for-sr">${layout.format_date(occurrence.localized_start, 'date')}</div>
            <div class="occurrence-location">${occurrence.location}</div>
            <div class="occurrence-time" tal:define="time layout.format_time_range(occurrence.localized_start, occurrence.localized_end)">
                ${time[0].upper()}${time[1:]}
            </div>
            <div tal:condition="occurrence.tags and show_tags" class="occurrence-tags" >
                <span tal:repeat="tag occurrence.tags" class="blank-label" i18n:translate>${tag}</span>
            </div>
            <div tal:condition="occurrence.filter_keywords and show_filters" class="occurrence-filter">
                <div tal:repeat="filter occurrence.filter_keywords_ordered().items()">
                    <span tal:condition="filter[1]" class="blank-label-description">${filter[0].title()}:</span>
                    <span tal:repeat="tag filter[1]" tal:condition="isinstance(filter[1], list)" class="blank-label">${tag}</span>
                    <span tal:condition="not isinstance(filter[1], list) and filter[1]" class="blank-label">${filter[1]}</span>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
</metal:occurrence_list_view>

<metal:date_range_selector define-macro="date-range-selector" i18n:domain="onegov.org">
    <div class="date-range-selector">
        <form action="" method="GET">
            <div metal:define-slot="before-date-range"></div>

            <div class="row date-range-selector">
                <div class="large-6 columns">
                    <div class="row collapse">
                        <label i18n:translate>From</label>
                        <input class="small" name="start" type="date" value="${start}" placeholder="${layout.today().isoformat()}">
                    </div>
                </div>
                <div class="large-6 columns">
                    <div class="row collapse">
                        <label i18n:translate>To</label>
                        <input class="small" name="end" type="date" value="${end}" placeholder="${layout.today().isoformat()}">
                    </div>
                </div>
            </div>
            <noscript>
                <div class="row">
                    <div class="large-6 columns">
                        <div class="row collapse">
                            <input type="submit" value="Filter by date" class="button" i18n:attributes="value">
                        </div>
                    </div>
                </div>
            </noscript>
        </form>
    </div>
</metal:date_range_selector>

<metal:role_singular define-macro="role-singular" i18n:domain="onegov.org">
    <tal:b switch="role">
        <tal:b case="'admin'" i18n:translate>Administrator</tal:b>
        <tal:b case="'editor'" i18n:translate>Editor</tal:b>
        <tal:b case="'supporter'" i18n:translate>Supporter</tal:b>
        <tal:b case="'member'" i18n:translate>Member</tal:b>
    </tal:b>
</metal:role_singular>

<metal:role_plural define-macro="role-plural" i18n:domain="onegov.org">
    <tal:b switch="role">
        <tal:b case="'admin'" i18n:translate>Administrators</tal:b>
        <tal:b case="'editor'" i18n:translate>Editors</tal:b>
        <tal:b case="'supporter'" i18n:translate>Supporters</tal:b>
        <tal:b case="'member'" i18n:translate>Members</tal:b>
    </tal:b>
</metal:role_plural>

<metal:user_source define-macro="user-source" i18n:domain="onegov.org">
    <tal:b switch="source">
        <tal:b case="'msal'">AzureAD</tal:b>
        <tal:b case="'ldap'">LDAP</tal:b>
        <tal:b case="'ldap_kerberos'">LDAP Kerberos</tal:b>
        <tal:b case="default" i18n:translate>${source}</tal:b>
    </tal:b>
</metal:user_source>

<metal:identicon define-macro="identicon" i18n:domain="onegov.org">
    <tal:b define="identicon_size size|'small'">
        <span class="user-initials-${identicon_size}" style="background-color: ${layout.get_user_color(username)}" title="${username}">
            ${initials}
        </span>
    </tal:b>
</metal:identicon>

<metal:photoswipe define-macro="photoswipe" i18n:domain="onegov.org">
    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="pswp__bg"></div>
        <div class="pswp__scroll-wrap">

            <div class="pswp__container">
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
            </div>

            <div class="pswp__ui pswp__ui--hidden">

                <div class="pswp__top-bar">

                    <div class="pswp__counter"></div>

                    <button class="pswp__button pswp__button--close" title="Close (Esc)" i18n:attributes="title"></button>
                    <button class="pswp__button pswp__button--share" title="Share" i18n:attributes="title"></button>
                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen" i18n:attributes="title"></button>
                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out" i18n:attributes="title"></button>

                    <div class="pswp__preloader">
                        <div class="pswp__preloader__icn">
                          <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                          </div>
                        </div>
                    </div>
                </div>

                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                    <div class="pswp__share-tooltip"></div>
                </div>

                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
                </button>

                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
                </button>

                <div class="pswp__caption">
                    <div class="pswp__caption__center"></div>
                </div>

            </div>
        </div>
    </div>
</metal:photoswipe>


<metal:slider define-macro="slider" i18n:domain="onegov.org">
    <ul tal:condition="images" class="slider" data-orbit="" data-options="slide_number:false; bullets:false; pause_on_hover:false; timer_speed: 7500;">
        <li tal:repeat="image images" style="background: url('${image.src}') no-repeat center;">
            <div class="orbit-caption" tal:condition="image.note">
                ${image.note}
            </div>
        </li>
    </ul>
    <div class="slider no-images" tal:condition="not images and request.is_manager">
        <tal:b i18n:translate>
            This space holds images from your photo-albums. To show photos add a few
            photos to an album and mark it as available for the homepage.
        </tal:b>
    </div>
</metal:slider>


<metal:search_result_users define-macro="search_result_users" i18n:domain="onegov.org">
    <a href="${request.return_here(request.link(result))}">${result.title} <metal:hint use-macro="layout.macros['access_hint']" tal:define="item result" /></a>
    <ul>
        <li>${translate(result.role.capitalize())}</li>
    </ul>
</metal:search_result_users>


<metal:search_result_files define-macro="search_result_files" i18n:domain="onegov.org">
    <a href="${request.return_here(request.link(result))}">${result.name} <metal:hint use-macro="layout.macros['access_hint']" tal:define="item result" /></a>
    <ul>
        <li>
            <tal:b condition="result.signed">
                <span i18n:translate>Has a digital seal</span>,
            </tal:b>
            <span>
                <tal:b i18n:translate tal:condition="result.stats.get('pages', 0) == 1">
                    <tal:b i18n:name="count">${result.stats.get('pages', 0)}</tal:b> page
                </tal:b>

                <tal:b i18n:translate tal:condition="result.stats.get('pages', 0) > 1">
                    <tal:b i18n:name="count">${result.stats.get('pages', 0)}</tal:b> pages
                </tal:b>
            </span>
        </li>
    </ul>
</metal:search_result_files>


<metal:search_result_tickets define-macro="search_result_tickets" i18n:domain="onegov.org">
    <a href="${request.link(result)}">${result.number} <i title="This site is private" i18n:attributes="title" class="private-hint"></i></a>
    <ul>
        <li>${translate(result.group)}</li>
        <li tal:content="result.title"></li>
        <li tal:content="result.subtitle"></li>
    </ul>
</metal:search_result_tickets>


<metal:search_result_events define-macro="search_result_events" i18n:domain="onegov.org">
    <a href="${request.link(result, 'latest')}">${result.title} <metal:hint use-macro="layout.macros['access_hint']" tal:define="item result" /></a>
    <ul tal:define="latest result.latest_occurrence">
        <li tal:condition="latest">
            ${
            '{}, {} - {}'.format(
                layout.format_date(latest.localized_start, 'event'),
                layout.format_date(latest.localized_start, 'time'),
                layout.format_date(latest.localized_end, 'time')
                )
            }
        </li>
        <li tal:condition="result.location">${result.location}</li>

        <tal:b tal:condition="future_occ" tal:define="future_occ result.future_occurrences(offset=1).all()">
            <li><span i18n:translate="">Further occurrences:</span>
                <div class="event-child-results">
                    <ul>
                        <tal:b tal:repeat="occ future_occ">
                            <li>
                                <a href="${request.link(occ)}">
                                    ${
                                    '{}, {} - {}'.format(
                                        layout.format_date(occ.localized_start, 'event'),
                                        layout.format_date(occ.localized_start, 'time'),
                                        layout.format_date(occ.localized_end, 'time')
                                        )
                                    }
                                </a>
                            </li>
                        </tal:b>
                    </ul>
                </div></li>
        </tal:b>
    </ul>
</metal:search_result_events>

<!--?<metal:search_result_event_occurrences define-macro="search_result_event_occurrences" i18n:domain="onegov.org">-->
<!--?    <a href="${request.link(occurrence)}">${occurrence.event.title}</a>-->
<!--?    <ul tal:define="location occurrence.event.location">-->
<!--?        <metal:b use-macro="layout.macros['occurrence_date']" />-->
<!--?        <li tal:condition="location">${location}</li>-->
<!--?    </ul>-->
<!--?</metal:search_result_event_occurrences>-->

<metal:search_result_people define-macro="search_result_people" i18n:domain="onegov.org">
    <a href="${request.link(result)}">${result.title} <metal:hint use-macro="layout.macros['access_hint']" tal:define="item result" /></a>
    <p tal:condition="result.function|nothing">${result.function}</p>
    <p tal:condition="not:result.function|nothing" i18n:translate>People</p>
</metal:search_result_people>


<metal:search_result_external_links define-macro="search_result_external_links" i18n:domain="onegov.org">
    <a href="${result.url}">${result.title} <metal:hint use-macro="layout.macros['access_hint']" tal:define="item result" /></a>
    <a class="edit-link" href="${request.link(result, name='edit')}" tal:condition="request.is_manager"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></a>
    <tal:b condition="result.lead">
        ${result.lead[:160]}<tal:b condition="len(result.lead) > 160">…</tal:b>
    </tal:b>
</metal:search_result_external_links>


<metal:search_result_default define-macro="search_result_default" i18n:domain="onegov.org">
    <a href="${request.link(result)}">${result.title} <metal:hint use-macro="layout.macros['access_hint']" tal:define="item result" /></a>
    <tal:b condition="result.lead">
        ${result.lead[:160]}<tal:b condition="len(result.lead) > 160">…</tal:b>
    </tal:b>
</metal:search_result_default>


<metal:ticket_status_page_message define-macro="ticket_status_page_message" i18n:domain="onegov.org" tal:define="mute_all request.app.org.mute_all_tickets; skip request.app.org.tickets_skip_opening_email or []">
    <tal:b tal:condition="ticket.state == 'open'">
        <tal:b tal:switch="not mute_all and ticket.handler_code in skip">
            <p tal:case="False" i18n:translate>
                Your request will be processed shortly. To see the state of
                your process your may return to this page at any time.

                All information on this page has been sent to your e-mail address.
            </p>
            <p tal:case="True" i18n:translate>
                Your request will be processed shortly. To see the state of
                your process your may return to this page at any time.
            </p>
        </tal:b>
    </tal:b>

    <p i18n:translate tal:condition="ticket.state == 'closed'">
        Your request has been completed.
    </p>
</metal:ticket_status_page_message>


<metal:checkout_form define-macro="checkout_form" i18n:domain="onegov.org">
    <form action="${complete_link}" method="POST" class="checkout">
        <dl class="field-display" tal:condition="show_privacy_settings|nothing">
            <dt i18n:translate>Privacy</dt>
            <dd>
                <label class="common-text">
                    <input type="checkbox" name="send_by_email" value="yes" checked>
                    <span class="label-text" i18n:translate style="max-width: 100%">
                        Send me my entered data by e-mail.
                    </span>
                </label>
            </dd>
        </dl>

        <tal:b condition="price" switch="'cc' if price.credit_card_payment else payment_method">
            <tal:b case="'manual'">
                <label style="display: none;">
                    <input type="radio" name="payment_method" value="manual" checked>
                </label>
            </tal:b>
            <tal:b case="'cc'">
                <label style="display: none;">
                    <input type="radio" name="payment_method" value="online" checked>
                </label>
            </tal:b>
            <tal:b case="'free'">
                <div class="field-display">
                    <div class="field-display-block">
                        <div class="field-display-label" i18n:translate>Payment</div>
                        <div class="field-display-data">
                            <label class="common-text">
                                <input type="radio" name="payment_method" value="online" checked>
                                <span>
                                    <tal:b i18n:translate>Pay Online Now</tal:b>
                                    <tal:b tal:condition="price.fee|nothing">
                                        (+ ${layout.format_number(price.fee)} ${price.currency} <tal:b i18n:translate>Credit Card Fee</tal:b>)
                                    </tal:b>
                                </span>
                            </label>
                            <label class="common-text">
                                <input type="radio" name="payment_method" value="manual">
                                <span i18n:translate>Pay Offline later</span>
                            </label>
                        </div>
                    </div>
                </div>
            </tal:b>

            <div data-depends-on="payment_method/online">
                <tal:b replace="checkout_button" />
                <metal:b define-slot="after-submit" />
            </div>
            <div data-depends-on="payment_method/manual">
                <input type="submit" value="Complete" class="button" i18n:attributes="value">
                <metal:b define-slot="after-submit" />
            </div>
        </tal:b>

        <tal:b condition="not price">
            <input type="submit" value="Complete" class="button" i18n:attributes="value">
            <metal:b define-slot="after-submit" />
        </tal:b>
    </form>
</metal:checkout_form>

<metal:tags define-macro="tags">
    <ul class="tags">
        <li tal:repeat="link tags" class="click-through">
            <span tal:content="link(layout)"
                class="${link.active and 'active'} blank-label ${getattr(link, 'rounded', None) and 'rounded'}"
            />
        </li>
    </ul>
</metal:tags>

<metal:tags_collapsed i18n:domain="onegov.org" define-macro="tags_collapsed">
    <tal:b tal:switch="len(tags) >= 15">
        <tal:b tal:case="False">
            <ul class="tags">
                <li tal:repeat="link tags" class="click-through">
                    <span tal:content="link(layout)"
                        class="${link.active and 'active'} blank-label ${getattr(link, 'rounded', None) and 'rounded'}"
                    />
                </li>
            </ul>
        </tal:b>
        <tal:b tal:case="True">
                <tal:b define="tags_start tags[:12]; tags_rest tags[12:]">
                <ul class="tags">
                    <li tal:repeat="link tags_start" class="click-through">
                        <span tal:content="link(layout)"
                            class="${link.active and 'active'} blank-label ${getattr(link, 'rounded', None) and 'rounded'}"
                        />
                    </li>
                </ul>
                <ul class="accordion" data-accordion tal:condition="len(tags_rest)">
                    <li class="accordion-navigation">
                        <a class="more-items" href="#panel-${filters.index(filter)}"><tal:b i18n:translate>Show more</tal:b> <i class="fa fa-chevron-down"></i></a>
                        <div id="panel-${filters.index(filter)}" class="content">
                            <ul class="tags">
                                <li tal:repeat="link tags_rest" class="click-through">
                                    <span tal:content="link(layout)"
                                        class="${link.active and 'active'} blank-label ${getattr(link, 'rounded', None) and 'rounded'}"
                                    />
                                </li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </tal:b>
        </tal:b>
    </tal:b>

</metal:tags_collapsed>

<metal:generic_message define-macro="generic_message" i18n:domain="onegov.org">
    <div class="title">
        <metal:b define-slot="title" />
    </div>
    <div class="identicon">
        <metal:b use-macro="layout.macros.identicon"
                 tal:define="
                    initials owner.initials if not layout.org.hide_personal_email or model.meta.get('origin') == 'external' or request.is_logged_in else layout.org.general_email[0];
                    username owner.username if not layout.org.hide_personal_email or model.meta.get('origin') == 'external' or request.is_logged_in else layout.org.general_email;
                    size 'large';
                "
        />
    </div>
    <div class="timestamp">
        <b>${owner.name if not layout.org.hide_personal_email or model.meta.get('origin') == 'external' or request.is_logged_in else layout.org.general_email}</b>
        <tal:b i18n:translate>
            at <tal:b i18n:name="time">${layout.format_date(model.created, 'time')}</tal:b>
        </tal:b>
    </div>
    <div class="text">
        <metal:b define-slot="text" />
    </div>
    <div class="file" tal:condition="model.file">
        <a href="${request.link(model.file)}">${model.file.name}</a>
    </div>
    <div class="actions">
        <metal:b define-slot="actions" />
    </div>
</metal:generic_message>

<metal:payments define-macro="payments" i18n:domain="onegov.org">
    <table class="payments-table" tal:condition="payments">
        <thead>
            <tr>
                <th class="select-all-checkbox-cell">
                    <input type="checkbox" aria-label="Select all payments" />
                </th>
                <th i18n:translate tal:condition="tickets|nothing">
                    Object
                </th>
                <th i18n:translate tal:condition="reservation_dates_formatted|nothing">
                    Reservation
                </th>
                <th i18n:translate>
                    Net Amount
                </th>
                <th i18n:translate>
                    Fee
                </th>
                <th i18n:translate>
                    Payment Provider
                </th>
                <th i18n:translate>
                    State
                </th>
                <th i18n:translate>
                    Created
                </th>
                <th i18n:translate>
                    Disbursed
                </th>
                <th tal:condition="payment_actions|nothing"></th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="payment payments">
                <td class="payment-checkbox-cell">
                    <input type="checkbox" name="selected_payments" value="${payment.id}" aria-label="Select this payment" i18n:attributes="aria-label" />
                </td>
                <td tal:condition="tickets|nothing">
                    <tal:b define="ticket tickets[payment.id]|nothing">
                        <div tal:condition="ticket">
                            <a tal:condition="ticket" href="${request.link(ticket)}">
                                <strong>${ticket.number}</strong> - ${ticket.group}
                            </a>
                            <tal:b tal:switch="ticket.handler_code">
                                <div tal:case="'RSV'">
                                    ${ticket.ticket_email}
                                </div>
                                <div tal:case="default">
                                    ${ticket.title}
                                </div>
                            </tal:b>
                        </div>
                    </tal:b>
                </td>
                <!-- Cell for Reservation Dates -->
                <td tal:condition="reservation_dates_formatted|nothing">
                    <span tal:replace="reservation_dates_formatted.get(payment.id, '')" />
                </td>
                <td>${'{0:.2f}'.format(payment.net_amount)} ${payment.currency}</td>
                <td>
                    <tal:b condition="payment.fee|nothing">
                        + ${'{0:.2f}'.format(payment.fee)} ${payment.currency}
                    </tal:b>
                </td>
                <td>
                    <span tal:condition="payment.provider_id">
                        ${providers[payment.provider_id].title}
                    </span>
                    <span tal:condition="not:payment.provider" i18n:translate>
                        Manual
                    </span>
                </td>
                <td>
                    <metal:b use-macro="layout.macros['payment_status']" />
                </td>
                <td>
                    ${layout.format_date(payment.created, 'datetime')}
                </td>
                <td>
                    <tal:b condition="payment.payout_date|nothing">
                        ${layout.format_date(payment.payout_date, 'date')}
                    </tal:b>
                </td>
                <td tal:condition="payment_actions|nothing" class="text-links">
                    <tal:b repeat="link payment_actions(payment)">
                        <tal:b replace="link(layout)" />
                    </tal:b>
                </td>
            </tr>
        </tbody>
    </table>
</metal:payments>

<metal:invoices define-macro="invoices" i18n:domain="onegov.org">
    <table class="invoices-table" tal:condition="invoices">
        <thead>
            <tr>
                <th class="select-all-checkbox-cell">
                    <input type="checkbox" aria-label="Select all invoices" />
                </th>
                <th i18n:translate>
                    Object
                </th>
                <th i18n:translate tal:condition="reservation_dates_formatted|nothing">
                    Reservation
                </th>
                <th i18n:translate>
                    Net Amount
                </th>
                <th i18n:translate>
                    Invoiced
                </th>
                <th i18n:translate>
                    Paid
                </th>
                <th i18n:translate>
                    Created
                </th>
                <th tal:condition="invoice_actions|nothing"></th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="invoice invoices" class="${'' if invoice.invoiced else 'un'}invoiced ${'' if invoice.paid else 'un'}paid">
                <td class="invoice-checkbox-cell">
                    <input type="checkbox" name="selected_invoices" value="${invoice.id}" aria-label="Select this invoice" i18n:attributes="aria-label" />
                </td>
                <td>
                    <div>
                        <a href="${request.link(invoice.ticket)}">
                            <strong>${invoice.ticket.number}</strong> - ${invoice.ticket.group}
                        </a>
                        <tal:b tal:switch="invoice.ticket.handler_code">
                            <div tal:case="'RSV'">
                                ${invoice.ticket.ticket_email}
                            </div>
                            <div tal:case="default">
                                ${invoice.ticket.title}
                            </div>
                        </tal:b>
                    </div>
                </td>
                <!-- Cell for Reservation Dates -->
                <td tal:condition="reservation_dates_formatted|nothing">
                    <span tal:replace="reservation_dates_formatted.get(invoice.id, '')" />
                </td>
                <td>${'{0:.2f}'.format(invoice.total_amount)}</td>
                <td class="invoiced-state">
                    <tal:b tal:condition="invoice.invoiced">
                        <i class="fa fa-check-circle" aria-hidden="true" title="Invoiced" i18n:attributes="title"></i>
                        <span i18n:translate class="show-for-sr">Invoiced</span>
                    </tal:b>
                    <tal:b tal:condition="not:invoice.invoiced">
                        <i class="fa fa-times-circle" aria-hidden="true" title="Uninvoiced" i18n:attributes="title"></i>
                        <span i18n:translate class="show-for-sr">Uninvoiced</span>
                    </tal:b>
                </td>
                <td class="paid-state">
                    <tal:b tal:condition="invoice.paid">
                        <i class="fa fa-check-circle" aria-hidden="true" title="Paid" i18n:attributes="title"></i>
                        <span i18n:translate class="show-for-sr">Paid</span>
                    </tal:b>
                    <tal:b tal:condition="not:invoice.paid">
                        <i class="fa fa-times-circle" aria-hidden="true" title="Unpaid" i18n:attributes="title"></i>
                        <span i18n:translate class="show-for-sr">Unpaid</span>
                    </tal:b>
                </td>
                <td>
                    ${layout.format_date(invoice.ticket.created, 'datetime')}
                </td>
                <td tal:condition="invoice_actions|nothing" class="text-links">
                    <tal:b repeat="link invoice_actions(invoice)">
                        <tal:b replace="link(layout)" />
                    </tal:b>
                </td>
            </tr>
        </tbody>
    </table>
</metal:invoices>

<metal:directory_error define-macro="directory_error" i18n:domain="onegov.org">
    <ul class="dense">
        <li tal:repeat="(field_id, messages) error.errors.items()">
            <div tal:condition="error.link|nothing">
                <strong><a href="${error.link}">${error.entry.title}</a></strong>
            </div>
            <div tal:condition="not:error.link|nothing">
                <strong>${error.entry.title}</strong>
            </div>
            <div>
                ${directory.field_by_id(field_id).human_id}: ${error_translate(' '.join(messages))}
            </div>
        </li>
    </ul>
</metal:directory_error>

<metal:group_by_column define-macro="group_by_column" i18n:domain="onegov.org">
    <tal:b repeat="group grouped" tal:define="link_func link_func|request.link; add_pagerefs add_pagerefs|False">
        <h2 tal:condition="len(grouped) > 1" id="${group}">
            ${group}
            <metal:b tal:condition="add_pagerefs" use-macro="layout.macros['pageref']" tal:define="pageref_id group" />
        </h2>

        <ul class="with-lead">
            <tal:block tal:repeat="record grouped[group]">
                <metal:b use-macro="layout.macros['group_record']"/>
            </tal:block>
        </ul>
    </tal:b>
</metal:group_by_column>

<metal:group_record define-macro="group_record" i18n:domain="onegov.org">
    <li tal:define="link edit_link(record)|nothing">
        <a class="list-title" tal:attributes="href link_func(record)">
            ${record.title}
        </a>
        <metal:hint use-macro="layout.macros['access_hint']" tal:define="item record" />
        <a class="edit-link" href="${link}" tal:condition="link"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></a>
        <div class="list-lead" tal:define="lead lead_func(record)|layout.linkify(record.meta.get('lead'))"
            tal:content="lead">
        </div>
        <div class="list-hint hints" tal:define="hint hint(record)|False"
            tal:content="hint" tal:condition="hint">
        </div>
    </li>
</metal:group_record>

<metal:resource_groups define-macro="resource_groups" i18n:domain="onegov.org">
    <tal:b repeat="group resources" tal:define="link_func link_func|request.link; add_pagerefs add_pagerefs|False">
        <h2 tal:condition="len(resources) > 1" id="${group.title}">
            ${group.title}
            <metal:b tal:condition="add_pagerefs" use-macro="layout.macros['pageref']" tal:define="pageref_id group.title" />
            <span tal:condition="group.find_your_spot" i18n:attributes="title" class="find-your-spot-link" data-tooltip aria-haspopup="true" class="has-tip" title="Find Your Spot">
                <a tal:attributes="href link_func(group.find_your_spot)"><i class="fa fa-calendar"></i></a>
            </span>
        </h2>

        <ul class="with-lead">
            <tal:b tal:repeat="record group.entries" tal:switch="record.__class__.__name__">
                <li tal:case="'ResourceSubgroup'">
                    <metal:b tal:define="subgroup record" use-macro="layout.macros['resource_subgroup']"/>
                </li>
                <metal:b tal:case="default" use-macro="layout.macros['group_record']"/>
            </tal:b>
        </ul>
    </tal:b>
</metal:resource_groups>

<metal:resource_subgroup define-macro="resource_subgroup" i18n:domain="onegov.org">
    <tal:b tal:define="pageref_id f'{group.title}-{subgroup.title}'">
        <h5 id="${pageref_id}">
            ${subgroup.title}
            <metal:b tal:condition="add_pagerefs" use-macro="layout.macros['pageref']" />
            <span tal:condition="subgroup.find_your_spot" i18n:attributes="title" class="find-your-spot-link" data-tooltip aria-haspopup="true" class="has-tip" title="Find Your Spot">
                <a tal:attributes="href link_func(subgroup.find_your_spot)"><i class="fa fa-calendar"></i></a>
            </span>
        </h5>

        <ul class="with-lead">
            <tal:b tal:repeat="record subgroup.entries">
                <metal:b use-macro="layout.macros['group_record']"/>
            </tal:b>
        </ul>
    </tal:b>
</metal:resource_subgroup>

<metal:file_details define-macro="file-details" i18n:domain="onegov.org">
    <div class="row">
        <div class="columns small-4">
            <a class="file-preview" href="${request.link(file)}" tal:condition="extension == 'pdf'" tal:attributes="target layout.file_link_target">
                <img class="pdf-preview" src="${request.link(file, name='medium')}">
            </a>
            <a class="file-preview" href="${request.link(file)}" tal:condition="extension != 'pdf'" tal:attributes="target layout.file_link_target">
                <svg width="204px" height="261px" viewBox="0 0 204 261" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="position:relative; left: -6px;">
                    <defs>
                        <filter x="-7.8%" y="-5.9%" width="120.0%" height="115.3%" filterUnits="objectBoundingBox" id="filter-1">
                            <feOffset dx="4" dy="4" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>
                            <feGaussianBlur stdDeviation="5" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>
                            <feColorMatrix values="0 0 0 0 0.392156863   0 0 0 0 0.392156863   0 0 0 0 0.392156863  0 0 0 0.4 0" type="matrix" in="shadowBlurOuter1" result="shadowMatrixOuter1"></feColorMatrix>
                            <feMerge>
                                <feMergeNode in="shadowMatrixOuter1"></feMergeNode>
                                <feMergeNode in="SourceGraphic"></feMergeNode>
                            </feMerge>
                        </filter>
                        <path d="M180,55.8004032 L180,233.892177 C180,235.962291 178.328034,237.640449 176.26556,237.640449 L3.73443983,237.640449 C1.67196566,237.640449 0,235.962291 0,233.892177 L0,3.74827207 C0,1.67815857 1.67196566,0 3.73443983,0 L124.368614,7.10542736e-15 C127.027185,1.13396268e-14 129.576325,1.05864997 131.452741,2.94201554 L177.084127,48.7424188 C178.9515,50.6167086 180,53.1546434 180,55.8004032 Z" id="path-2"></path>
                        <path d="M180,55.8004032 L180,233.892177 C180,235.962291 178.328034,237.640449 176.26556,237.640449 L3.73443983,237.640449 C1.67196566,237.640449 0,235.962291 0,233.892177 L0,3.74827207 C0,1.67815857 1.67196566,0 3.73443983,0 L124.368614,7.10542736e-15 C127.027185,1.13396268e-14 129.576325,1.05864997 131.452741,2.94201554 L177.084127,48.7424188 C178.9515,50.6167086 180,53.1546434 180,55.8004032 Z" id="path-4"></path>
                    </defs>
                    <g id="Artboard" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <g id="Group" filter="url(#filter-1)" transform="translate(7.000000, 7.000000)">
                            <g id="Page">
                                <mask id="mask-3" fill="white">
                                    <use xlink:href="#path-2"></use>
                                </mask>
                                <use id="Mask" stroke="#DDDDDD" stroke-width="2" fill="#F7F8F8" fill-rule="nonzero" xlink:href="#path-2"></use>
                                <rect id="Corner" fill="#DDDDDD" mask="url(#mask-3)" x="127.717842" y="-3.74827207" width="56.0165975" height="56.2240811" rx="4"></rect>
                            </g>
                            <mask id="mask-5" fill="white">
                                <use xlink:href="#path-4"></use>
                            </mask>
                            <use id="Mask" stroke="#DDDDDD" stroke-width="2" fill="#F7F8F8" fill-rule="nonzero" xlink:href="#path-4"></use>
                            <rect id="Corner" fill="#DDDDDD" mask="url(#mask-5)" x="128.426966" y="-5.05617978" width="55.6179775" height="56.6292135" rx="4"></rect>
                            <path d="M-0.0112359551,167.853933 L-0.0112359551,233.651685 C-0.0112359551,235.860824 1.77962505,237.651685 3.98876404,237.651685 L176.011236,237.651685 C178.220375,237.651685 180.011236,235.860824 180.011236,233.651685 L180.011236,167.853933 L-0.0112359551,167.853933 Z" id="Banner" stroke="#DDDDDD" stroke-width="2" fill="${color}" mask="url(#mask-5)"></path>
                            <text id="PDF" mask="url(#mask-5)" font-family="OpenSans-Bold, Open Sans, Helvetica Neue, Arial, sans-serif" font-size="41" font-weight="bold" fill="#FFFFFF" text-anchor="middle" y="216" x="44.5%">${extension.upper()}</text>
                        </g>
                    </g>
                </svg>
            </a>
        </div>
        <div class="columns small-6 file-status">

            <tal:b condition="request.app.enable_yubikey and file.reference['content_type'] == 'application/pdf'">
                <h3 i18n:translate>Digital seal</h3>
                <div class="signature">
                    <div class="file-status-tag">
                        <metal:b use-macro="layout.macros['signature_status']" />
                    </div>
                </div>
            </tal:b>

            <tal:block tal:condition="not: hide_publication|False">
                <h3 i18n:translate>Access</h3>
                <div class="publication" tal:define="
                    post_url layout.csrf_protected_url(request.link(file, name='update-publish-date'));
                    publish_date file.publish_date and layout.to_timezone(file.publish_date, layout.timezone);"
                    >
                    <div tal:condition="file.published" class="file-status-tag">
                        <a ic-post-to="${layout.csrf_protected_url(request.link(file, name='unpublish'))}"
                           ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))"
                           class="is-published">
                            <i class="fa fa-fw fa-check-circle" aria-hidden="true"></i> <span i18n:translate>Public</span>
                        </a>
                    </div>
                    <div tal:condition="not:file.published" class="file-status-tag">
                        <a ic-post-to="${layout.csrf_protected_url(request.link(file, name='publish'))}"
                           ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))"
                           class="is-not-published">
                            <i class="fa fa-fw fa-eye-slash" aria-hidden="true"></i> <span i18n:translate>Private</span>
                        </a>
                    </div>

                    <div class="publication-settings ${publish_date and 'publication-date-set' or 'publication-date-not-set'}" tal:condition="not:file.published">
                        <form method="POST">
                            <fieldset>
                                <legend tal:condition="publish_date" i18n:translate>Will be published on:</legend>
                                <legend tal:condition="not:publish_date" i18n:translate>Publication date:</legend>

                                <div class="publication-settings-input">
                                    <input type="date" name="date" class="small" ic-post-to="${post_url}" ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))" value="${publish_date and publish_date.date().isoformat() or ''}" required="required">

                                    <select name="hour" ic-post-to="${post_url}" ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))">
                                        <option tal:condition="not:publish_date"></option>
                                        <tal:b repeat="hour range(24)" tal:define="publish_time publish_date and '{:0>2}:00'.format(publish_date.hour)">
                                            <option tal:define="time '{:0>2}:00'.format(hour)" tal:attributes="selected publish_time == time" value="${time}">${time}</option>
                                        </tal:b>
                                    </select>

                                    <a ic-post-to="${post_url}&clear=1" ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))">
                                        <i class="fa fa-times-circle" aria-hidden="true"></i>
                                        <span class="show-for-sr" i18n:translate>Reset</span>
                                    </a>
                                </div>
                            </fieldset>
                        </form>
                    </div>
                </div>

                <h3 i18n:translate>Publication</h3>
                <div class="publication" tal:define="
                    post_url layout.csrf_protected_url(request.link(file, name='update-publish-date'));
                    publish_date file.publish_date and layout.to_timezone(file.publish_date, layout.timezone);"
                    >
                    <div tal:condition="file.publication" class="file-status-tag">
                        <a ic-post-to="${layout.csrf_protected_url(request.link(file, name='toggle-publication'))}"
                           ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))"
                           class="is-a-publication">
                            <i class="fa fa-fw fa-check-circle" aria-hidden="true"></i> <span i18n:translate>Publication</span>
                        </a>
                    </div>
                    <div tal:condition="not:file.publication" class="file-status-tag">
                        <a ic-post-to="${layout.csrf_protected_url(request.link(file, name='toggle-publication'))}"
                           ic-on-success="Intercooler.triggerRequest($(elt).closest('[ic-get-from]'))"
                           class="is-not-a-publication">
                            <i class="fa fa-fw fa-times-circle" aria-hidden="true"></i> <span i18n:translate>Not a publication</span>
                        </a>
                    </div>
                </div>
            </tal:block>

            <tal:b condition="file.reference['content_type'] == 'application/pdf'">
                <h3 i18n:translate>Content</h3>
                <div class="file-content">
                    <div class="file-status-tag">
                        <div tal:condition="file.stats.get('pages', 0) <= 1">
                            <i class="fa fa-fw fa-file-text-o" aria-hidden="true"></i>
                            <span i18n:translate>1 page</span>
                        </div>
                        <div tal:condition="file.stats.get('pages', 0) > 1">
                            <i class="fa fa-fw fa-file-text-o" aria-hidden="true"></i>
                            <span i18n:translate><tal:b i18n:name="count">${file.stats.get('pages', 0)}</tal:b> pages</span>
                        </div>
                        <div tal:define="words file.stats.get('words', 0)">
                            <tal:b condition="words == 0">
                                <i class="fa fa-fw fa-exclamation-triangle" aria-hidden="true"></i>
                                <span i18n:translate>Contains no readable text</span>
                            </tal:b>
                            <tal:b condition="words == 1">
                                <i class="fa fa-fw fa-font" aria-hidden="true"></i>
                                <span i18n:translate>1 word</span>
                            </tal:b>
                            <tal:b condition="words > 1">
                                <i class="fa fa-fw fa-font" aria-hidden="true"></i>
                                <span i18n:translate><tal:b i18n:name="count">${words}</tal:b> words</span>
                            </tal:b>
                        </div>
                    </div>
                </div>
            </tal:b>
        </div>
        <div class="columns small-2 file-actions">
            <a class="button secondary confirm delete" role="button"
                ic-delete-from="${request.link(file)}?csrf-token=${layout.csrf_token}"
                ic-on-success="
                    var info = $(elt).closest('tr');
                    info.prev().remove();
                    info.remove();
                "
                data-confirm="Do you really want to delete this file?"
                data-confirm-extra="${file.name}"
                data-confirm-yes="Delete File"
                data-confirm-no="Cancel"
                i18n:attributes="data-confirm;data-confirm-yes;data-confirm-no">
                <span class="fa fa-trash" aria-hidden="true"></span>
                <span i18n:translate >Delete</span>
            </a>
            <a class="button secondary rename prompt" role="button"
                data-prompt="Please provide the new name for the file"
                data-prompt-ok="Rename"
                data-prompt-cancel="Cancel"
                data-prompt-value="${file.name}"
                data-prompt-success="(function(value) {
                    var url = '${request.link(file, 'rename')}?csrf-token=${layout.csrf_token}';
                    var ext = '.${file.name.split('.')[-1].strip()}';
                    var elt = $(this);

                    value = value.substring(value.length - ext.length, value.length) === ext && value || value + ext;

                    jQuery.post(url, {'name': value}, function() {
                        var actions = elt;

                        actions.closest('tr').prev().find('td:first').text(value);
                        actions.find('a.prompt').data('prompt-value', value);
                        actions.find('a.delete').data('confirm-extra', value);
                    });
                })"
                i18n:attributes="data-prompt;data-prompt-ok;data-prompt-cancel">
                <span class="fa fa-edit" aria-hidden="true"></span>
                <span i18n:translate>Rename</span>
            </a>
            <a class="button secondary" role="button" href="${request.link(file)}">
                <span class="fa fa-download" aria-hidden="true"></span>
                <span i18n:translate>Download</span>
           </a>
            <a class="button secondary" role="button"
               ic-get-from="${request.link(file, 'links')}"
               ic-target="#links-${id}"
               ic-on-success="
                   var modal = $('#links-${id}-modal');
                   modal.foundation('reveal', 'open');
                   modal.focus();
               ">
                <span class="fa fa-link" aria-hidden="true"></span>
                <span i18n:translate>Linked Pages</span>
                <span class="ic-indicator fa fa-spinner fa-spin" style="display: none"></span>
           </a>
        </div>
    </div>
    <div style="display:none;">
        <div id="links-${id}-modal" class="reveal-modal medium dialog" data-reveal role="dialog" aria-hidden="true">
            <h2 i18n:translate>Links to <tal:b i18n:name="filename">${file.name}</tal:b></h2>
            <ul id="links-${id}"></ul>
        </div>
    </div>
</metal:file_details>

<metal:file_links define-macro="file-links" i18n:domain="onegov.org">
    <ul class="search-results">
        <tal:b repeat="result file.links">
            <li class="search-result-${result.es_type_name}" tal:condition="result">
                <tal:b
                    define="macro 'search_result_{}'.format(result.__tablename__); tenant_macro 'search_result_{}_{}'.format(result.__tablename__, request.app.application_id.split('/')[-1])"
                    metal:use-macro="layout.macros[tenant_macro]|layout.macros[macro]|layout.macros['search_result_default']"
                />
            </li>
        </tal:b>
    </ul>
</metal:file_links>

<metal:sign_result define-macro="sign_result" i18n:domain="onegov.org">
    <metal:b use-macro="layout.macros['consume_messages']" />
    <metal:b use-macro="layout.macros['signature_status']" />
</metal:sign_result>

<metal:signature_status define-macro="signature_status" i18n:domain="onegov.org">
    <tal:b condition="file.reference.content_type == 'application/pdf'" define="may_sign request.app.enable_yubikey and request.is_admin">
        <div tal:condition="file.signed" class="is-signed signature-status">
            <i class="fa fa-fw fa-lock" aria-hidden="true"></i>

            <span i18n:translate>
                Digital seal applied by <tal:b i18n:name="signee">${layout.get_user_title(file.signature_metadata['signee'])}</tal:b>
                on <span class="nowrap" i18n:name="date">${layout.format_date(layout.parse_isodate(file.signature_metadata['timestamp']), 'datetime_long')}</span>
            </span>
        </div>
        <tal:b condition="not file.signed and may_sign">
            <a tal:condition="not:file.signed" class="is-not-signed signature-status"
                role="button"
                data-prompt="Please enter your yubikey to apply a digital seal to this file"
                data-prompt-ok="Sign"
                data-prompt-cancel="Cancel"
                data-prompt-placeholder="Plug your YubiKey into a USB slot and press it."
                data-prompt-info="Published documents with a digital seal can be discovered through the site-search and in the list of documents with a digital seal. This action will be logged and cannot be undone."
                data-prompt-success="(function(value) {
                    var url = '${request.link(file, 'sign')}?csrf-token=${layout.csrf_token}';
                    var elt = $(this);
                    var row = elt.closest('tr');

                    elt.toggleClass('signing', true);
                    window.elt = elt;

                    jQuery.post(url, {'token': value}, function(data) {
                        var target = elt.closest('.signature-status').parent();
                        target.html(data);
                        processCommonNodes(target);
                        row.prev().addClass('signed');
                    }).always(function() {
                        elt.toggleClass('signing', false);
                    });
                })"
                i18n:attributes="data-prompt;data-prompt-ok;data-prompt-cancel;data-prompt-info;data-prompt-placeholder"
            >
                <i class="fa fa-fw fa-unlock" aria-hidden="true"></i>

                <span i18n:translate class="hide-on-hover">
                    Without digital seal
                </span>

                <span i18n:translate class="show-on-hover">
                    Apply digital seal now
                </span>
            </a>
        </tal:b>
        <tal:b condition="not file.signed and not may_sign">
            <div class="is-not-signed signature-status">
                <i class="fa fa-fw fa-lock" aria-hidden="true"></i>

                <span i18n:translate class="hide-on-hover">
                    Without digital seal
                </span>

                <span i18n:translate class="show-on-hover">
                    You are not authorised to apply digital seals to documents
                </span>
            </div>
        </tal:b>
    </tal:b>
</metal:signature_status>

<metal:file_info define-macro="file-info" i18n:domain="onegov.org">
    <tal:b define="
        file_number file.number|file.id;
        file_upload file.upload_date|file.created
    ">
        <tr class="file-info ${'signed' if file.signed else ''}">
            <td>
                ${file.name}
            </td>
            <td>
                <a id="button-${file_number}" data-toggle="#details-${file_number}" class="untoggled">
                    <i class="fa fa-chevron-down" aria-hidden="true"></i>
                </a>
            </td>
            <td>
                ${extension(file)}
            </td>
            <td>
                ${format_date(file_upload)}
            </td>
        </tr>
        <tr id="details-${file_number}" style="display: none;">
            <td colspan="4">
                <div ic-trigger-from="#button-${file_number}"
                     ic-trigger-on="click once"
                     ic-get-from="${actions_url(file.id)}">
                </div>
            </td>
        </tr>
        <tr style="display: none"></tr> <!--! keeps odd/even shading on track -->
    </tal:b>
</metal:file_info>

<metal:uploaded_image define-macro="uploaded_image" i18n:domain="onegov.org">
    <li id="image-${index}" class="image-box">
        <a href="${image.url}" tal:attributes="target layout.file_link_target" tal:condition="image" class="editable-alt" data-note-update-url="${image.extra}">
            <img tal:condition="image.alt" data-src="${image.src}" class="lazyload static-alt" alt="${image.alt}" width="${image.width}" height="${image.height}" />
            <img tal:condition="not:image.alt" data-src="${image.src}" class="lazyload missing-alt static-alt" alt="Click to add a description" i18n:attributes="alt" width="${image.width}" height="${image.height}"/>
        </a>
        <a class="delete confirm"
           ic-delete-from="${image.url}?csrf-token=${layout.csrf_token}"
           ic-on-success="$('#image-${index}').remove();"
           data-confirm="Do you really want to delete the image?"
           data-confirm-yes="Delete Image"
           data-confirm-no="Cancel"
           i18n:attributes="data-confirm;data-confirm-yes;data-confirm-no"><i class="fa fa-times" aria-hidden="true"></i></a>
    </li>
</metal:uploaded_image>

<metal:digest_result define-macro="digest_result" i18n:domain="onegov.org">
    <div class="digest-result digest-${is_known and 'is-known' or 'is-not-known'}" tal:switch="is_known">
        <tal:b case="True">
            <div>
                <i class="fa fa-fw fa-check-circle" aria-hidden="true"></i>
            </div>
            <div i18n:translate>
                <span i18n:name="name">${name}</span>
                was provided with a digital seal on
                <span i18n:name="date">${layout.format_date(date, 'datetime')}</span>
            </div>
        </tal:b>
        <tal:b case="False">
            <div>
                <i class="fa fa-fw fa-exclamation-circle" aria-hidden="true"></i>
            </div>
            <div i18n:translate>
                <span i18n:name="name">${name}</span>
                is not in our database
            </div>
        </tal:b>
    </div>
</metal:digest_result>

<metal:publication define-macro="publication" i18n:domain="onegov.org">
    <div tal:define="file_link link(publication)" class="publication-item">
        <a class="file-preview" href="${file_link}">
            <img class="pdf-preview lazyload" data-no-alt data-src="${link(publication, name='medium')}">
        </a>

        <ul class="dense">
            <li class="publication-title">
                <a href="${file_link}">${name_without_extension(publication.name)}</a>
            </li>
            <li class="publication-date">
                <span>
                    ${layout.format_date(publication.created, 'date')}
                </span>
            </li>
            <li tal:define="pages publication.stats.get('pages') or 0" class="publication-stats">
                <span>
                    <i class="fa fa-fw fa-file-text-o" aria-hidden="true"></i>
                    <tal:b tal:condition="pages == 0 or pages > 1" i18n:translate>
                        <tal:b i18n:name="count">${pages}</tal:b> pages
                    </tal:b>
                    <tal:b tal:condition="pages == 1" i18n:translate>
                        1 page
                    </tal:b>
                </span>
            </li>
        </ul>
    </div>
</metal:publication>

<metal:holidays define-macro="holidays" i18n:domain="onegov.org">
    <ul class="holidays">
        <li tal:repeat="(holiday, descriptions) holidays.all(year)">
            ${layout.format_date(holiday, 'date')} - ${', '.join(descriptions)}
        </li>
    </ul>
</metal:holidays>

<metal:tickets_table_row define-macro="tickets_table_row" i18n:domain="onegov.org">
    <tr tal:define="ticket_url request.link(ticket); has_access request.is_manager_for_model(ticket)"
            class="ticket ticket-handler-${ticket.handler_code} ticket-row-state-${ticket.state}" tal:attributes="data-url action_link(ticket) if has_access else nothing">
        <tal:block tal:condition="has_access">
          <td class="ticket-number-plain">
              <a href="${ticket_url}">
                  ${ticket.number}
              </a>
          </td>
          <td class="ticket-group" colspan="2">
              <div>${translate(ticket.group)}</div>
              <div>${ticket.title}</div>
              <div>${ticket.subtitle}</div>
              <tal:b define="payment ticket.handler.payment" tal:condition="payment">
                  <div class="payment-state payment-state-${payment.state}">
                      ${layout.format_number(payment.amount)} ${payment.currency}
                  </div>
              </tal:b>
          </td>
          <td class="ticket-date">
              ${layout.format_date(ticket.created, 'relative')}
          </td>
          <td class="ticket-action" tal:condition="ticket.state == 'open'" colspan="2">
              <a class="ticket-accept ticket-button" href="${request.link(ticket, 'accept')}" i18n:translate>
                  Accept
              </a>
          </td>
          <td class="ticket-state" tal:condition="ticket.state != 'open'">
              <tal:b condition="ticket.state == 'pending'" i18n:translate>
                  Pending
              </tal:b>
              <tal:b condition="ticket.state == 'closed'" i18n:translate>
                  Closed
              </tal:b>
          </td>
          <td class="ticket-user" tal:condition="ticket.state != 'open'">
              <metal:identicon tal:condition="ticket.user" use-macro="layout.macros.identicon" tal:define="initials ticket.user.initials|None; username ticket.user.username|None" />
          </td>
      </tal:block>
      <tal:block tal:condition="not has_access">
        <td class="ticket-number-plain" colspan="6">
            ${ticket.number}
        </td>
      </tal:block>
      <td tal:condition="archive_tickets" class="archive-tickets">
          <input tal:condition="has_access" type="checkbox">
      </td>
  </tr>
</metal:tickets_table_row>

<metal:open_graph_tags define-macro="open_graph_tags">
<meta property="og:title" tal:attributes="content og_title" tal:define="og_title layout.og_title | title | None" tal:condition="og_title" />
<meta property="og:type" tal:attributes="content layout.og_type" />
<meta property="og:url" tal:attributes="content layout.og_url" />
<tal:b tal:define="og_image layout.og_image" tal:condition="og_image">
<meta property="og:image" content="${layout.og_image_url}">
<meta property="og:image:secure_url" content="${layout.og_image_url}">
<meta property="og:image:alt" content="${layout.og_image_alt}">
<meta property="og:image:type" content="${layout.og_image_type}" />
<meta property="og:image:width" tal:condition="layout.og_image_width" content="${layout.og_image_width}" />
<meta property="og:image:height" tal:condition="layout.og_image_height" content="${layout.og_image_height}" />
</tal:b>

<meta property="og:site_name" tal:attributes="content site_name" tal:define="site_name layout.og_site_name" tal:condition="site_name">
<meta property="og:description" tal:attributes="content og_description" tal:define="og_description layout.og_description" tal:condition="og_description">
<meta property="og:locale" tal:attributes="content layout.og_locale">
<meta tal:repeat="locale layout.og_locale_alternate" property="og:locale:alternate" tal:attributes="content locale">
</metal:open_graph_tags>

<metal:modal define-macro="modal">
<div id="${modal_id}" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <tal:block metal:define-slot="modal_content"></tal:block>
    <a class="close-reveal-modal" aria-label="Close" i18n:attributes="aria-label">&#215;</a>
</div>
</metal:modal>

<metal:pageref define-macro="pageref" i18n:domain="onegov.org">
    <div
        class="pageref"
        title="Copy to clipboard"
        i18n:attributes="title"
        data-clipboard-action="copy"
        data-clipboard-text="${request.url + '#' + pageref_id}"
        tal:condition="not: layout.org.disable_page_refs"
    ></div>
</metal:pageref>

<metal:invoice_items define-macro="invoice_items" i18n:domain="onegov.org">
    <table class="invoice-items" tal:define="total_amount total_amount|None; total_vat total_vat|None; total_paid total_paid|False; show_vat total_vat or any(item.vat for items in invoice_items.values() for item in items); show_quantity any(item.quantity != 1.0 for items in invoice_items.values() for item in items); item_actions item_actions|None; show_payment_state show_payment_state|False">
        <thead>
            <tr>
                <th i18n:translate>Booking Text</th>
                <th tal:condition="show_quantity" i18n:translate>Unit</th>
                <th tal:condition="show_quantity" i18n:translate>Quantity</th>
                <th tal:condition="show_vat" i18n:translate>VAT Rate</th>
                <th tal:condition="show_vat" i18n:translate>VAT</th>
                <th i18n:translate>Amount</th>
                <th tal:condition="item_actions">
                    <span i18n:translate class="show-for-sr">Actions</span>
                </th>
            </tr>
        </thead>
        <tal:b tal:repeat="(group, items) invoice_items.items()">
            <thead>
                <tr class="group">
                    <th tal:switch="group" colspan="${2 + (2 if show_quantity else 0) + (2 if show_vat else 0) + (1 if item_actions else 0)}">
                        <tal:b tal:case="'reservation'" i18n:translate>
                            Reservations
                        </tal:b>
                        <tal:b tal:case="'submission'" i18n:translate>
                            Submission
                        </tal:b>
                        <tal:b tal:case="'form'" i18n:translate>
                            Selected Options
                        </tal:b>
                        <tal:b tal:case="'manual'" i18n:translate>
                            Discounts / Surcharges
                        </tal:b>
                        <tal:b tal:case="'migration'" i18n:translate>
                            Lump sum
                        </tal:b>
                        <tal:b tal:case="default">
                            ${item.group}
                        </tal:b>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tal:b tal:repeat="item items">
                    <tr tal:define="groupid hash(str(item.group) + str(repeat.item.index)); paid total_paid or item.paid|False" tal:attributes="class ('paid' if paid else 'unpaid') if show_payment_state else None">
                        <td>
                            ${item.text}
                        </td>
                        <td tal:condition="show_quantity" class="unit">${'{:.2f}'.format(item.unit)}</td>
                        <td tal:condition="show_quantity" class="quantity">${'{:.2f}'.format(item.quantity)}</td>
                        <td tal:condition="show_vat" class="vat-rate">${'{:.1f}%'.format(item.vat_rate or 0.0)}</td>
                        <td tal:condition="show_vat" class="vat">${'{:.2f}'.format(item.vat)}</td>
                        <td class="amount">
                            ${'{:.2f}'.format(item.amount)}
                            <tal:b tal:condition="show_payment_state and paid">
                                <i class="fa ${item.source in ('datatrans', 'stripe_connect', 'worldline_saferpay') and 'fa-credit-card' or 'fa-check-circle'}" aria-hidden="true" title="Paid" i18n:attributes="title"></i>
                                <span i18n:translate class="show-for-sr">Paid</span>
                            </tal:b>
                            <tal:b tal:condition="show_payment_state and not paid">
                                <i class="fa fa-exclamation-triangle" aria-hidden="true" title="Unpaid" i18n:attributes="title"></i>
                                <span i18n:translate class="show-for-sr">Unpaid</span>
                            </tal:b>
                        </td>
                        <td class="actions" tal:condition="item_actions">
                            <tal:b tal:repeat="action actions" tal:define="actions item_actions(item)">
                                ${action(layout)}
                            </tal:b>
                        </td>
                    </tr>
                </tal:b>
            </tbody>
        </tal:b>
        <tfoot tal:condition="total_amount is not None">
            <tr class="total${(' paid' if total_paid else ' unpaid') if show_payment_state else ''}">
                <td i18n:translate>Total</td>
                <td tal:condition="show_quantity" class="unit"></td>
                <td tal:condition="show_quantity" class="quantity"></td>
                <td tal:condition="show_vat" class="vat-rate"></td>
                <td tal:condition="show_vat" class="vat">
                    ${'{:.2f}'.format(total_vat)}
                </td>
                <td class="amount">
                    ${'{:.2f}'.format(total_amount)}
                    <tal:b tal:condition="show_payment_state and total_paid">
                        <i class="fa fa-check-circle" aria-hidden="true" title="Paid" i18n:attributes="title"></i>
                        <span i18n:translate class="show-for-sr">Paid</span>
                    </tal:b>
                    <tal:b tal:condition="show_payment_state and not total_paid">
                        <i class="fa fa-exclamation-triangle" aria-hidden="true" title="Unpaid" i18n:attributes="title"></i>
                        <span i18n:translate class="show-for-sr">Unpaid</span>
                    </tal:b>
                </td>
                <td tal:condition="item_actions"></td>
            </tr>
        </tfoot>
    </table>
</metal:invoice_items>

<metal:display_results define-macro="display_results" i18n:domain="onegov.org">
    <tal:b tal:condition="not submission_count" i18n:translate="">No submissions yet.</tal:b>
    <b tal:condition="submission_count"><tal:b i18n:translate="">Number of participants</tal:b>: ${submission_count}</b>
    <tal:b tal:repeat="field fields" tal:condition="submission_count">
        <hr>
        <h3 id="${field.id}">${field.label.text}</h3>
        <p tal:condition="field.type not in aggregated">
            <tal:b tal:condition="field.type != 'TextAreaField'">
                "${'", "'.join(results.get(field.id, []))}"
            </tal:b>
            <tal:b tal:condition="field.type == 'TextAreaField'">
                <p tal:repeat="value results.get(field.id, [])">"${value}"</p>
            </tal:b>
        </p>
        <tal:b tal:condition="field.type in aggregated">
            <div class="chart-wrap" tal:condition="field.type == 'MultiCheckboxField'">
                <div tal:define="maximum max(results[field.id].values())" class="grid horizontal">
                    <tal:b tal:repeat="choice field.choices">
                        <tal:b tal:define="val results[field.id][choice[0]]; max max(maximum, 1)">
                            <div class="bar" style="--bar-value:${val/max*100}%;" data-name="${choice[1]} (${val})" title="${choice[1]} (${val})"></div>
                        </tal:b>
                    </tal:b>
                </div>
            </div>
            <div class="chart-wrap" tal:condition="field.type == 'RadioField'">
                <div tal:define="sum sum(results[field.id].values())" class="grid horizontal">
                    <tal:b tal:repeat="choice field.choices" >
                        <tal:b tal:define="val results[field.id][choice[0]]">
                            <div class="bar" style="--bar-value:${val/sum*100}%;" data-name="${choice[1]} (${val}/${sum})" title="${choice[1]} (${val}/${sum})"></div>
                        </tal:b>
                    </tal:b>
                </div>
            </div>
        </tal:b>
    </tal:b>
</metal:display_results>
