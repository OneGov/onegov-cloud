<div metal:use-macro="layout.base" i18n:domain="onegov.org">
    <tal:b metal:fill-slot="title">
        ${title}
    </tal:b>
    <tal:b metal:fill-slot="content">

        <div class="row" tal:define="show_vat any(item.vat for item in invoice.items); show_quantity any(item.quantity != 1.0 for item in invoice.items); total_paid invoice.paid">
            <div class="columns small-12 medium-8">
                <table class="invoice-items">
                    <thead>
                        <tr>
                            <th i18n:translate>Booking Text</th>
                            <th tal:condition="show_quantity" i18n:translate>Unit</th>
                            <th tal:condition="show_quantity" i18n:translate>Quantity</th>
                            <th tal:condition="show_vat" i18n:translate>VAT Rate</th>
                            <th tal:condition="show_vat" i18n:translate>VAT</th>
                            <th i18n:translate>Amount</th>
                            <th>
                                <span i18n:translate class="show-for-sr">Actions</span>
                            </th>
                        </tr>
                    </thead>
                    <tal:b tal:repeat="(group, items) invoice_items.items()">
                        <thead>
                            <tr class="group">
                                <th tal:switch="group" colspan="${3 + (2 if show_quantity else 0) + (2 if show_vat else 0)}">
                                    <tal:b tal:case="'reservation'" i18n:translate>
                                        Reservations
                                    </tal:b>
                                    <tal:b tal:case="'submission'" i18n:translate>
                                        Submission
                                    </tal:b>
                                    <tal:b tal:case="'form'" i18n:translate>
                                        Selected Options
                                    </tal:b>
                                    <tal:b tal:case="'manual'" i18n:translate>
                                        Discounts / Surcharges
                                    </tal:b>
                                    <tal:b tal:case="'migration'" i18n:translate>
                                        Lump sum
                                    </tal:b>
                                    <tal:b tal:case="default">
                                        ${item.group}
                                    </tal:b>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tal:b tal:repeat="item items">
                                <tr class="${paid and 'paid' or 'unpaid'}" tal:define="groupid hash(str(item.group) + str(repeat.item.index)); paid total_paid or item.paid">
                                    <td>
                                        ${item.text}
                                    </td>
                                    <td tal:condition="show_quantity" class="unit">${'{:.2f}'.format(item.unit)}</td>
                                    <td tal:condition="show_quantity" class="quantity">${'{:.2f}'.format(item.quantity)}</td>
                                    <td tal:condition="show_vat" class="vat-rate">${'{:.2f}%'.format(item.vat_rate or 0.0)}</td>
                                    <td tal:condition="show_vat" class="vat">${'{:.2f}'.format(item.vat)}</td>
                                    <td class="amount">
                                        ${'{:.2f}'.format(item.amount)}
                                        <tal:b tal:condition="paid">
                                            <i class="fa ${item.source in ('datatrans', 'stripe_connect', 'worldline_saferpay') and 'fa-credit-card' or 'fa-check-circle'}" aria-hidden="true" title="Paid" i18n:attributes="title"></i>
                                            <span i18n:translate class="show-for-sr">Paid</span>
                                        </tal:b>
                                        <tal:b tal:condition="not:paid">
                                            <i class="fa fa-exclamation-triangle" aria-hidden="true" title="Unpaid" i18n:attributes="title"></i>
                                            <span i18n:translate class="show-for-sr">Unpaid</span>
                                        </tal:b>
                                    </td>
                                    <td tal:define="actions item_actions(item)" class="actions">
                                        <tal:b tal:repeat="action actions">
                                            ${action(layout)}
                                        </tal:b>
                                    </td>
                                </tr>
                            </tal:b>
                        </tbody>
                    </tal:b>
                    <tfoot>
                        <tr class="total ${total_paid and 'paid' or 'unpaid'}">
                            <td i18n:translate>Total</td>
                            <td tal:condition="show_quantity" class="unit"></td>
                            <td tal:condition="show_quantity" class="quantity"></td>
                            <td tal:condition="show_vat" class="vat-rate"></td>
                            <td tal:condition="show_vat" class="vat">
                                ${'{:.2f}'.format(invoice.total_vat)}
                            </td>
                            <td class="amount">
                                ${'{:.2f}'.format(invoice.total_amount)}
                                <tal:b tal:condition="total_paid">
                                    <i class="fa fa-check-circle" aria-hidden="true" title="Paid" i18n:attributes="title"></i>
                                    <span i18n:translate class="show-for-sr">Paid</span>
                                </tal:b>
                                <tal:b tal:condition="not:total_paid">
                                    <i class="fa fa-exclamation-triangle" aria-hidden="true" title="Unpaid" i18n:attributes="title"></i>
                                    <span i18n:translate class="show-for-sr">Unpaid</span>
                                </tal:b>
                            </td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        <div class="row" tal:condition="ticket.handler.payment">
            <div class="columns small-12 medium-8">
                <tal:b tal:define="payment ticket.handler.payment; show_vat ticket.handler.show_vat" metal:use-macro="layout.macros['payment']" />
                <tal:b condition="payment_button" replace="payment_button(layout)" />
            </div>
        </div>
    </tal:b>
</div>
